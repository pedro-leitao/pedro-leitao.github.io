<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.23">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2025-06-09">
<meta name="description" content="A quick introduction to Apache Spark, its components, and how to use PySpark for data processing tasks.">

<title>A Primer on Spark for Data Processing – Pedro Leitão</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../_static/logo.jpg" rel="icon" type="image/jpeg">
<script src="../../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-ce48a3f02a1a94fca2583af14ebdcdba.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap-4dff25cae16b2fde054c749d4dd18e4b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="../../../site_libs/quarto-contrib/nutshell-1.0.7/nutshell.js"></script>
<script src="../../../site_libs/quarto-contrib/nutshell-1.0.7/nutshell_options.js"></script>
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>

      .quarto-title-block .quarto-title-banner {
        background-image: url(../../../_static/banner-waves-partial.jpg);
background-size: cover;
      }
</style>
<meta name="mermaid-theme" content="default">
<script src="../../../site_libs/quarto-diagram/mermaid.min.js"></script>
<script src="../../../site_libs/quarto-diagram/mermaid-init.js"></script>
<link href="../../../site_libs/quarto-diagram/mermaid.css" rel="stylesheet">
<script data-collect-dnt="true" async="" src="https://scripts.simpleanalyticscdn.com/latest.js"></script>


<link rel="stylesheet" href="../../../styles.css">
<meta property="og:title" content="A Primer on Spark for Data Processing – Pedro Leitão">
<meta property="og:description" content="A quick introduction to Apache Spark, its components, and how to use PySpark for data processing tasks.">
<meta property="og:image" content="https://pedroleitao.nl/_static/logo.jpg">
<meta property="og:site_name" content="Pedro Leitão">
<meta name="twitter:title" content="A Primer on Spark for Data Processing – Pedro Leitão">
<meta name="twitter:description" content="A quick introduction to Apache Spark, its components, and how to use PySpark for data processing tasks.">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../../_static/logo.jpg" alt="" class="navbar-logo">
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../index.html"> 
<span class="menu-text">Bio</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../posts.html"> 
<span class="menu-text">All posts</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../experiments.html"> 
<span class="menu-text">Experiments</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../thoughts.html"> 
<span class="menu-text">Thoughts</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../howtos.html"> 
<span class="menu-text">Howto’s</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../python-for-students.html"> 
<span class="menu-text">Python for Students</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../dashboards.html"> 
<span class="menu-text">Dashboards</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/pedro-leitao"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://linkedin.com/in/nunoleitao"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../../posts.xml"> <i class="bi bi-rss" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">A Primer on Spark for Data Processing</h1>
            <p class="subtitle lead">a five minute introduction to Spark and PySpark</p>
                  <div>
        <div class="description">
          A quick introduction to Apache Spark, its components, and how to use PySpark for data processing tasks.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">HowTo</div>
                <div class="quarto-category">Data Processing</div>
                <div class="quarto-category">Apache Spark</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">June 9, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#the-spark-architecture" id="toc-the-spark-architecture" class="nav-link active" data-scroll-target="#the-spark-architecture">The Spark architecture</a></li>
  <li><a href="#map-reduce" id="toc-map-reduce" class="nav-link" data-scroll-target="#map-reduce">Map-Reduce</a></li>
  <li><a href="#spark-dataframes-and-spark-sql" id="toc-spark-dataframes-and-spark-sql" class="nav-link" data-scroll-target="#spark-dataframes-and-spark-sql">Spark DataFrames and Spark SQL</a></li>
  <li><a href="#connecting-to-spark" id="toc-connecting-to-spark" class="nav-link" data-scroll-target="#connecting-to-spark">Connecting to Spark</a>
  <ul class="collapse">
  <li><a href="#a-more-complex-example" id="toc-a-more-complex-example" class="nav-link" data-scroll-target="#a-more-complex-example">A more complex example</a></li>
  <li><a href="#hadoop-and-spark" id="toc-hadoop-and-spark" class="nav-link" data-scroll-target="#hadoop-and-spark">Hadoop and Spark</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p>A mainstay in big data processing, <a href="https://en.wikipedia.org/wiki/Apache_Spark">:link Apache Spark</a> is an open-source distributed computing system that provides an interface for programming entire clusters with implicit data parallelism and fault tolerance. It is designed to be fast for both batch and streaming data processing, and is a tool which any data scientist or engineer should be familiar with.</p>
<p>This primer will cover the basics of Spark, its components, and how to use PySpark for data processing tasks. It is intended for those who are new to Spark or need a quick refresher.</p>
<section id="the-spark-architecture" class="level2">
<h2 class="anchored" data-anchor-id="the-spark-architecture">The Spark architecture</h2>
<p>Apache Spark is built around a master-worker architecture. The <em>master</em> node coordinates the cluster, while <em>worker</em> nodes execute tasks in parallel. Each worker runs one or more <em>executors</em>, which are JVM processes that handle the actual computation and store data in memory.</p>
<p>The master node manages the cluster resources and schedules tasks, while the workers execute the tasks assigned to them. The Spark driver program runs on the master node and is responsible for creating the <code>SparkContext</code>, which is the entry point to using Spark.</p>
<p>The <code>DAG Scheduler</code> is responsible for breaking down the job into smaller tasks and scheduling them across the available executors. <code>The Task Scheduler</code> then assigns these tasks to the executors, which run them in parallel.</p>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">graph LR
  subgraph Driver
    SC[SparkContext]
    DAG[DAG Scheduler]
    TS[Task Scheduler]
  end

  subgraph ClusterManager
    CM[Cluster Manager]
  end

  subgraph Worker_Nodes
    W1[Worker 1]
    W2[Worker 2]
  end

  subgraph Executors
    E1[Executor 1]
    E2[Executor 2]
    E3[Executor 3]
    E4[Executor 4]
  end

  SC --&gt; DAG --&gt; TS --&gt; CM
  CM --&gt; W1 &amp; W2

  W1 --&gt; E1 &amp; E2
  W2 --&gt; E3 &amp; E4

  E1 --&gt; Task1[Task]
  E2 --&gt; Task2[Task]
  E3 --&gt; Task3[Task]
  E4 --&gt; Task4[Task]
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
</section>
<section id="map-reduce" class="level2">
<h2 class="anchored" data-anchor-id="map-reduce">Map-Reduce</h2>
<p>MapReduce is a programming paradigm for processing large datasets in parallel by splitting a job into a map stage, where each input record is transformed into intermediate key-value pairs—and a reduce stage, where all values for each key are aggregated into a final result. Its fault-tolerance comes from writing intermediate data to disk and re-running failed tasks, but that disk I/O between stages makes multi-stage or iterative workflows comparatively slow.</p>
<p>Apache Spark extends the MapReduce model with in-memory <a href="https://spark.apache.org/docs/latest/rdd-programming-guide.html#resilient-distributed-datasets-rdds">Resilient Distributed Datasets</a> (RDDs) and a Directed Acyclic Graph (DAG) execution engine. Spark lazily builds a DAG of transformations, pipelines narrow dependencies in memory (spilling to disk only when necessary), and applies whole-stage optimizations across multiple steps. The result is often an order-of-magnitude speed-up (10x or more in real-world benchmarks) for MapReduce style jobs, especially iterative algorithms like machine learning and graph processing. On top of RDDs, Spark’s higher-level DataFrame and Dataset APIs (powered by the Catalyst optimizer and Tungsten execution engine) let you express joins, aggregations, and SQL queries more succinctly and efficiently than raw MapReduce code.</p>
</section>
<section id="spark-dataframes-and-spark-sql" class="level2">
<h2 class="anchored" data-anchor-id="spark-dataframes-and-spark-sql">Spark DataFrames and Spark SQL</h2>
<p>Spark DataFrames are immutable, distributed collections of data organized into named columns. Think of them like tables in a relational database but spread across your cluster. Under the hood they’re built on RDDs but come with the Catalyst optimizer and Tungsten execution engine, which automatically plan and optimize your queries so you get far better performance than hand-rolled RDD code.</p>
<p>Transformations are <em>lazy</em>, meaning Spark builds a logical plan for your operations and only kicks off computation when you call an action (e.g.&nbsp;<code>show()</code>), which helps minimize I/O and shuffle overhead.</p>
<p>Here’s a self contained example of using Spark DataFrames:</p>
<div id="cd84286b" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cd84286b"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cd84286b-1"><a href="#cd84286b-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cd84286b-2"><a href="#cd84286b-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cd84286b-3"><a href="#cd84286b-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cd84286b-4"><a href="#cd84286b-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Set environment variables for PySpark</span></span>
<span id="cd84286b-5"><a href="#cd84286b-5" aria-hidden="true" tabindex="-1"></a>os.environ[<span class="st">"PYSPARK_DRIVER_PYTHON"</span>] <span class="op">=</span> sys.executable</span>
<span id="cd84286b-6"><a href="#cd84286b-6" aria-hidden="true" tabindex="-1"></a>os.environ[<span class="st">"PYSPARK_PYTHON"</span>] <span class="op">=</span> sys.executable</span>
<span id="cd84286b-7"><a href="#cd84286b-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cd84286b-8"><a href="#cd84286b-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql <span class="im">import</span> SparkSession</span>
<span id="cd84286b-9"><a href="#cd84286b-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql.functions <span class="im">import</span> col</span>
<span id="cd84286b-10"><a href="#cd84286b-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cd84286b-11"><a href="#cd84286b-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize Spark</span></span>
<span id="cd84286b-12"><a href="#cd84286b-12" aria-hidden="true" tabindex="-1"></a>spark <span class="op">=</span> SparkSession.builder.appName(<span class="st">"InMemoryDataFrameExample"</span>).getOrCreate()</span>
<span id="cd84286b-13"><a href="#cd84286b-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cd84286b-14"><a href="#cd84286b-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample data as a list of tuples</span></span>
<span id="cd84286b-15"><a href="#cd84286b-15" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> [</span>
<span id="cd84286b-16"><a href="#cd84286b-16" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"Paul"</span>, <span class="dv">36</span>, <span class="st">"London"</span>),</span>
<span id="cd84286b-17"><a href="#cd84286b-17" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"Antonio"</span>, <span class="dv">23</span>, <span class="st">"Madrid"</span>),</span>
<span id="cd84286b-18"><a href="#cd84286b-18" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"Francois"</span>, <span class="dv">45</span>, <span class="st">"Paris"</span>),</span>
<span id="cd84286b-19"><a href="#cd84286b-19" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"Katherine"</span>, <span class="dv">29</span>, <span class="st">"Berlin"</span>),</span>
<span id="cd84286b-20"><a href="#cd84286b-20" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"Sofia"</span>, <span class="dv">32</span>, <span class="st">"Rome"</span>),</span>
<span id="cd84286b-21"><a href="#cd84286b-21" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"Yuki"</span>, <span class="dv">28</span>, <span class="st">"Tokyo"</span>),</span>
<span id="cd84286b-22"><a href="#cd84286b-22" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"Amina"</span>, <span class="dv">41</span>, <span class="st">"Cairo"</span>),</span>
<span id="cd84286b-23"><a href="#cd84286b-23" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"Liam"</span>, <span class="dv">34</span>, <span class="st">"Dublin"</span>),</span>
<span id="cd84286b-24"><a href="#cd84286b-24" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"Olivia"</span>, <span class="dv">30</span>, <span class="st">"Sydney"</span>),</span>
<span id="cd84286b-25"><a href="#cd84286b-25" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"Noah"</span>, <span class="dv">38</span>, <span class="st">"Toronto"</span>),</span>
<span id="cd84286b-26"><a href="#cd84286b-26" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cd84286b-27"><a href="#cd84286b-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cd84286b-28"><a href="#cd84286b-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Define column names</span></span>
<span id="cd84286b-29"><a href="#cd84286b-29" aria-hidden="true" tabindex="-1"></a>columns <span class="op">=</span> [<span class="st">"name"</span>, <span class="st">"age"</span>, <span class="st">"city"</span>]</span>
<span id="cd84286b-30"><a href="#cd84286b-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cd84286b-31"><a href="#cd84286b-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Create DataFrame from in-memory data</span></span>
<span id="cd84286b-32"><a href="#cd84286b-32" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> spark.createDataFrame(data, schema<span class="op">=</span>columns)</span>
<span id="cd84286b-33"><a href="#cd84286b-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cd84286b-34"><a href="#cd84286b-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Transform: select name and age where age &gt; 30</span></span>
<span id="cd84286b-35"><a href="#cd84286b-35" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> df.select(<span class="st">"name"</span>, <span class="st">"age"</span>).<span class="bu">filter</span>(col(<span class="st">"age"</span>) <span class="op">&gt;</span> <span class="dv">30</span>)</span>
<span id="cd84286b-36"><a href="#cd84286b-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cd84286b-37"><a href="#cd84286b-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Trigger execution and display</span></span>
<span id="cd84286b-38"><a href="#cd84286b-38" aria-hidden="true" tabindex="-1"></a>result.show()</span>
<span id="cd84286b-39"><a href="#cd84286b-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cd84286b-40"><a href="#cd84286b-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean up</span></span>
<span id="cd84286b-41"><a href="#cd84286b-41" aria-hidden="true" tabindex="-1"></a>spark.stop()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>+--------+---+
|    name|age|
+--------+---+
|    Paul| 36|
|Francois| 45|
|   Sofia| 32|
|   Amina| 41|
|    Liam| 34|
|    Noah| 38|
+--------+---+
</code></pre>
</div>
</div>
<p>And here’s the equivalent, but instead of using a DataFrame, we use Spark SQL:</p>
<div id="8277307d" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="8277307d"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="8277307d-1"><a href="#8277307d-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="8277307d-2"><a href="#8277307d-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="8277307d-3"><a href="#8277307d-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="8277307d-4"><a href="#8277307d-4" aria-hidden="true" tabindex="-1"></a><span class="co"># point both driver and executors at the same Python</span></span>
<span id="8277307d-5"><a href="#8277307d-5" aria-hidden="true" tabindex="-1"></a>os.environ[<span class="st">"PYSPARK_DRIVER_PYTHON"</span>] <span class="op">=</span> sys.executable</span>
<span id="8277307d-6"><a href="#8277307d-6" aria-hidden="true" tabindex="-1"></a>os.environ[<span class="st">"PYSPARK_PYTHON"</span>] <span class="op">=</span> sys.executable</span>
<span id="8277307d-7"><a href="#8277307d-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="8277307d-8"><a href="#8277307d-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql <span class="im">import</span> SparkSession</span>
<span id="8277307d-9"><a href="#8277307d-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="8277307d-10"><a href="#8277307d-10" aria-hidden="true" tabindex="-1"></a>spark <span class="op">=</span> SparkSession.builder.appName(<span class="st">"InMemorySparkSQLExample"</span>).getOrCreate()</span>
<span id="8277307d-11"><a href="#8277307d-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="8277307d-12"><a href="#8277307d-12" aria-hidden="true" tabindex="-1"></a><span class="co"># -- same sample data --</span></span>
<span id="8277307d-13"><a href="#8277307d-13" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> [</span>
<span id="8277307d-14"><a href="#8277307d-14" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"Paul"</span>, <span class="dv">36</span>, <span class="st">"London"</span>),</span>
<span id="8277307d-15"><a href="#8277307d-15" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"Antonio"</span>, <span class="dv">23</span>, <span class="st">"Madrid"</span>),</span>
<span id="8277307d-16"><a href="#8277307d-16" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"Francois"</span>, <span class="dv">45</span>, <span class="st">"Paris"</span>),</span>
<span id="8277307d-17"><a href="#8277307d-17" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"Katherine"</span>, <span class="dv">29</span>, <span class="st">"Berlin"</span>),</span>
<span id="8277307d-18"><a href="#8277307d-18" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"Sofia"</span>, <span class="dv">32</span>, <span class="st">"Rome"</span>),</span>
<span id="8277307d-19"><a href="#8277307d-19" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"Yuki"</span>, <span class="dv">28</span>, <span class="st">"Tokyo"</span>),</span>
<span id="8277307d-20"><a href="#8277307d-20" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"Amina"</span>, <span class="dv">41</span>, <span class="st">"Cairo"</span>),</span>
<span id="8277307d-21"><a href="#8277307d-21" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"Liam"</span>, <span class="dv">34</span>, <span class="st">"Dublin"</span>),</span>
<span id="8277307d-22"><a href="#8277307d-22" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"Olivia"</span>, <span class="dv">30</span>, <span class="st">"Sydney"</span>),</span>
<span id="8277307d-23"><a href="#8277307d-23" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"Noah"</span>, <span class="dv">38</span>, <span class="st">"Toronto"</span>),</span>
<span id="8277307d-24"><a href="#8277307d-24" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="8277307d-25"><a href="#8277307d-25" aria-hidden="true" tabindex="-1"></a>columns <span class="op">=</span> [<span class="st">"name"</span>, <span class="st">"age"</span>, <span class="st">"city"</span>]</span>
<span id="8277307d-26"><a href="#8277307d-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="8277307d-27"><a href="#8277307d-27" aria-hidden="true" tabindex="-1"></a><span class="co"># create DataFrame and register as a temp view</span></span>
<span id="8277307d-28"><a href="#8277307d-28" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> spark.createDataFrame(data, schema<span class="op">=</span>columns)</span>
<span id="8277307d-29"><a href="#8277307d-29" aria-hidden="true" tabindex="-1"></a>df.createOrReplaceTempView(<span class="st">"people"</span>)</span>
<span id="8277307d-30"><a href="#8277307d-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="8277307d-31"><a href="#8277307d-31" aria-hidden="true" tabindex="-1"></a><span class="co"># run a SQL query</span></span>
<span id="8277307d-32"><a href="#8277307d-32" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> spark.sql(</span>
<span id="8277307d-33"><a href="#8277307d-33" aria-hidden="true" tabindex="-1"></a>    <span class="st">"""</span></span>
<span id="8277307d-34"><a href="#8277307d-34" aria-hidden="true" tabindex="-1"></a><span class="st">  SELECT name, age</span></span>
<span id="8277307d-35"><a href="#8277307d-35" aria-hidden="true" tabindex="-1"></a><span class="st">    FROM people</span></span>
<span id="8277307d-36"><a href="#8277307d-36" aria-hidden="true" tabindex="-1"></a><span class="st">   WHERE age &gt; 30</span></span>
<span id="8277307d-37"><a href="#8277307d-37" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="8277307d-38"><a href="#8277307d-38" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="8277307d-39"><a href="#8277307d-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="8277307d-40"><a href="#8277307d-40" aria-hidden="true" tabindex="-1"></a><span class="co"># show the results</span></span>
<span id="8277307d-41"><a href="#8277307d-41" aria-hidden="true" tabindex="-1"></a>result.show()</span>
<span id="8277307d-42"><a href="#8277307d-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="8277307d-43"><a href="#8277307d-43" aria-hidden="true" tabindex="-1"></a>spark.stop()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>+--------+---+
|    name|age|
+--------+---+
|    Paul| 36|
|Francois| 45|
|   Sofia| 32|
|   Amina| 41|
|    Liam| 34|
|    Noah| 38|
+--------+---+
</code></pre>
</div>
</div>
<p>Here we are using <code>df.createGlobalTempView("people")</code> to register the DataFrame as a temporary view, which allows us to run SQL queries against it. The <code>spark.sql()</code> method executes the SQL query and returns a new DataFrame with the results.</p>
</section>
<section id="connecting-to-spark" class="level1">
<h1>Connecting to Spark</h1>
<p>In the examples above, we used the <code>SparkSession.builder</code> to create a local Spark session. This is the entry point to using Spark and allows you to configure various settings, such as the application name, master URL, and more.</p>
<p>We can connect to remote executors running in a pre-configured Spark cluster running on a specific master URL (in this case, my own host where a Spark master is running). Here’s a minimal example.</p>
<div id="28486f8c" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="28486f8c"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="28486f8c-1"><a href="#28486f8c-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="28486f8c-2"><a href="#28486f8c-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="28486f8c-3"><a href="#28486f8c-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="28486f8c-4"><a href="#28486f8c-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Set environment variables for PySpark</span></span>
<span id="28486f8c-5"><a href="#28486f8c-5" aria-hidden="true" tabindex="-1"></a>os.environ[<span class="st">"PYSPARK_DRIVER_PYTHON"</span>] <span class="op">=</span> sys.executable</span>
<span id="28486f8c-6"><a href="#28486f8c-6" aria-hidden="true" tabindex="-1"></a>os.environ[<span class="st">"PYSPARK_PYTHON"</span>] <span class="op">=</span> sys.executable</span>
<span id="28486f8c-7"><a href="#28486f8c-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="28486f8c-8"><a href="#28486f8c-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql <span class="im">import</span> SparkSession</span>
<span id="28486f8c-9"><a href="#28486f8c-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="28486f8c-10"><a href="#28486f8c-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Point at the remote master</span></span>
<span id="28486f8c-11"><a href="#28486f8c-11" aria-hidden="true" tabindex="-1"></a>spark <span class="op">=</span> (</span>
<span id="28486f8c-12"><a href="#28486f8c-12" aria-hidden="true" tabindex="-1"></a>    SparkSession.builder.master(<span class="st">"spark://beast.Home:7077"</span>)</span>
<span id="28486f8c-13"><a href="#28486f8c-13" aria-hidden="true" tabindex="-1"></a>    .appName(<span class="st">"MinimalCounter"</span>)</span>
<span id="28486f8c-14"><a href="#28486f8c-14" aria-hidden="true" tabindex="-1"></a>    .getOrCreate()</span>
<span id="28486f8c-15"><a href="#28486f8c-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="28486f8c-16"><a href="#28486f8c-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="28486f8c-17"><a href="#28486f8c-17" aria-hidden="true" tabindex="-1"></a>sc <span class="op">=</span> spark.sparkContext</span>
<span id="28486f8c-18"><a href="#28486f8c-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="28486f8c-19"><a href="#28486f8c-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify connection and get some metadata</span></span>
<span id="28486f8c-20"><a href="#28486f8c-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Master URL:    "</span>, sc.master)</span>
<span id="28486f8c-21"><a href="#28486f8c-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"App ID:        "</span>, sc.applicationId)</span>
<span id="28486f8c-22"><a href="#28486f8c-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Spark Version: "</span>, sc.version)</span>
<span id="28486f8c-23"><a href="#28486f8c-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Default Parallelism: "</span>, sc.defaultParallelism)</span>
<span id="28486f8c-24"><a href="#28486f8c-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="28486f8c-25"><a href="#28486f8c-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Run a trivial job</span></span>
<span id="28486f8c-26"><a href="#28486f8c-26" aria-hidden="true" tabindex="-1"></a>count <span class="op">=</span> sc.<span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">100</span>).count()</span>
<span id="28486f8c-27"><a href="#28486f8c-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Count(1→99):   "</span>, count)</span>
<span id="28486f8c-28"><a href="#28486f8c-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="28486f8c-29"><a href="#28486f8c-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Tear down</span></span>
<span id="28486f8c-30"><a href="#28486f8c-30" aria-hidden="true" tabindex="-1"></a>spark.stop()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Master URL:     spark://beast.Home:7077
App ID:         app-20250709120239-0012
Spark Version:  4.0.0
Default Parallelism:  2</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Count(1→99):    99</code></pre>
</div>
</div>
<section id="a-more-complex-example" class="level2">
<h2 class="anchored" data-anchor-id="a-more-complex-example">A more complex example</h2>
<p>Now let’s work on a more complex example, while staying within the basics of Spark and PySpark. We’ll read a dataset from a remote URL, perform some transformations, and show the results.</p>
<p>In this example, we will read a CSV file containing housing data, perform some transformations, and display the results. The dataset is available at a remote URL, and we will use Spark to download and process it.</p>
<p>Everything else stays as before, but now we will use the <code>SparkFiles</code> module to download the file and make it available locally. This allows us to read the file as if it were a local file, while still leveraging Spark’s distributed processing capabilities.</p>
<div id="bf116f36" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="bf116f36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="bf116f36-1"><a href="#bf116f36-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="bf116f36-2"><a href="#bf116f36-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="bf116f36-3"><a href="#bf116f36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="bf116f36-4"><a href="#bf116f36-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Set environment variables for PySpark</span></span>
<span id="bf116f36-5"><a href="#bf116f36-5" aria-hidden="true" tabindex="-1"></a>os.environ[<span class="st">"PYSPARK_DRIVER_PYTHON"</span>] <span class="op">=</span> sys.executable</span>
<span id="bf116f36-6"><a href="#bf116f36-6" aria-hidden="true" tabindex="-1"></a>os.environ[<span class="st">"PYSPARK_PYTHON"</span>] <span class="op">=</span> sys.executable</span>
<span id="bf116f36-7"><a href="#bf116f36-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="bf116f36-8"><a href="#bf116f36-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql <span class="im">import</span> SparkSession</span>
<span id="bf116f36-9"><a href="#bf116f36-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql.functions <span class="im">import</span> col</span>
<span id="bf116f36-10"><a href="#bf116f36-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark <span class="im">import</span> SparkFiles</span>
<span id="bf116f36-11"><a href="#bf116f36-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="bf116f36-12"><a href="#bf116f36-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Remote dataset URL</span></span>
<span id="bf116f36-13"><a href="#bf116f36-13" aria-hidden="true" tabindex="-1"></a>DATA_URL <span class="op">=</span> (</span>
<span id="bf116f36-14"><a href="#bf116f36-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"https://raw.githubusercontent.com/"</span></span>
<span id="bf116f36-15"><a href="#bf116f36-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ageron/handson-ml/master/datasets/housing/housing.csv"</span></span>
<span id="bf116f36-16"><a href="#bf116f36-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="bf116f36-17"><a href="#bf116f36-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="bf116f36-18"><a href="#bf116f36-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Build the SparkSession</span></span>
<span id="bf116f36-19"><a href="#bf116f36-19" aria-hidden="true" tabindex="-1"></a>spark <span class="op">=</span> (</span>
<span id="bf116f36-20"><a href="#bf116f36-20" aria-hidden="true" tabindex="-1"></a>    SparkSession.builder.appName(<span class="st">"HousingAnalysis"</span>)</span>
<span id="bf116f36-21"><a href="#bf116f36-21" aria-hidden="true" tabindex="-1"></a>    .master(<span class="st">"spark://beast.Home:7077"</span>)</span>
<span id="bf116f36-22"><a href="#bf116f36-22" aria-hidden="true" tabindex="-1"></a>    .getOrCreate()</span>
<span id="bf116f36-23"><a href="#bf116f36-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="bf116f36-24"><a href="#bf116f36-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="bf116f36-25"><a href="#bf116f36-25" aria-hidden="true" tabindex="-1"></a>sc <span class="op">=</span> spark.sparkContext</span>
<span id="bf116f36-26"><a href="#bf116f36-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="bf116f36-27"><a href="#bf116f36-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify connection and get some metadata</span></span>
<span id="bf116f36-28"><a href="#bf116f36-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Master URL:    "</span>, sc.master)</span>
<span id="bf116f36-29"><a href="#bf116f36-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"App ID:        "</span>, sc.applicationId)</span>
<span id="bf116f36-30"><a href="#bf116f36-30" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Spark Version: "</span>, sc.version)</span>
<span id="bf116f36-31"><a href="#bf116f36-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Default Parallelism: "</span>, sc.defaultParallelism)</span>
<span id="bf116f36-32"><a href="#bf116f36-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="bf116f36-33"><a href="#bf116f36-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell Spark to download the file and make it available locally</span></span>
<span id="bf116f36-34"><a href="#bf116f36-34" aria-hidden="true" tabindex="-1"></a>spark.sparkContext.addFile(DATA_URL)</span>
<span id="bf116f36-35"><a href="#bf116f36-35" aria-hidden="true" tabindex="-1"></a>local_csv <span class="op">=</span> SparkFiles.get(os.path.basename(DATA_URL))</span>
<span id="bf116f36-36"><a href="#bf116f36-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="bf116f36-37"><a href="#bf116f36-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Now read from the local copy</span></span>
<span id="bf116f36-38"><a href="#bf116f36-38" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> spark.read.csv(local_csv, header<span class="op">=</span><span class="va">True</span>, inferSchema<span class="op">=</span><span class="va">True</span>)</span>
<span id="bf116f36-39"><a href="#bf116f36-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="bf116f36-40"><a href="#bf116f36-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Quick schema + sample</span></span>
<span id="bf116f36-41"><a href="#bf116f36-41" aria-hidden="true" tabindex="-1"></a>df.printSchema()</span>
<span id="bf116f36-42"><a href="#bf116f36-42" aria-hidden="true" tabindex="-1"></a>df.show(<span class="dv">5</span>, truncate<span class="op">=</span><span class="va">False</span>)</span>
<span id="bf116f36-43"><a href="#bf116f36-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="bf116f36-44"><a href="#bf116f36-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a new feature</span></span>
<span id="bf116f36-45"><a href="#bf116f36-45" aria-hidden="true" tabindex="-1"></a>df2 <span class="op">=</span> df.withColumn(<span class="st">"rooms_per_household"</span>, col(<span class="st">"total_rooms"</span>) <span class="op">/</span> col(<span class="st">"households"</span>))</span>
<span id="bf116f36-46"><a href="#bf116f36-46" aria-hidden="true" tabindex="-1"></a>df2.select(<span class="st">"rooms_per_household"</span>).show(<span class="dv">5</span>)</span>
<span id="bf116f36-47"><a href="#bf116f36-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="bf116f36-48"><a href="#bf116f36-48" aria-hidden="true" tabindex="-1"></a>spark.stop()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Master URL:     spark://beast.Home:7077
App ID:         app-20250709120526-0013
Spark Version:  4.0.0
Default Parallelism:  2</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>root
 |-- longitude: double (nullable = true)
 |-- latitude: double (nullable = true)
 |-- housing_median_age: double (nullable = true)
 |-- total_rooms: double (nullable = true)
 |-- total_bedrooms: double (nullable = true)
 |-- population: double (nullable = true)
 |-- households: double (nullable = true)
 |-- median_income: double (nullable = true)
 |-- median_house_value: double (nullable = true)
 |-- ocean_proximity: string (nullable = true)

+---------+--------+------------------+-----------+--------------+----------+----------+-------------+------------------+---------------+
|longitude|latitude|housing_median_age|total_rooms|total_bedrooms|population|households|median_income|median_house_value|ocean_proximity|
+---------+--------+------------------+-----------+--------------+----------+----------+-------------+------------------+---------------+
|-122.23  |37.88   |41.0              |880.0      |129.0         |322.0     |126.0     |8.3252       |452600.0          |NEAR BAY       |
|-122.22  |37.86   |21.0              |7099.0     |1106.0        |2401.0    |1138.0    |8.3014       |358500.0          |NEAR BAY       |
|-122.24  |37.85   |52.0              |1467.0     |190.0         |496.0     |177.0     |7.2574       |352100.0          |NEAR BAY       |
|-122.25  |37.85   |52.0              |1274.0     |235.0         |558.0     |219.0     |5.6431       |341300.0          |NEAR BAY       |
|-122.25  |37.85   |52.0              |1627.0     |280.0         |565.0     |259.0     |3.8462       |342200.0          |NEAR BAY       |
+---------+--------+------------------+-----------+--------------+----------+----------+-------------+------------------+---------------+
only showing top 5 rows
+-------------------+
|rooms_per_household|
+-------------------+
|  6.984126984126984|
|  6.238137082601054|
|  8.288135593220339|
| 5.8173515981735155|
|  6.281853281853282|
+-------------------+
only showing top 5 rows</code></pre>
</div>
</div>
<p>The above tells Spark to explicitely download the file from the remote URL and make it available locally in each worker. We then read the CSV file into a DataFrame, print its schema, run some transformations and show a few rows.</p>
<p>Note that all of the above (particularly the compute necessary for the addition of the new feature) is done in a distributed manner, meaning that Spark will handle the parallel processing across the cluster for you.</p>
</section>
<section id="hadoop-and-spark" class="level2">
<h2 class="anchored" data-anchor-id="hadoop-and-spark">Hadoop and Spark</h2>
<p>Apache Spark can run on Hadoop YARN to leverage HDFS for storage and YARN for resource management, while integrating out of the box with Hive’s metastore and HBase via built-in connectors. In YARN <em>cluster</em> mode, the driver lives inside an ApplicationMaster and executors launch as YARN containers, whereas in <em>client</em> mode the driver stays external and only the executors run under YARN.</p>
<p>Spark isn’t tied to Hadoop, though. You can also run it in its <em>standalone</em> mode, under <em>Apache Mesos</em>, or natively on <em>Kubernetes</em>. In Kubernetes, the Spark driver and executors run as pods scheduled by Kubernetes’ own scheduler, letting you deploy Spark apps alongside your other containerized workloads.</p>
<p>On the data side, Spark’s unified DataFrame/Dataset API can read from HDFS, local files, object stores like Amazon S3 or Azure Blob Storage, JDBC sources (e.g.&nbsp;MySQL, Postgres), and NoSQL systems such as Cassandra, HBase or Kudu, without changing your business logic. Spark’s Catalyst optimizer and connector implementations automatically plan efficient read patterns across these sources.</p>
<p>These advanced deployment and integration patterns go beyond this primer, but if you want to learn more about running Spark on YARN, see the <a href="https://spark.apache.org/docs/latest/running-on-yarn.html">official documentation</a>, or for Kubernetes check out <a href="https://spark.apache.org/docs/latest/running-on-kubernetes.html">Running on Kubernetes</a>.</p>


</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div>This work is licensed under CC BY <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">(View License)</a></div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/pedroleitao\.nl");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Written with love, take time to think and ponder.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://quarto.org">
      <i class="bi bi-arrow-through-heart" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="http://www.frankscanteen.com">
      <i class="bi bi-cup-hot" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://www.instagram.com/bilhanovarestaurante">
      <i class="bi bi-egg-fried" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>