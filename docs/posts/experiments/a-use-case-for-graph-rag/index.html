<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.23">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2025-07-23">
<meta name="description" content="issue analysis with graphs and RAG">

<title>A Use Case for Graph RAG – Pedro Leitão</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../_static/logo.jpg" rel="icon" type="image/jpeg">
<script src="../../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-ce48a3f02a1a94fca2583af14ebdcdba.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap-b0b4a5a44bd68b3ea90cf5591c8aa521.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="../../../site_libs/quarto-contrib/nutshell-1.0.7/nutshell.js"></script>
<script src="../../../site_libs/quarto-contrib/nutshell-1.0.7/nutshell_options.js"></script>
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>

      .quarto-title-block .quarto-title-banner {
        background-image: url(../../../_static/banner-highlights-partial.jpg);
background-size: cover;
      }
</style>
<meta name="mermaid-theme" content="forest">
<script src="../../../site_libs/quarto-diagram/mermaid.min.js"></script>
<script src="../../../site_libs/quarto-diagram/mermaid-init.js"></script>
<link href="../../../site_libs/quarto-diagram/mermaid.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<script src="https://unpkg.com/@jupyter-widgets/html-manager@*/dist/embed-amd.js" crossorigin="anonymous"></script>
<script data-collect-dnt="true" async="" src="https://scripts.simpleanalyticscdn.com/latest.js"></script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../../styles.css">
<meta property="og:title" content="A Use Case for Graph RAG – Pedro Leitão">
<meta property="og:description" content="issue analysis with graphs and RAG">
<meta property="og:image" content="https://pedroleitao.nl/_static/logo.jpg">
<meta property="og:site_name" content="Pedro Leitão">
<meta name="twitter:title" content="A Use Case for Graph RAG – Pedro Leitão">
<meta name="twitter:description" content="issue analysis with graphs and RAG">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../../_static/logo.jpg" alt="" class="navbar-logo">
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../index.html"> 
<span class="menu-text">Bio</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../posts.html"> 
<span class="menu-text">All posts</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../experiments.html"> 
<span class="menu-text">Experiments</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../thoughts.html"> 
<span class="menu-text">Thoughts</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../howtos.html"> 
<span class="menu-text">Howto’s</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../python-for-students.html"> 
<span class="menu-text">Python for Students</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../dashboards.html"> 
<span class="menu-text">Dashboards</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/pedro-leitao"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://linkedin.com/in/nunoleitao"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../../posts.xml"> <i class="bi bi-rss" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">A Use Case for Graph RAG</h1>
                  <div>
        <div class="description">
          issue analysis with graphs and RAG
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">Experiments</div>
                <div class="quarto-category">Machine Learning</div>
                <div class="quarto-category">RAG</div>
                <div class="quarto-category">LLMs</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">July 23, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#the-use-case" id="toc-the-use-case" class="nav-link active" data-scroll-target="#the-use-case">The use case</a>
  <ul class="collapse">
  <li><a href="#retrieving-issues-from-github" id="toc-retrieving-issues-from-github" class="nav-link" data-scroll-target="#retrieving-issues-from-github">Retrieving issues from GitHub</a></li>
  <li><a href="#computing-embeddings" id="toc-computing-embeddings" class="nav-link" data-scroll-target="#computing-embeddings">Computing embeddings</a></li>
  </ul></li>
  <li><a href="#the-raw-issue-data" id="toc-the-raw-issue-data" class="nav-link" data-scroll-target="#the-raw-issue-data">The raw issue data</a></li>
  <li><a href="#setting-up-the-neo4j-graph-database" id="toc-setting-up-the-neo4j-graph-database" class="nav-link" data-scroll-target="#setting-up-the-neo4j-graph-database">Setting up the Neo4j graph database</a></li>
  <li><a href="#importing-data-into-neo4j" id="toc-importing-data-into-neo4j" class="nav-link" data-scroll-target="#importing-data-into-neo4j">Importing data into Neo4j</a></li>
  <li><a href="#visualising-our-graph" id="toc-visualising-our-graph" class="nav-link" data-scroll-target="#visualising-our-graph">Visualising our graph</a></li>
  <li><a href="#computing-similarity-links" id="toc-computing-similarity-links" class="nav-link" data-scroll-target="#computing-similarity-links">Computing similarity links</a>
  <ul class="collapse">
  <li><a href="#visualizing-related-issues" id="toc-visualizing-related-issues" class="nav-link" data-scroll-target="#visualizing-related-issues">Visualizing related issues</a></li>
  </ul></li>
  <li><a href="#the-resulting-rag-graph" id="toc-the-resulting-rag-graph" class="nav-link" data-scroll-target="#the-resulting-rag-graph">The resulting RAG graph</a></li>
  <li><a href="#the-ai-agent" id="toc-the-ai-agent" class="nav-link" data-scroll-target="#the-ai-agent">The AI agent</a>
  <ul class="collapse">
  <li><a href="#tools-for-the-agent" id="toc-tools-for-the-agent" class="nav-link" data-scroll-target="#tools-for-the-agent">Tools for the agent</a></li>
  </ul></li>
  <li><a href="#example-interactions" id="toc-example-interactions" class="nav-link" data-scroll-target="#example-interactions">Example interactions</a></li>
  <li><a href="#what-can-we-improve" id="toc-what-can-we-improve" class="nav-link" data-scroll-target="#what-can-we-improve">What can we improve ?</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p>RAG, or <a href="https://en.wikipedia.org/wiki/Retrieval-Augmented_Generation">Retrieval-Augmented Generation</a>, is a technique that combines the strengths of large language models (LLMs) with external knowledge sources. In this experiment, we explore a practical use case for RAG using a graph database.</p>
<p>RAG combined with a graph, allows us to enhance the contextual understanding of the LLM by providing it with structured information from the graph. While when RAG is combined with a typical search index and unstructured data, it can lead to <a href="https://stackoverflow.blog/2024/12/27/breaking-up-is-hard-to-do-chunking-in-rag-applications/">less accurate or relevant results</a> due to the lack of context and fine detail.</p>
<section id="the-use-case" class="level2">
<h2 class="anchored" data-anchor-id="the-use-case">The use case</h2>
<p>In this experiment, we will build methods which can download issues from any GitHub repository, store them in a graph database, and then use RAG to query the issues and comments. The goal is to demonstrate how combining retrieval with a graph can improve the usefulness of information from structured data.</p>
<section id="retrieving-issues-from-github" class="level3">
<h3 class="anchored" data-anchor-id="retrieving-issues-from-github">Retrieving issues from GitHub</h3>
<p>We will start by implementing the necessary methods to download issues from a GitHub repository, including their comments, users, labels, and events.</p>
<div id="78ea6a85" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="78ea6a85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="78ea6a85-1"><a href="#78ea6a85-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> github <span class="im">import</span> Github, UnknownObjectException</span>
<span id="78ea6a85-2"><a href="#78ea6a85-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="78ea6a85-3"><a href="#78ea6a85-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tqdm.auto <span class="im">import</span> tqdm</span>
<span id="78ea6a85-4"><a href="#78ea6a85-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests_cache</span>
<span id="78ea6a85-5"><a href="#78ea6a85-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="78ea6a85-6"><a href="#78ea6a85-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="78ea6a85-7"><a href="#78ea6a85-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _get_user_data(user, users_data: <span class="bu">dict</span>):</span>
<span id="78ea6a85-8"><a href="#78ea6a85-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Safely retrieves user data and handles exceptions for non-existent users."""</span></span>
<span id="78ea6a85-9"><a href="#78ea6a85-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> user <span class="kw">and</span> user.login <span class="kw">not</span> <span class="kw">in</span> users_data:</span>
<span id="78ea6a85-10"><a href="#78ea6a85-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="78ea6a85-11"><a href="#78ea6a85-11" aria-hidden="true" tabindex="-1"></a>            users_data[user.login] <span class="op">=</span> {</span>
<span id="78ea6a85-12"><a href="#78ea6a85-12" aria-hidden="true" tabindex="-1"></a>                <span class="st">"id"</span>: user.<span class="bu">id</span>,</span>
<span id="78ea6a85-13"><a href="#78ea6a85-13" aria-hidden="true" tabindex="-1"></a>                <span class="st">"login"</span>: user.login,</span>
<span id="78ea6a85-14"><a href="#78ea6a85-14" aria-hidden="true" tabindex="-1"></a>                <span class="st">"name"</span>: user.name,</span>
<span id="78ea6a85-15"><a href="#78ea6a85-15" aria-hidden="true" tabindex="-1"></a>                <span class="st">"company"</span>: user.company,</span>
<span id="78ea6a85-16"><a href="#78ea6a85-16" aria-hidden="true" tabindex="-1"></a>                <span class="st">"location"</span>: user.location,</span>
<span id="78ea6a85-17"><a href="#78ea6a85-17" aria-hidden="true" tabindex="-1"></a>                <span class="st">"followers"</span>: user.followers,</span>
<span id="78ea6a85-18"><a href="#78ea6a85-18" aria-hidden="true" tabindex="-1"></a>                <span class="st">"created_at"</span>: user.created_at,</span>
<span id="78ea6a85-19"><a href="#78ea6a85-19" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="78ea6a85-20"><a href="#78ea6a85-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> UnknownObjectException:</span>
<span id="78ea6a85-21"><a href="#78ea6a85-21" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(</span>
<span id="78ea6a85-22"><a href="#78ea6a85-22" aria-hidden="true" tabindex="-1"></a>                <span class="ss">f"Could not retrieve full profile for user </span><span class="sc">{</span>user<span class="sc">.</span>login<span class="sc">}</span><span class="ss">. Storing basic info."</span></span>
<span id="78ea6a85-23"><a href="#78ea6a85-23" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="78ea6a85-24"><a href="#78ea6a85-24" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Store basic info if the full profile is not available</span></span>
<span id="78ea6a85-25"><a href="#78ea6a85-25" aria-hidden="true" tabindex="-1"></a>            users_data[user.login] <span class="op">=</span> {</span>
<span id="78ea6a85-26"><a href="#78ea6a85-26" aria-hidden="true" tabindex="-1"></a>                <span class="st">"id"</span>: user.<span class="bu">id</span>,</span>
<span id="78ea6a85-27"><a href="#78ea6a85-27" aria-hidden="true" tabindex="-1"></a>                <span class="st">"login"</span>: user.login,</span>
<span id="78ea6a85-28"><a href="#78ea6a85-28" aria-hidden="true" tabindex="-1"></a>                <span class="st">"name"</span>: <span class="va">None</span>,</span>
<span id="78ea6a85-29"><a href="#78ea6a85-29" aria-hidden="true" tabindex="-1"></a>                <span class="st">"company"</span>: <span class="va">None</span>,</span>
<span id="78ea6a85-30"><a href="#78ea6a85-30" aria-hidden="true" tabindex="-1"></a>                <span class="st">"location"</span>: <span class="va">None</span>,</span>
<span id="78ea6a85-31"><a href="#78ea6a85-31" aria-hidden="true" tabindex="-1"></a>                <span class="st">"followers"</span>: <span class="op">-</span><span class="dv">1</span>,</span>
<span id="78ea6a85-32"><a href="#78ea6a85-32" aria-hidden="true" tabindex="-1"></a>                <span class="st">"created_at"</span>: <span class="va">None</span>,</span>
<span id="78ea6a85-33"><a href="#78ea6a85-33" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="78ea6a85-34"><a href="#78ea6a85-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="78ea6a85-35"><a href="#78ea6a85-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="78ea6a85-36"><a href="#78ea6a85-36" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> download_issues(</span>
<span id="78ea6a85-37"><a href="#78ea6a85-37" aria-hidden="true" tabindex="-1"></a>    token: <span class="bu">str</span>, repo_name: <span class="bu">str</span></span>
<span id="78ea6a85-38"><a href="#78ea6a85-38" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> <span class="bu">tuple</span>[pd.DataFrame, pd.DataFrame, pd.DataFrame, pd.DataFrame, pd.DataFrame]:</span>
<span id="78ea6a85-39"><a href="#78ea6a85-39" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="78ea6a85-40"><a href="#78ea6a85-40" aria-hidden="true" tabindex="-1"></a><span class="co">    Download issues from a GitHub repository and return them as DataFrames.</span></span>
<span id="78ea6a85-41"><a href="#78ea6a85-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="78ea6a85-42"><a href="#78ea6a85-42" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="78ea6a85-43"><a href="#78ea6a85-43" aria-hidden="true" tabindex="-1"></a><span class="co">        token (str): GitHub personal access token.</span></span>
<span id="78ea6a85-44"><a href="#78ea6a85-44" aria-hidden="true" tabindex="-1"></a><span class="co">        repo_name (str): Name of the repository in the format 'owner/repo'.</span></span>
<span id="78ea6a85-45"><a href="#78ea6a85-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="78ea6a85-46"><a href="#78ea6a85-46" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="78ea6a85-47"><a href="#78ea6a85-47" aria-hidden="true" tabindex="-1"></a><span class="co">        tuple: DataFrames for issues, comments, users, labels, and events.</span></span>
<span id="78ea6a85-48"><a href="#78ea6a85-48" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="78ea6a85-49"><a href="#78ea6a85-49" aria-hidden="true" tabindex="-1"></a>    os.makedirs(<span class="st">".data"</span>, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="78ea6a85-50"><a href="#78ea6a85-50" aria-hidden="true" tabindex="-1"></a>    requests_cache.install_cache(</span>
<span id="78ea6a85-51"><a href="#78ea6a85-51" aria-hidden="true" tabindex="-1"></a>        <span class="st">".data/github_cache"</span>, backend<span class="op">=</span><span class="st">"sqlite"</span>, expire_after<span class="op">=</span><span class="dv">4</span> <span class="op">*</span> <span class="dv">3600</span></span>
<span id="78ea6a85-52"><a href="#78ea6a85-52" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="78ea6a85-53"><a href="#78ea6a85-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="78ea6a85-54"><a href="#78ea6a85-54" aria-hidden="true" tabindex="-1"></a>    g <span class="op">=</span> Github(token)</span>
<span id="78ea6a85-55"><a href="#78ea6a85-55" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> g:</span>
<span id="78ea6a85-56"><a href="#78ea6a85-56" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"Invalid GitHub token or authentication failed."</span>)</span>
<span id="78ea6a85-57"><a href="#78ea6a85-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="78ea6a85-58"><a href="#78ea6a85-58" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 2) Get repo and issues</span></span>
<span id="78ea6a85-59"><a href="#78ea6a85-59" aria-hidden="true" tabindex="-1"></a>    repo <span class="op">=</span> g.get_repo(repo_name)</span>
<span id="78ea6a85-60"><a href="#78ea6a85-60" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> repo:</span>
<span id="78ea6a85-61"><a href="#78ea6a85-61" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"Repository '</span><span class="sc">{</span>repo_name<span class="sc">}</span><span class="ss">' not found or access denied."</span>)</span>
<span id="78ea6a85-62"><a href="#78ea6a85-62" aria-hidden="true" tabindex="-1"></a>    issues <span class="op">=</span> repo.get_issues(state<span class="op">=</span><span class="st">"all"</span>)  <span class="co"># Paginated iterator</span></span>
<span id="78ea6a85-63"><a href="#78ea6a85-63" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> issues:</span>
<span id="78ea6a85-64"><a href="#78ea6a85-64" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"No issues found in repository '</span><span class="sc">{</span>repo_name<span class="sc">}</span><span class="ss">'."</span>)</span>
<span id="78ea6a85-65"><a href="#78ea6a85-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="78ea6a85-66"><a href="#78ea6a85-66" aria-hidden="true" tabindex="-1"></a>    issue_data <span class="op">=</span> []</span>
<span id="78ea6a85-67"><a href="#78ea6a85-67" aria-hidden="true" tabindex="-1"></a>    issue_comments <span class="op">=</span> []</span>
<span id="78ea6a85-68"><a href="#78ea6a85-68" aria-hidden="true" tabindex="-1"></a>    issue_events <span class="op">=</span> []</span>
<span id="78ea6a85-69"><a href="#78ea6a85-69" aria-hidden="true" tabindex="-1"></a>    users_data <span class="op">=</span> {}</span>
<span id="78ea6a85-70"><a href="#78ea6a85-70" aria-hidden="true" tabindex="-1"></a>    labels_data <span class="op">=</span> {}</span>
<span id="78ea6a85-71"><a href="#78ea6a85-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="78ea6a85-72"><a href="#78ea6a85-72" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> issue <span class="kw">in</span> tqdm(</span>
<span id="78ea6a85-73"><a href="#78ea6a85-73" aria-hidden="true" tabindex="-1"></a>        issues, total<span class="op">=</span>issues.totalCount, desc<span class="op">=</span><span class="ss">f"Downloading issues from </span><span class="sc">{</span>repo_name<span class="sc">}</span><span class="ss">"</span></span>
<span id="78ea6a85-74"><a href="#78ea6a85-74" aria-hidden="true" tabindex="-1"></a>    ):</span>
<span id="78ea6a85-75"><a href="#78ea6a85-75" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add all issue data to list</span></span>
<span id="78ea6a85-76"><a href="#78ea6a85-76" aria-hidden="true" tabindex="-1"></a>        issue_data.append(</span>
<span id="78ea6a85-77"><a href="#78ea6a85-77" aria-hidden="true" tabindex="-1"></a>            {</span>
<span id="78ea6a85-78"><a href="#78ea6a85-78" aria-hidden="true" tabindex="-1"></a>                <span class="st">"id"</span>: issue.<span class="bu">id</span>,</span>
<span id="78ea6a85-79"><a href="#78ea6a85-79" aria-hidden="true" tabindex="-1"></a>                <span class="st">"number"</span>: issue.number,</span>
<span id="78ea6a85-80"><a href="#78ea6a85-80" aria-hidden="true" tabindex="-1"></a>                <span class="st">"title"</span>: issue.title,</span>
<span id="78ea6a85-81"><a href="#78ea6a85-81" aria-hidden="true" tabindex="-1"></a>                <span class="st">"state"</span>: issue.state,</span>
<span id="78ea6a85-82"><a href="#78ea6a85-82" aria-hidden="true" tabindex="-1"></a>                <span class="st">"created_at"</span>: issue.created_at,</span>
<span id="78ea6a85-83"><a href="#78ea6a85-83" aria-hidden="true" tabindex="-1"></a>                <span class="st">"updated_at"</span>: issue.updated_at,</span>
<span id="78ea6a85-84"><a href="#78ea6a85-84" aria-hidden="true" tabindex="-1"></a>                <span class="st">"closed_at"</span>: issue.closed_at,</span>
<span id="78ea6a85-85"><a href="#78ea6a85-85" aria-hidden="true" tabindex="-1"></a>                <span class="st">"body"</span>: issue.body,</span>
<span id="78ea6a85-86"><a href="#78ea6a85-86" aria-hidden="true" tabindex="-1"></a>                <span class="st">"labels"</span>: [label.name <span class="cf">for</span> label <span class="kw">in</span> issue.labels],</span>
<span id="78ea6a85-87"><a href="#78ea6a85-87" aria-hidden="true" tabindex="-1"></a>                <span class="st">"assignees"</span>: [assignee.login <span class="cf">for</span> assignee <span class="kw">in</span> issue.assignees],</span>
<span id="78ea6a85-88"><a href="#78ea6a85-88" aria-hidden="true" tabindex="-1"></a>                <span class="st">"user"</span>: issue.user.login,</span>
<span id="78ea6a85-89"><a href="#78ea6a85-89" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="78ea6a85-90"><a href="#78ea6a85-90" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="78ea6a85-91"><a href="#78ea6a85-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="78ea6a85-92"><a href="#78ea6a85-92" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add user data</span></span>
<span id="78ea6a85-93"><a href="#78ea6a85-93" aria-hidden="true" tabindex="-1"></a>        _get_user_data(issue.user, users_data)</span>
<span id="78ea6a85-94"><a href="#78ea6a85-94" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> assignee <span class="kw">in</span> issue.assignees:</span>
<span id="78ea6a85-95"><a href="#78ea6a85-95" aria-hidden="true" tabindex="-1"></a>            _get_user_data(assignee, users_data)</span>
<span id="78ea6a85-96"><a href="#78ea6a85-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="78ea6a85-97"><a href="#78ea6a85-97" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add all comments to list</span></span>
<span id="78ea6a85-98"><a href="#78ea6a85-98" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> comment <span class="kw">in</span> issue.get_comments():</span>
<span id="78ea6a85-99"><a href="#78ea6a85-99" aria-hidden="true" tabindex="-1"></a>            issue_comments.append(</span>
<span id="78ea6a85-100"><a href="#78ea6a85-100" aria-hidden="true" tabindex="-1"></a>                {</span>
<span id="78ea6a85-101"><a href="#78ea6a85-101" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"issue_id"</span>: issue.<span class="bu">id</span>,</span>
<span id="78ea6a85-102"><a href="#78ea6a85-102" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"comment_id"</span>: comment.<span class="bu">id</span>,</span>
<span id="78ea6a85-103"><a href="#78ea6a85-103" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"user"</span>: comment.user.login,</span>
<span id="78ea6a85-104"><a href="#78ea6a85-104" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"created_at"</span>: comment.created_at,</span>
<span id="78ea6a85-105"><a href="#78ea6a85-105" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"updated_at"</span>: comment.updated_at,</span>
<span id="78ea6a85-106"><a href="#78ea6a85-106" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"body"</span>: comment.body,</span>
<span id="78ea6a85-107"><a href="#78ea6a85-107" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="78ea6a85-108"><a href="#78ea6a85-108" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="78ea6a85-109"><a href="#78ea6a85-109" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Add comment user to users list</span></span>
<span id="78ea6a85-110"><a href="#78ea6a85-110" aria-hidden="true" tabindex="-1"></a>            _get_user_data(comment.user, users_data)</span>
<span id="78ea6a85-111"><a href="#78ea6a85-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="78ea6a85-112"><a href="#78ea6a85-112" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add all labels to list</span></span>
<span id="78ea6a85-113"><a href="#78ea6a85-113" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> label <span class="kw">in</span> issue.labels:</span>
<span id="78ea6a85-114"><a href="#78ea6a85-114" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> label.name <span class="kw">not</span> <span class="kw">in</span> labels_data:</span>
<span id="78ea6a85-115"><a href="#78ea6a85-115" aria-hidden="true" tabindex="-1"></a>                labels_data[label.name] <span class="op">=</span> {</span>
<span id="78ea6a85-116"><a href="#78ea6a85-116" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"name"</span>: label.name,</span>
<span id="78ea6a85-117"><a href="#78ea6a85-117" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"color"</span>: label.color,</span>
<span id="78ea6a85-118"><a href="#78ea6a85-118" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"description"</span>: label.description,</span>
<span id="78ea6a85-119"><a href="#78ea6a85-119" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="78ea6a85-120"><a href="#78ea6a85-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="78ea6a85-121"><a href="#78ea6a85-121" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add all events to list</span></span>
<span id="78ea6a85-122"><a href="#78ea6a85-122" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> event <span class="kw">in</span> issue.get_events():</span>
<span id="78ea6a85-123"><a href="#78ea6a85-123" aria-hidden="true" tabindex="-1"></a>            issue_events.append(</span>
<span id="78ea6a85-124"><a href="#78ea6a85-124" aria-hidden="true" tabindex="-1"></a>                {</span>
<span id="78ea6a85-125"><a href="#78ea6a85-125" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"issue_id"</span>: issue.<span class="bu">id</span>,</span>
<span id="78ea6a85-126"><a href="#78ea6a85-126" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"event_id"</span>: event.<span class="bu">id</span>,</span>
<span id="78ea6a85-127"><a href="#78ea6a85-127" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"actor"</span>: event.actor.login <span class="cf">if</span> event.actor <span class="cf">else</span> <span class="va">None</span>,</span>
<span id="78ea6a85-128"><a href="#78ea6a85-128" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"event"</span>: event.event,</span>
<span id="78ea6a85-129"><a href="#78ea6a85-129" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"created_at"</span>: event.created_at,</span>
<span id="78ea6a85-130"><a href="#78ea6a85-130" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="78ea6a85-131"><a href="#78ea6a85-131" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="78ea6a85-132"><a href="#78ea6a85-132" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Add event actor to users list</span></span>
<span id="78ea6a85-133"><a href="#78ea6a85-133" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> event.actor:</span>
<span id="78ea6a85-134"><a href="#78ea6a85-134" aria-hidden="true" tabindex="-1"></a>                _get_user_data(event.actor, users_data)</span>
<span id="78ea6a85-135"><a href="#78ea6a85-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="78ea6a85-136"><a href="#78ea6a85-136" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (</span>
<span id="78ea6a85-137"><a href="#78ea6a85-137" aria-hidden="true" tabindex="-1"></a>        pd.DataFrame(issue_data),</span>
<span id="78ea6a85-138"><a href="#78ea6a85-138" aria-hidden="true" tabindex="-1"></a>        pd.DataFrame(issue_comments),</span>
<span id="78ea6a85-139"><a href="#78ea6a85-139" aria-hidden="true" tabindex="-1"></a>        pd.DataFrame(<span class="bu">list</span>(users_data.values())),</span>
<span id="78ea6a85-140"><a href="#78ea6a85-140" aria-hidden="true" tabindex="-1"></a>        pd.DataFrame(<span class="bu">list</span>(labels_data.values())),</span>
<span id="78ea6a85-141"><a href="#78ea6a85-141" aria-hidden="true" tabindex="-1"></a>        pd.DataFrame(issue_events),</span>
<span id="78ea6a85-142"><a href="#78ea6a85-142" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Retrieving hundreds of issues from a repository can take a while, so we will cache the results to avoid unnecessary API calls. In this case we will use the <a href="https://github.com/Farama-Foundation/Gymnasium"><code>Farama-Foundation/Gymnasium</code></a> repository as our data source - it is small enough to be manageable, but large enough to demonstrate the capabilities of our methods.</p>
<div id="0210d346" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="0210d346"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="0210d346-1"><a href="#0210d346-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="0210d346-2"><a href="#0210d346-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="0210d346-3"><a href="#0210d346-3" aria-hidden="true" tabindex="-1"></a>token <span class="op">=</span> os.getenv(<span class="st">"GITHUB_TOKEN"</span>)</span>
<span id="0210d346-4"><a href="#0210d346-4" aria-hidden="true" tabindex="-1"></a>repo_name <span class="op">=</span> <span class="st">"Farama-Foundation/Gymnasium"</span></span>
<span id="0210d346-5"><a href="#0210d346-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="0210d346-6"><a href="#0210d346-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if we already have the data</span></span>
<span id="0210d346-7"><a href="#0210d346-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> os.path.exists(<span class="st">".data/issues.pkl"</span>):</span>
<span id="0210d346-8"><a href="#0210d346-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Data already downloaded. Loading from pickle files."</span>)</span>
<span id="0210d346-9"><a href="#0210d346-9" aria-hidden="true" tabindex="-1"></a>    issue_data <span class="op">=</span> pd.read_pickle(<span class="st">".data/issues.pkl"</span>)</span>
<span id="0210d346-10"><a href="#0210d346-10" aria-hidden="true" tabindex="-1"></a>    issue_comments <span class="op">=</span> pd.read_pickle(<span class="st">".data/comments.pkl"</span>)</span>
<span id="0210d346-11"><a href="#0210d346-11" aria-hidden="true" tabindex="-1"></a>    users_data <span class="op">=</span> pd.read_pickle(<span class="st">".data/users.pkl"</span>)</span>
<span id="0210d346-12"><a href="#0210d346-12" aria-hidden="true" tabindex="-1"></a>    labels_data <span class="op">=</span> pd.read_pickle(<span class="st">".data/labels.pkl"</span>)</span>
<span id="0210d346-13"><a href="#0210d346-13" aria-hidden="true" tabindex="-1"></a>    issue_events <span class="op">=</span> pd.read_pickle(<span class="st">".data/events.pkl"</span>)</span>
<span id="0210d346-14"><a href="#0210d346-14" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="0210d346-15"><a href="#0210d346-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Downloading issues from GitHub..."</span>)</span>
<span id="0210d346-16"><a href="#0210d346-16" aria-hidden="true" tabindex="-1"></a>    issue_data, issue_comments, users_data, labels_data, issue_events <span class="op">=</span> download_issues(</span>
<span id="0210d346-17"><a href="#0210d346-17" aria-hidden="true" tabindex="-1"></a>        token, repo_name</span>
<span id="0210d346-18"><a href="#0210d346-18" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="0210d346-19"><a href="#0210d346-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Save all dataframes to pickle files under `.data`</span></span>
<span id="0210d346-20"><a href="#0210d346-20" aria-hidden="true" tabindex="-1"></a>    os.makedirs(<span class="st">".data"</span>, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="0210d346-21"><a href="#0210d346-21" aria-hidden="true" tabindex="-1"></a>    issue_data.to_pickle(<span class="st">".data/issues.pkl"</span>)</span>
<span id="0210d346-22"><a href="#0210d346-22" aria-hidden="true" tabindex="-1"></a>    issue_comments.to_pickle(<span class="st">".data/comments.pkl"</span>)</span>
<span id="0210d346-23"><a href="#0210d346-23" aria-hidden="true" tabindex="-1"></a>    users_data.to_pickle(<span class="st">".data/users.pkl"</span>)</span>
<span id="0210d346-24"><a href="#0210d346-24" aria-hidden="true" tabindex="-1"></a>    labels_data.to_pickle(<span class="st">".data/labels.pkl"</span>)</span>
<span id="0210d346-25"><a href="#0210d346-25" aria-hidden="true" tabindex="-1"></a>    issue_events.to_pickle(<span class="st">".data/events.pkl"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Data already downloaded. Loading from pickle files.</code></pre>
</div>
</div>
</section>
<section id="computing-embeddings" class="level3">
<h3 class="anchored" data-anchor-id="computing-embeddings">Computing embeddings</h3>
<p>With the data at hand, and loaded into <code>pandas</code> DataFrames, we can now compute embeddings for the content in issues and comments. We will use a the <code>QWen/Qwen3-Embedding-0.6B</code> pre-trained Transformer model to generate embeddings for the text data, as it provides a good balance between accuracy and performance for our use case. It can also handle large text lengths, which means we can in many cases use it without necessarily chunking the text.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>In a production setting, you would most definitely want to implement chunking of the text. For the purpose of this experiment, we will keep it simple and not chunk content.</p>
</div>
</div>
<p>To keep our data size manageable, we will also truncate the embeddings to a fixed dimension of <span class="math inline">\(768\)</span>, which is a common size for many Transformer models. For larger datasets, you would want to consider using a larger embedding size.</p>
<div id="c59112e8" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="c59112e8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="c59112e8-1"><a href="#c59112e8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Method to compute embeddings using a given Transformer model</span></span>
<span id="c59112e8-2"><a href="#c59112e8-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sentence_transformers <span class="im">import</span> SentenceTransformer</span>
<span id="c59112e8-3"><a href="#c59112e8-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch</span>
<span id="c59112e8-4"><a href="#c59112e8-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="c59112e8-5"><a href="#c59112e8-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> List</span>
<span id="c59112e8-6"><a href="#c59112e8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="c59112e8-7"><a href="#c59112e8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="c59112e8-8"><a href="#c59112e8-8" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> EmbeddingModel:</span>
<span id="c59112e8-9"><a href="#c59112e8-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(</span>
<span id="c59112e8-10"><a href="#c59112e8-10" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>,</span>
<span id="c59112e8-11"><a href="#c59112e8-11" aria-hidden="true" tabindex="-1"></a>        model_name: <span class="bu">str</span> <span class="op">=</span> <span class="st">"QWen/Qwen3-Embedding-0.6B"</span>,</span>
<span id="c59112e8-12"><a href="#c59112e8-12" aria-hidden="true" tabindex="-1"></a>        batch_size: <span class="bu">int</span> <span class="op">=</span> <span class="dv">32</span>,</span>
<span id="c59112e8-13"><a href="#c59112e8-13" aria-hidden="true" tabindex="-1"></a>        truncate_dim: <span class="bu">int</span> <span class="op">=</span> <span class="va">None</span>,</span>
<span id="c59112e8-14"><a href="#c59112e8-14" aria-hidden="true" tabindex="-1"></a>    ) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="c59112e8-15"><a href="#c59112e8-15" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Use CUDA if available</span></span>
<span id="c59112e8-16"><a href="#c59112e8-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> torch.cuda.is_available():</span>
<span id="c59112e8-17"><a href="#c59112e8-17" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">"Using CUDA for embeddings."</span>)</span>
<span id="c59112e8-18"><a href="#c59112e8-18" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.device <span class="op">=</span> torch.device(<span class="st">"cuda"</span>)</span>
<span id="c59112e8-19"><a href="#c59112e8-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> torch.backends.mps.is_available():</span>
<span id="c59112e8-20"><a href="#c59112e8-20" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">"Using MPS for embeddings."</span>)</span>
<span id="c59112e8-21"><a href="#c59112e8-21" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.device <span class="op">=</span> torch.device(<span class="st">"mps"</span>)</span>
<span id="c59112e8-22"><a href="#c59112e8-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="c59112e8-23"><a href="#c59112e8-23" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">"Using CPU for embeddings."</span>)</span>
<span id="c59112e8-24"><a href="#c59112e8-24" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.device <span class="op">=</span> torch.device(<span class="st">"cpu"</span>)</span>
<span id="c59112e8-25"><a href="#c59112e8-25" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.model <span class="op">=</span> SentenceTransformer(model_name, truncate_dim<span class="op">=</span>truncate_dim).to(</span>
<span id="c59112e8-26"><a href="#c59112e8-26" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.device</span>
<span id="c59112e8-27"><a href="#c59112e8-27" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="c59112e8-28"><a href="#c59112e8-28" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.batch_size <span class="op">=</span> batch_size</span>
<span id="c59112e8-29"><a href="#c59112e8-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="c59112e8-30"><a href="#c59112e8-30" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> embed_batch(</span>
<span id="c59112e8-31"><a href="#c59112e8-31" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>, texts: List[<span class="bu">str</span>], desc: <span class="bu">str</span> <span class="op">=</span> <span class="st">"Embedding batch"</span></span>
<span id="c59112e8-32"><a href="#c59112e8-32" aria-hidden="true" tabindex="-1"></a>    ) <span class="op">-&gt;</span> np.ndarray:</span>
<span id="c59112e8-33"><a href="#c59112e8-33" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="c59112e8-34"><a href="#c59112e8-34" aria-hidden="true" tabindex="-1"></a><span class="co">        Embed a batch of texts using the SentenceTransformer model.</span></span>
<span id="c59112e8-35"><a href="#c59112e8-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="c59112e8-36"><a href="#c59112e8-36" aria-hidden="true" tabindex="-1"></a><span class="co">        Args:</span></span>
<span id="c59112e8-37"><a href="#c59112e8-37" aria-hidden="true" tabindex="-1"></a><span class="co">            texts (List[str]): List of texts to embed.</span></span>
<span id="c59112e8-38"><a href="#c59112e8-38" aria-hidden="true" tabindex="-1"></a><span class="co">            desc (str): Description for the tqdm progress bar.</span></span>
<span id="c59112e8-39"><a href="#c59112e8-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="c59112e8-40"><a href="#c59112e8-40" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns:</span></span>
<span id="c59112e8-41"><a href="#c59112e8-41" aria-hidden="true" tabindex="-1"></a><span class="co">            np.ndarray: Array of embeddings for the input texts.</span></span>
<span id="c59112e8-42"><a href="#c59112e8-42" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="c59112e8-43"><a href="#c59112e8-43" aria-hidden="true" tabindex="-1"></a>        all_embs <span class="op">=</span> []</span>
<span id="c59112e8-44"><a href="#c59112e8-44" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.model.to(<span class="va">self</span>.device)</span>
<span id="c59112e8-45"><a href="#c59112e8-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> torch.no_grad():  <span class="co"># disable grads</span></span>
<span id="c59112e8-46"><a href="#c59112e8-46" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> tqdm(<span class="bu">range</span>(<span class="dv">0</span>, <span class="bu">len</span>(texts), <span class="va">self</span>.batch_size), desc<span class="op">=</span>desc):</span>
<span id="c59112e8-47"><a href="#c59112e8-47" aria-hidden="true" tabindex="-1"></a>                batch <span class="op">=</span> texts[i : i <span class="op">+</span> <span class="va">self</span>.batch_size]</span>
<span id="c59112e8-48"><a href="#c59112e8-48" aria-hidden="true" tabindex="-1"></a>                <span class="co"># get a CPU numpy array directly</span></span>
<span id="c59112e8-49"><a href="#c59112e8-49" aria-hidden="true" tabindex="-1"></a>                embs <span class="op">=</span> <span class="va">self</span>.model.encode(</span>
<span id="c59112e8-50"><a href="#c59112e8-50" aria-hidden="true" tabindex="-1"></a>                    batch,</span>
<span id="c59112e8-51"><a href="#c59112e8-51" aria-hidden="true" tabindex="-1"></a>                    batch_size<span class="op">=</span><span class="bu">len</span>(batch),</span>
<span id="c59112e8-52"><a href="#c59112e8-52" aria-hidden="true" tabindex="-1"></a>                    show_progress_bar<span class="op">=</span><span class="va">False</span>,</span>
<span id="c59112e8-53"><a href="#c59112e8-53" aria-hidden="true" tabindex="-1"></a>                    convert_to_tensor<span class="op">=</span><span class="va">False</span>,  <span class="co"># returns numpy on CPU</span></span>
<span id="c59112e8-54"><a href="#c59112e8-54" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="c59112e8-55"><a href="#c59112e8-55" aria-hidden="true" tabindex="-1"></a>                all_embs.append(np.vstack(embs) <span class="cf">if</span> <span class="bu">isinstance</span>(embs, <span class="bu">list</span>) <span class="cf">else</span> embs)</span>
<span id="c59112e8-56"><a href="#c59112e8-56" aria-hidden="true" tabindex="-1"></a>                <span class="co"># free any CUDA scratch</span></span>
<span id="c59112e8-57"><a href="#c59112e8-57" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="va">self</span>.device.<span class="bu">type</span> <span class="op">==</span> <span class="st">"cuda"</span>:</span>
<span id="c59112e8-58"><a href="#c59112e8-58" aria-hidden="true" tabindex="-1"></a>                    torch.cuda.empty_cache()</span>
<span id="c59112e8-59"><a href="#c59112e8-59" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> np.vstack(all_embs)</span>
<span id="c59112e8-60"><a href="#c59112e8-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="c59112e8-61"><a href="#c59112e8-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="c59112e8-62"><a href="#c59112e8-62" aria-hidden="true" tabindex="-1"></a>embedding_dim <span class="op">=</span> <span class="dv">768</span>  <span class="co"># Set the embedding dimension</span></span>
<span id="c59112e8-63"><a href="#c59112e8-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="c59112e8-64"><a href="#c59112e8-64" aria-hidden="true" tabindex="-1"></a>embedding_model <span class="op">=</span> EmbeddingModel(batch_size<span class="op">=</span><span class="dv">2</span>, truncate_dim<span class="op">=</span>embedding_dim)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Using CUDA for embeddings.</code></pre>
</div>
</div>
<div id="a906380e" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="a906380e"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="a906380e-1"><a href="#a906380e-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute embeddings for issues and comments, including title and body</span></span>
<span id="a906380e-2"><a href="#a906380e-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_embeddings(</span>
<span id="a906380e-3"><a href="#a906380e-3" aria-hidden="true" tabindex="-1"></a>    df: pd.DataFrame, text_columns: List[<span class="bu">str</span>], desc: <span class="bu">str</span> <span class="op">=</span> <span class="st">"Computing embeddings"</span></span>
<span id="a906380e-4"><a href="#a906380e-4" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> np.ndarray:</span>
<span id="a906380e-5"><a href="#a906380e-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="a906380e-6"><a href="#a906380e-6" aria-hidden="true" tabindex="-1"></a><span class="co">    Compute embeddings for specified text columns in a DataFrame.</span></span>
<span id="a906380e-7"><a href="#a906380e-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="a906380e-8"><a href="#a906380e-8" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="a906380e-9"><a href="#a906380e-9" aria-hidden="true" tabindex="-1"></a><span class="co">        df (pd.DataFrame): DataFrame containing the text data.</span></span>
<span id="a906380e-10"><a href="#a906380e-10" aria-hidden="true" tabindex="-1"></a><span class="co">        text_columns (List[str]): List of column names to compute embeddings for.</span></span>
<span id="a906380e-11"><a href="#a906380e-11" aria-hidden="true" tabindex="-1"></a><span class="co">        desc (str): Description for the tqdm progress bar.</span></span>
<span id="a906380e-12"><a href="#a906380e-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="a906380e-13"><a href="#a906380e-13" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="a906380e-14"><a href="#a906380e-14" aria-hidden="true" tabindex="-1"></a><span class="co">        np.ndarray: Array of embeddings for the specified text columns.</span></span>
<span id="a906380e-15"><a href="#a906380e-15" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="a906380e-16"><a href="#a906380e-16" aria-hidden="true" tabindex="-1"></a>    texts <span class="op">=</span> []</span>
<span id="a906380e-17"><a href="#a906380e-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _, row <span class="kw">in</span> df.iterrows():</span>
<span id="a906380e-18"><a href="#a906380e-18" aria-hidden="true" tabindex="-1"></a>        text <span class="op">=</span> <span class="st">" "</span>.join(<span class="bu">str</span>(row[col]) <span class="cf">for</span> col <span class="kw">in</span> text_columns <span class="cf">if</span> pd.notna(row[col]))</span>
<span id="a906380e-19"><a href="#a906380e-19" aria-hidden="true" tabindex="-1"></a>        texts.append(text)</span>
<span id="a906380e-20"><a href="#a906380e-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> embedding_model.embed_batch(texts, desc<span class="op">=</span>desc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Just as with the issue data, we will cache the embeddings to avoid recomputing them every time we run the experiment. If the embeddings already exist in the DataFrame, we will load them from there to avoid unnecessary computation.</p>
<div id="4c1acd02" class="cell" data-execution_count="6">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="4c1acd02"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="4c1acd02-1"><a href="#4c1acd02-1" aria-hidden="true" tabindex="-1"></a>recompute <span class="op">=</span> <span class="va">False</span></span>
<span id="4c1acd02-2"><a href="#4c1acd02-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if embeddings already exist</span></span>
<span id="4c1acd02-3"><a href="#4c1acd02-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (</span>
<span id="4c1acd02-4"><a href="#4c1acd02-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"embeddings"</span> <span class="kw">in</span> issue_data.columns</span>
<span id="4c1acd02-5"><a href="#4c1acd02-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">and</span> <span class="st">"embeddings"</span> <span class="kw">in</span> issue_comments.columns</span>
<span id="4c1acd02-6"><a href="#4c1acd02-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">and</span> <span class="kw">not</span> recompute</span>
<span id="4c1acd02-7"><a href="#4c1acd02-7" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="4c1acd02-8"><a href="#4c1acd02-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Embeddings already computed. Loading from DataFrame."</span>)</span>
<span id="4c1acd02-9"><a href="#4c1acd02-9" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="4c1acd02-10"><a href="#4c1acd02-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Computing embeddings for issues and comments..."</span>)</span>
<span id="4c1acd02-11"><a href="#4c1acd02-11" aria-hidden="true" tabindex="-1"></a>    issue_text_columns <span class="op">=</span> [<span class="st">"title"</span>, <span class="st">"body"</span>]</span>
<span id="4c1acd02-12"><a href="#4c1acd02-12" aria-hidden="true" tabindex="-1"></a>    issue_embeddings <span class="op">=</span> compute_embeddings(</span>
<span id="4c1acd02-13"><a href="#4c1acd02-13" aria-hidden="true" tabindex="-1"></a>        issue_data, issue_text_columns, <span class="st">"Computing issue embeddings"</span></span>
<span id="4c1acd02-14"><a href="#4c1acd02-14" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="4c1acd02-15"><a href="#4c1acd02-15" aria-hidden="true" tabindex="-1"></a>    comment_text_columns <span class="op">=</span> [<span class="st">"body"</span>]</span>
<span id="4c1acd02-16"><a href="#4c1acd02-16" aria-hidden="true" tabindex="-1"></a>    comment_embeddings <span class="op">=</span> compute_embeddings(</span>
<span id="4c1acd02-17"><a href="#4c1acd02-17" aria-hidden="true" tabindex="-1"></a>        issue_comments, comment_text_columns, <span class="st">"Computing comment embeddings"</span></span>
<span id="4c1acd02-18"><a href="#4c1acd02-18" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="4c1acd02-19"><a href="#4c1acd02-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add embeddings to DataFrames</span></span>
<span id="4c1acd02-20"><a href="#4c1acd02-20" aria-hidden="true" tabindex="-1"></a>    issue_data[<span class="st">"embeddings"</span>] <span class="op">=</span> <span class="bu">list</span>(issue_embeddings)</span>
<span id="4c1acd02-21"><a href="#4c1acd02-21" aria-hidden="true" tabindex="-1"></a>    issue_comments[<span class="st">"embeddings"</span>] <span class="op">=</span> <span class="bu">list</span>(comment_embeddings)</span>
<span id="4c1acd02-22"><a href="#4c1acd02-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Save dataframe back to pickle files</span></span>
<span id="4c1acd02-23"><a href="#4c1acd02-23" aria-hidden="true" tabindex="-1"></a>    issue_data.to_pickle(<span class="st">".data/issues.pkl"</span>)</span>
<span id="4c1acd02-24"><a href="#4c1acd02-24" aria-hidden="true" tabindex="-1"></a>    issue_comments.to_pickle(<span class="st">".data/comments.pkl"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Embeddings already computed. Loading from DataFrame.</code></pre>
</div>
</div>
</section>
</section>
<section id="the-raw-issue-data" class="level2">
<h2 class="anchored" data-anchor-id="the-raw-issue-data">The raw issue data</h2>
<p>Let us take a look at the raw data we have collected and processed so far. We will display a sample of each DataFrame to get an overview of the data structure and content.</p>
<p>Issue data contains information about the issues, including their title, body, state, labels, assignees, and user who raised the issue. Also note the computed embeddings for the issue text.</p>
<div id="5abc43f0" class="cell" data-execution_count="7">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="5abc43f0"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="5abc43f0-1"><a href="#5abc43f0-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Show a sample for each dataframe</span></span>
<span id="5abc43f0-2"><a href="#5abc43f0-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Sample issue data:"</span>)</span>
<span id="5abc43f0-3"><a href="#5abc43f0-3" aria-hidden="true" tabindex="-1"></a>issue_data.sample(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Sample issue data:</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="6">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th">number</th>
<th data-quarto-table-cell-role="th">title</th>
<th data-quarto-table-cell-role="th">state</th>
<th data-quarto-table-cell-role="th">created_at</th>
<th data-quarto-table-cell-role="th">updated_at</th>
<th data-quarto-table-cell-role="th">closed_at</th>
<th data-quarto-table-cell-role="th">body</th>
<th data-quarto-table-cell-role="th">labels</th>
<th data-quarto-table-cell-role="th">assignees</th>
<th data-quarto-table-cell-role="th">user</th>
<th data-quarto-table-cell-role="th">embeddings</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">853</td>
<td>1764400983</td>
<td>560</td>
<td>[Proposal] Check render_mode for RecordVideo w...</td>
<td>closed</td>
<td>2023-06-20 00:21:09+00:00</td>
<td>2023-07-03 09:46:40+00:00</td>
<td>2023-07-03 09:46:40+00:00</td>
<td>### Proposal\r\n\r\nRight now, when you wrap a...</td>
<td>[enhancement]</td>
<td>[]</td>
<td>robertoschiavone</td>
<td>[0.011846603, 0.0290194, -0.0031601943, -0.075...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1262</td>
<td>1457055647</td>
<td>150</td>
<td>Versioned Action wrappers which supports jumpy</td>
<td>closed</td>
<td>2022-11-20 21:37:48+00:00</td>
<td>2022-12-01 20:36:12+00:00</td>
<td>2022-12-01 20:36:12+00:00</td>
<td># Description\r\n\r\nThis PR add support for j...</td>
<td>[]</td>
<td>[]</td>
<td>gianlucadecola</td>
<td>[0.030979421, 0.041525118, -0.011083876, -0.07...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">594</td>
<td>2030125938</td>
<td>820</td>
<td>[Bug Report] [documentation] The LaTeX math is...</td>
<td>closed</td>
<td>2023-12-07 08:02:45+00:00</td>
<td>2023-12-17 09:38:24+00:00</td>
<td>2023-12-17 09:38:23+00:00</td>
<td>### Describe the bug\n\nexample:\r\nhttps://gy...</td>
<td>[bug]</td>
<td>[]</td>
<td>Kallinteris-Andreas</td>
<td>[0.0021287652, 0.048698895, -0.005818796, -0.0...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1106</td>
<td>1568043962</td>
<td>307</td>
<td>Update test_vector_make.py</td>
<td>closed</td>
<td>2023-02-02 13:16:09+00:00</td>
<td>2023-02-02 15:26:54+00:00</td>
<td>2023-02-02 15:26:53+00:00</td>
<td># Description\r\nThe code has been updated to ...</td>
<td>[]</td>
<td>[]</td>
<td>MiChaelinzo</td>
<td>[0.037689343, 0.008772637, -0.006663781, -0.03...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">127</td>
<td>2774346221</td>
<td>1288</td>
<td>Add `wrappers.vector.TransformObs/Action` sing...</td>
<td>closed</td>
<td>2025-01-08 05:39:52+00:00</td>
<td>2025-01-12 12:43:55+00:00</td>
<td>2025-01-12 12:43:55+00:00</td>
<td># Description\r\n\r\nFixes #1287\r\n\r\n## Typ...</td>
<td>[]</td>
<td>[]</td>
<td>howardh</td>
<td>[-0.0051537124, 0.0085140485, -0.0072919703, -...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Comments on issues include the comment body, creation and update timestamps, and the user who made the comment. The embeddings for the comment text are also included.</p>
<div id="9c2bcbc2" class="cell" data-execution_count="8">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="9c2bcbc2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="9c2bcbc2-1"><a href="#9c2bcbc2-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Sample issue comments:"</span>)</span>
<span id="9c2bcbc2-2"><a href="#9c2bcbc2-2" aria-hidden="true" tabindex="-1"></a>issue_comments.sample(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Sample issue comments:</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="7">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">issue_id</th>
<th data-quarto-table-cell-role="th">comment_id</th>
<th data-quarto-table-cell-role="th">user</th>
<th data-quarto-table-cell-role="th">created_at</th>
<th data-quarto-table-cell-role="th">updated_at</th>
<th data-quarto-table-cell-role="th">body</th>
<th data-quarto-table-cell-role="th">embeddings</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2005</td>
<td>1718352168</td>
<td>1562609339</td>
<td>jjshoots</td>
<td>2023-05-25 09:47:22+00:00</td>
<td>2023-05-25 09:58:55+00:00</td>
<td>@pseudo-rnd-thoughts In my edit it wasn't actu...</td>
<td>[0.01990752, 0.06396204, -0.0070522893, -0.036...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">986</td>
<td>2138606364</td>
<td>1949122830</td>
<td>Kallinteris-Andreas</td>
<td>2024-02-16 18:56:29+00:00</td>
<td>2024-02-16 18:56:29+00:00</td>
<td>Update: it now handles `nondeterministic` envi...</td>
<td>[0.0044486374, -0.007628141, -0.010253754, -0....</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">116</td>
<td>2930111508</td>
<td>2737406358</td>
<td>amacati</td>
<td>2025-03-19 17:00:01+00:00</td>
<td>2025-03-19 17:00:01+00:00</td>
<td>If 1.1 is out, should I update the Python requ...</td>
<td>[0.0014711036, 0.036554232, -0.0057385303, -0....</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2946</td>
<td>1413905787</td>
<td>1285802792</td>
<td>mgoulao</td>
<td>2022-10-20 15:59:50+00:00</td>
<td>2022-10-20 15:59:50+00:00</td>
<td>@pseudo-rnd-thoughts `vectorising.py` is raisi...</td>
<td>[0.014613141, -0.019691627, -0.014793664, -0.0...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2833</td>
<td>1436202749</td>
<td>1308868067</td>
<td>pseudo-rnd-thoughts</td>
<td>2022-11-09 14:42:29+00:00</td>
<td>2022-11-09 14:42:29+00:00</td>
<td>I think that a list of options (`list[dict]`) ...</td>
<td>[0.017504165, 0.0024789188, -0.011195177, -0.0...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>User data contains information about the users who raised issues or made comments, including their login, name, company, location, followers count, and account creation date.</p>
<div id="d446e1ea" class="cell" data-execution_count="9">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="d446e1ea"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="d446e1ea-1"><a href="#d446e1ea-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Sample users data:"</span>)</span>
<span id="d446e1ea-2"><a href="#d446e1ea-2" aria-hidden="true" tabindex="-1"></a>users_data.sample(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Sample users data:</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="8">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th">login</th>
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">company</th>
<th data-quarto-table-cell-role="th">location</th>
<th data-quarto-table-cell-role="th">followers</th>
<th data-quarto-table-cell-role="th">created_at</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">62</td>
<td>66969704</td>
<td>mariovas3</td>
<td>Mario Vasilev</td>
<td>None</td>
<td>London, United Kingdom</td>
<td>2</td>
<td>2020-06-15 18:43:17+00:00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">48</td>
<td>6186430</td>
<td>abouelsaadat</td>
<td>Mohamed Abouelsaadat</td>
<td>None</td>
<td>None</td>
<td>0</td>
<td>2013-12-14 18:34:14+00:00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">30</td>
<td>64679842</td>
<td>is-jang</td>
<td>장인성 (Insung Jang)</td>
<td>None</td>
<td>Busan, Republic of Korea</td>
<td>2</td>
<td>2020-05-02 06:53:53+00:00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">118</td>
<td>36020639</td>
<td>RuizhouLiu</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>1</td>
<td>2018-02-01 02:07:30+00:00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">450</td>
<td>18716355</td>
<td>YangyangFu</td>
<td>yyf</td>
<td>Texas A$M University</td>
<td>None</td>
<td>47</td>
<td>2016-04-28 08:40:11+00:00</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Labels associated with issues include their name, color, and description.</p>
<div id="a1339f21" class="cell" data-execution_count="10">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="a1339f21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="a1339f21-1"><a href="#a1339f21-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Sample labels data:"</span>)</span>
<span id="a1339f21-2"><a href="#a1339f21-2" aria-hidden="true" tabindex="-1"></a>labels_data.sample(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Sample labels data:</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="9">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">color</th>
<th data-quarto-table-cell-role="th">description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>github_actions</td>
<td>000000</td>
<td>Pull requests that update GitHub Actions code</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">8</td>
<td>documentation</td>
<td>0075ca</td>
<td>Improvements or additions to documentation</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>enhancement</td>
<td>a2eeef</td>
<td>New feature or request</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>dependencies</td>
<td>0366d6</td>
<td>Pull requests that update a dependency file</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>question</td>
<td>d876e3</td>
<td>Further information is requested</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Finally, issue events include information about events related to issues, such as when an issue was opened, closed, or commented on. The events also include the user who triggered the event and the timestamp of the event.</p>
<div id="e9305800" class="cell" data-execution_count="11">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="e9305800"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="e9305800-1"><a href="#e9305800-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Sample issue events:"</span>)</span>
<span id="e9305800-2"><a href="#e9305800-2" aria-hidden="true" tabindex="-1"></a>issue_events.sample(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Sample issue events:</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="10">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">issue_id</th>
<th data-quarto-table-cell-role="th">event_id</th>
<th data-quarto-table-cell-role="th">actor</th>
<th data-quarto-table-cell-role="th">event</th>
<th data-quarto-table-cell-role="th">created_at</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">4235</td>
<td>1691435458</td>
<td>9139915984</td>
<td>RedTachyon</td>
<td>merged</td>
<td>2023-05-01 21:45:29+00:00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2105</td>
<td>2118803859</td>
<td>11705850805</td>
<td>pseudo-rnd-thoughts</td>
<td>merged</td>
<td>2024-02-05 15:26:57+00:00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5711</td>
<td>1452193591</td>
<td>7837642524</td>
<td>pseudo-rnd-thoughts</td>
<td>referenced</td>
<td>2022-11-17 20:40:20+00:00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1643</td>
<td>2229274906</td>
<td>12381814404</td>
<td>pseudo-rnd-thoughts</td>
<td>closed</td>
<td>2024-04-06 14:44:10+00:00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2769</td>
<td>1991519068</td>
<td>10947309626</td>
<td>howardh</td>
<td>labeled</td>
<td>2023-11-13 21:31:40+00:00</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Once loaded into a graph, the data will be modeled as the following data architecture.</p>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">%%{
  init: {
    'theme': 'base',
    'themeVariables': {
      'fontSize': '16px'
    }
  }
}%%
graph TD
    subgraph "Graph Data Model"
        U[User]
        I[Issue]
        C[Comment]
        L[Label]
        E[Event]

        U -- "RAISED_BY" --&gt; I
        U -- "ASSIGNED_TO" --&gt; I
        U -- "COMMENT_BY" --&gt; C
        U -- "EVENT_BY" --&gt; E
        
        I -- "HAS_LABEL" --&gt; L
        I -- "MIGHT_RELATE_TO" --&gt; I
        
        C -- "COMMENT_ON" --&gt; I
        E -- "EVENT_ON" --&gt; I
    end
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
</section>
<section id="setting-up-the-neo4j-graph-database" class="level2">
<h2 class="anchored" data-anchor-id="setting-up-the-neo4j-graph-database">Setting up the Neo4j graph database</h2>
<p>We will use Neo4j Aura to store our issue data in a graph database. Neo4j Aura is a fully managed cloud service that provides a Neo4j database instance, which we can use to store and query our data. A number of helper methods are needed to set up the database schema, create constraints, and indexes, and to clear the database if needed.</p>
<p>First, we will connect to the Neo4j Aura instance using the <code>neo4j</code> Python driver. Make sure you have the necessary environment variables set for the connection.</p>
<div id="53a5aacb" class="cell" data-execution_count="12">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="53a5aacb"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="53a5aacb-1"><a href="#53a5aacb-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> neo4j <span class="im">import</span> GraphDatabase, basic_auth, Driver, Session, Transaction, Record</span>
<span id="53a5aacb-2"><a href="#53a5aacb-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> neo4j.graph <span class="im">import</span> Graph</span>
<span id="53a5aacb-3"><a href="#53a5aacb-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="53a5aacb-4"><a href="#53a5aacb-4" aria-hidden="true" tabindex="-1"></a>URI <span class="op">=</span> os.getenv(<span class="st">"NEO4J_URI"</span>)</span>
<span id="53a5aacb-5"><a href="#53a5aacb-5" aria-hidden="true" tabindex="-1"></a>USER <span class="op">=</span> os.getenv(<span class="st">"NEO4J_USERNAME"</span>)</span>
<span id="53a5aacb-6"><a href="#53a5aacb-6" aria-hidden="true" tabindex="-1"></a>PASSWORD <span class="op">=</span> os.getenv(<span class="st">"NEO4J_PASSWORD"</span>)</span>
<span id="53a5aacb-7"><a href="#53a5aacb-7" aria-hidden="true" tabindex="-1"></a>AUTH <span class="op">=</span> (USER, PASSWORD)</span>
<span id="53a5aacb-8"><a href="#53a5aacb-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="53a5aacb-9"><a href="#53a5aacb-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Connecting to Neo4j at </span><span class="sc">{</span>URI<span class="sc">}</span><span class="ss"> with user </span><span class="sc">{</span>USER<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="53a5aacb-10"><a href="#53a5aacb-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="53a5aacb-11"><a href="#53a5aacb-11" aria-hidden="true" tabindex="-1"></a>driver <span class="op">=</span> GraphDatabase.driver(URI, auth<span class="op">=</span>AUTH)</span>
<span id="53a5aacb-12"><a href="#53a5aacb-12" aria-hidden="true" tabindex="-1"></a>driver.verify_connectivity()</span>
<span id="53a5aacb-13"><a href="#53a5aacb-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="53a5aacb-14"><a href="#53a5aacb-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="53a5aacb-15"><a href="#53a5aacb-15" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test_aura_connection() <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="53a5aacb-16"><a href="#53a5aacb-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> driver.session() <span class="im">as</span> session:</span>
<span id="53a5aacb-17"><a href="#53a5aacb-17" aria-hidden="true" tabindex="-1"></a>        result <span class="op">=</span> session.run(<span class="st">"RETURN 'Hello, Aura!' AS message"</span>)</span>
<span id="53a5aacb-18"><a href="#53a5aacb-18" aria-hidden="true" tabindex="-1"></a>        record <span class="op">=</span> result.single()</span>
<span id="53a5aacb-19"><a href="#53a5aacb-19" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(record[<span class="st">"message"</span>])  <span class="co"># should print "Hello, Aura!"</span></span>
<span id="53a5aacb-20"><a href="#53a5aacb-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="53a5aacb-21"><a href="#53a5aacb-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="53a5aacb-22"><a href="#53a5aacb-22" aria-hidden="true" tabindex="-1"></a>test_aura_connection()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Connecting to Neo4j at neo4j+s://8c1ab3e4.databases.neo4j.io with user neo4j
Hello, Aura!</code></pre>
</div>
</div>
<p>We then need a few additional methods to manage the database schema, including dropping existing constraints and indexes, clearing the database, and creating new constraints and vector indexes for the issue and comment embeddings whenever we re-run the experiment. This is useful to ensure that we start with a clean slate and can easily modify the schema if needed.</p>
<div id="0a22ef2f" class="cell" data-execution_count="13">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="0a22ef2f"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="0a22ef2f-1"><a href="#0a22ef2f-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> drop_schema(tx: Transaction) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="0a22ef2f-2"><a href="#0a22ef2f-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Drop constraints</span></span>
<span id="0a22ef2f-3"><a href="#0a22ef2f-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> record <span class="kw">in</span> tx.run(<span class="st">"SHOW CONSTRAINTS"</span>):</span>
<span id="0a22ef2f-4"><a href="#0a22ef2f-4" aria-hidden="true" tabindex="-1"></a>        name <span class="op">=</span> record[<span class="st">"name"</span>]</span>
<span id="0a22ef2f-5"><a href="#0a22ef2f-5" aria-hidden="true" tabindex="-1"></a>        tx.run(<span class="ss">f"DROP CONSTRAINT `</span><span class="sc">{</span>name<span class="sc">}</span><span class="ss">`"</span>)</span>
<span id="0a22ef2f-6"><a href="#0a22ef2f-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Drop indexes</span></span>
<span id="0a22ef2f-7"><a href="#0a22ef2f-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> record <span class="kw">in</span> tx.run(<span class="st">"SHOW INDEXES"</span>):</span>
<span id="0a22ef2f-8"><a href="#0a22ef2f-8" aria-hidden="true" tabindex="-1"></a>        name <span class="op">=</span> record[<span class="st">"name"</span>]</span>
<span id="0a22ef2f-9"><a href="#0a22ef2f-9" aria-hidden="true" tabindex="-1"></a>        tx.run(<span class="ss">f"DROP INDEX `</span><span class="sc">{</span>name<span class="sc">}</span><span class="ss">`"</span>)</span>
<span id="0a22ef2f-10"><a href="#0a22ef2f-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="0a22ef2f-11"><a href="#0a22ef2f-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="0a22ef2f-12"><a href="#0a22ef2f-12" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> clear_database(tx: Transaction) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="0a22ef2f-13"><a href="#0a22ef2f-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Drop all nodes and relationships</span></span>
<span id="0a22ef2f-14"><a href="#0a22ef2f-14" aria-hidden="true" tabindex="-1"></a>    tx.run(<span class="st">"MATCH (n) DETACH DELETE n"</span>)</span>
<span id="0a22ef2f-15"><a href="#0a22ef2f-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="0a22ef2f-16"><a href="#0a22ef2f-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="0a22ef2f-17"><a href="#0a22ef2f-17" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_constraints(tx: Transaction) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="0a22ef2f-18"><a href="#0a22ef2f-18" aria-hidden="true" tabindex="-1"></a>    tx.run(<span class="st">"CREATE CONSTRAINT IF NOT EXISTS FOR (i:Issue) REQUIRE i.id IS UNIQUE"</span>)</span>
<span id="0a22ef2f-19"><a href="#0a22ef2f-19" aria-hidden="true" tabindex="-1"></a>    tx.run(<span class="st">"CREATE CONSTRAINT IF NOT EXISTS FOR (c:Comment) REQUIRE c.id IS UNIQUE"</span>)</span>
<span id="0a22ef2f-20"><a href="#0a22ef2f-20" aria-hidden="true" tabindex="-1"></a>    tx.run(<span class="st">"CREATE CONSTRAINT IF NOT EXISTS FOR (u:User) REQUIRE u.id IS UNIQUE"</span>)</span>
<span id="0a22ef2f-21"><a href="#0a22ef2f-21" aria-hidden="true" tabindex="-1"></a>    tx.run(<span class="st">"CREATE CONSTRAINT IF NOT EXISTS FOR (l:Label) REQUIRE l.name IS UNIQUE"</span>)</span>
<span id="0a22ef2f-22"><a href="#0a22ef2f-22" aria-hidden="true" tabindex="-1"></a>    tx.run(<span class="st">"CREATE CONSTRAINT IF NOT EXISTS FOR (e:Event) REQUIRE e.id IS UNIQUE"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>To store and query embeddings efficiently (the core of our RAG approach), we will create vector indexes for the issue and comment embeddings. The embedding dimensions will need to match the model’s output dimensions.</p>
<div id="c9054be3" class="cell" data-execution_count="14">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="c9054be3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="c9054be3-1"><a href="#c9054be3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_issue_vector_index(tx: Transaction, embedding_dim: <span class="bu">int</span> <span class="op">=</span> <span class="dv">768</span>) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="c9054be3-2"><a href="#c9054be3-2" aria-hidden="true" tabindex="-1"></a>    tx.run(</span>
<span id="c9054be3-3"><a href="#c9054be3-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">"""</span></span>
<span id="c9054be3-4"><a href="#c9054be3-4" aria-hidden="true" tabindex="-1"></a><span class="st">        CREATE VECTOR INDEX `issue_embeddings` IF NOT EXISTS</span></span>
<span id="c9054be3-5"><a href="#c9054be3-5" aria-hidden="true" tabindex="-1"></a><span class="st">        FOR (i:Issue)</span></span>
<span id="c9054be3-6"><a href="#c9054be3-6" aria-hidden="true" tabindex="-1"></a><span class="st">        ON i.embedding</span></span>
<span id="c9054be3-7"><a href="#c9054be3-7" aria-hidden="true" tabindex="-1"></a><span class="st">        OPTIONS {indexConfig: {</span></span>
<span id="c9054be3-8"><a href="#c9054be3-8" aria-hidden="true" tabindex="-1"></a><span class="st">            `vector.dimensions`: $embedding_dim,</span></span>
<span id="c9054be3-9"><a href="#c9054be3-9" aria-hidden="true" tabindex="-1"></a><span class="st">            `vector.similarity_function`: 'cosine'</span></span>
<span id="c9054be3-10"><a href="#c9054be3-10" aria-hidden="true" tabindex="-1"></a><span class="st">        </span><span class="sc">}}</span></span>
<span id="c9054be3-11"><a href="#c9054be3-11" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span>,</span>
<span id="c9054be3-12"><a href="#c9054be3-12" aria-hidden="true" tabindex="-1"></a>        embedding_dim<span class="op">=</span>embedding_dim,</span>
<span id="c9054be3-13"><a href="#c9054be3-13" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="c9054be3-14"><a href="#c9054be3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="c9054be3-15"><a href="#c9054be3-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="c9054be3-16"><a href="#c9054be3-16" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_comment_vector_index(tx: Transaction, embedding_dim: <span class="bu">int</span> <span class="op">=</span> <span class="dv">768</span>) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="c9054be3-17"><a href="#c9054be3-17" aria-hidden="true" tabindex="-1"></a>    tx.run(</span>
<span id="c9054be3-18"><a href="#c9054be3-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">"""</span></span>
<span id="c9054be3-19"><a href="#c9054be3-19" aria-hidden="true" tabindex="-1"></a><span class="st">        CREATE VECTOR INDEX `comment_embeddings` IF NOT EXISTS</span></span>
<span id="c9054be3-20"><a href="#c9054be3-20" aria-hidden="true" tabindex="-1"></a><span class="st">        FOR (c:Comment)</span></span>
<span id="c9054be3-21"><a href="#c9054be3-21" aria-hidden="true" tabindex="-1"></a><span class="st">        ON c.embedding</span></span>
<span id="c9054be3-22"><a href="#c9054be3-22" aria-hidden="true" tabindex="-1"></a><span class="st">        OPTIONS {indexConfig: {</span></span>
<span id="c9054be3-23"><a href="#c9054be3-23" aria-hidden="true" tabindex="-1"></a><span class="st">            `vector.dimensions`: $embedding_dim,</span></span>
<span id="c9054be3-24"><a href="#c9054be3-24" aria-hidden="true" tabindex="-1"></a><span class="st">            `vector.similarity_function`: 'cosine'</span></span>
<span id="c9054be3-25"><a href="#c9054be3-25" aria-hidden="true" tabindex="-1"></a><span class="st">        </span><span class="sc">}}</span></span>
<span id="c9054be3-26"><a href="#c9054be3-26" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span>,</span>
<span id="c9054be3-27"><a href="#c9054be3-27" aria-hidden="true" tabindex="-1"></a>        embedding_dim<span class="op">=</span>embedding_dim,</span>
<span id="c9054be3-28"><a href="#c9054be3-28" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="ada62536" class="cell" data-execution_count="15">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="ada62536"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="ada62536-1"><a href="#ada62536-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> driver.session(database<span class="op">=</span><span class="st">"neo4j"</span>) <span class="im">as</span> session:</span>
<span id="ada62536-2"><a href="#ada62536-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Clear the database</span></span>
<span id="ada62536-3"><a href="#ada62536-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Clearing the database..."</span>)</span>
<span id="ada62536-4"><a href="#ada62536-4" aria-hidden="true" tabindex="-1"></a>    session.execute_write(clear_database)</span>
<span id="ada62536-5"><a href="#ada62536-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="ada62536-6"><a href="#ada62536-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Drop existing schema</span></span>
<span id="ada62536-7"><a href="#ada62536-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Dropping existing schema..."</span>)</span>
<span id="ada62536-8"><a href="#ada62536-8" aria-hidden="true" tabindex="-1"></a>    session.execute_write(drop_schema)</span>
<span id="ada62536-9"><a href="#ada62536-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="ada62536-10"><a href="#ada62536-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create new constraints</span></span>
<span id="ada62536-11"><a href="#ada62536-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Creating new constraints..."</span>)</span>
<span id="ada62536-12"><a href="#ada62536-12" aria-hidden="true" tabindex="-1"></a>    session.execute_write(create_constraints)</span>
<span id="ada62536-13"><a href="#ada62536-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="ada62536-14"><a href="#ada62536-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create vector indexes</span></span>
<span id="ada62536-15"><a href="#ada62536-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Creating vector indexes..."</span>)</span>
<span id="ada62536-16"><a href="#ada62536-16" aria-hidden="true" tabindex="-1"></a>    session.execute_write(create_issue_vector_index, embedding_dim<span class="op">=</span>embedding_dim)</span>
<span id="ada62536-17"><a href="#ada62536-17" aria-hidden="true" tabindex="-1"></a>    session.execute_write(create_comment_vector_index, embedding_dim<span class="op">=</span>embedding_dim)</span>
<span id="ada62536-18"><a href="#ada62536-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="ada62536-19"><a href="#ada62536-19" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Schema updated successfully."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Clearing the database...
Dropping existing schema...
Creating new constraints...
Creating vector indexes...
Schema updated successfully.</code></pre>
</div>
</div>
</section>
<section id="importing-data-into-neo4j" class="level2">
<h2 class="anchored" data-anchor-id="importing-data-into-neo4j">Importing data into Neo4j</h2>
<p>We still need a few methods to import issue data. These methods will handle the insertion of users, labels, issues, comments, and events into the Neo4j database in batches. This is important for performance, especially when dealing with large datasets.</p>
<div id="3a772c0a" class="cell" data-execution_count="16">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="3a772c0a"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="3a772c0a-1"><a href="#3a772c0a-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> List, Dict, Any</span>
<span id="3a772c0a-2"><a href="#3a772c0a-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="3a772c0a-3"><a href="#3a772c0a-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="3a772c0a-4"><a href="#3a772c0a-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="3a772c0a-5"><a href="#3a772c0a-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _load_users_batch(tx: Transaction, batch: List[Dict[<span class="bu">str</span>, Any]]) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="3a772c0a-6"><a href="#3a772c0a-6" aria-hidden="true" tabindex="-1"></a>    tx.run(</span>
<span id="3a772c0a-7"><a href="#3a772c0a-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">"""</span></span>
<span id="3a772c0a-8"><a href="#3a772c0a-8" aria-hidden="true" tabindex="-1"></a><span class="st">        UNWIND $batch AS row</span></span>
<span id="3a772c0a-9"><a href="#3a772c0a-9" aria-hidden="true" tabindex="-1"></a><span class="st">        MERGE (u:User {id: row.id})</span></span>
<span id="3a772c0a-10"><a href="#3a772c0a-10" aria-hidden="true" tabindex="-1"></a><span class="st">        SET u.login = row.login,</span></span>
<span id="3a772c0a-11"><a href="#3a772c0a-11" aria-hidden="true" tabindex="-1"></a><span class="st">            u.name = row.name,</span></span>
<span id="3a772c0a-12"><a href="#3a772c0a-12" aria-hidden="true" tabindex="-1"></a><span class="st">            u.company = row.company,</span></span>
<span id="3a772c0a-13"><a href="#3a772c0a-13" aria-hidden="true" tabindex="-1"></a><span class="st">            u.location = row.location,</span></span>
<span id="3a772c0a-14"><a href="#3a772c0a-14" aria-hidden="true" tabindex="-1"></a><span class="st">            u.followers = row.followers,</span></span>
<span id="3a772c0a-15"><a href="#3a772c0a-15" aria-hidden="true" tabindex="-1"></a><span class="st">            u.created_at = CASE WHEN row.created_at IS NOT NULL THEN datetime(row.created_at) ELSE null END</span></span>
<span id="3a772c0a-16"><a href="#3a772c0a-16" aria-hidden="true" tabindex="-1"></a><span class="st">        """</span>,</span>
<span id="3a772c0a-17"><a href="#3a772c0a-17" aria-hidden="true" tabindex="-1"></a>        batch<span class="op">=</span>batch,</span>
<span id="3a772c0a-18"><a href="#3a772c0a-18" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="3a772c0a-19"><a href="#3a772c0a-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="3a772c0a-20"><a href="#3a772c0a-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="3a772c0a-21"><a href="#3a772c0a-21" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> import_users_batched(</span>
<span id="3a772c0a-22"><a href="#3a772c0a-22" aria-hidden="true" tabindex="-1"></a>    session: Session, users_df: pd.DataFrame, batch_size: <span class="bu">int</span> <span class="op">=</span> <span class="dv">128</span></span>
<span id="3a772c0a-23"><a href="#3a772c0a-23" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="3a772c0a-24"><a href="#3a772c0a-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> tqdm(<span class="bu">range</span>(<span class="dv">0</span>, <span class="bu">len</span>(users_df), batch_size), desc<span class="op">=</span><span class="st">"Importing users"</span>):</span>
<span id="3a772c0a-25"><a href="#3a772c0a-25" aria-hidden="true" tabindex="-1"></a>        batch <span class="op">=</span> users_df.iloc[i : i <span class="op">+</span> batch_size].to_dict(<span class="st">"records"</span>)</span>
<span id="3a772c0a-26"><a href="#3a772c0a-26" aria-hidden="true" tabindex="-1"></a>        session.execute_write(_load_users_batch, batch)</span>
<span id="3a772c0a-27"><a href="#3a772c0a-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="3a772c0a-28"><a href="#3a772c0a-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="3a772c0a-29"><a href="#3a772c0a-29" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _load_labels_batch(tx: Transaction, batch: List[Dict[<span class="bu">str</span>, Any]]) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="3a772c0a-30"><a href="#3a772c0a-30" aria-hidden="true" tabindex="-1"></a>    tx.run(</span>
<span id="3a772c0a-31"><a href="#3a772c0a-31" aria-hidden="true" tabindex="-1"></a>        <span class="st">"""</span></span>
<span id="3a772c0a-32"><a href="#3a772c0a-32" aria-hidden="true" tabindex="-1"></a><span class="st">        UNWIND $batch AS row</span></span>
<span id="3a772c0a-33"><a href="#3a772c0a-33" aria-hidden="true" tabindex="-1"></a><span class="st">        MERGE (l:Label {name: row.name})</span></span>
<span id="3a772c0a-34"><a href="#3a772c0a-34" aria-hidden="true" tabindex="-1"></a><span class="st">        SET l.color = row.color,</span></span>
<span id="3a772c0a-35"><a href="#3a772c0a-35" aria-hidden="true" tabindex="-1"></a><span class="st">            l.description = row.description</span></span>
<span id="3a772c0a-36"><a href="#3a772c0a-36" aria-hidden="true" tabindex="-1"></a><span class="st">        """</span>,</span>
<span id="3a772c0a-37"><a href="#3a772c0a-37" aria-hidden="true" tabindex="-1"></a>        batch<span class="op">=</span>batch,</span>
<span id="3a772c0a-38"><a href="#3a772c0a-38" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="3a772c0a-39"><a href="#3a772c0a-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="3a772c0a-40"><a href="#3a772c0a-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="3a772c0a-41"><a href="#3a772c0a-41" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> import_labels_batched(</span>
<span id="3a772c0a-42"><a href="#3a772c0a-42" aria-hidden="true" tabindex="-1"></a>    session: Session, labels_df: pd.DataFrame, batch_size: <span class="bu">int</span> <span class="op">=</span> <span class="dv">128</span></span>
<span id="3a772c0a-43"><a href="#3a772c0a-43" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="3a772c0a-44"><a href="#3a772c0a-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> tqdm(<span class="bu">range</span>(<span class="dv">0</span>, <span class="bu">len</span>(labels_df), batch_size), desc<span class="op">=</span><span class="st">"Importing labels"</span>):</span>
<span id="3a772c0a-45"><a href="#3a772c0a-45" aria-hidden="true" tabindex="-1"></a>        batch <span class="op">=</span> labels_df.iloc[i : i <span class="op">+</span> batch_size].to_dict(<span class="st">"records"</span>)</span>
<span id="3a772c0a-46"><a href="#3a772c0a-46" aria-hidden="true" tabindex="-1"></a>        session.execute_write(_load_labels_batch, batch)</span>
<span id="3a772c0a-47"><a href="#3a772c0a-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="3a772c0a-48"><a href="#3a772c0a-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="3a772c0a-49"><a href="#3a772c0a-49" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _load_issues_batch(tx: Transaction, batch: List[Dict[<span class="bu">str</span>, Any]]) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="3a772c0a-50"><a href="#3a772c0a-50" aria-hidden="true" tabindex="-1"></a>    tx.run(</span>
<span id="3a772c0a-51"><a href="#3a772c0a-51" aria-hidden="true" tabindex="-1"></a>        <span class="st">"""</span></span>
<span id="3a772c0a-52"><a href="#3a772c0a-52" aria-hidden="true" tabindex="-1"></a><span class="st">        UNWIND $batch AS row</span></span>
<span id="3a772c0a-53"><a href="#3a772c0a-53" aria-hidden="true" tabindex="-1"></a><span class="st">        MERGE (i:Issue {id: row.id})</span></span>
<span id="3a772c0a-54"><a href="#3a772c0a-54" aria-hidden="true" tabindex="-1"></a><span class="st">        SET i.number = row.number,</span></span>
<span id="3a772c0a-55"><a href="#3a772c0a-55" aria-hidden="true" tabindex="-1"></a><span class="st">            i.title = row.title,</span></span>
<span id="3a772c0a-56"><a href="#3a772c0a-56" aria-hidden="true" tabindex="-1"></a><span class="st">            i.state = row.state,</span></span>
<span id="3a772c0a-57"><a href="#3a772c0a-57" aria-hidden="true" tabindex="-1"></a><span class="st">            i.body = row.body,</span></span>
<span id="3a772c0a-58"><a href="#3a772c0a-58" aria-hidden="true" tabindex="-1"></a><span class="st">            i.created_at = datetime(row.created_at),</span></span>
<span id="3a772c0a-59"><a href="#3a772c0a-59" aria-hidden="true" tabindex="-1"></a><span class="st">            i.updated_at = datetime(row.updated_at),</span></span>
<span id="3a772c0a-60"><a href="#3a772c0a-60" aria-hidden="true" tabindex="-1"></a><span class="st">            i.closed_at = CASE WHEN row.closed_at IS NOT NULL THEN datetime(row.closed_at) ELSE null END,</span></span>
<span id="3a772c0a-61"><a href="#3a772c0a-61" aria-hidden="true" tabindex="-1"></a><span class="st">            i.embedding = row.embeddings</span></span>
<span id="3a772c0a-62"><a href="#3a772c0a-62" aria-hidden="true" tabindex="-1"></a><span class="st">        WITH i, row</span></span>
<span id="3a772c0a-63"><a href="#3a772c0a-63" aria-hidden="true" tabindex="-1"></a><span class="st">        MERGE (u:User {login: row.user})</span></span>
<span id="3a772c0a-64"><a href="#3a772c0a-64" aria-hidden="true" tabindex="-1"></a><span class="st">        MERGE (i)-[:RAISED_BY]-&gt;(u)</span></span>
<span id="3a772c0a-65"><a href="#3a772c0a-65" aria-hidden="true" tabindex="-1"></a><span class="st">        WITH i, row</span></span>
<span id="3a772c0a-66"><a href="#3a772c0a-66" aria-hidden="true" tabindex="-1"></a><span class="st">        UNWIND row.labels AS labelName</span></span>
<span id="3a772c0a-67"><a href="#3a772c0a-67" aria-hidden="true" tabindex="-1"></a><span class="st">          MERGE (l:Label {name: labelName})</span></span>
<span id="3a772c0a-68"><a href="#3a772c0a-68" aria-hidden="true" tabindex="-1"></a><span class="st">          MERGE (i)-[:HAS_LABEL]-&gt;(l)</span></span>
<span id="3a772c0a-69"><a href="#3a772c0a-69" aria-hidden="true" tabindex="-1"></a><span class="st">        WITH i, row</span></span>
<span id="3a772c0a-70"><a href="#3a772c0a-70" aria-hidden="true" tabindex="-1"></a><span class="st">        UNWIND row.assignees AS assigneeLogin</span></span>
<span id="3a772c0a-71"><a href="#3a772c0a-71" aria-hidden="true" tabindex="-1"></a><span class="st">          MERGE (a:User {login: assigneeLogin})</span></span>
<span id="3a772c0a-72"><a href="#3a772c0a-72" aria-hidden="true" tabindex="-1"></a><span class="st">          MERGE (i)-[:ASSIGNED_TO]-&gt;(a)</span></span>
<span id="3a772c0a-73"><a href="#3a772c0a-73" aria-hidden="true" tabindex="-1"></a><span class="st">        """</span>,</span>
<span id="3a772c0a-74"><a href="#3a772c0a-74" aria-hidden="true" tabindex="-1"></a>        batch<span class="op">=</span>batch,</span>
<span id="3a772c0a-75"><a href="#3a772c0a-75" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="3a772c0a-76"><a href="#3a772c0a-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="3a772c0a-77"><a href="#3a772c0a-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="3a772c0a-78"><a href="#3a772c0a-78" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> import_issues_batched(</span>
<span id="3a772c0a-79"><a href="#3a772c0a-79" aria-hidden="true" tabindex="-1"></a>    session: Session, issues_df: pd.DataFrame, batch_size: <span class="bu">int</span> <span class="op">=</span> <span class="dv">128</span></span>
<span id="3a772c0a-80"><a href="#3a772c0a-80" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="3a772c0a-81"><a href="#3a772c0a-81" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> tqdm(<span class="bu">range</span>(<span class="dv">0</span>, <span class="bu">len</span>(issues_df), batch_size), desc<span class="op">=</span><span class="st">"Importing issues"</span>):</span>
<span id="3a772c0a-82"><a href="#3a772c0a-82" aria-hidden="true" tabindex="-1"></a>        batch <span class="op">=</span> issues_df.iloc[i : i <span class="op">+</span> batch_size].to_dict(<span class="st">"records"</span>)</span>
<span id="3a772c0a-83"><a href="#3a772c0a-83" aria-hidden="true" tabindex="-1"></a>        session.execute_write(_load_issues_batch, batch)</span>
<span id="3a772c0a-84"><a href="#3a772c0a-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="3a772c0a-85"><a href="#3a772c0a-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="3a772c0a-86"><a href="#3a772c0a-86" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _load_comments_batch(tx: Transaction, batch: List[Dict[<span class="bu">str</span>, Any]]) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="3a772c0a-87"><a href="#3a772c0a-87" aria-hidden="true" tabindex="-1"></a>    tx.run(</span>
<span id="3a772c0a-88"><a href="#3a772c0a-88" aria-hidden="true" tabindex="-1"></a>        <span class="st">"""</span></span>
<span id="3a772c0a-89"><a href="#3a772c0a-89" aria-hidden="true" tabindex="-1"></a><span class="st">        UNWIND $batch AS row</span></span>
<span id="3a772c0a-90"><a href="#3a772c0a-90" aria-hidden="true" tabindex="-1"></a><span class="st">        MERGE (c:Comment {id: row.comment_id})</span></span>
<span id="3a772c0a-91"><a href="#3a772c0a-91" aria-hidden="true" tabindex="-1"></a><span class="st">        SET c.body = row.body,</span></span>
<span id="3a772c0a-92"><a href="#3a772c0a-92" aria-hidden="true" tabindex="-1"></a><span class="st">            c.created_at = datetime(row.created_at),</span></span>
<span id="3a772c0a-93"><a href="#3a772c0a-93" aria-hidden="true" tabindex="-1"></a><span class="st">            c.updated_at = datetime(row.updated_at),</span></span>
<span id="3a772c0a-94"><a href="#3a772c0a-94" aria-hidden="true" tabindex="-1"></a><span class="st">            c.embedding = row.embeddings</span></span>
<span id="3a772c0a-95"><a href="#3a772c0a-95" aria-hidden="true" tabindex="-1"></a><span class="st">        WITH c, row</span></span>
<span id="3a772c0a-96"><a href="#3a772c0a-96" aria-hidden="true" tabindex="-1"></a><span class="st">        MERGE (i:Issue {id: row.issue_id})</span></span>
<span id="3a772c0a-97"><a href="#3a772c0a-97" aria-hidden="true" tabindex="-1"></a><span class="st">        MERGE (c)-[:COMMENT_ON]-&gt;(i)</span></span>
<span id="3a772c0a-98"><a href="#3a772c0a-98" aria-hidden="true" tabindex="-1"></a><span class="st">        WITH c, row</span></span>
<span id="3a772c0a-99"><a href="#3a772c0a-99" aria-hidden="true" tabindex="-1"></a><span class="st">        MERGE (u:User {login: row.user})</span></span>
<span id="3a772c0a-100"><a href="#3a772c0a-100" aria-hidden="true" tabindex="-1"></a><span class="st">        MERGE (c)-[:COMMENT_BY]-&gt;(u)</span></span>
<span id="3a772c0a-101"><a href="#3a772c0a-101" aria-hidden="true" tabindex="-1"></a><span class="st">        """</span>,</span>
<span id="3a772c0a-102"><a href="#3a772c0a-102" aria-hidden="true" tabindex="-1"></a>        batch<span class="op">=</span>batch,</span>
<span id="3a772c0a-103"><a href="#3a772c0a-103" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="3a772c0a-104"><a href="#3a772c0a-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="3a772c0a-105"><a href="#3a772c0a-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="3a772c0a-106"><a href="#3a772c0a-106" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> import_comments_batched(</span>
<span id="3a772c0a-107"><a href="#3a772c0a-107" aria-hidden="true" tabindex="-1"></a>    session: Session, comments_df: pd.DataFrame, batch_size: <span class="bu">int</span> <span class="op">=</span> <span class="dv">128</span></span>
<span id="3a772c0a-108"><a href="#3a772c0a-108" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="3a772c0a-109"><a href="#3a772c0a-109" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> tqdm(<span class="bu">range</span>(<span class="dv">0</span>, <span class="bu">len</span>(comments_df), batch_size), desc<span class="op">=</span><span class="st">"Importing comments"</span>):</span>
<span id="3a772c0a-110"><a href="#3a772c0a-110" aria-hidden="true" tabindex="-1"></a>        batch <span class="op">=</span> comments_df.iloc[i : i <span class="op">+</span> batch_size].to_dict(<span class="st">"records"</span>)</span>
<span id="3a772c0a-111"><a href="#3a772c0a-111" aria-hidden="true" tabindex="-1"></a>        session.execute_write(_load_comments_batch, batch)</span>
<span id="3a772c0a-112"><a href="#3a772c0a-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="3a772c0a-113"><a href="#3a772c0a-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="3a772c0a-114"><a href="#3a772c0a-114" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _load_events_batch(tx: Transaction, batch: List[Dict[<span class="bu">str</span>, Any]]) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="3a772c0a-115"><a href="#3a772c0a-115" aria-hidden="true" tabindex="-1"></a>    tx.run(</span>
<span id="3a772c0a-116"><a href="#3a772c0a-116" aria-hidden="true" tabindex="-1"></a>        <span class="st">"""</span></span>
<span id="3a772c0a-117"><a href="#3a772c0a-117" aria-hidden="true" tabindex="-1"></a><span class="st">        UNWIND $batch AS row</span></span>
<span id="3a772c0a-118"><a href="#3a772c0a-118" aria-hidden="true" tabindex="-1"></a><span class="st">        MERGE (e:Event {id: row.event_id})</span></span>
<span id="3a772c0a-119"><a href="#3a772c0a-119" aria-hidden="true" tabindex="-1"></a><span class="st">        SET e.event = row.event,</span></span>
<span id="3a772c0a-120"><a href="#3a772c0a-120" aria-hidden="true" tabindex="-1"></a><span class="st">            e.created_at = datetime(row.created_at)</span></span>
<span id="3a772c0a-121"><a href="#3a772c0a-121" aria-hidden="true" tabindex="-1"></a><span class="st">        WITH e, row</span></span>
<span id="3a772c0a-122"><a href="#3a772c0a-122" aria-hidden="true" tabindex="-1"></a><span class="st">        MERGE (i:Issue {id: row.issue_id})</span></span>
<span id="3a772c0a-123"><a href="#3a772c0a-123" aria-hidden="true" tabindex="-1"></a><span class="st">        MERGE (e)-[:EVENT_ON]-&gt;(i)</span></span>
<span id="3a772c0a-124"><a href="#3a772c0a-124" aria-hidden="true" tabindex="-1"></a><span class="st">        WITH e, row</span></span>
<span id="3a772c0a-125"><a href="#3a772c0a-125" aria-hidden="true" tabindex="-1"></a><span class="st">        WHERE row.actor IS NOT NULL</span></span>
<span id="3a772c0a-126"><a href="#3a772c0a-126" aria-hidden="true" tabindex="-1"></a><span class="st">        MERGE (u:User {login: row.actor})</span></span>
<span id="3a772c0a-127"><a href="#3a772c0a-127" aria-hidden="true" tabindex="-1"></a><span class="st">        MERGE (e)-[:EVENT_BY]-&gt;(u)</span></span>
<span id="3a772c0a-128"><a href="#3a772c0a-128" aria-hidden="true" tabindex="-1"></a><span class="st">        """</span>,</span>
<span id="3a772c0a-129"><a href="#3a772c0a-129" aria-hidden="true" tabindex="-1"></a>        batch<span class="op">=</span>batch,</span>
<span id="3a772c0a-130"><a href="#3a772c0a-130" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="3a772c0a-131"><a href="#3a772c0a-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="3a772c0a-132"><a href="#3a772c0a-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="3a772c0a-133"><a href="#3a772c0a-133" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> import_events_batched(</span>
<span id="3a772c0a-134"><a href="#3a772c0a-134" aria-hidden="true" tabindex="-1"></a>    session: Session, events_df: pd.DataFrame, batch_size: <span class="bu">int</span> <span class="op">=</span> <span class="dv">128</span></span>
<span id="3a772c0a-135"><a href="#3a772c0a-135" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="3a772c0a-136"><a href="#3a772c0a-136" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> tqdm(<span class="bu">range</span>(<span class="dv">0</span>, <span class="bu">len</span>(events_df), batch_size), desc<span class="op">=</span><span class="st">"Importing events"</span>):</span>
<span id="3a772c0a-137"><a href="#3a772c0a-137" aria-hidden="true" tabindex="-1"></a>        batch <span class="op">=</span> events_df.iloc[i : i <span class="op">+</span> batch_size].to_dict(<span class="st">"records"</span>)</span>
<span id="3a772c0a-138"><a href="#3a772c0a-138" aria-hidden="true" tabindex="-1"></a>        session.execute_write(_load_events_batch, batch)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We can now import the data, creating nodes and relationships for users, labels, issues, comments, and events in the graph database.</p>
<div id="5e8040a4" class="cell" data-execution_count="17">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="5e8040a4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="5e8040a4-1"><a href="#5e8040a4-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> driver.session() <span class="im">as</span> session:</span>
<span id="5e8040a4-2"><a href="#5e8040a4-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Import data</span></span>
<span id="5e8040a4-3"><a href="#5e8040a4-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Importing data..."</span>)</span>
<span id="5e8040a4-4"><a href="#5e8040a4-4" aria-hidden="true" tabindex="-1"></a>    import_users_batched(session, users_data)</span>
<span id="5e8040a4-5"><a href="#5e8040a4-5" aria-hidden="true" tabindex="-1"></a>    import_labels_batched(session, labels_data)</span>
<span id="5e8040a4-6"><a href="#5e8040a4-6" aria-hidden="true" tabindex="-1"></a>    import_issues_batched(session, issue_data)</span>
<span id="5e8040a4-7"><a href="#5e8040a4-7" aria-hidden="true" tabindex="-1"></a>    import_comments_batched(session, issue_comments)</span>
<span id="5e8040a4-8"><a href="#5e8040a4-8" aria-hidden="true" tabindex="-1"></a>    import_events_batched(session, issue_events)</span>
<span id="5e8040a4-9"><a href="#5e8040a4-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Data imported successfully."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Importing data...</code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"3bac5771b14b4afc800fa10fd46f6580","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"ad02c2658c3d456ead5f772559134505","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"a58df76e984249908d3cc40be99493a1","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"44dc2f2d9c4b4829ad35f99b8278ec1f","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"a27f145ce1c2493692ed1ce43695ffec","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Data imported successfully.</code></pre>
</div>
</div>
</section>
<section id="visualising-our-graph" class="level2">
<h2 class="anchored" data-anchor-id="visualising-our-graph">Visualising our graph</h2>
<p>A picture is worth a thousand words, we can use the <a href="https://pyvis.readthedocs.io/en/latest/">Pyvis</a> library to visualize the graph we have created in Neo4j. It is a great way to get an immediate intuitive understanding of the data and their relationships. Let us quickly create a method to convert the Neo4j graph object into a Pyvis Network object, which we can then visualize.</p>
<div id="0326ab72" class="cell" data-execution_count="18">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="0326ab72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="0326ab72-1"><a href="#0326ab72-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyvis.network <span class="im">import</span> Network</span>
<span id="0326ab72-2"><a href="#0326ab72-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="0326ab72-3"><a href="#0326ab72-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> neo4j.graph <span class="im">import</span> Node, Relationship</span>
<span id="0326ab72-4"><a href="#0326ab72-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="0326ab72-5"><a href="#0326ab72-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="0326ab72-6"><a href="#0326ab72-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_pyvis_network_from_neo4j(graph: Graph) <span class="op">-&gt;</span> Network:</span>
<span id="0326ab72-7"><a href="#0326ab72-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="0326ab72-8"><a href="#0326ab72-8" aria-hidden="true" tabindex="-1"></a><span class="co">    Creates a Pyvis Network object from a Neo4j graph object.</span></span>
<span id="0326ab72-9"><a href="#0326ab72-9" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="0326ab72-10"><a href="#0326ab72-10" aria-hidden="true" tabindex="-1"></a>    net <span class="op">=</span> Network(</span>
<span id="0326ab72-11"><a href="#0326ab72-11" aria-hidden="true" tabindex="-1"></a>        notebook<span class="op">=</span><span class="va">True</span>,</span>
<span id="0326ab72-12"><a href="#0326ab72-12" aria-hidden="true" tabindex="-1"></a>        cdn_resources<span class="op">=</span><span class="st">"in_line"</span>,</span>
<span id="0326ab72-13"><a href="#0326ab72-13" aria-hidden="true" tabindex="-1"></a>        height<span class="op">=</span><span class="st">"750px"</span>,</span>
<span id="0326ab72-14"><a href="#0326ab72-14" aria-hidden="true" tabindex="-1"></a>        width<span class="op">=</span><span class="st">"100%"</span>,</span>
<span id="0326ab72-15"><a href="#0326ab72-15" aria-hidden="true" tabindex="-1"></a>        bgcolor<span class="op">=</span><span class="st">"#ffffff"</span>,</span>
<span id="0326ab72-16"><a href="#0326ab72-16" aria-hidden="true" tabindex="-1"></a>        font_color<span class="op">=</span><span class="st">"black"</span>,</span>
<span id="0326ab72-17"><a href="#0326ab72-17" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="0326ab72-18"><a href="#0326ab72-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="0326ab72-19"><a href="#0326ab72-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> node <span class="kw">in</span> graph.nodes:</span>
<span id="0326ab72-20"><a href="#0326ab72-20" aria-hidden="true" tabindex="-1"></a>        node_id <span class="op">=</span> node.element_id</span>
<span id="0326ab72-21"><a href="#0326ab72-21" aria-hidden="true" tabindex="-1"></a>        labels <span class="op">=</span> <span class="bu">list</span>(node.labels)</span>
<span id="0326ab72-22"><a href="#0326ab72-22" aria-hidden="true" tabindex="-1"></a>        group <span class="op">=</span> labels[<span class="dv">0</span>] <span class="cf">if</span> labels <span class="cf">else</span> <span class="st">"Node"</span></span>
<span id="0326ab72-23"><a href="#0326ab72-23" aria-hidden="true" tabindex="-1"></a>        properties <span class="op">=</span> <span class="bu">dict</span>(node)</span>
<span id="0326ab72-24"><a href="#0326ab72-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="0326ab72-25"><a href="#0326ab72-25" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Plain‑text title with newlines</span></span>
<span id="0326ab72-26"><a href="#0326ab72-26" aria-hidden="true" tabindex="-1"></a>        title_lines <span class="op">=</span> [group]</span>
<span id="0326ab72-27"><a href="#0326ab72-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> k, v <span class="kw">in</span> properties.items():</span>
<span id="0326ab72-28"><a href="#0326ab72-28" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> k <span class="op">==</span> <span class="st">"embedding"</span>:</span>
<span id="0326ab72-29"><a href="#0326ab72-29" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="0326ab72-30"><a href="#0326ab72-30" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> k <span class="op">==</span> <span class="st">"body"</span> <span class="kw">and</span> v <span class="kw">and</span> <span class="bu">len</span>(v) <span class="op">&gt;</span> <span class="dv">512</span>:</span>
<span id="0326ab72-31"><a href="#0326ab72-31" aria-hidden="true" tabindex="-1"></a>                v <span class="op">=</span> v[:<span class="dv">512</span>] <span class="op">+</span> <span class="st">"..."</span></span>
<span id="0326ab72-32"><a href="#0326ab72-32" aria-hidden="true" tabindex="-1"></a>            title_lines.append(<span class="ss">f"</span><span class="sc">{</span>k<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>v<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="0326ab72-33"><a href="#0326ab72-33" aria-hidden="true" tabindex="-1"></a>        title <span class="op">=</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>.join(title_lines)</span>
<span id="0326ab72-34"><a href="#0326ab72-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="0326ab72-35"><a href="#0326ab72-35" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Use a specific property for the label if available</span></span>
<span id="0326ab72-36"><a href="#0326ab72-36" aria-hidden="true" tabindex="-1"></a>        node_label <span class="op">=</span> <span class="bu">str</span>(</span>
<span id="0326ab72-37"><a href="#0326ab72-37" aria-hidden="true" tabindex="-1"></a>            properties.get(<span class="st">"title"</span>)</span>
<span id="0326ab72-38"><a href="#0326ab72-38" aria-hidden="true" tabindex="-1"></a>            <span class="kw">or</span> properties.get(<span class="st">"name"</span>)</span>
<span id="0326ab72-39"><a href="#0326ab72-39" aria-hidden="true" tabindex="-1"></a>            <span class="kw">or</span> properties.get(<span class="st">"login"</span>)</span>
<span id="0326ab72-40"><a href="#0326ab72-40" aria-hidden="true" tabindex="-1"></a>            <span class="kw">or</span> properties.get(<span class="st">"id"</span>)</span>
<span id="0326ab72-41"><a href="#0326ab72-41" aria-hidden="true" tabindex="-1"></a>            <span class="kw">or</span> node_id</span>
<span id="0326ab72-42"><a href="#0326ab72-42" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="0326ab72-43"><a href="#0326ab72-43" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(node_label) <span class="op">&gt;</span> <span class="dv">30</span>:</span>
<span id="0326ab72-44"><a href="#0326ab72-44" aria-hidden="true" tabindex="-1"></a>            node_label <span class="op">=</span> node_label[:<span class="dv">27</span>] <span class="op">+</span> <span class="st">"..."</span></span>
<span id="0326ab72-45"><a href="#0326ab72-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="0326ab72-46"><a href="#0326ab72-46" aria-hidden="true" tabindex="-1"></a>        node_size <span class="op">=</span> <span class="dv">25</span></span>
<span id="0326ab72-47"><a href="#0326ab72-47" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">"Issue"</span> <span class="kw">in</span> labels:</span>
<span id="0326ab72-48"><a href="#0326ab72-48" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Make the node size relative to the number of related nodes</span></span>
<span id="0326ab72-49"><a href="#0326ab72-49" aria-hidden="true" tabindex="-1"></a>            related_nodes <span class="op">=</span> <span class="bu">len</span>(</span>
<span id="0326ab72-50"><a href="#0326ab72-50" aria-hidden="true" tabindex="-1"></a>                [</span>
<span id="0326ab72-51"><a href="#0326ab72-51" aria-hidden="true" tabindex="-1"></a>                    rel</span>
<span id="0326ab72-52"><a href="#0326ab72-52" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> rel <span class="kw">in</span> graph.relationships</span>
<span id="0326ab72-53"><a href="#0326ab72-53" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> rel.start_node.element_id <span class="op">==</span> node_id</span>
<span id="0326ab72-54"><a href="#0326ab72-54" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">or</span> rel.end_node.element_id <span class="op">==</span> node_id</span>
<span id="0326ab72-55"><a href="#0326ab72-55" aria-hidden="true" tabindex="-1"></a>                ]</span>
<span id="0326ab72-56"><a href="#0326ab72-56" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="0326ab72-57"><a href="#0326ab72-57" aria-hidden="true" tabindex="-1"></a>            node_size <span class="op">+=</span> related_nodes</span>
<span id="0326ab72-58"><a href="#0326ab72-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="0326ab72-59"><a href="#0326ab72-59" aria-hidden="true" tabindex="-1"></a>        net.add_node(</span>
<span id="0326ab72-60"><a href="#0326ab72-60" aria-hidden="true" tabindex="-1"></a>            node_id, label<span class="op">=</span>node_label, title<span class="op">=</span>title, group<span class="op">=</span>group, size<span class="op">=</span>node_size</span>
<span id="0326ab72-61"><a href="#0326ab72-61" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="0326ab72-62"><a href="#0326ab72-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="0326ab72-63"><a href="#0326ab72-63" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add edges</span></span>
<span id="0326ab72-64"><a href="#0326ab72-64" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> rel <span class="kw">in</span> graph.relationships:</span>
<span id="0326ab72-65"><a href="#0326ab72-65" aria-hidden="true" tabindex="-1"></a>        source_id <span class="op">=</span> rel.start_node.element_id</span>
<span id="0326ab72-66"><a href="#0326ab72-66" aria-hidden="true" tabindex="-1"></a>        target_id <span class="op">=</span> rel.end_node.element_id</span>
<span id="0326ab72-67"><a href="#0326ab72-67" aria-hidden="true" tabindex="-1"></a>        net.add_edge(source_id, target_id, title<span class="op">=</span>rel.<span class="bu">type</span>, arrows<span class="op">=</span><span class="st">"to"</span>, dashes<span class="op">=</span><span class="va">True</span>)</span>
<span id="0326ab72-68"><a href="#0326ab72-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="0326ab72-69"><a href="#0326ab72-69" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> net</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>So we don’t overwhelm the visualization with too many nodes, we will sample a subset of the graph data. We can use random sampling with Cypher’s <code>rand</code> method to select a limited number of issues and their related nodes. You can zoom in and out of the visualization, and click on nodes to see their properties in the graph.</p>
<div id="b1aeb6e2" class="cell" data-execution_count="19">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="b1aeb6e2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="b1aeb6e2-1"><a href="#b1aeb6e2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Query Neo4j to get a sample of the graph data</span></span>
<span id="b1aeb6e2-2"><a href="#b1aeb6e2-2" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> driver.session() <span class="im">as</span> session:</span>
<span id="b1aeb6e2-3"><a href="#b1aeb6e2-3" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> session.run(</span>
<span id="b1aeb6e2-4"><a href="#b1aeb6e2-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">"""</span></span>
<span id="b1aeb6e2-5"><a href="#b1aeb6e2-5" aria-hidden="true" tabindex="-1"></a><span class="st">    MATCH (i:Issue)</span></span>
<span id="b1aeb6e2-6"><a href="#b1aeb6e2-6" aria-hidden="true" tabindex="-1"></a><span class="st">    WITH i, rand() AS r ORDER BY r LIMIT 50</span></span>
<span id="b1aeb6e2-7"><a href="#b1aeb6e2-7" aria-hidden="true" tabindex="-1"></a><span class="st">    MATCH (i)-[rel]-(neighbor)</span></span>
<span id="b1aeb6e2-8"><a href="#b1aeb6e2-8" aria-hidden="true" tabindex="-1"></a><span class="st">    RETURN i, rel, neighbor</span></span>
<span id="b1aeb6e2-9"><a href="#b1aeb6e2-9" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span></span>
<span id="b1aeb6e2-10"><a href="#b1aeb6e2-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="b1aeb6e2-11"><a href="#b1aeb6e2-11" aria-hidden="true" tabindex="-1"></a>    graph <span class="op">=</span> result.graph()</span>
<span id="b1aeb6e2-12"><a href="#b1aeb6e2-12" aria-hidden="true" tabindex="-1"></a>    net <span class="op">=</span> create_pyvis_network_from_neo4j(graph)</span>
<span id="b1aeb6e2-13"><a href="#b1aeb6e2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="b1aeb6e2-14"><a href="#b1aeb6e2-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Configure physics and controls</span></span>
<span id="b1aeb6e2-15"><a href="#b1aeb6e2-15" aria-hidden="true" tabindex="-1"></a>net.toggle_physics(<span class="va">True</span>)</span>
<span id="b1aeb6e2-16"><a href="#b1aeb6e2-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="b1aeb6e2-17"><a href="#b1aeb6e2-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the visualization to HTML</span></span>
<span id="b1aeb6e2-18"><a href="#b1aeb6e2-18" aria-hidden="true" tabindex="-1"></a>net.show(<span class="st">"graph_visualization.html"</span>, notebook<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>graph_visualization.html</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="18">

        <iframe width="100%" height="750px" src="graph_visualization.html" frameborder="0" allowfullscreen=""></iframe>
        
</div>
</div>
</section>
<section id="computing-similarity-links" class="level2">
<h2 class="anchored" data-anchor-id="computing-similarity-links">Computing similarity links</h2>
<p>By comparing the embeddings of issues and their comments, we can create <code>MIGHT_RELATE_TO</code> relationships between issues that are semantically similar. This can help in identifying duplicate or related issues, and in understanding the context of a given issue by looking at which others might contain important information related to the problem at hand.</p>
<p>This will help us build a more connected graph, with more meaningful relationships between relevant problems.</p>
<div id="6d3f82c0" class="cell" data-execution_count="20">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="6d3f82c0"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="6d3f82c0-1"><a href="#6d3f82c0-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_similarity_links(tx: Transaction, min_score: <span class="bu">float</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="6d3f82c0-2"><a href="#6d3f82c0-2" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> tx.run(</span>
<span id="6d3f82c0-3"><a href="#6d3f82c0-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">"""</span></span>
<span id="6d3f82c0-4"><a href="#6d3f82c0-4" aria-hidden="true" tabindex="-1"></a><span class="st">        // issue→issue and issue→comment similarities</span></span>
<span id="6d3f82c0-5"><a href="#6d3f82c0-5" aria-hidden="true" tabindex="-1"></a><span class="st">        MATCH (i:Issue)</span></span>
<span id="6d3f82c0-6"><a href="#6d3f82c0-6" aria-hidden="true" tabindex="-1"></a><span class="st">        CALL {</span></span>
<span id="6d3f82c0-7"><a href="#6d3f82c0-7" aria-hidden="true" tabindex="-1"></a><span class="st">          WITH i</span></span>
<span id="6d3f82c0-8"><a href="#6d3f82c0-8" aria-hidden="true" tabindex="-1"></a><span class="st">          CALL db.index.vector.queryNodes('issue_embeddings', 10, i.embedding)</span></span>
<span id="6d3f82c0-9"><a href="#6d3f82c0-9" aria-hidden="true" tabindex="-1"></a><span class="st">            YIELD node AS similar_issue, score</span></span>
<span id="6d3f82c0-10"><a href="#6d3f82c0-10" aria-hidden="true" tabindex="-1"></a><span class="st">          RETURN i AS issue, similar_issue, score</span></span>
<span id="6d3f82c0-11"><a href="#6d3f82c0-11" aria-hidden="true" tabindex="-1"></a><span class="st">          UNION</span></span>
<span id="6d3f82c0-12"><a href="#6d3f82c0-12" aria-hidden="true" tabindex="-1"></a><span class="st">          WITH i</span></span>
<span id="6d3f82c0-13"><a href="#6d3f82c0-13" aria-hidden="true" tabindex="-1"></a><span class="st">          CALL db.index.vector.queryNodes('comment_embeddings', 10, i.embedding)</span></span>
<span id="6d3f82c0-14"><a href="#6d3f82c0-14" aria-hidden="true" tabindex="-1"></a><span class="st">            YIELD node AS similar_comment, score</span></span>
<span id="6d3f82c0-15"><a href="#6d3f82c0-15" aria-hidden="true" tabindex="-1"></a><span class="st">          MATCH (similar_issue:Issue)&lt;-[:COMMENT_ON]-(similar_comment)</span></span>
<span id="6d3f82c0-16"><a href="#6d3f82c0-16" aria-hidden="true" tabindex="-1"></a><span class="st">          RETURN i AS issue, similar_issue, score</span></span>
<span id="6d3f82c0-17"><a href="#6d3f82c0-17" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="6d3f82c0-18"><a href="#6d3f82c0-18" aria-hidden="true" tabindex="-1"></a><span class="st">        WITH issue, similar_issue, score</span></span>
<span id="6d3f82c0-19"><a href="#6d3f82c0-19" aria-hidden="true" tabindex="-1"></a><span class="st">        WHERE score &gt;= $min_score AND elementId(issue) &lt; elementId(similar_issue)</span></span>
<span id="6d3f82c0-20"><a href="#6d3f82c0-20" aria-hidden="true" tabindex="-1"></a><span class="st">        WITH issue, similar_issue, max(score) AS max_score</span></span>
<span id="6d3f82c0-21"><a href="#6d3f82c0-21" aria-hidden="true" tabindex="-1"></a><span class="st">        MERGE (issue)-[r:MIGHT_RELATE_TO]-&gt;(similar_issue)</span></span>
<span id="6d3f82c0-22"><a href="#6d3f82c0-22" aria-hidden="true" tabindex="-1"></a><span class="st">        SET r.score = max_score</span></span>
<span id="6d3f82c0-23"><a href="#6d3f82c0-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="6d3f82c0-24"><a href="#6d3f82c0-24" aria-hidden="true" tabindex="-1"></a><span class="st">        // comment→issue similarities (no shadowing in import WITH)</span></span>
<span id="6d3f82c0-25"><a href="#6d3f82c0-25" aria-hidden="true" tabindex="-1"></a><span class="st">        WITH issue</span></span>
<span id="6d3f82c0-26"><a href="#6d3f82c0-26" aria-hidden="true" tabindex="-1"></a><span class="st">        MATCH (issue)&lt;-[:COMMENT_ON]-(c:Comment)</span></span>
<span id="6d3f82c0-27"><a href="#6d3f82c0-27" aria-hidden="true" tabindex="-1"></a><span class="st">        CALL {</span></span>
<span id="6d3f82c0-28"><a href="#6d3f82c0-28" aria-hidden="true" tabindex="-1"></a><span class="st">          WITH c, issue</span></span>
<span id="6d3f82c0-29"><a href="#6d3f82c0-29" aria-hidden="true" tabindex="-1"></a><span class="st">          CALL db.index.vector.queryNodes('issue_embeddings', 10, c.embedding)</span></span>
<span id="6d3f82c0-30"><a href="#6d3f82c0-30" aria-hidden="true" tabindex="-1"></a><span class="st">            YIELD node AS similar_issue, score</span></span>
<span id="6d3f82c0-31"><a href="#6d3f82c0-31" aria-hidden="true" tabindex="-1"></a><span class="st">          // alias here, not in the WITH</span></span>
<span id="6d3f82c0-32"><a href="#6d3f82c0-32" aria-hidden="true" tabindex="-1"></a><span class="st">          RETURN issue AS parent_issue, similar_issue, score</span></span>
<span id="6d3f82c0-33"><a href="#6d3f82c0-33" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="6d3f82c0-34"><a href="#6d3f82c0-34" aria-hidden="true" tabindex="-1"></a><span class="st">        // safely re‑alias back to `issue`</span></span>
<span id="6d3f82c0-35"><a href="#6d3f82c0-35" aria-hidden="true" tabindex="-1"></a><span class="st">        WITH parent_issue AS issue, similar_issue, score</span></span>
<span id="6d3f82c0-36"><a href="#6d3f82c0-36" aria-hidden="true" tabindex="-1"></a><span class="st">        WHERE score &gt;= $min_score AND elementId(issue) &lt; elementId(similar_issue)</span></span>
<span id="6d3f82c0-37"><a href="#6d3f82c0-37" aria-hidden="true" tabindex="-1"></a><span class="st">        WITH issue, similar_issue, max(score) AS max_score</span></span>
<span id="6d3f82c0-38"><a href="#6d3f82c0-38" aria-hidden="true" tabindex="-1"></a><span class="st">        MERGE (issue)-[r:MIGHT_RELATE_TO]-&gt;(similar_issue)</span></span>
<span id="6d3f82c0-39"><a href="#6d3f82c0-39" aria-hidden="true" tabindex="-1"></a><span class="st">        SET r.score = max_score</span></span>
<span id="6d3f82c0-40"><a href="#6d3f82c0-40" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span>,</span>
<span id="6d3f82c0-41"><a href="#6d3f82c0-41" aria-hidden="true" tabindex="-1"></a>        min_score<span class="op">=</span>min_score,</span>
<span id="6d3f82c0-42"><a href="#6d3f82c0-42" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="6d3f82c0-43"><a href="#6d3f82c0-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result.consume().counters.relationships_created</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We will set a minimum score threshold of 0.75 (keep in mind cosine similarity scores can range from -1 to 1) for the similarity links to avoid creating too many relationships that might not be meaningful. This threshold can be adjusted based on the specific use case and the quality of the embeddings.</p>
<div id="94e5daf1" class="cell" data-execution_count="21">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="94e5daf1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="94e5daf1-1"><a href="#94e5daf1-1" aria-hidden="true" tabindex="-1"></a>min_score_threshold <span class="op">=</span> <span class="fl">0.75</span></span>
<span id="94e5daf1-2"><a href="#94e5daf1-2" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> driver.session() <span class="im">as</span> session:</span>
<span id="94e5daf1-3"><a href="#94e5daf1-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(</span>
<span id="94e5daf1-4"><a href="#94e5daf1-4" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"Creating MIGHT_RELATE_TO relationships between issues with score &gt;= </span><span class="sc">{</span>min_score_threshold<span class="sc">}</span><span class="ss">..."</span></span>
<span id="94e5daf1-5"><a href="#94e5daf1-5" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="94e5daf1-6"><a href="#94e5daf1-6" aria-hidden="true" tabindex="-1"></a>    num_rels_created <span class="op">=</span> session.execute_write(</span>
<span id="94e5daf1-7"><a href="#94e5daf1-7" aria-hidden="true" tabindex="-1"></a>        create_similarity_links, min_score<span class="op">=</span>min_score_threshold</span>
<span id="94e5daf1-8"><a href="#94e5daf1-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="94e5daf1-9"><a href="#94e5daf1-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Created </span><span class="sc">{</span>num_rels_created<span class="sc">}</span><span class="ss"> MIGHT_RELATE_TO relationships."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Creating MIGHT_RELATE_TO relationships between issues with score &gt;= 0.75...</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Created 19282 MIGHT_RELATE_TO relationships.</code></pre>
</div>
</div>
<section id="visualizing-related-issues" class="level3">
<h3 class="anchored" data-anchor-id="visualizing-related-issues">Visualizing related issues</h3>
<p>To visualize the relationships between issues, we can create a Pyvis network that includes the <code>MIGHT_RELATE_TO</code> relationships. This will help us see how issues are connected based on their semantic similarity. To further enhance the visualisation, we will also perform community detection on the graph, to group similar issues together using correlated colors.</p>
<div id="4eef16f6" class="cell" data-execution_count="22">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="4eef16f6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="4eef16f6-1"><a href="#4eef16f6-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> networkx <span class="im">as</span> nx</span>
<span id="4eef16f6-2"><a href="#4eef16f6-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> networkx.algorithms <span class="im">import</span> community</span>
<span id="4eef16f6-3"><a href="#4eef16f6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="4eef16f6-4"><a href="#4eef16f6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="4eef16f6-5"><a href="#4eef16f6-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_pyvis_network_from_networkx(</span>
<span id="4eef16f6-6"><a href="#4eef16f6-6" aria-hidden="true" tabindex="-1"></a>    G: nx.Graph, node_community: <span class="bu">dict</span>, min_score_threshold: <span class="bu">float</span></span>
<span id="4eef16f6-7"><a href="#4eef16f6-7" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> Network:</span>
<span id="4eef16f6-8"><a href="#4eef16f6-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="4eef16f6-9"><a href="#4eef16f6-9" aria-hidden="true" tabindex="-1"></a><span class="co">    Creates a Pyvis Network object from a NetworkX graph object, with community information.</span></span>
<span id="4eef16f6-10"><a href="#4eef16f6-10" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="4eef16f6-11"><a href="#4eef16f6-11" aria-hidden="true" tabindex="-1"></a>    net <span class="op">=</span> Network(</span>
<span id="4eef16f6-12"><a href="#4eef16f6-12" aria-hidden="true" tabindex="-1"></a>        notebook<span class="op">=</span><span class="va">True</span>,</span>
<span id="4eef16f6-13"><a href="#4eef16f6-13" aria-hidden="true" tabindex="-1"></a>        cdn_resources<span class="op">=</span><span class="st">"in_line"</span>,</span>
<span id="4eef16f6-14"><a href="#4eef16f6-14" aria-hidden="true" tabindex="-1"></a>        height<span class="op">=</span><span class="st">"750px"</span>,</span>
<span id="4eef16f6-15"><a href="#4eef16f6-15" aria-hidden="true" tabindex="-1"></a>        width<span class="op">=</span><span class="st">"100%"</span>,</span>
<span id="4eef16f6-16"><a href="#4eef16f6-16" aria-hidden="true" tabindex="-1"></a>        bgcolor<span class="op">=</span><span class="st">"#ffffff"</span>,</span>
<span id="4eef16f6-17"><a href="#4eef16f6-17" aria-hidden="true" tabindex="-1"></a>        font_color<span class="op">=</span><span class="st">"black"</span>,</span>
<span id="4eef16f6-18"><a href="#4eef16f6-18" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="4eef16f6-19"><a href="#4eef16f6-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="4eef16f6-20"><a href="#4eef16f6-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add nodes to PyVis network with community information</span></span>
<span id="4eef16f6-21"><a href="#4eef16f6-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> node_id, properties <span class="kw">in</span> G.nodes(data<span class="op">=</span><span class="va">True</span>):</span>
<span id="4eef16f6-22"><a href="#4eef16f6-22" aria-hidden="true" tabindex="-1"></a>        group <span class="op">=</span> node_community.get(node_id, <span class="op">-</span><span class="dv">1</span>)  <span class="co"># -1 for nodes not in any community</span></span>
<span id="4eef16f6-23"><a href="#4eef16f6-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="4eef16f6-24"><a href="#4eef16f6-24" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Plain‑text title with newlines</span></span>
<span id="4eef16f6-25"><a href="#4eef16f6-25" aria-hidden="true" tabindex="-1"></a>        title_lines <span class="op">=</span> [<span class="ss">f"Community: </span><span class="sc">{</span>group<span class="sc">}</span><span class="ss">"</span>]</span>
<span id="4eef16f6-26"><a href="#4eef16f6-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> k, v <span class="kw">in</span> properties.items():</span>
<span id="4eef16f6-27"><a href="#4eef16f6-27" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> k <span class="op">==</span> <span class="st">"embedding"</span>:</span>
<span id="4eef16f6-28"><a href="#4eef16f6-28" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="4eef16f6-29"><a href="#4eef16f6-29" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> k <span class="op">==</span> <span class="st">"body"</span> <span class="kw">and</span> v <span class="kw">and</span> <span class="bu">len</span>(v) <span class="op">&gt;</span> <span class="dv">512</span>:</span>
<span id="4eef16f6-30"><a href="#4eef16f6-30" aria-hidden="true" tabindex="-1"></a>                v <span class="op">=</span> v[:<span class="dv">512</span>] <span class="op">+</span> <span class="st">"..."</span></span>
<span id="4eef16f6-31"><a href="#4eef16f6-31" aria-hidden="true" tabindex="-1"></a>            title_lines.append(<span class="ss">f"</span><span class="sc">{</span>k<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>v<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="4eef16f6-32"><a href="#4eef16f6-32" aria-hidden="true" tabindex="-1"></a>        title <span class="op">=</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>.join(title_lines)</span>
<span id="4eef16f6-33"><a href="#4eef16f6-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="4eef16f6-34"><a href="#4eef16f6-34" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Use a specific property for the label if available</span></span>
<span id="4eef16f6-35"><a href="#4eef16f6-35" aria-hidden="true" tabindex="-1"></a>        node_label <span class="op">=</span> <span class="bu">str</span>(</span>
<span id="4eef16f6-36"><a href="#4eef16f6-36" aria-hidden="true" tabindex="-1"></a>            properties.get(<span class="st">"title"</span>)</span>
<span id="4eef16f6-37"><a href="#4eef16f6-37" aria-hidden="true" tabindex="-1"></a>            <span class="kw">or</span> properties.get(<span class="st">"name"</span>)</span>
<span id="4eef16f6-38"><a href="#4eef16f6-38" aria-hidden="true" tabindex="-1"></a>            <span class="kw">or</span> properties.get(<span class="st">"login"</span>)</span>
<span id="4eef16f6-39"><a href="#4eef16f6-39" aria-hidden="true" tabindex="-1"></a>            <span class="kw">or</span> properties.get(<span class="st">"id"</span>)</span>
<span id="4eef16f6-40"><a href="#4eef16f6-40" aria-hidden="true" tabindex="-1"></a>            <span class="kw">or</span> node_id</span>
<span id="4eef16f6-41"><a href="#4eef16f6-41" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="4eef16f6-42"><a href="#4eef16f6-42" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(node_label) <span class="op">&gt;</span> <span class="dv">30</span>:</span>
<span id="4eef16f6-43"><a href="#4eef16f6-43" aria-hidden="true" tabindex="-1"></a>            node_label <span class="op">=</span> node_label[:<span class="dv">27</span>] <span class="op">+</span> <span class="st">"..."</span></span>
<span id="4eef16f6-44"><a href="#4eef16f6-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="4eef16f6-45"><a href="#4eef16f6-45" aria-hidden="true" tabindex="-1"></a>        net.add_node(node_id, label<span class="op">=</span>node_label, title<span class="op">=</span>title, group<span class="op">=</span>group)</span>
<span id="4eef16f6-46"><a href="#4eef16f6-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="4eef16f6-47"><a href="#4eef16f6-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add edges</span></span>
<span id="4eef16f6-48"><a href="#4eef16f6-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> source_id, target_id, properties <span class="kw">in</span> G.edges(data<span class="op">=</span><span class="va">True</span>):</span>
<span id="4eef16f6-49"><a href="#4eef16f6-49" aria-hidden="true" tabindex="-1"></a>        rel_title <span class="op">=</span> properties.get(<span class="st">"type"</span>, <span class="st">""</span>)</span>
<span id="4eef16f6-50"><a href="#4eef16f6-50" aria-hidden="true" tabindex="-1"></a>        edge_width <span class="op">=</span> <span class="dv">1</span></span>
<span id="4eef16f6-51"><a href="#4eef16f6-51" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">"score"</span> <span class="kw">in</span> properties:</span>
<span id="4eef16f6-52"><a href="#4eef16f6-52" aria-hidden="true" tabindex="-1"></a>            score <span class="op">=</span> properties[<span class="st">"score"</span>]</span>
<span id="4eef16f6-53"><a href="#4eef16f6-53" aria-hidden="true" tabindex="-1"></a>            rel_title <span class="op">=</span> <span class="ss">f"MIGHT_RELATE_TO (score: </span><span class="sc">{</span>score<span class="sc">:.2f}</span><span class="ss">)"</span></span>
<span id="4eef16f6-54"><a href="#4eef16f6-54" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Scale edge width based on score.</span></span>
<span id="4eef16f6-55"><a href="#4eef16f6-55" aria-hidden="true" tabindex="-1"></a>            edge_width <span class="op">=</span> <span class="dv">1</span> <span class="op">+</span> (score <span class="op">-</span> min_score_threshold) <span class="op">*</span> (</span>
<span id="4eef16f6-56"><a href="#4eef16f6-56" aria-hidden="true" tabindex="-1"></a>                <span class="dv">10</span> <span class="op">/</span> (<span class="dv">1</span> <span class="op">-</span> min_score_threshold)</span>
<span id="4eef16f6-57"><a href="#4eef16f6-57" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="4eef16f6-58"><a href="#4eef16f6-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="4eef16f6-59"><a href="#4eef16f6-59" aria-hidden="true" tabindex="-1"></a>        net.add_edge(</span>
<span id="4eef16f6-60"><a href="#4eef16f6-60" aria-hidden="true" tabindex="-1"></a>            source_id,</span>
<span id="4eef16f6-61"><a href="#4eef16f6-61" aria-hidden="true" tabindex="-1"></a>            target_id,</span>
<span id="4eef16f6-62"><a href="#4eef16f6-62" aria-hidden="true" tabindex="-1"></a>            title<span class="op">=</span>rel_title,</span>
<span id="4eef16f6-63"><a href="#4eef16f6-63" aria-hidden="true" tabindex="-1"></a>            width<span class="op">=</span>edge_width,</span>
<span id="4eef16f6-64"><a href="#4eef16f6-64" aria-hidden="true" tabindex="-1"></a>            arrows<span class="op">=</span><span class="st">"to"</span>,</span>
<span id="4eef16f6-65"><a href="#4eef16f6-65" aria-hidden="true" tabindex="-1"></a>            dashes<span class="op">=</span><span class="va">True</span>,</span>
<span id="4eef16f6-66"><a href="#4eef16f6-66" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="4eef16f6-67"><a href="#4eef16f6-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="4eef16f6-68"><a href="#4eef16f6-68" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> net</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Note how the new <code>MIGHT_RELATE_TO</code> relationships are established based on semantic similarity scores (represented by the thickness of the edges).</p>
<div id="aac6019d" class="cell" data-execution_count="23">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="aac6019d"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="aac6019d-1"><a href="#aac6019d-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a NetworkX graph to perform community detection</span></span>
<span id="aac6019d-2"><a href="#aac6019d-2" aria-hidden="true" tabindex="-1"></a>G <span class="op">=</span> nx.Graph()</span>
<span id="aac6019d-3"><a href="#aac6019d-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="aac6019d-4"><a href="#aac6019d-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Query Neo4j to get a sample of issues with MIGHT_RELATE_TO relationships</span></span>
<span id="aac6019d-5"><a href="#aac6019d-5" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> driver.session() <span class="im">as</span> session:</span>
<span id="aac6019d-6"><a href="#aac6019d-6" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> session.run(</span>
<span id="aac6019d-7"><a href="#aac6019d-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">"""</span></span>
<span id="aac6019d-8"><a href="#aac6019d-8" aria-hidden="true" tabindex="-1"></a><span class="st">    MATCH (i:Issue)-[rel:MIGHT_RELATE_TO]-(neighbor:Issue)</span></span>
<span id="aac6019d-9"><a href="#aac6019d-9" aria-hidden="true" tabindex="-1"></a><span class="st">    WITH i, rel, neighbor, rand() as r</span></span>
<span id="aac6019d-10"><a href="#aac6019d-10" aria-hidden="true" tabindex="-1"></a><span class="st">    ORDER BY r</span></span>
<span id="aac6019d-11"><a href="#aac6019d-11" aria-hidden="true" tabindex="-1"></a><span class="st">    LIMIT 200</span></span>
<span id="aac6019d-12"><a href="#aac6019d-12" aria-hidden="true" tabindex="-1"></a><span class="st">    RETURN i, rel, neighbor</span></span>
<span id="aac6019d-13"><a href="#aac6019d-13" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span></span>
<span id="aac6019d-14"><a href="#aac6019d-14" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="aac6019d-15"><a href="#aac6019d-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="aac6019d-16"><a href="#aac6019d-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Build the NetworkX graph from the query results</span></span>
<span id="aac6019d-17"><a href="#aac6019d-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> record <span class="kw">in</span> result:</span>
<span id="aac6019d-18"><a href="#aac6019d-18" aria-hidden="true" tabindex="-1"></a>        node_i <span class="op">=</span> record[<span class="st">"i"</span>]</span>
<span id="aac6019d-19"><a href="#aac6019d-19" aria-hidden="true" tabindex="-1"></a>        node_neighbor <span class="op">=</span> record[<span class="st">"neighbor"</span>]</span>
<span id="aac6019d-20"><a href="#aac6019d-20" aria-hidden="true" tabindex="-1"></a>        rel <span class="op">=</span> record[<span class="st">"rel"</span>]</span>
<span id="aac6019d-21"><a href="#aac6019d-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="aac6019d-22"><a href="#aac6019d-22" aria-hidden="true" tabindex="-1"></a>        G.add_node(node_i.element_id, <span class="op">**</span><span class="bu">dict</span>(node_i))</span>
<span id="aac6019d-23"><a href="#aac6019d-23" aria-hidden="true" tabindex="-1"></a>        G.add_node(node_neighbor.element_id, <span class="op">**</span><span class="bu">dict</span>(node_neighbor))</span>
<span id="aac6019d-24"><a href="#aac6019d-24" aria-hidden="true" tabindex="-1"></a>        G.add_edge(node_i.element_id, node_neighbor.element_id, <span class="op">**</span><span class="bu">dict</span>(rel))</span>
<span id="aac6019d-25"><a href="#aac6019d-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="aac6019d-26"><a href="#aac6019d-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Detect communities using the Louvain method</span></span>
<span id="aac6019d-27"><a href="#aac6019d-27" aria-hidden="true" tabindex="-1"></a>communities <span class="op">=</span> community.louvain_communities(G)</span>
<span id="aac6019d-28"><a href="#aac6019d-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a mapping from node to community id</span></span>
<span id="aac6019d-29"><a href="#aac6019d-29" aria-hidden="true" tabindex="-1"></a>node_community <span class="op">=</span> {}</span>
<span id="aac6019d-30"><a href="#aac6019d-30" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, comm <span class="kw">in</span> <span class="bu">enumerate</span>(communities):</span>
<span id="aac6019d-31"><a href="#aac6019d-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> node_id <span class="kw">in</span> comm:</span>
<span id="aac6019d-32"><a href="#aac6019d-32" aria-hidden="true" tabindex="-1"></a>        node_community[node_id] <span class="op">=</span> i</span>
<span id="aac6019d-33"><a href="#aac6019d-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="aac6019d-34"><a href="#aac6019d-34" aria-hidden="true" tabindex="-1"></a>net_similar <span class="op">=</span> create_pyvis_network_from_networkx(G, node_community, min_score_threshold)</span>
<span id="aac6019d-35"><a href="#aac6019d-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="aac6019d-36"><a href="#aac6019d-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Configure physics and controls</span></span>
<span id="aac6019d-37"><a href="#aac6019d-37" aria-hidden="true" tabindex="-1"></a>net_similar.toggle_physics(<span class="va">True</span>)</span>
<span id="aac6019d-38"><a href="#aac6019d-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="aac6019d-39"><a href="#aac6019d-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the visualization to HTML</span></span>
<span id="aac6019d-40"><a href="#aac6019d-40" aria-hidden="true" tabindex="-1"></a>net_similar.show(<span class="st">"might_relate_to_visualization.html"</span>, notebook<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>might_relate_to_visualization.html</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="22">

        <iframe width="100%" height="750px" src="might_relate_to_visualization.html" frameborder="0" allowfullscreen=""></iframe>
        
</div>
</div>
</section>
</section>
<section id="the-resulting-rag-graph" class="level2">
<h2 class="anchored" data-anchor-id="the-resulting-rag-graph">The resulting RAG graph</h2>
<p>To find the most relevant issues to a query string, we can use the embeddings of both issues and comments. We will create a method that searches for the top-k matching issues based on a blended search of issues and comments, and returns a graph of their connections. This will allow us to build a RAG graph that can be used to answer questions about the issues and their related comments.</p>
<p>The Cypher query in the following method is a bit complex, and requires some explanation. It starts by running two vector‐search subqueries in parallel: one against the issue embeddings index and another against the comment embeddings index. It returns the top&nbsp;k matches from each search, pairing comment matches back to their parent issues so that you end up with a unified stream of issues scored by similarity to your input embedding.</p>
<p>Next, it orders every returned issue‑score pair by descending score, wraps each issue node together with its score into a map, and deduplicates those maps so that each issue appears only once (preserving its highest score). It then slices that deduplicated list down to the single top&nbsp;k issues you want to focus on, and re‑materializes the actual Issue nodes by matching on their IDs.</p>
<p>Finally, for each of those top&nbsp;<span class="math inline">\(k\)</span> issues the query pulls in any labels or “raised by” relationships, all comments on the issue, and the users who made those comments. It aggregates each issue’s related nodes and relationships, flattens everything into two big collections, and then unwinds and re‑collects them with <code>DISTINCT</code> to eliminate duplicates. The result is a clean subgraph containing exactly the top&nbsp;<span class="math inline">\(k\)</span> semantically similar issues plus their immediate context.</p>
<div id="12cfe04c" class="cell" data-execution_count="24">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="12cfe04c"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="12cfe04c-1"><a href="#12cfe04c-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_rag_graph(tx: Transaction, query_string: <span class="bu">str</span>, top_k: <span class="bu">int</span> <span class="op">=</span> <span class="dv">5</span>) <span class="op">-&gt;</span> Graph:</span>
<span id="12cfe04c-2"><a href="#12cfe04c-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="12cfe04c-3"><a href="#12cfe04c-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Finds the most relevant issues to a query string by searching both issue and comment embeddings,</span></span>
<span id="12cfe04c-4"><a href="#12cfe04c-4" aria-hidden="true" tabindex="-1"></a><span class="co">    and returns a graph of their connections.</span></span>
<span id="12cfe04c-5"><a href="#12cfe04c-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="12cfe04c-6"><a href="#12cfe04c-6" aria-hidden="true" tabindex="-1"></a><span class="co">    The graph contains:</span></span>
<span id="12cfe04c-7"><a href="#12cfe04c-7" aria-hidden="true" tabindex="-1"></a><span class="co">    - The top-k matching issues based on a blended search of issues and comments.</span></span>
<span id="12cfe04c-8"><a href="#12cfe04c-8" aria-hidden="true" tabindex="-1"></a><span class="co">    - For each of these issues: their comments, users who wrote them, and labels.</span></span>
<span id="12cfe04c-9"><a href="#12cfe04c-9" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="12cfe04c-10"><a href="#12cfe04c-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Embed the query string</span></span>
<span id="12cfe04c-11"><a href="#12cfe04c-11" aria-hidden="true" tabindex="-1"></a>    query_embedding <span class="op">=</span> embedding_model.embed_batch([query_string])[<span class="dv">0</span>].tolist()</span>
<span id="12cfe04c-12"><a href="#12cfe04c-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="12cfe04c-13"><a href="#12cfe04c-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find the most relevant issues and build the graph</span></span>
<span id="12cfe04c-14"><a href="#12cfe04c-14" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> tx.run(</span>
<span id="12cfe04c-15"><a href="#12cfe04c-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">"""</span></span>
<span id="12cfe04c-16"><a href="#12cfe04c-16" aria-hidden="true" tabindex="-1"></a><span class="st">        // Find top k issues from issue embeddings and from comment embeddings</span></span>
<span id="12cfe04c-17"><a href="#12cfe04c-17" aria-hidden="true" tabindex="-1"></a><span class="st">        CALL {</span></span>
<span id="12cfe04c-18"><a href="#12cfe04c-18" aria-hidden="true" tabindex="-1"></a><span class="st">            CALL db.index.vector.queryNodes('issue_embeddings', $top_k, $embedding) YIELD node AS issue, score</span></span>
<span id="12cfe04c-19"><a href="#12cfe04c-19" aria-hidden="true" tabindex="-1"></a><span class="st">            RETURN issue, score</span></span>
<span id="12cfe04c-20"><a href="#12cfe04c-20" aria-hidden="true" tabindex="-1"></a><span class="st">            UNION</span></span>
<span id="12cfe04c-21"><a href="#12cfe04c-21" aria-hidden="true" tabindex="-1"></a><span class="st">            CALL db.index.vector.queryNodes('comment_embeddings', $top_k, $embedding) YIELD node AS comment, score</span></span>
<span id="12cfe04c-22"><a href="#12cfe04c-22" aria-hidden="true" tabindex="-1"></a><span class="st">            MATCH (comment)-[:COMMENT_ON]-&gt;(issue:Issue)</span></span>
<span id="12cfe04c-23"><a href="#12cfe04c-23" aria-hidden="true" tabindex="-1"></a><span class="st">            RETURN issue, score</span></span>
<span id="12cfe04c-24"><a href="#12cfe04c-24" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="12cfe04c-25"><a href="#12cfe04c-25" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="12cfe04c-26"><a href="#12cfe04c-26" aria-hidden="true" tabindex="-1"></a><span class="st">        // Combine, deduplicate, and select top k issues overall</span></span>
<span id="12cfe04c-27"><a href="#12cfe04c-27" aria-hidden="true" tabindex="-1"></a><span class="st">        WITH issue, score</span></span>
<span id="12cfe04c-28"><a href="#12cfe04c-28" aria-hidden="true" tabindex="-1"></a><span class="st">        ORDER BY score DESC</span></span>
<span id="12cfe04c-29"><a href="#12cfe04c-29" aria-hidden="true" tabindex="-1"></a><span class="st">        WITH collect(issue {.*, score: score}) AS issues</span></span>
<span id="12cfe04c-30"><a href="#12cfe04c-30" aria-hidden="true" tabindex="-1"></a><span class="st">        WITH [i in issues | i.id] AS issueIds, issues</span></span>
<span id="12cfe04c-31"><a href="#12cfe04c-31" aria-hidden="true" tabindex="-1"></a><span class="st">        WITH [id IN issueIds | head([i IN issues WHERE i.id = id])] AS uniqueIssues</span></span>
<span id="12cfe04c-32"><a href="#12cfe04c-32" aria-hidden="true" tabindex="-1"></a><span class="st">        WITH uniqueIssues[..$top_k] AS top_issues</span></span>
<span id="12cfe04c-33"><a href="#12cfe04c-33" aria-hidden="true" tabindex="-1"></a><span class="st">        UNWIND top_issues as top_issue_data</span></span>
<span id="12cfe04c-34"><a href="#12cfe04c-34" aria-hidden="true" tabindex="-1"></a><span class="st">        MATCH (top_issue:Issue {id: top_issue_data.id})</span></span>
<span id="12cfe04c-35"><a href="#12cfe04c-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="12cfe04c-36"><a href="#12cfe04c-36" aria-hidden="true" tabindex="-1"></a><span class="st">        // Collect the top issues, their labels, and the users who raised them</span></span>
<span id="12cfe04c-37"><a href="#12cfe04c-37" aria-hidden="true" tabindex="-1"></a><span class="st">        OPTIONAL MATCH (top_issue)-[r1:HAS_LABEL|RAISED_BY]-&gt;(n1)</span></span>
<span id="12cfe04c-38"><a href="#12cfe04c-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="12cfe04c-39"><a href="#12cfe04c-39" aria-hidden="true" tabindex="-1"></a><span class="st">        // Collect comments on the top issues and the users who made them</span></span>
<span id="12cfe04c-40"><a href="#12cfe04c-40" aria-hidden="true" tabindex="-1"></a><span class="st">        OPTIONAL MATCH (top_issue)&lt;-[r2:COMMENT_ON]-(c1:Comment)-[r3:COMMENT_BY]-&gt;(u1:User)</span></span>
<span id="12cfe04c-41"><a href="#12cfe04c-41" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="12cfe04c-42"><a href="#12cfe04c-42" aria-hidden="true" tabindex="-1"></a><span class="st">        // Aggregate all nodes and relationships per issue</span></span>
<span id="12cfe04c-43"><a href="#12cfe04c-43" aria-hidden="true" tabindex="-1"></a><span class="st">        WITH top_issue, </span></span>
<span id="12cfe04c-44"><a href="#12cfe04c-44" aria-hidden="true" tabindex="-1"></a><span class="st">             collect(DISTINCT n1) as nodes1,</span></span>
<span id="12cfe04c-45"><a href="#12cfe04c-45" aria-hidden="true" tabindex="-1"></a><span class="st">             collect(DISTINCT r1) as rels1,</span></span>
<span id="12cfe04c-46"><a href="#12cfe04c-46" aria-hidden="true" tabindex="-1"></a><span class="st">             collect(DISTINCT c1) + collect(DISTINCT u1) as nodes2,</span></span>
<span id="12cfe04c-47"><a href="#12cfe04c-47" aria-hidden="true" tabindex="-1"></a><span class="st">             collect(DISTINCT r2) + collect(DISTINCT r3) as rels2</span></span>
<span id="12cfe04c-48"><a href="#12cfe04c-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="12cfe04c-49"><a href="#12cfe04c-49" aria-hidden="true" tabindex="-1"></a><span class="st">        // Aggregate all nodes and relationships across all issues</span></span>
<span id="12cfe04c-50"><a href="#12cfe04c-50" aria-hidden="true" tabindex="-1"></a><span class="st">        WITH collect(top_issue) + apoc.coll.flatten(collect(nodes1)) + apoc.coll.flatten(collect(nodes2)) as all_nodes,</span></span>
<span id="12cfe04c-51"><a href="#12cfe04c-51" aria-hidden="true" tabindex="-1"></a><span class="st">             apoc.coll.flatten(collect(rels1)) + apoc.coll.flatten(collect(rels2)) as all_rels</span></span>
<span id="12cfe04c-52"><a href="#12cfe04c-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="12cfe04c-53"><a href="#12cfe04c-53" aria-hidden="true" tabindex="-1"></a><span class="st">        UNWIND all_nodes as n</span></span>
<span id="12cfe04c-54"><a href="#12cfe04c-54" aria-hidden="true" tabindex="-1"></a><span class="st">        UNWIND all_rels as r</span></span>
<span id="12cfe04c-55"><a href="#12cfe04c-55" aria-hidden="true" tabindex="-1"></a><span class="st">        RETURN collect(DISTINCT n) as nodes, collect(DISTINCT r) as relationships</span></span>
<span id="12cfe04c-56"><a href="#12cfe04c-56" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span>,</span>
<span id="12cfe04c-57"><a href="#12cfe04c-57" aria-hidden="true" tabindex="-1"></a>        embedding<span class="op">=</span>query_embedding,</span>
<span id="12cfe04c-58"><a href="#12cfe04c-58" aria-hidden="true" tabindex="-1"></a>        top_k<span class="op">=</span>top_k,</span>
<span id="12cfe04c-59"><a href="#12cfe04c-59" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="12cfe04c-60"><a href="#12cfe04c-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="12cfe04c-61"><a href="#12cfe04c-61" aria-hidden="true" tabindex="-1"></a>    record <span class="op">=</span> result.single()</span>
<span id="12cfe04c-62"><a href="#12cfe04c-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="12cfe04c-63"><a href="#12cfe04c-63" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Reconstruct the graph from nodes and relationships</span></span>
<span id="12cfe04c-64"><a href="#12cfe04c-64" aria-hidden="true" tabindex="-1"></a>    nodes <span class="op">=</span> record[<span class="st">"nodes"</span>]</span>
<span id="12cfe04c-65"><a href="#12cfe04c-65" aria-hidden="true" tabindex="-1"></a>    relationships <span class="op">=</span> record[<span class="st">"relationships"</span>]</span>
<span id="12cfe04c-66"><a href="#12cfe04c-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="12cfe04c-67"><a href="#12cfe04c-67" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a graph object to return</span></span>
<span id="12cfe04c-68"><a href="#12cfe04c-68" aria-hidden="true" tabindex="-1"></a>    <span class="co"># This is a bit of a hack, as we can't directly instantiate a Graph object easily</span></span>
<span id="12cfe04c-69"><a href="#12cfe04c-69" aria-hidden="true" tabindex="-1"></a>    <span class="co"># with nodes and relationships from the driver. We'll run a query that returns a graph.</span></span>
<span id="12cfe04c-70"><a href="#12cfe04c-70" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> nodes:</span>
<span id="12cfe04c-71"><a href="#12cfe04c-71" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> Graph()</span>
<span id="12cfe04c-72"><a href="#12cfe04c-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="12cfe04c-73"><a href="#12cfe04c-73" aria-hidden="true" tabindex="-1"></a>    node_ids <span class="op">=</span> [n.element_id <span class="cf">for</span> n <span class="kw">in</span> nodes]</span>
<span id="12cfe04c-74"><a href="#12cfe04c-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="12cfe04c-75"><a href="#12cfe04c-75" aria-hidden="true" tabindex="-1"></a>    graph_result <span class="op">=</span> tx.run(</span>
<span id="12cfe04c-76"><a href="#12cfe04c-76" aria-hidden="true" tabindex="-1"></a>        <span class="st">"""</span></span>
<span id="12cfe04c-77"><a href="#12cfe04c-77" aria-hidden="true" tabindex="-1"></a><span class="st">        MATCH (n) WHERE elementId(n) IN $node_ids</span></span>
<span id="12cfe04c-78"><a href="#12cfe04c-78" aria-hidden="true" tabindex="-1"></a><span class="st">        OPTIONAL MATCH (n)-[r]-(m) WHERE elementId(n) IN $node_ids AND elementId(m) IN $node_ids</span></span>
<span id="12cfe04c-79"><a href="#12cfe04c-79" aria-hidden="true" tabindex="-1"></a><span class="st">        RETURN n, r, m</span></span>
<span id="12cfe04c-80"><a href="#12cfe04c-80" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span>,</span>
<span id="12cfe04c-81"><a href="#12cfe04c-81" aria-hidden="true" tabindex="-1"></a>        node_ids<span class="op">=</span>node_ids,</span>
<span id="12cfe04c-82"><a href="#12cfe04c-82" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="12cfe04c-83"><a href="#12cfe04c-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="12cfe04c-84"><a href="#12cfe04c-84" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> graph_result.graph()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Let’s see what the RAG graph looks like for a specific query. Note the default <code>top_k</code> value is set to 5, but you can adjust it to retrieve more or fewer issues based on your needs.</p>
<div id="11078a74" class="cell" data-execution_count="25">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="11078a74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="11078a74-1"><a href="#11078a74-1" aria-hidden="true" tabindex="-1"></a>query_string <span class="op">=</span> <span class="st">"What are the dependencies necessary to run Atari environments ?"</span></span>
<span id="11078a74-2"><a href="#11078a74-2" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> driver.session() <span class="im">as</span> session:</span>
<span id="11078a74-3"><a href="#11078a74-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Finding RAG graph for query: </span><span class="sc">{</span>query_string<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="11078a74-4"><a href="#11078a74-4" aria-hidden="true" tabindex="-1"></a>    rag_graph <span class="op">=</span> session.execute_read(get_rag_graph, query_string)</span>
<span id="11078a74-5"><a href="#11078a74-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(</span>
<span id="11078a74-6"><a href="#11078a74-6" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"Found </span><span class="sc">{</span><span class="bu">len</span>(rag_graph.nodes)<span class="sc">}</span><span class="ss"> nodes and </span><span class="sc">{</span><span class="bu">len</span>(rag_graph.relationships)<span class="sc">}</span><span class="ss"> relationships in the RAG graph."</span></span>
<span id="11078a74-7"><a href="#11078a74-7" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Finding RAG graph for query: What are the dependencies necessary to run Atari environments ?</code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"4fa9d48adbd64d0c84b2d570a822a1fc","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Found 17 nodes and 26 relationships in the RAG graph.</code></pre>
</div>
</div>
<div id="e1d93d6f" class="cell" data-execution_count="26">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="e1d93d6f"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="e1d93d6f-1"><a href="#e1d93d6f-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize the RAG graph using Pyvis</span></span>
<span id="e1d93d6f-2"><a href="#e1d93d6f-2" aria-hidden="true" tabindex="-1"></a>rag_net <span class="op">=</span> create_pyvis_network_from_neo4j(rag_graph)</span>
<span id="e1d93d6f-3"><a href="#e1d93d6f-3" aria-hidden="true" tabindex="-1"></a>rag_net.toggle_physics(<span class="va">True</span>)</span>
<span id="e1d93d6f-4"><a href="#e1d93d6f-4" aria-hidden="true" tabindex="-1"></a>rag_net.show(<span class="st">"rag_graph_visualization.html"</span>, notebook<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>rag_graph_visualization.html</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="25">

        <iframe width="100%" height="750px" src="rag_graph_visualization.html" frameborder="0" allowfullscreen=""></iframe>
        
</div>
</div>
</section>
<section id="the-ai-agent" class="level2">
<h2 class="anchored" data-anchor-id="the-ai-agent">The AI agent</h2>
<p>Now that we understand how our graph is structured and how to retrieve relevant information from it, we can build an <a href="https://github.com/resources/articles/ai/what-are-ai-agents">AI agent</a> that can answer questions about issues in our graph. The agent will use the RAG graph to find relevant issues and comments, and then generate a textual summary of the information found.</p>
<p>We will use the <a href="https://developers.generativeai.google/api/rest">Gemini API</a> to interact with a large language model (LLM) that can process the textual summaries and generate answers to user queries. Google Gemini offers a nice Python client library that we can use to interact with the API (if you use <code>Conda</code>, you can install the gemini API with <code>conda install google-genai</code>).</p>
<p>First we need to set up the Gemini client with our API key. Make sure you have the <code>GEMINI_API_KEY</code> environment variable set with your key.</p>
<div id="eaed7b10" class="cell" data-execution_count="27">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="eaed7b10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="eaed7b10-1"><a href="#eaed7b10-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> google <span class="im">import</span> genai</span>
<span id="eaed7b10-2"><a href="#eaed7b10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="eaed7b10-3"><a href="#eaed7b10-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Configure the Gemini API key</span></span>
<span id="eaed7b10-4"><a href="#eaed7b10-4" aria-hidden="true" tabindex="-1"></a>gemini_api_key <span class="op">=</span> os.getenv(<span class="st">"GEMINI_API_KEY"</span>)</span>
<span id="eaed7b10-5"><a href="#eaed7b10-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> gemini_api_key:</span>
<span id="eaed7b10-6"><a href="#eaed7b10-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"GEMINI_API_KEY environment variable not set."</span>)</span>
<span id="eaed7b10-7"><a href="#eaed7b10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="eaed7b10-8"><a href="#eaed7b10-8" aria-hidden="true" tabindex="-1"></a>genai_client <span class="op">=</span> genai.Client(api_key<span class="op">=</span>gemini_api_key)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We also need a method to convert the Neo4j graph into a textual memo that can be passed to the LLM. This summary will include information about the nodes and relationships in the graph, which will help the LLM understand the context of the issues and comments.</p>
<div id="d087f5b7" class="cell" data-execution_count="28">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="d087f5b7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="d087f5b7-1"><a href="#d087f5b7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> graph_to_textual_summary(graph: Graph) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="d087f5b7-2"><a href="#d087f5b7-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Converts a Neo4j graph into a descriptive narrative summary for an LLM."""</span></span>
<span id="d087f5b7-3"><a href="#d087f5b7-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Use the driver-provided Graph object, which has .nodes and .relationships</span></span>
<span id="d087f5b7-4"><a href="#d087f5b7-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> graph.nodes:</span>
<span id="d087f5b7-5"><a href="#d087f5b7-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">"No information found for the query."</span></span>
<span id="d087f5b7-6"><a href="#d087f5b7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="d087f5b7-7"><a href="#d087f5b7-7" aria-hidden="true" tabindex="-1"></a>    descriptions <span class="op">=</span> []</span>
<span id="d087f5b7-8"><a href="#d087f5b7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="d087f5b7-9"><a href="#d087f5b7-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Describe each node in a natural-language sentence</span></span>
<span id="d087f5b7-10"><a href="#d087f5b7-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> node <span class="kw">in</span> graph.nodes:</span>
<span id="d087f5b7-11"><a href="#d087f5b7-11" aria-hidden="true" tabindex="-1"></a>        labels <span class="op">=</span> <span class="bu">sorted</span>(node.labels)</span>
<span id="d087f5b7-12"><a href="#d087f5b7-12" aria-hidden="true" tabindex="-1"></a>        props <span class="op">=</span> <span class="bu">dict</span>(node)</span>
<span id="d087f5b7-13"><a href="#d087f5b7-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="d087f5b7-14"><a href="#d087f5b7-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Choose a human-friendly identifier</span></span>
<span id="d087f5b7-15"><a href="#d087f5b7-15" aria-hidden="true" tabindex="-1"></a>        identifier <span class="op">=</span> (</span>
<span id="d087f5b7-16"><a href="#d087f5b7-16" aria-hidden="true" tabindex="-1"></a>            props.get(<span class="st">"title"</span>)</span>
<span id="d087f5b7-17"><a href="#d087f5b7-17" aria-hidden="true" tabindex="-1"></a>            <span class="kw">or</span> props.get(<span class="st">"name"</span>)</span>
<span id="d087f5b7-18"><a href="#d087f5b7-18" aria-hidden="true" tabindex="-1"></a>            <span class="kw">or</span> props.get(<span class="st">"login"</span>)</span>
<span id="d087f5b7-19"><a href="#d087f5b7-19" aria-hidden="true" tabindex="-1"></a>            <span class="kw">or</span> props.get(<span class="st">"id"</span>)</span>
<span id="d087f5b7-20"><a href="#d087f5b7-20" aria-hidden="true" tabindex="-1"></a>            <span class="kw">or</span> <span class="bu">str</span>(node.<span class="bu">id</span>)</span>
<span id="d087f5b7-21"><a href="#d087f5b7-21" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="d087f5b7-22"><a href="#d087f5b7-22" aria-hidden="true" tabindex="-1"></a>        label_str <span class="op">=</span> <span class="st">" and "</span>.join(labels) <span class="cf">if</span> labels <span class="cf">else</span> <span class="st">"Node"</span></span>
<span id="d087f5b7-23"><a href="#d087f5b7-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="d087f5b7-24"><a href="#d087f5b7-24" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Build the sentence</span></span>
<span id="d087f5b7-25"><a href="#d087f5b7-25" aria-hidden="true" tabindex="-1"></a>        sentence <span class="op">=</span> <span class="ss">f"A </span><span class="sc">{</span>label_str<span class="sc">}</span><span class="ss"> node identified as '</span><span class="sc">{</span>identifier<span class="sc">}</span><span class="ss">'"</span></span>
<span id="d087f5b7-26"><a href="#d087f5b7-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="d087f5b7-27"><a href="#d087f5b7-27" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add other descriptive properties</span></span>
<span id="d087f5b7-28"><a href="#d087f5b7-28" aria-hidden="true" tabindex="-1"></a>        extras <span class="op">=</span> []</span>
<span id="d087f5b7-29"><a href="#d087f5b7-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> key, value <span class="kw">in</span> props.items():</span>
<span id="d087f5b7-30"><a href="#d087f5b7-30" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> key <span class="kw">in</span> (<span class="st">"title"</span>, <span class="st">"name"</span>, <span class="st">"login"</span>, <span class="st">"id"</span>, <span class="st">"embedding"</span>):</span>
<span id="d087f5b7-31"><a href="#d087f5b7-31" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="d087f5b7-32"><a href="#d087f5b7-32" aria-hidden="true" tabindex="-1"></a>            text <span class="op">=</span> <span class="bu">str</span>(value)</span>
<span id="d087f5b7-33"><a href="#d087f5b7-33" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> key <span class="op">==</span> <span class="st">"body"</span> <span class="kw">and</span> value <span class="kw">and</span> <span class="bu">len</span>(value) <span class="op">&gt;</span> <span class="dv">600</span>:</span>
<span id="d087f5b7-34"><a href="#d087f5b7-34" aria-hidden="true" tabindex="-1"></a>                text <span class="op">=</span> value[:<span class="dv">600</span>] <span class="op">+</span> <span class="st">"..."</span></span>
<span id="d087f5b7-35"><a href="#d087f5b7-35" aria-hidden="true" tabindex="-1"></a>            extras.append(<span class="ss">f"its </span><span class="sc">{</span>key<span class="sc">}</span><span class="ss"> is '</span><span class="sc">{</span>text<span class="sc">}</span><span class="ss">'"</span>)</span>
<span id="d087f5b7-36"><a href="#d087f5b7-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="d087f5b7-37"><a href="#d087f5b7-37" aria-hidden="true" tabindex="-1"></a>        sentence <span class="op">+=</span> <span class="ss">f" has </span><span class="sc">{</span><span class="st">', '</span><span class="sc">.</span>join(extras)<span class="sc">}</span><span class="ss">"</span> <span class="cf">if</span> extras <span class="cf">else</span> <span class="st">""</span></span>
<span id="d087f5b7-38"><a href="#d087f5b7-38" aria-hidden="true" tabindex="-1"></a>        sentence <span class="op">=</span> sentence.rstrip(<span class="st">", "</span>) <span class="op">+</span> <span class="st">"."</span></span>
<span id="d087f5b7-39"><a href="#d087f5b7-39" aria-hidden="true" tabindex="-1"></a>        descriptions.append(sentence)</span>
<span id="d087f5b7-40"><a href="#d087f5b7-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="d087f5b7-41"><a href="#d087f5b7-41" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Describe relationships in narrative form</span></span>
<span id="d087f5b7-42"><a href="#d087f5b7-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> rel <span class="kw">in</span> graph.relationships:</span>
<span id="d087f5b7-43"><a href="#d087f5b7-43" aria-hidden="true" tabindex="-1"></a>        start <span class="op">=</span> rel.start_node</span>
<span id="d087f5b7-44"><a href="#d087f5b7-44" aria-hidden="true" tabindex="-1"></a>        end <span class="op">=</span> rel.end_node</span>
<span id="d087f5b7-45"><a href="#d087f5b7-45" aria-hidden="true" tabindex="-1"></a>        start_id <span class="op">=</span> (</span>
<span id="d087f5b7-46"><a href="#d087f5b7-46" aria-hidden="true" tabindex="-1"></a>            <span class="bu">dict</span>(start).get(<span class="st">"title"</span>)</span>
<span id="d087f5b7-47"><a href="#d087f5b7-47" aria-hidden="true" tabindex="-1"></a>            <span class="kw">or</span> <span class="bu">dict</span>(start).get(<span class="st">"name"</span>)</span>
<span id="d087f5b7-48"><a href="#d087f5b7-48" aria-hidden="true" tabindex="-1"></a>            <span class="kw">or</span> <span class="bu">dict</span>(start).get(<span class="st">"login"</span>)</span>
<span id="d087f5b7-49"><a href="#d087f5b7-49" aria-hidden="true" tabindex="-1"></a>            <span class="kw">or</span> <span class="bu">dict</span>(start).get(<span class="st">"id"</span>)</span>
<span id="d087f5b7-50"><a href="#d087f5b7-50" aria-hidden="true" tabindex="-1"></a>            <span class="kw">or</span> <span class="bu">str</span>(start.<span class="bu">id</span>)</span>
<span id="d087f5b7-51"><a href="#d087f5b7-51" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="d087f5b7-52"><a href="#d087f5b7-52" aria-hidden="true" tabindex="-1"></a>        end_id <span class="op">=</span> (</span>
<span id="d087f5b7-53"><a href="#d087f5b7-53" aria-hidden="true" tabindex="-1"></a>            <span class="bu">dict</span>(end).get(<span class="st">"title"</span>)</span>
<span id="d087f5b7-54"><a href="#d087f5b7-54" aria-hidden="true" tabindex="-1"></a>            <span class="kw">or</span> <span class="bu">dict</span>(end).get(<span class="st">"name"</span>)</span>
<span id="d087f5b7-55"><a href="#d087f5b7-55" aria-hidden="true" tabindex="-1"></a>            <span class="kw">or</span> <span class="bu">dict</span>(end).get(<span class="st">"login"</span>)</span>
<span id="d087f5b7-56"><a href="#d087f5b7-56" aria-hidden="true" tabindex="-1"></a>            <span class="kw">or</span> <span class="bu">dict</span>(end).get(<span class="st">"id"</span>)</span>
<span id="d087f5b7-57"><a href="#d087f5b7-57" aria-hidden="true" tabindex="-1"></a>            <span class="kw">or</span> <span class="bu">str</span>(end.<span class="bu">id</span>)</span>
<span id="d087f5b7-58"><a href="#d087f5b7-58" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="d087f5b7-59"><a href="#d087f5b7-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="d087f5b7-60"><a href="#d087f5b7-60" aria-hidden="true" tabindex="-1"></a>        sentence <span class="op">=</span> <span class="ss">f"There is a relationship of type '</span><span class="sc">{</span>rel<span class="sc">.</span><span class="bu">type</span><span class="sc">}</span><span class="ss">' from node '</span><span class="sc">{</span>start_id<span class="sc">}</span><span class="ss">' to node '</span><span class="sc">{</span>end_id<span class="sc">}</span><span class="ss">'"</span></span>
<span id="d087f5b7-61"><a href="#d087f5b7-61" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">"score"</span> <span class="kw">in</span> rel:</span>
<span id="d087f5b7-62"><a href="#d087f5b7-62" aria-hidden="true" tabindex="-1"></a>            score <span class="op">=</span> rel[<span class="st">"score"</span>]</span>
<span id="d087f5b7-63"><a href="#d087f5b7-63" aria-hidden="true" tabindex="-1"></a>            sentence <span class="op">+=</span> <span class="ss">f" with a similarity score of </span><span class="sc">{</span>score<span class="sc">:.2f}</span><span class="ss">"</span></span>
<span id="d087f5b7-64"><a href="#d087f5b7-64" aria-hidden="true" tabindex="-1"></a>        descriptions.append(sentence <span class="op">+</span> <span class="st">"."</span>)</span>
<span id="d087f5b7-65"><a href="#d087f5b7-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="d087f5b7-66"><a href="#d087f5b7-66" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>.join(descriptions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We can use an example query to see how the information will be structured for the LLM.</p>
<div id="0fd01813" class="cell" data-execution_count="29">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="0fd01813"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="0fd01813-1"><a href="#0fd01813-1" aria-hidden="true" tabindex="-1"></a>example_query <span class="op">=</span> <span class="st">"What are the dependencies necessary to run Atari environments ?"</span></span>
<span id="0fd01813-2"><a href="#0fd01813-2" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> driver.session() <span class="im">as</span> session:</span>
<span id="0fd01813-3"><a href="#0fd01813-3" aria-hidden="true" tabindex="-1"></a>    rag_graph <span class="op">=</span> session.execute_read(get_rag_graph, example_query)</span>
<span id="0fd01813-4"><a href="#0fd01813-4" aria-hidden="true" tabindex="-1"></a>    summary <span class="op">=</span> graph_to_textual_summary(rag_graph)</span>
<span id="0fd01813-5"><a href="#0fd01813-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(summary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"ba54fe30536b4e4ea584f26db50b8ff7","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>A Issue node identified as 'Added Atari environments to tests, removed dead code' has its number is '78', its closed_at is '2022-10-26T20:41:39.000000000+00:00', its updated_at is '2022-10-26T20:41:40.000000000+00:00', its created_at is '2022-10-26T15:30:13.000000000+00:00', its state is 'closed', its body is '- Adds some atari environments to tested environments (if gym and ale are available)
- Removed definition of `minimum_testing_env_specs`, which was dead code, also didn't make sense (compared specs to strings, I think)
- Atari environments are currently not being tested for `render_mode` because `GymEnvironment` doesn't support that kwarg

Tests are currently not passing locally, which seems to be due to an unrelated problem'.
A User node identified as 'Markus Krimmel' has its followers is '21', its created_at is '2015-11-11T20:17:24.000000000+00:00'.
A Comment node identified as '1292409182' has its updated_at is '2022-10-26T18:02:09.000000000+00:00', its created_at is '2022-10-26T18:02:09.000000000+00:00', its body is 'Yeah, I will add that comment :) 

I also considered fetching the ids from the (old) Gym registry, but I decided against it because that registry should not really change, given that Gym is no longer being maintained. Also, I would be somewhat worried that for some reason (e.g. ale not being installed) no Atari envs show up in the registry and the test is silently skipped.

Currently, neither this test, nor `test_gym_conversion` are in CI, because gym isn't being installed.'.
A Issue node identified as '[Question] Does the Pong game have speed in its actions?' has its number is '865', its closed_at is '2024-01-02T19:51:20.000000000+00:00', its updated_at is '2024-01-02T19:51:20.000000000+00:00', its created_at is '2024-01-02T15:56:36.000000000+00:00', its state is 'closed', its body is '### Question

The pong game has 6 basic actions. Noop, fire, right, rightfire, left, left fire. My question is do actions that have fire options (such as right fire) speed up the ball? 
According to the AtariAge page, the red button in the actual controller adds some speed. Did you add this feature to the gymnasium?'.
A Issue node identified as 'Fix documentation ci' has its number is '417', its closed_at is '2023-03-30T13:49:19.000000000+00:00', its updated_at is '2023-03-30T13:49:19.000000000+00:00', its created_at is '2023-03-30T13:29:07.000000000+00:00', its state is 'closed', its body is 'https://github.com/Farama-Foundation/Gymnasium/pull/414 caused the documentation CI to fail due to the filter list not working as intended

Additionally, add the new atari environments to the list '.
A Issue node identified as 'Add all atari environments and remove pip install atari from documentation' has its number is '367', its closed_at is '2023-03-08T12:31:43.000000000+00:00', its updated_at is '2023-03-08T12:31:44.000000000+00:00', its created_at is '2023-03-08T12:29:06.000000000+00:00', its state is 'closed', its body is 'Previously, in generating the documentation, atari and autorom was installed which caused issues if the roms failed to install. 
However, atari is not generate each time in the documentation so this was just causing issues for no reason

Furthermore, this PR add documentation for all of the atari environments (not including descriptions)'.
A Issue node identified as '[Bug Report] Cannot make an environment in env.registry' has its number is '152', its closed_at is '2022-11-23T14:03:14.000000000+00:00', its updated_at is '2022-11-23T14:53:50.000000000+00:00', its created_at is '2022-11-21T17:24:08.000000000+00:00', its state is 'closed', its body is '### Describe the bug

Hello,

When trying to make an environment in ``gym.registry`` I get a ``NameNotFound`` error, even though the environment should be found as I am picking the name from ``gym.registry``.

```python
Python 3.10.6 (main, Nov  2 2022, 18:53:38) [GCC 11.3.0] on linux
Type "help", "copyright", "credits" or "license" for more information.
&gt;&gt;&gt; import gymnasium as gym
&gt;&gt;&gt; gym.make("YarsRevengeNoFrameskip-v4")
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in &lt;module&gt;
  File "/home/marc/.venvs/bonsai-gym/lib/python3.10/site-packages/gymnasium/envs/regist...'.
A User node identified as 'Mark Towers' has its followers is '245', its created_at is '2015-10-03T12:42:08.000000000+00:00'.
A User node identified as 'Marco Zatta' has its followers is '0', its created_at is '2021-12-03T07:44:35.000000000+00:00', its company is '@microsoft'.
A Label node identified as 'bug' has its color is 'd73a4a', its description is 'Something isn't working'.
A Comment node identified as '1322786823' has its updated_at is '2022-11-23T14:53:50.000000000+00:00', its created_at is '2022-11-21T23:19:47.000000000+00:00', its body is 'Ale-py has not updated to gymnasium yet sadly. 
I will update the release notes. 
This will be fixed in the next release, in the meantime you can use `pip install shimmy[atari]` or using the gym compatibility Env (see the website info)'.
A Comment node identified as '1325117034' has its updated_at is '2022-11-23T14:03:14.000000000+00:00', its created_at is '2022-11-23T14:03:14.000000000+00:00', its body is 'Oh sorry, I got confused and did not consider that I was talking about a `gym` environment and not a `gymnasium` one. Sorry for that'.
A User node identified as 'gglsmm' has its followers is '0', its created_at is '2022-04-23T20:17:49.000000000+00:00', its location is 'USA'.
A Label node identified as 'question' has its color is 'd876e3', its description is 'Further information is requested'.
A Comment node identified as '1874411902' has its updated_at is '2024-01-02T18:48:57.000000000+00:00', its created_at is '2024-01-02T18:48:57.000000000+00:00', its body is 'https://gymnasium.farama.org/environments/atari/pong/#actions'.
A Comment node identified as '1874475704' has its updated_at is '2024-01-02T19:51:20.000000000+00:00', its created_at is '2024-01-02T19:51:20.000000000+00:00', its body is '@gglsmm I would guess so and from playing the environment, I believe so, as all the atari environment is a wrapper over the stella emulator which should run the actual pong ROM so it should play identically to the real thing '.
A User node identified as 'Kallinteris Andreas' has its followers is '37', its created_at is '2017-08-05T21:48:59.000000000+00:00'.
There is a relationship of type 'RAISED_BY' from node 'Added Atari environments to tests, removed dead code' to node 'Markus Krimmel'.
There is a relationship of type 'COMMENT_ON' from node '1292409182' to node 'Added Atari environments to tests, removed dead code'.
There is a relationship of type 'MIGHT_RELATE_TO' from node '[Question] Does the Pong game have speed in its actions?' to node 'Added Atari environments to tests, removed dead code' with a similarity score of 0.80.
There is a relationship of type 'MIGHT_RELATE_TO' from node 'Fix documentation ci' to node 'Added Atari environments to tests, removed dead code' with a similarity score of 0.91.
There is a relationship of type 'MIGHT_RELATE_TO' from node 'Add all atari environments and remove pip install atari from documentation' to node 'Added Atari environments to tests, removed dead code' with a similarity score of 0.90.
There is a relationship of type 'MIGHT_RELATE_TO' from node '[Bug Report] Cannot make an environment in env.registry' to node 'Added Atari environments to tests, removed dead code' with a similarity score of 0.87.
There is a relationship of type 'RAISED_BY' from node 'Add all atari environments and remove pip install atari from documentation' to node 'Mark Towers'.
There is a relationship of type 'MIGHT_RELATE_TO' from node 'Add all atari environments and remove pip install atari from documentation' to node '[Bug Report] Cannot make an environment in env.registry' with a similarity score of 0.86.
There is a relationship of type 'MIGHT_RELATE_TO' from node '[Question] Does the Pong game have speed in its actions?' to node 'Add all atari environments and remove pip install atari from documentation' with a similarity score of 0.84.
There is a relationship of type 'MIGHT_RELATE_TO' from node 'Fix documentation ci' to node 'Add all atari environments and remove pip install atari from documentation' with a similarity score of 0.93.
There is a relationship of type 'RAISED_BY' from node 'Fix documentation ci' to node 'Mark Towers'.
There is a relationship of type 'MIGHT_RELATE_TO' from node 'Fix documentation ci' to node '[Bug Report] Cannot make an environment in env.registry' with a similarity score of 0.88.
There is a relationship of type 'MIGHT_RELATE_TO' from node '[Question] Does the Pong game have speed in its actions?' to node 'Fix documentation ci' with a similarity score of 0.85.
There is a relationship of type 'RAISED_BY' from node '[Bug Report] Cannot make an environment in env.registry' to node 'Marco Zatta'.
There is a relationship of type 'HAS_LABEL' from node '[Bug Report] Cannot make an environment in env.registry' to node 'bug'.
There is a relationship of type 'COMMENT_ON' from node '1322786823' to node '[Bug Report] Cannot make an environment in env.registry'.
There is a relationship of type 'COMMENT_ON' from node '1325117034' to node '[Bug Report] Cannot make an environment in env.registry'.
There is a relationship of type 'RAISED_BY' from node '[Question] Does the Pong game have speed in its actions?' to node 'gglsmm'.
There is a relationship of type 'HAS_LABEL' from node '[Question] Does the Pong game have speed in its actions?' to node 'question'.
There is a relationship of type 'COMMENT_ON' from node '1874411902' to node '[Question] Does the Pong game have speed in its actions?'.
There is a relationship of type 'COMMENT_ON' from node '1874475704' to node '[Question] Does the Pong game have speed in its actions?'.
There is a relationship of type 'COMMENT_BY' from node '1292409182' to node 'Markus Krimmel'.
There is a relationship of type 'COMMENT_BY' from node '1874475704' to node 'Mark Towers'.
There is a relationship of type 'COMMENT_BY' from node '1322786823' to node 'Mark Towers'.
There is a relationship of type 'COMMENT_BY' from node '1325117034' to node 'Marco Zatta'.
There is a relationship of type 'COMMENT_BY' from node '1874411902' to node 'Kallinteris Andreas'.</code></pre>
</div>
</div>
<p>This might seem like a lot of information, and not particularly easy to follow. But keep in mind that the LLM is capable of processing it and generating a coherent response based on it - it is not supposed to be easy to follow for a human reader, but rather structured in a way that the LLM can understand and use to generate answers.</p>
<section id="tools-for-the-agent" class="level3">
<h3 class="anchored" data-anchor-id="tools-for-the-agent">Tools for the agent</h3>
<p>A key aspect of building an AI agent is defining the tools it can use to autonomously interact with, and potentially modify, the environment. In our case we will provide the agent with two tools - <code>find_issues_from_prompt</code> and <code>find_experts</code>. The first tool will allow the agent to find issues in the graph based on a user prompt, while the second tool will help it identify potential experts based on their interactions with relevant issues.</p>
<p>In many cases tools just return further information to the agent, which it can then use to generate a response. However, in some cases the agent might need to take actions based on the information it retrieves, such as creating new issues or updating existing ones. In our case, we will focus on retrieving information and generating summaries.</p>
<div id="54e16791" class="cell" data-execution_count="30">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="54e16791"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="54e16791-1"><a href="#54e16791-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_issues_from_prompt(query_string: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">dict</span>:</span>
<span id="54e16791-2"><a href="#54e16791-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="54e16791-3"><a href="#54e16791-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Finds potential issues from a user prompt, gets the graph matching the prompt,</span></span>
<span id="54e16791-4"><a href="#54e16791-4" aria-hidden="true" tabindex="-1"></a><span class="co">    and returns a textual summary of the graph.</span></span>
<span id="54e16791-5"><a href="#54e16791-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="54e16791-6"><a href="#54e16791-6" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="54e16791-7"><a href="#54e16791-7" aria-hidden="true" tabindex="-1"></a><span class="co">        query_string: The user's query about issues.</span></span>
<span id="54e16791-8"><a href="#54e16791-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="54e16791-9"><a href="#54e16791-9" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="54e16791-10"><a href="#54e16791-10" aria-hidden="true" tabindex="-1"></a><span class="co">        A dictionary containing a summary of the retrieved graph data.</span></span>
<span id="54e16791-11"><a href="#54e16791-11" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="54e16791-12"><a href="#54e16791-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Agent is calling find_issues_from_prompt with query: '</span><span class="sc">{</span>query_string<span class="sc">}</span><span class="ss">'"</span>)</span>
<span id="54e16791-13"><a href="#54e16791-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> driver.session() <span class="im">as</span> session:</span>
<span id="54e16791-14"><a href="#54e16791-14" aria-hidden="true" tabindex="-1"></a>        rag_graph <span class="op">=</span> session.execute_read(get_rag_graph, query_string)</span>
<span id="54e16791-15"><a href="#54e16791-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> rag_graph:</span>
<span id="54e16791-16"><a href="#54e16791-16" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(</span>
<span id="54e16791-17"><a href="#54e16791-17" aria-hidden="true" tabindex="-1"></a>                <span class="ss">f"Found </span><span class="sc">{</span><span class="bu">len</span>(rag_graph.nodes)<span class="sc">}</span><span class="ss"> nodes and </span><span class="sc">{</span><span class="bu">len</span>(rag_graph.relationships)<span class="sc">}</span><span class="ss"> relationships."</span></span>
<span id="54e16791-18"><a href="#54e16791-18" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="54e16791-19"><a href="#54e16791-19" aria-hidden="true" tabindex="-1"></a>            summary <span class="op">=</span> graph_to_textual_summary(rag_graph)</span>
<span id="54e16791-20"><a href="#54e16791-20" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> {<span class="st">"summary"</span>: summary}</span>
<span id="54e16791-21"><a href="#54e16791-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="54e16791-22"><a href="#54e16791-22" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> {<span class="st">"summary"</span>: <span class="st">"Could not find any relevant information in the graph."</span>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="8ed77354" class="cell" data-execution_count="31">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="8ed77354"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="8ed77354-1"><a href="#8ed77354-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_experts(query_string: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">dict</span>:</span>
<span id="8ed77354-2"><a href="#8ed77354-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="8ed77354-3"><a href="#8ed77354-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Finds potential experts on a topic by analyzing who has contributed to the most relevant issues.</span></span>
<span id="8ed77354-4"><a href="#8ed77354-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="8ed77354-5"><a href="#8ed77354-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="8ed77354-6"><a href="#8ed77354-6" aria-hidden="true" tabindex="-1"></a><span class="co">        query_string: The user's query describing the topic of interest.</span></span>
<span id="8ed77354-7"><a href="#8ed77354-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="8ed77354-8"><a href="#8ed77354-8" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="8ed77354-9"><a href="#8ed77354-9" aria-hidden="true" tabindex="-1"></a><span class="co">        A dictionary containing a summary of potential experts.</span></span>
<span id="8ed77354-10"><a href="#8ed77354-10" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="8ed77354-11"><a href="#8ed77354-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Agent is calling find_experts with query: '</span><span class="sc">{</span>query_string<span class="sc">}</span><span class="ss">'"</span>)</span>
<span id="8ed77354-12"><a href="#8ed77354-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="8ed77354-13"><a href="#8ed77354-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Embed the query string</span></span>
<span id="8ed77354-14"><a href="#8ed77354-14" aria-hidden="true" tabindex="-1"></a>    query_embedding <span class="op">=</span> embedding_model.embed_batch([query_string])[<span class="dv">0</span>].tolist()</span>
<span id="8ed77354-15"><a href="#8ed77354-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="8ed77354-16"><a href="#8ed77354-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find experts in the graph</span></span>
<span id="8ed77354-17"><a href="#8ed77354-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> driver.session() <span class="im">as</span> session:</span>
<span id="8ed77354-18"><a href="#8ed77354-18" aria-hidden="true" tabindex="-1"></a>        result <span class="op">=</span> session.run(</span>
<span id="8ed77354-19"><a href="#8ed77354-19" aria-hidden="true" tabindex="-1"></a>            <span class="st">"""</span></span>
<span id="8ed77354-20"><a href="#8ed77354-20" aria-hidden="true" tabindex="-1"></a><span class="st">            // Find the top matching issue for the query embedding</span></span>
<span id="8ed77354-21"><a href="#8ed77354-21" aria-hidden="true" tabindex="-1"></a><span class="st">            CALL db.index.vector.queryNodes('issue_embeddings', 1, $embedding) YIELD node AS top_issue</span></span>
<span id="8ed77354-22"><a href="#8ed77354-22" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="8ed77354-23"><a href="#8ed77354-23" aria-hidden="true" tabindex="-1"></a><span class="st">            // Collect the top issue and up to 5 of its most similar issues</span></span>
<span id="8ed77354-24"><a href="#8ed77354-24" aria-hidden="true" tabindex="-1"></a><span class="st">            WITH top_issue</span></span>
<span id="8ed77354-25"><a href="#8ed77354-25" aria-hidden="true" tabindex="-1"></a><span class="st">            OPTIONAL MATCH (top_issue)-[r:MIGHT_RELATE_TO]-(related_issue:Issue)</span></span>
<span id="8ed77354-26"><a href="#8ed77354-26" aria-hidden="true" tabindex="-1"></a><span class="st">            WITH top_issue, related_issue, r.score as score</span></span>
<span id="8ed77354-27"><a href="#8ed77354-27" aria-hidden="true" tabindex="-1"></a><span class="st">            ORDER BY score DESC</span></span>
<span id="8ed77354-28"><a href="#8ed77354-28" aria-hidden="true" tabindex="-1"></a><span class="st">            WITH top_issue, collect(related_issue)[..5] AS related_issues</span></span>
<span id="8ed77354-29"><a href="#8ed77354-29" aria-hidden="true" tabindex="-1"></a><span class="st">            WITH [top_issue] + related_issues AS all_issues</span></span>
<span id="8ed77354-30"><a href="#8ed77354-30" aria-hidden="true" tabindex="-1"></a><span class="st">            UNWIND all_issues as issue</span></span>
<span id="8ed77354-31"><a href="#8ed77354-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="8ed77354-32"><a href="#8ed77354-32" aria-hidden="true" tabindex="-1"></a><span class="st">            // Find all users who have interacted with these issues</span></span>
<span id="8ed77354-33"><a href="#8ed77354-33" aria-hidden="true" tabindex="-1"></a><span class="st">            OPTIONAL MATCH (issue)&lt;-[:RAISED_BY]-(u1:User)</span></span>
<span id="8ed77354-34"><a href="#8ed77354-34" aria-hidden="true" tabindex="-1"></a><span class="st">            OPTIONAL MATCH (issue)&lt;-[:ASSIGNED_TO]-(u2:User)</span></span>
<span id="8ed77354-35"><a href="#8ed77354-35" aria-hidden="true" tabindex="-1"></a><span class="st">            OPTIONAL MATCH (issue)&lt;-[:COMMENT_ON]-(:Comment)-[:COMMENT_BY]-&gt;(u3:User)</span></span>
<span id="8ed77354-36"><a href="#8ed77354-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="8ed77354-37"><a href="#8ed77354-37" aria-hidden="true" tabindex="-1"></a><span class="st">            // Aggregate and rank the users</span></span>
<span id="8ed77354-38"><a href="#8ed77354-38" aria-hidden="true" tabindex="-1"></a><span class="st">            WITH issue, u1, u2, u3</span></span>
<span id="8ed77354-39"><a href="#8ed77354-39" aria-hidden="true" tabindex="-1"></a><span class="st">            WITH collect(u1) + collect(u2) + collect(u3) as users, issue</span></span>
<span id="8ed77354-40"><a href="#8ed77354-40" aria-hidden="true" tabindex="-1"></a><span class="st">            UNWIND users as user</span></span>
<span id="8ed77354-41"><a href="#8ed77354-41" aria-hidden="true" tabindex="-1"></a><span class="st">            WITH user, count(issue) as interactions, collect(DISTINCT {id: issue.id, title: issue.title}) as issues</span></span>
<span id="8ed77354-42"><a href="#8ed77354-42" aria-hidden="true" tabindex="-1"></a><span class="st">            ORDER BY interactions DESC</span></span>
<span id="8ed77354-43"><a href="#8ed77354-43" aria-hidden="true" tabindex="-1"></a><span class="st">            LIMIT 5</span></span>
<span id="8ed77354-44"><a href="#8ed77354-44" aria-hidden="true" tabindex="-1"></a><span class="st">            </span></span>
<span id="8ed77354-45"><a href="#8ed77354-45" aria-hidden="true" tabindex="-1"></a><span class="st">            RETURN collect({user: user.login, interactions: interactions, issues: issues}) as experts</span></span>
<span id="8ed77354-46"><a href="#8ed77354-46" aria-hidden="true" tabindex="-1"></a><span class="st">        """</span>,</span>
<span id="8ed77354-47"><a href="#8ed77354-47" aria-hidden="true" tabindex="-1"></a>            embedding<span class="op">=</span>query_embedding,</span>
<span id="8ed77354-48"><a href="#8ed77354-48" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="8ed77354-49"><a href="#8ed77354-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="8ed77354-50"><a href="#8ed77354-50" aria-hidden="true" tabindex="-1"></a>        experts <span class="op">=</span> result.single()[<span class="st">"experts"</span>]</span>
<span id="8ed77354-51"><a href="#8ed77354-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="8ed77354-52"><a href="#8ed77354-52" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> experts:</span>
<span id="8ed77354-53"><a href="#8ed77354-53" aria-hidden="true" tabindex="-1"></a>            summary <span class="op">=</span> <span class="st">"Found the following potential experts based on their interactions with relevant issues:</span><span class="ch">\n\n</span><span class="st">"</span></span>
<span id="8ed77354-54"><a href="#8ed77354-54" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> expert <span class="kw">in</span> experts:</span>
<span id="8ed77354-55"><a href="#8ed77354-55" aria-hidden="true" tabindex="-1"></a>                summary <span class="op">+=</span> <span class="ss">f"- User: </span><span class="sc">{</span>expert[<span class="st">'user'</span>]<span class="sc">}</span><span class="ss"> (Interactions: </span><span class="sc">{</span>expert[<span class="st">'interactions'</span>]<span class="sc">}</span><span class="ss">)</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="8ed77354-56"><a href="#8ed77354-56" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> issue <span class="kw">in</span> expert[<span class="st">"issues"</span>]:</span>
<span id="8ed77354-57"><a href="#8ed77354-57" aria-hidden="true" tabindex="-1"></a>                    summary <span class="op">+=</span> (</span>
<span id="8ed77354-58"><a href="#8ed77354-58" aria-hidden="true" tabindex="-1"></a>                        <span class="ss">f"  - Interacted with issue #</span><span class="sc">{</span>issue[<span class="st">'id'</span>]<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>issue[<span class="st">'title'</span>]<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="8ed77354-59"><a href="#8ed77354-59" aria-hidden="true" tabindex="-1"></a>                    )</span>
<span id="8ed77354-60"><a href="#8ed77354-60" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> {<span class="st">"summary"</span>: summary}</span>
<span id="8ed77354-61"><a href="#8ed77354-61" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="8ed77354-62"><a href="#8ed77354-62" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> {<span class="st">"summary"</span>: <span class="st">"Could not find any potential experts for this topic."</span>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>With these tools defined, we can now create an AI agent that can use them to answer user queries about issues in the graph. The agent will be able to find relevant issues based on user prompts and summarize the information found, as well as identify potential experts based on their interactions with relevant issues.</p>
<p>Note the <code>system_instruction</code> in the <code>GenerateContentConfig</code> is crucial as it defines the agent’s role and how it should use the tools provided. The agent will strictly use the information provided by the tools to formulate its response, ensuring that it does not make assumptions or generate information that is not present in the graph.</p>
<div id="17949f75" class="cell" data-execution_count="32">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="17949f75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="17949f75-1"><a href="#17949f75-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> google.genai <span class="im">import</span> types</span>
<span id="17949f75-2"><a href="#17949f75-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> display, Markdown</span>
<span id="17949f75-3"><a href="#17949f75-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="17949f75-4"><a href="#17949f75-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="17949f75-5"><a href="#17949f75-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> converse_with_agent(user_prompt: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="17949f75-6"><a href="#17949f75-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="17949f75-7"><a href="#17949f75-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Converse with the agent using a user prompt.</span></span>
<span id="17949f75-8"><a href="#17949f75-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="17949f75-9"><a href="#17949f75-9" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="17949f75-10"><a href="#17949f75-10" aria-hidden="true" tabindex="-1"></a><span class="co">        user_prompt: The user's query to the agent.</span></span>
<span id="17949f75-11"><a href="#17949f75-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="17949f75-12"><a href="#17949f75-12" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="17949f75-13"><a href="#17949f75-13" aria-hidden="true" tabindex="-1"></a><span class="co">        The agent's response as a string.</span></span>
<span id="17949f75-14"><a href="#17949f75-14" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="17949f75-15"><a href="#17949f75-15" aria-hidden="true" tabindex="-1"></a>    config <span class="op">=</span> types.GenerateContentConfig(</span>
<span id="17949f75-16"><a href="#17949f75-16" aria-hidden="true" tabindex="-1"></a>        system_instruction<span class="op">=</span><span class="ss">f"""You are an expert agent that can find issues in a Neo4j graph database based on user prompts for the </span><span class="sc">{</span>repo_name<span class="sc">}</span><span class="ss"> repository. Use the find_issues_from_prompt tool to retrieve relevant issues, summarize them into two sections:</span></span>
<span id="17949f75-17"><a href="#17949f75-17" aria-hidden="true" tabindex="-1"></a><span class="ss">        </span></span>
<span id="17949f75-18"><a href="#17949f75-18" aria-hidden="true" tabindex="-1"></a><span class="ss">        ### Summary</span></span>
<span id="17949f75-19"><a href="#17949f75-19" aria-hidden="true" tabindex="-1"></a><span class="ss">        Provide a concise summary of the issues found in the graph based on the user prompt.</span></span>
<span id="17949f75-20"><a href="#17949f75-20" aria-hidden="true" tabindex="-1"></a><span class="ss">        ### Potential Issues</span></span>
<span id="17949f75-21"><a href="#17949f75-21" aria-hidden="true" tabindex="-1"></a><span class="ss">        List the potential issues that match the user prompt, including relevant details such as issue titles, labels, and any other pertinent information.</span></span>
<span id="17949f75-22"><a href="#17949f75-22" aria-hidden="true" tabindex="-1"></a><span class="ss">        ### Advice</span></span>
<span id="17949f75-23"><a href="#17949f75-23" aria-hidden="true" tabindex="-1"></a><span class="ss">        Provide any advice or recommendations based on the issues found in the graph.</span></span>
<span id="17949f75-24"><a href="#17949f75-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="17949f75-25"><a href="#17949f75-25" aria-hidden="true" tabindex="-1"></a><span class="ss">        When using the find_experts tool, summarize the potential experts based on their interactions with relevant issues as a table, including their usernames and interaction counts, and a list of relevant issue titles and ID's.</span></span>
<span id="17949f75-26"><a href="#17949f75-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="17949f75-27"><a href="#17949f75-27" aria-hidden="true" tabindex="-1"></a><span class="ss">        Strictly use only the information provided by the tool to formulate your response."""</span>,</span>
<span id="17949f75-28"><a href="#17949f75-28" aria-hidden="true" tabindex="-1"></a>        temperature<span class="op">=</span><span class="fl">0.4</span>,</span>
<span id="17949f75-29"><a href="#17949f75-29" aria-hidden="true" tabindex="-1"></a>        tools<span class="op">=</span>[find_issues_from_prompt, find_experts],</span>
<span id="17949f75-30"><a href="#17949f75-30" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="17949f75-31"><a href="#17949f75-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="17949f75-32"><a href="#17949f75-32" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> genai_client.models.generate_content(</span>
<span id="17949f75-33"><a href="#17949f75-33" aria-hidden="true" tabindex="-1"></a>        model<span class="op">=</span><span class="st">"gemini-2.5-flash"</span>, config<span class="op">=</span>config, contents<span class="op">=</span>user_prompt</span>
<span id="17949f75-34"><a href="#17949f75-34" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="17949f75-35"><a href="#17949f75-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="17949f75-36"><a href="#17949f75-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> response.candidates <span class="kw">or</span> <span class="kw">not</span> response.candidates[<span class="dv">0</span>].content.parts:</span>
<span id="17949f75-37"><a href="#17949f75-37" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">"No response generated by the agent."</span></span>
<span id="17949f75-38"><a href="#17949f75-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="17949f75-39"><a href="#17949f75-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> response.candidates[<span class="dv">0</span>].content.parts[<span class="dv">0</span>].text</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="example-interactions" class="level2">
<h2 class="anchored" data-anchor-id="example-interactions">Example interactions</h2>
<p>Let’s test our agent with a few example queries. The agent will use the tools defined earlier to find relevant issues and provide a summary of the information found in the graph.</p>
<div id="9ed533d6" class="cell" data-execution_count="33">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="9ed533d6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="9ed533d6-1"><a href="#9ed533d6-1" aria-hidden="true" tabindex="-1"></a>user_prompt <span class="op">=</span> <span class="st">"What are the dependencies necessary to run Atari environments ?"</span></span>
<span id="9ed533d6-2"><a href="#9ed533d6-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"User prompt: </span><span class="sc">{</span>user_prompt<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="9ed533d6-3"><a href="#9ed533d6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="9ed533d6-4"><a href="#9ed533d6-4" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> converse_with_agent(user_prompt)</span>
<span id="9ed533d6-5"><a href="#9ed533d6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="9ed533d6-6"><a href="#9ed533d6-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Agent Response:"</span>)</span>
<span id="9ed533d6-7"><a href="#9ed533d6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="9ed533d6-8"><a href="#9ed533d6-8" aria-hidden="true" tabindex="-1"></a>boxed_md <span class="op">=</span> <span class="ss">f"""</span></span>
<span id="9ed533d6-9"><a href="#9ed533d6-9" aria-hidden="true" tabindex="-1"></a><span class="ss">::: callout-note</span></span>
<span id="9ed533d6-10"><a href="#9ed533d6-10" aria-hidden="true" tabindex="-1"></a><span class="sc">{</span>response<span class="sc">}</span></span>
<span id="9ed533d6-11"><a href="#9ed533d6-11" aria-hidden="true" tabindex="-1"></a><span class="ss">:::</span></span>
<span id="9ed533d6-12"><a href="#9ed533d6-12" aria-hidden="true" tabindex="-1"></a><span class="ss">"""</span></span>
<span id="9ed533d6-13"><a href="#9ed533d6-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="9ed533d6-14"><a href="#9ed533d6-14" aria-hidden="true" tabindex="-1"></a>display(Markdown(boxed_md))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>User prompt: What are the dependencies necessary to run Atari environments ?

Agent is calling find_issues_from_prompt with query: 'What are the dependencies necessary to run Atari environments ?'</code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"6f755d36221f48128f4c1a0c20db6796","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Found 17 nodes and 26 relationships.

Agent Response:</code></pre>
</div>
<div class="cell-output cell-output-display cell-output-markdown">
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Summary
</div>
</div>
<div class="callout-body-container callout-body">
<p>The issues found indicate that running Atari environments in Gymnasium requires specific dependencies, primarily <code>gym</code> and <code>ale-py</code>. There have been discussions and fixes related to ensuring these environments are properly tested and documented, and issues have arisen when <code>ale-py</code> was not updated to support Gymnasium.</p>
<section id="potential-issues" class="level3">
<h3 class="anchored" data-anchor-id="potential-issues">Potential Issues</h3>
<ul>
<li><strong>Issue 78: Added Atari environments to tests, removed dead code</strong>
<ul>
<li><strong>Details:</strong> This issue, raised by Markus Krimmel, mentions that Atari environments are added to tests “if gym and ale are available.” This directly points to <code>gym</code> and <code>ale</code> (likely referring to <code>ale-py</code>) as necessary dependencies.</li>
</ul></li>
<li><strong>Issue 152: [Bug Report] Cannot make an environment in env.registry</strong>
<ul>
<li><strong>Labels:</strong> bug</li>
<li><strong>Details:</strong> Raised by Marco Zatta, this bug report highlights that <code>ale-py</code> had not been updated to Gymnasium, preventing the creation of Atari environments. A comment on this issue suggests using <code>pip install shimmy[atari]</code> as a workaround or utilizing the Gym compatibility environment. This strongly indicates <code>ale-py</code> as a crucial dependency.</li>
</ul></li>
<li><strong>Issue 367: Add all atari environments and remove pip install atari from documentation</strong>
<ul>
<li><strong>Details:</strong> Raised by Mark Towers, this issue discusses the installation of <code>atari</code> and <code>autorom</code> for documentation generation, which caused issues if ROMs failed to install. While the issue aimed to remove <code>pip install atari</code> from documentation generation, it implies that <code>atari</code> (and potentially <code>autorom</code>) were considered dependencies at some point for these environments.</li>
</ul></li>
<li><strong>Issue 417: Fix documentation ci</strong>
<ul>
<li><strong>Details:</strong> Raised by Mark Towers, this issue is related to fixing documentation CI failures and adding new Atari environments to a list, suggesting that the proper setup for Atari environments impacts documentation and CI processes.</li>
</ul></li>
<li><strong>Issue 865: [Question] Does the Pong game have speed in its actions?</strong>
<ul>
<li><strong>Labels:</strong> question</li>
<li><strong>Details:</strong> Raised by gglsmm, this question about Pong game actions mentions that “all the atari environment is a wrapper over the stella emulator which should run the actual pong ROM.” This implies that the underlying Atari environments rely on an emulator like Stella and the corresponding ROMs.</li>
</ul></li>
</ul>
</section>
<section id="advice" class="level3">
<h3 class="anchored" data-anchor-id="advice">Advice</h3>
<p>To run Atari environments in Gymnasium, you will primarily need <code>gym</code> and <code>ale-py</code>. Ensure that <code>ale-py</code> is compatible with your Gymnasium version. If you encounter issues with environment creation, consider using <code>pip install shimmy[atari]</code> or exploring the Gym compatibility environment as mentioned in Issue 152. Additionally, be aware that the Atari environments are built upon emulators like Stella and require the relevant ROMs.</p>
</section>
</div>
</div>
</div>
</div>
<div id="322695bb" class="cell" data-execution_count="34">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="322695bb"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="322695bb-1"><a href="#322695bb-1" aria-hidden="true" tabindex="-1"></a>user_prompt <span class="op">=</span> <span class="st">"How do I make sure random number generation is seeded properly for experiment consistency ?"</span></span>
<span id="322695bb-2"><a href="#322695bb-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="322695bb-3"><a href="#322695bb-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"User prompt: </span><span class="sc">{</span>user_prompt<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="322695bb-4"><a href="#322695bb-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="322695bb-5"><a href="#322695bb-5" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> converse_with_agent(user_prompt)</span>
<span id="322695bb-6"><a href="#322695bb-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="322695bb-7"><a href="#322695bb-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Agent Response:"</span>)</span>
<span id="322695bb-8"><a href="#322695bb-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="322695bb-9"><a href="#322695bb-9" aria-hidden="true" tabindex="-1"></a>boxed_md <span class="op">=</span> <span class="ss">f"""</span></span>
<span id="322695bb-10"><a href="#322695bb-10" aria-hidden="true" tabindex="-1"></a><span class="ss">::: callout-note</span></span>
<span id="322695bb-11"><a href="#322695bb-11" aria-hidden="true" tabindex="-1"></a><span class="sc">{</span>response<span class="sc">}</span></span>
<span id="322695bb-12"><a href="#322695bb-12" aria-hidden="true" tabindex="-1"></a><span class="ss">:::</span></span>
<span id="322695bb-13"><a href="#322695bb-13" aria-hidden="true" tabindex="-1"></a><span class="ss">"""</span></span>
<span id="322695bb-14"><a href="#322695bb-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="322695bb-15"><a href="#322695bb-15" aria-hidden="true" tabindex="-1"></a>display(Markdown(boxed_md))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>User prompt: How do I make sure random number generation is seeded properly for experiment consistency ?

Agent is calling find_issues_from_prompt with query: 'random number generation seeded properly for experiment consistency'</code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"6d9f1db388204c8490418bd5bfd51dad","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Found 69 nodes and 125 relationships.

Agent Response:</code></pre>
</div>
<div class="cell-output cell-output-display cell-output-markdown">
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Summary
</div>
</div>
<div class="callout-body-container callout-body">
<p>The issues found highlight the challenges and ongoing efforts in ensuring consistent and reproducible random number generation within the Gymnasium environment, particularly concerning the seeding of environments and the ability to retrieve the seed used. There’s a recognized need for better control over seeding in vectorized environments and for making the active seed easily accessible for debugging and reproducibility.</p>
<section id="potential-issues-1" class="level3">
<h3 class="anchored" data-anchor-id="potential-issues-1">Potential Issues</h3>
<ul>
<li><strong>Support list of options in VectorEnv.reset() (Issue #113)</strong>: This closed issue indicates a past attempt to allow passing a list of seeds (and options) to <code>VectorEnv.reset()</code>. While it was deemed not feasible to implement cleanly at the time, it points to a desire for more fine-grained control over individual sub-environment seeding within a vectorized setup. This could be a potential area for future development if experiment consistency across multiple parallel environments is a high priority.</li>
<li><strong>Made readout of seed possible in env (Issue #889)</strong>: This issue addresses the difficulty of extracting the random seed used by the environment’s <code>np_random</code> object. It proposes adding a <code>np_random_seed</code> property to the environment, allowing users to read the seed that was set during <code>reset()</code>. This is crucial for verifying and recording the exact seed used for an experiment, which is fundamental for reproducibility. The discussion also touches upon potential inconsistencies if <code>env.np_random</code> is directly set by the user.</li>
<li><strong>Check the determinism of <code>env.reset(seed=42); env.reset()</code> (Issue #1086)</strong>: This issue focuses on ensuring that <code>env.reset()</code> behaves deterministically when a seed is provided. It highlights a scenario where an environment might generate random observations <em>not</em> based on the internal <code>np_random</code> object, leading to non-deterministic behavior even if a seed is passed. This is a direct threat to experiment consistency and emphasizes the importance of correctly implementing random number generation within custom environments.</li>
</ul>
</section>
<section id="advice-1" class="level3">
<h3 class="anchored" data-anchor-id="advice-1">Advice</h3>
<p>Based on the issues, here’s some advice for ensuring random number generation is seeded properly for experiment consistency:</p>
<ol type="1">
<li><strong>Always use the <code>seed</code> parameter in <code>env.reset()</code></strong>: This is the primary and most reliable way to seed the environment’s internal random number generator. Ensure that you pass a consistent seed value for reproducible experiments.</li>
<li><strong>Understand <code>np_random_seed</code> (Issue #889)</strong>: If you need to verify the seed used by an environment, especially within complex frameworks or parallel processes, the <code>np_random_seed</code> property (introduced in Issue #889) can be very useful. Be aware of its behavior, particularly if you are directly manipulating <code>env.np_random</code>.</li>
<li><strong>Ensure all random operations are tied to <code>env.np_random</code> (Issue #1086)</strong>: When creating custom Gymnasium environments, it is critical that <em>all</em> random number generation within the environment (e.g., for initial states, observations, or internal dynamics) uses the <code>self.np_random</code> object provided by the Gymnasium API. If you use <code>random</code> or <code>numpy.random</code> directly without linking it to <code>self.np_random</code>, your environment will not be deterministic even if <code>env.reset(seed=...)</code> is called.</li>
<li><strong>Consider the implications for vectorized environments (Issue #113)</strong>: While direct support for lists of seeds in <code>VectorEnv.reset()</code> was deemed complex, be mindful of how individual sub-environments are seeded within your vectorized setups. If you require specific seeding for each sub-environment, you might need to manage this externally or explore wrappers that provide such functionality.</li>
<li><strong>Test for determinism</strong>: Actively test your environments for determinism by resetting with the same seed multiple times and verifying that the initial states and subsequent transitions are identical. The example provided in Issue #1086 (<code>check_env</code> from <code>gymnasium.utils.env_checker</code>) can be a good starting point for such tests.</li>
</ol>
</section>
</div>
</div>
</div>
</div>
<div id="e92c2075" class="cell" data-execution_count="35">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="e92c2075"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="e92c2075-1"><a href="#e92c2075-1" aria-hidden="true" tabindex="-1"></a>user_prompt <span class="op">=</span> (</span>
<span id="e92c2075-2"><a href="#e92c2075-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Who could I reach out to for help with an issue with Atari environments ?"</span></span>
<span id="e92c2075-3"><a href="#e92c2075-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="e92c2075-4"><a href="#e92c2075-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="e92c2075-5"><a href="#e92c2075-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"User prompt: </span><span class="sc">{</span>user_prompt<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="e92c2075-6"><a href="#e92c2075-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="e92c2075-7"><a href="#e92c2075-7" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> converse_with_agent(user_prompt)</span>
<span id="e92c2075-8"><a href="#e92c2075-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="e92c2075-9"><a href="#e92c2075-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Agent Response:"</span>)</span>
<span id="e92c2075-10"><a href="#e92c2075-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="e92c2075-11"><a href="#e92c2075-11" aria-hidden="true" tabindex="-1"></a>boxed_md <span class="op">=</span> <span class="ss">f"""</span></span>
<span id="e92c2075-12"><a href="#e92c2075-12" aria-hidden="true" tabindex="-1"></a><span class="ss">::: callout-note</span></span>
<span id="e92c2075-13"><a href="#e92c2075-13" aria-hidden="true" tabindex="-1"></a><span class="sc">{</span>response<span class="sc">}</span></span>
<span id="e92c2075-14"><a href="#e92c2075-14" aria-hidden="true" tabindex="-1"></a><span class="ss">:::</span></span>
<span id="e92c2075-15"><a href="#e92c2075-15" aria-hidden="true" tabindex="-1"></a><span class="ss">"""</span></span>
<span id="e92c2075-16"><a href="#e92c2075-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="e92c2075-17"><a href="#e92c2075-17" aria-hidden="true" tabindex="-1"></a>display(Markdown(boxed_md))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>User prompt: Who could I reach out to for help with an issue with Atari environments ?

Agent is calling find_experts with query: 'Atari environments'</code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"6f2430a6af3b44189a17fb823ad21262","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Agent Response:</code></pre>
</div>
<div class="cell-output cell-output-display cell-output-markdown">
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Potential Experts
</div>
</div>
<div class="callout-body-container callout-body">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th>Username</th>
<th>Interaction Count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>dylwil3</td>
<td>5</td>
</tr>
<tr class="even">
<td>pseudo-rnd-thoughts</td>
<td>3</td>
</tr>
<tr class="odd">
<td>Markus28</td>
<td>1</td>
</tr>
</tbody>
</table>
<section id="relevant-issues" class="level3">
<h3 class="anchored" data-anchor-id="relevant-issues">Relevant Issues</h3>
<ul>
<li><strong>Add missing descriptions to Atari docs</strong> (ID: #1715976674)</li>
<li><strong>[Bug Report] The Atari doc is missing some information</strong> (ID: #1575650136)</li>
<li><strong>Added Atari environments to tests, removed dead code</strong> (ID: #1424260214)</li>
</ul>
</section>
</div>
</div>
</div>
</div>
</section>
<section id="what-can-we-improve" class="level2">
<h2 class="anchored" data-anchor-id="what-can-we-improve">What can we improve ?</h2>
<p>The above results are quite promising, but there are several areas where we can improve the agent’s performance. A key one is adding chunking when computing embeddings - this will allow us to handle larger texts and provide more context to the agent. We can also improve the way we summarize the graph data, making it more concise and easier for the LLM to process.</p>
<p>We can also enhance the agent’s ability to reason about the graph data by providing it with more context and examples of how to use the tools effectively. This can be done by refining the system instruction and providing more detailed examples of how to use the tools in different scenarios.</p>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div>This work is licensed under CC BY <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">(View License)</a></div></div></section></div></main> <!-- /main -->
<script type="application/vnd.jupyter.widget-state+json">
{"state":{"03815632cb4c425ca005e706edb90dc0":{"model_module":"@jupyter-widgets/base","model_module_version":"2.0.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"2.0.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border_bottom":null,"border_left":null,"border_right":null,"border_top":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"040e92e775bb4e91bcf8603bbc430e89":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"HTMLStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"HTMLStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"StyleView","background":null,"description_width":"","font_size":null,"text_color":null}},"04db57e3d0af4d32ac99bc1f1b73d2e2":{"model_module":"@jupyter-widgets/base","model_module_version":"2.0.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"2.0.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border_bottom":null,"border_left":null,"border_right":null,"border_top":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"05a8a0932fcf4704873d293152749a17":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"2.0.0","_view_name":"HTMLView","description":"","description_allow_html":false,"layout":"IPY_MODEL_25d88bbd133e444c90a5d7b4c11bd99c","placeholder":"​","style":"IPY_MODEL_22d062d169d34143af183d216ec4fae7","tabbable":null,"tooltip":null,"value":"Embedding batch: 100%"}},"0708cea9657141e2bfa8286812ca1e5b":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"HTMLStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"HTMLStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"StyleView","background":null,"description_width":"","font_size":null,"text_color":null}},"11b1efeaf9a54c768afbcb47573d64b0":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"HTMLStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"HTMLStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"StyleView","background":null,"description_width":"","font_size":null,"text_color":null}},"13ff1c6436f747d49ecb1b54758fde02":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"2.0.0","_view_name":"HTMLView","description":"","description_allow_html":false,"layout":"IPY_MODEL_28940c1884844ac68b69dbd253227aca","placeholder":"​","style":"IPY_MODEL_e62a767056f549a48c79a8cf34f574f1","tabbable":null,"tooltip":null,"value":" 1/1 [00:00&lt;00:00, 56.49it/s]"}},"143c97133c1a44c0ac04b3aaa2cfcdda":{"model_module":"@jupyter-widgets/base","model_module_version":"2.0.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"2.0.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border_bottom":null,"border_left":null,"border_right":null,"border_top":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"14d283f4174240838a82e864712f2e59":{"model_module":"@jupyter-widgets/base","model_module_version":"2.0.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"2.0.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border_bottom":null,"border_left":null,"border_right":null,"border_top":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"19f6a88c4c1c41f6bb97cb3851427662":{"model_module":"@jupyter-widgets/base","model_module_version":"2.0.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"2.0.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border_bottom":null,"border_left":null,"border_right":null,"border_top":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"1d43d77d87c64ddaa536f523e18ea918":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"2.0.0","_view_name":"HTMLView","description":"","description_allow_html":false,"layout":"IPY_MODEL_98faeb057e29496c88cef39da31ac104","placeholder":"​","style":"IPY_MODEL_56b0185dbf874adfa8dca1f8628deafb","tabbable":null,"tooltip":null,"value":"Importing users: 100%"}},"2196863c21d341618d94630da96d0086":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"FloatProgressModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"2.0.0","_view_name":"ProgressView","bar_style":"success","description":"","description_allow_html":false,"layout":"IPY_MODEL_d891fd4845bd411591ab8619e8eff089","max":5,"min":0,"orientation":"horizontal","style":"IPY_MODEL_c8a45ace9f2049bca368b5784f330fcd","tabbable":null,"tooltip":null,"value":5}},"21b3d8b5ebe447b09cca220efebce4ab":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"ProgressStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"220157abb9ca4e64a92c02f70a0469a8":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"2.0.0","_view_name":"HTMLView","description":"","description_allow_html":false,"layout":"IPY_MODEL_6c9b6d65d63b4215a478855946cfd79b","placeholder":"​","style":"IPY_MODEL_cb75b8bf7d6943699564a8cabaea792a","tabbable":null,"tooltip":null,"value":"Embedding batch: 100%"}},"22d062d169d34143af183d216ec4fae7":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"HTMLStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"HTMLStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"StyleView","background":null,"description_width":"","font_size":null,"text_color":null}},"25d88bbd133e444c90a5d7b4c11bd99c":{"model_module":"@jupyter-widgets/base","model_module_version":"2.0.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"2.0.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border_bottom":null,"border_left":null,"border_right":null,"border_top":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"28940c1884844ac68b69dbd253227aca":{"model_module":"@jupyter-widgets/base","model_module_version":"2.0.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"2.0.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border_bottom":null,"border_left":null,"border_right":null,"border_top":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"296a79b26583428c86c4972ca915da0b":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"HTMLStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"HTMLStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"StyleView","background":null,"description_width":"","font_size":null,"text_color":null}},"299fbfa35085482ebdd886aae957fb98":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"HTMLStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"HTMLStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"StyleView","background":null,"description_width":"","font_size":null,"text_color":null}},"2bbeb08c9b5a4cb29690ee0db40da0bf":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"ProgressStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"2cb361b006ec483dadb9574d3a3ef74e":{"model_module":"@jupyter-widgets/base","model_module_version":"2.0.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"2.0.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border_bottom":null,"border_left":null,"border_right":null,"border_top":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"2cefd71c2e4f41da90873313ed851b5d":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"HTMLStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"HTMLStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"StyleView","background":null,"description_width":"","font_size":null,"text_color":null}},"2db956e9ddf54110baa1d7490d74affa":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"FloatProgressModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"2.0.0","_view_name":"ProgressView","bar_style":"success","description":"","description_allow_html":false,"layout":"IPY_MODEL_14d283f4174240838a82e864712f2e59","max":24,"min":0,"orientation":"horizontal","style":"IPY_MODEL_ffaca5e42bcc4f9db8f1c9d8acddc0d4","tabbable":null,"tooltip":null,"value":24}},"34f64431402d4431b0265573819a6304":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"2.0.0","_view_name":"HTMLView","description":"","description_allow_html":false,"layout":"IPY_MODEL_aee853732b8b41fcac121a287b2d097e","placeholder":"​","style":"IPY_MODEL_5b0242c67b57468894968483fa329f5a","tabbable":null,"tooltip":null,"value":"Importing events: 100%"}},"3a760c0738d5431e8d0a89b5820add9d":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"2.0.0","_view_name":"HTMLView","description":"","description_allow_html":false,"layout":"IPY_MODEL_a62da0869fe14fde91fd02876889e761","placeholder":"​","style":"IPY_MODEL_a3f99c57939048bf9dd5b9fbb17e5ffe","tabbable":null,"tooltip":null,"value":"Importing issues: 100%"}},"3bac5771b14b4afc800fa10fd46f6580":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"HBoxModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"2.0.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_1d43d77d87c64ddaa536f523e18ea918","IPY_MODEL_2196863c21d341618d94630da96d0086","IPY_MODEL_65240c815c2c4c8bbb7b4691f4c9c6ca"],"layout":"IPY_MODEL_883a8c0e3eb44e6e8d616bad0a4693a7","tabbable":null,"tooltip":null}},"3c364be6df404803bffc9e648df7cc25":{"model_module":"@jupyter-widgets/base","model_module_version":"2.0.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"2.0.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border_bottom":null,"border_left":null,"border_right":null,"border_top":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"435bf144bb724e4cb878fcb4da675166":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"2.0.0","_view_name":"HTMLView","description":"","description_allow_html":false,"layout":"IPY_MODEL_7ac5024be08f4e838b48d8f661ef2a54","placeholder":"​","style":"IPY_MODEL_77fc00e9f2af4176bea24f0bb14007eb","tabbable":null,"tooltip":null,"value":" 1/1 [00:00&lt;00:00, 54.70it/s]"}},"44c2d17cc72c406f9b150e4be372fef6":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"2.0.0","_view_name":"HTMLView","description":"","description_allow_html":false,"layout":"IPY_MODEL_df78800a4bc04ad5912d5c122bdb884f","placeholder":"​","style":"IPY_MODEL_296a79b26583428c86c4972ca915da0b","tabbable":null,"tooltip":null,"value":" 12/12 [00:09&lt;00:00,  1.58it/s]"}},"44cb9bc37af240c1b20c405f6c62f592":{"model_module":"@jupyter-widgets/base","model_module_version":"2.0.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"2.0.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border_bottom":null,"border_left":null,"border_right":null,"border_top":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"44dc2f2d9c4b4829ad35f99b8278ec1f":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"HBoxModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"2.0.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_e75d4e8746f74cd1a9d808459307eb3b","IPY_MODEL_2db956e9ddf54110baa1d7490d74affa","IPY_MODEL_4c4f127f3fc042469618c648e24a6e72"],"layout":"IPY_MODEL_fd12c2a4bc1c402cb72baa98e34b903e","tabbable":null,"tooltip":null}},"45b220c6b19941baa1502aaf204f6cb8":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"FloatProgressModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"2.0.0","_view_name":"ProgressView","bar_style":"success","description":"","description_allow_html":false,"layout":"IPY_MODEL_143c97133c1a44c0ac04b3aaa2cfcdda","max":1,"min":0,"orientation":"horizontal","style":"IPY_MODEL_9b8179129db444338a3af7a6020d84bf","tabbable":null,"tooltip":null,"value":1}},"46bf9d2f44a74510b6db27c3354df115":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"ProgressStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"4c406b2778864f76951855df83652ee7":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"ProgressStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"4c4f127f3fc042469618c648e24a6e72":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"2.0.0","_view_name":"HTMLView","description":"","description_allow_html":false,"layout":"IPY_MODEL_b67298c77f14440a8f06b68571bf281c","placeholder":"​","style":"IPY_MODEL_6bcf0f9b093145edb96b4c0148881c5d","tabbable":null,"tooltip":null,"value":" 24/24 [00:18&lt;00:00,  1.27it/s]"}},"4cc88b2f78af4fd583d13f9b7080c109":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"HTMLStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"HTMLStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"StyleView","background":null,"description_width":"","font_size":null,"text_color":null}},"4d4330fa76a7430888e9d38863c49e1f":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"FloatProgressModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"2.0.0","_view_name":"ProgressView","bar_style":"success","description":"","description_allow_html":false,"layout":"IPY_MODEL_3c364be6df404803bffc9e648df7cc25","max":1,"min":0,"orientation":"horizontal","style":"IPY_MODEL_46bf9d2f44a74510b6db27c3354df115","tabbable":null,"tooltip":null,"value":1}},"4e2f1a059a6648c791f3a2e84f2e4b33":{"model_module":"@jupyter-widgets/base","model_module_version":"2.0.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"2.0.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border_bottom":null,"border_left":null,"border_right":null,"border_top":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"4fa9d48adbd64d0c84b2d570a822a1fc":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"HBoxModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"2.0.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_05a8a0932fcf4704873d293152749a17","IPY_MODEL_dc3994979bf14a2690debb301c128cc1","IPY_MODEL_58ad072faa5b4456b00f888e3fe16231"],"layout":"IPY_MODEL_72bc20c906dc455d9519c3341409b4e3","tabbable":null,"tooltip":null}},"508ec9c0a313400eb87c94493dcc4f87":{"model_module":"@jupyter-widgets/base","model_module_version":"2.0.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"2.0.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border_bottom":null,"border_left":null,"border_right":null,"border_top":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"53bc4b0473c24bad9d0554c0b03d1f66":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"HTMLStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"HTMLStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"StyleView","background":null,"description_width":"","font_size":null,"text_color":null}},"55cd602c0cea4d8d83c51e36d8b767a9":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"HTMLStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"HTMLStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"StyleView","background":null,"description_width":"","font_size":null,"text_color":null}},"56189d9223804343b460911a20e006f5":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"FloatProgressModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"2.0.0","_view_name":"ProgressView","bar_style":"success","description":"","description_allow_html":false,"layout":"IPY_MODEL_19f6a88c4c1c41f6bb97cb3851427662","max":1,"min":0,"orientation":"horizontal","style":"IPY_MODEL_5a83af522e1f47478b11057d2b944844","tabbable":null,"tooltip":null,"value":1}},"56b0185dbf874adfa8dca1f8628deafb":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"HTMLStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"HTMLStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"StyleView","background":null,"description_width":"","font_size":null,"text_color":null}},"58ad072faa5b4456b00f888e3fe16231":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"2.0.0","_view_name":"HTMLView","description":"","description_allow_html":false,"layout":"IPY_MODEL_44cb9bc37af240c1b20c405f6c62f592","placeholder":"​","style":"IPY_MODEL_5fae4377d61c4c009f243d76df5f4e3d","tabbable":null,"tooltip":null,"value":" 1/1 [00:00&lt;00:00,  6.42it/s]"}},"5a83af522e1f47478b11057d2b944844":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"ProgressStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"5b0242c67b57468894968483fa329f5a":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"HTMLStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"HTMLStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"StyleView","background":null,"description_width":"","font_size":null,"text_color":null}},"5fae4377d61c4c009f243d76df5f4e3d":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"HTMLStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"HTMLStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"StyleView","background":null,"description_width":"","font_size":null,"text_color":null}},"60e040355b1444e4be813869b27361b0":{"model_module":"@jupyter-widgets/base","model_module_version":"2.0.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"2.0.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border_bottom":null,"border_left":null,"border_right":null,"border_top":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"61f254934dc74335a90e94e1cb0dad72":{"model_module":"@jupyter-widgets/base","model_module_version":"2.0.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"2.0.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border_bottom":null,"border_left":null,"border_right":null,"border_top":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"62a950fa07cd48018b9132c82b9576b1":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"FloatProgressModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"2.0.0","_view_name":"ProgressView","bar_style":"success","description":"","description_allow_html":false,"layout":"IPY_MODEL_b64b222402d34564a22bfb8da18cb021","max":50,"min":0,"orientation":"horizontal","style":"IPY_MODEL_d7779bf7bd384c009e53896f769703fa","tabbable":null,"tooltip":null,"value":50}},"65240c815c2c4c8bbb7b4691f4c9c6ca":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"2.0.0","_view_name":"HTMLView","description":"","description_allow_html":false,"layout":"IPY_MODEL_f59362e1c03d40cf90035fd7b95eaef5","placeholder":"​","style":"IPY_MODEL_040e92e775bb4e91bcf8603bbc430e89","tabbable":null,"tooltip":null,"value":" 5/5 [00:00&lt;00:00,  5.75it/s]"}},"6bcf0f9b093145edb96b4c0148881c5d":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"HTMLStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"HTMLStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"StyleView","background":null,"description_width":"","font_size":null,"text_color":null}},"6c4c985af1da4355bd67583fcf2dbdbf":{"model_module":"@jupyter-widgets/base","model_module_version":"2.0.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"2.0.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border_bottom":null,"border_left":null,"border_right":null,"border_top":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"6c9b6d65d63b4215a478855946cfd79b":{"model_module":"@jupyter-widgets/base","model_module_version":"2.0.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"2.0.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border_bottom":null,"border_left":null,"border_right":null,"border_top":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"6d9f1db388204c8490418bd5bfd51dad":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"HBoxModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"2.0.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_f994dc0902134ab0bfd26d89cbfbfd43","IPY_MODEL_b5c0cec99bda4c23944f905d3e1528cd","IPY_MODEL_cf2fa81540e54ddd88cda721665499f7"],"layout":"IPY_MODEL_bcbabf2d311b42c2826ec24455cf1ef7","tabbable":null,"tooltip":null}},"6f2430a6af3b44189a17fb823ad21262":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"HBoxModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"2.0.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_ac500f6fc5c04b548b1445a4458f694f","IPY_MODEL_56189d9223804343b460911a20e006f5","IPY_MODEL_435bf144bb724e4cb878fcb4da675166"],"layout":"IPY_MODEL_04db57e3d0af4d32ac99bc1f1b73d2e2","tabbable":null,"tooltip":null}},"6f755d36221f48128f4c1a0c20db6796":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"HBoxModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"2.0.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_8aaa4041ea664828a99808fa41d0a2c2","IPY_MODEL_4d4330fa76a7430888e9d38863c49e1f","IPY_MODEL_13ff1c6436f747d49ecb1b54758fde02"],"layout":"IPY_MODEL_f297451d877e42c7984788dd58284030","tabbable":null,"tooltip":null}},"72bc20c906dc455d9519c3341409b4e3":{"model_module":"@jupyter-widgets/base","model_module_version":"2.0.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"2.0.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border_bottom":null,"border_left":null,"border_right":null,"border_top":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"77fc00e9f2af4176bea24f0bb14007eb":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"HTMLStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"HTMLStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"StyleView","background":null,"description_width":"","font_size":null,"text_color":null}},"7ac5024be08f4e838b48d8f661ef2a54":{"model_module":"@jupyter-widgets/base","model_module_version":"2.0.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"2.0.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border_bottom":null,"border_left":null,"border_right":null,"border_top":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"84d41ccf365c4424bf603c421704812f":{"model_module":"@jupyter-widgets/base","model_module_version":"2.0.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"2.0.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border_bottom":null,"border_left":null,"border_right":null,"border_top":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"883a8c0e3eb44e6e8d616bad0a4693a7":{"model_module":"@jupyter-widgets/base","model_module_version":"2.0.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"2.0.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border_bottom":null,"border_left":null,"border_right":null,"border_top":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"8aaa4041ea664828a99808fa41d0a2c2":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"2.0.0","_view_name":"HTMLView","description":"","description_allow_html":false,"layout":"IPY_MODEL_03815632cb4c425ca005e706edb90dc0","placeholder":"​","style":"IPY_MODEL_299fbfa35085482ebdd886aae957fb98","tabbable":null,"tooltip":null,"value":"Embedding batch: 100%"}},"8c04da8674e04e57ace4b8fdd16229bb":{"model_module":"@jupyter-widgets/base","model_module_version":"2.0.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"2.0.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border_bottom":null,"border_left":null,"border_right":null,"border_top":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"9880e374b6b5480cb8ceb752ed9d37aa":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"2.0.0","_view_name":"HTMLView","description":"","description_allow_html":false,"layout":"IPY_MODEL_2cb361b006ec483dadb9574d3a3ef74e","placeholder":"​","style":"IPY_MODEL_2cefd71c2e4f41da90873313ed851b5d","tabbable":null,"tooltip":null,"value":" 1/1 [00:00&lt;00:00,  6.66it/s]"}},"98faeb057e29496c88cef39da31ac104":{"model_module":"@jupyter-widgets/base","model_module_version":"2.0.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"2.0.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border_bottom":null,"border_left":null,"border_right":null,"border_top":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"9b8179129db444338a3af7a6020d84bf":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"ProgressStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"a27f145ce1c2493692ed1ce43695ffec":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"HBoxModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"2.0.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_34f64431402d4431b0265573819a6304","IPY_MODEL_62a950fa07cd48018b9132c82b9576b1","IPY_MODEL_e5414464c2d94225b9808df59cba0def"],"layout":"IPY_MODEL_aeb7d168f56348338bfbd27f4758552a","tabbable":null,"tooltip":null}},"a3f99c57939048bf9dd5b9fbb17e5ffe":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"HTMLStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"HTMLStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"StyleView","background":null,"description_width":"","font_size":null,"text_color":null}},"a58df76e984249908d3cc40be99493a1":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"HBoxModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"2.0.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_3a760c0738d5431e8d0a89b5820add9d","IPY_MODEL_ead802b31faf4ff2b5344bcb2607d826","IPY_MODEL_44c2d17cc72c406f9b150e4be372fef6"],"layout":"IPY_MODEL_b337b389f4754cb5a798aa095acfba99","tabbable":null,"tooltip":null}},"a62da0869fe14fde91fd02876889e761":{"model_module":"@jupyter-widgets/base","model_module_version":"2.0.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"2.0.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border_bottom":null,"border_left":null,"border_right":null,"border_top":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"ac500f6fc5c04b548b1445a4458f694f":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"2.0.0","_view_name":"HTMLView","description":"","description_allow_html":false,"layout":"IPY_MODEL_bc37a999daab444ebb2ffa8be93a1acf","placeholder":"​","style":"IPY_MODEL_53bc4b0473c24bad9d0554c0b03d1f66","tabbable":null,"tooltip":null,"value":"Embedding batch: 100%"}},"acc8ed7e59c045749774bce1573340c9":{"model_module":"@jupyter-widgets/base","model_module_version":"2.0.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"2.0.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border_bottom":null,"border_left":null,"border_right":null,"border_top":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"ad02c2658c3d456ead5f772559134505":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"HBoxModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"2.0.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_b7cfff2f736f4dbeb8b7584c04903104","IPY_MODEL_b352f0bed5b44d5994d896efdf9f58a6","IPY_MODEL_9880e374b6b5480cb8ceb752ed9d37aa"],"layout":"IPY_MODEL_61f254934dc74335a90e94e1cb0dad72","tabbable":null,"tooltip":null}},"aeb7d168f56348338bfbd27f4758552a":{"model_module":"@jupyter-widgets/base","model_module_version":"2.0.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"2.0.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border_bottom":null,"border_left":null,"border_right":null,"border_top":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"aee853732b8b41fcac121a287b2d097e":{"model_module":"@jupyter-widgets/base","model_module_version":"2.0.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"2.0.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border_bottom":null,"border_left":null,"border_right":null,"border_top":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"b337b389f4754cb5a798aa095acfba99":{"model_module":"@jupyter-widgets/base","model_module_version":"2.0.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"2.0.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border_bottom":null,"border_left":null,"border_right":null,"border_top":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"b352f0bed5b44d5994d896efdf9f58a6":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"FloatProgressModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"2.0.0","_view_name":"ProgressView","bar_style":"success","description":"","description_allow_html":false,"layout":"IPY_MODEL_fd95143e19e9426a81d50d9c55205047","max":1,"min":0,"orientation":"horizontal","style":"IPY_MODEL_ecd753fc32ca431a9bbe2e3ac0b68931","tabbable":null,"tooltip":null,"value":1}},"b5c0cec99bda4c23944f905d3e1528cd":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"FloatProgressModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"2.0.0","_view_name":"ProgressView","bar_style":"success","description":"","description_allow_html":false,"layout":"IPY_MODEL_acc8ed7e59c045749774bce1573340c9","max":1,"min":0,"orientation":"horizontal","style":"IPY_MODEL_2bbeb08c9b5a4cb29690ee0db40da0bf","tabbable":null,"tooltip":null,"value":1}},"b64b222402d34564a22bfb8da18cb021":{"model_module":"@jupyter-widgets/base","model_module_version":"2.0.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"2.0.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border_bottom":null,"border_left":null,"border_right":null,"border_top":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"b67298c77f14440a8f06b68571bf281c":{"model_module":"@jupyter-widgets/base","model_module_version":"2.0.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"2.0.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border_bottom":null,"border_left":null,"border_right":null,"border_top":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"b7cfff2f736f4dbeb8b7584c04903104":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"2.0.0","_view_name":"HTMLView","description":"","description_allow_html":false,"layout":"IPY_MODEL_e8f150c747fc4d8486567215770f8fe3","placeholder":"​","style":"IPY_MODEL_4cc88b2f78af4fd583d13f9b7080c109","tabbable":null,"tooltip":null,"value":"Importing labels: 100%"}},"ba54fe30536b4e4ea584f26db50b8ff7":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"HBoxModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"2.0.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_220157abb9ca4e64a92c02f70a0469a8","IPY_MODEL_45b220c6b19941baa1502aaf204f6cb8","IPY_MODEL_f05add78e1174d1f95ebb069b43d0b62"],"layout":"IPY_MODEL_8c04da8674e04e57ace4b8fdd16229bb","tabbable":null,"tooltip":null}},"bc37a999daab444ebb2ffa8be93a1acf":{"model_module":"@jupyter-widgets/base","model_module_version":"2.0.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"2.0.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border_bottom":null,"border_left":null,"border_right":null,"border_top":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"bcbabf2d311b42c2826ec24455cf1ef7":{"model_module":"@jupyter-widgets/base","model_module_version":"2.0.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"2.0.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border_bottom":null,"border_left":null,"border_right":null,"border_top":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"be7b73b5732a410996b210a51972f506":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"HTMLStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"HTMLStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"StyleView","background":null,"description_width":"","font_size":null,"text_color":null}},"c8a45ace9f2049bca368b5784f330fcd":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"ProgressStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"cb75b8bf7d6943699564a8cabaea792a":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"HTMLStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"HTMLStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"StyleView","background":null,"description_width":"","font_size":null,"text_color":null}},"cf2fa81540e54ddd88cda721665499f7":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"2.0.0","_view_name":"HTMLView","description":"","description_allow_html":false,"layout":"IPY_MODEL_d2f276e67471488cbcfceb979a40cb8a","placeholder":"​","style":"IPY_MODEL_55cd602c0cea4d8d83c51e36d8b767a9","tabbable":null,"tooltip":null,"value":" 1/1 [00:00&lt;00:00, 56.81it/s]"}},"d2f276e67471488cbcfceb979a40cb8a":{"model_module":"@jupyter-widgets/base","model_module_version":"2.0.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"2.0.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border_bottom":null,"border_left":null,"border_right":null,"border_top":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"d7779bf7bd384c009e53896f769703fa":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"ProgressStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"d891fd4845bd411591ab8619e8eff089":{"model_module":"@jupyter-widgets/base","model_module_version":"2.0.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"2.0.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border_bottom":null,"border_left":null,"border_right":null,"border_top":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"dc3994979bf14a2690debb301c128cc1":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"FloatProgressModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"2.0.0","_view_name":"ProgressView","bar_style":"success","description":"","description_allow_html":false,"layout":"IPY_MODEL_6c4c985af1da4355bd67583fcf2dbdbf","max":1,"min":0,"orientation":"horizontal","style":"IPY_MODEL_21b3d8b5ebe447b09cca220efebce4ab","tabbable":null,"tooltip":null,"value":1}},"df78800a4bc04ad5912d5c122bdb884f":{"model_module":"@jupyter-widgets/base","model_module_version":"2.0.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"2.0.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border_bottom":null,"border_left":null,"border_right":null,"border_top":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"e5414464c2d94225b9808df59cba0def":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"2.0.0","_view_name":"HTMLView","description":"","description_allow_html":false,"layout":"IPY_MODEL_f8390c05706349279b15c2b16a2dd1ab","placeholder":"​","style":"IPY_MODEL_11b1efeaf9a54c768afbcb47573d64b0","tabbable":null,"tooltip":null,"value":" 50/50 [00:19&lt;00:00,  2.07it/s]"}},"e62a767056f549a48c79a8cf34f574f1":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"HTMLStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"HTMLStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"StyleView","background":null,"description_width":"","font_size":null,"text_color":null}},"e75d4e8746f74cd1a9d808459307eb3b":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"2.0.0","_view_name":"HTMLView","description":"","description_allow_html":false,"layout":"IPY_MODEL_508ec9c0a313400eb87c94493dcc4f87","placeholder":"​","style":"IPY_MODEL_f220dc020eec4aa2b739605af7ed504f","tabbable":null,"tooltip":null,"value":"Importing comments: 100%"}},"e8f150c747fc4d8486567215770f8fe3":{"model_module":"@jupyter-widgets/base","model_module_version":"2.0.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"2.0.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border_bottom":null,"border_left":null,"border_right":null,"border_top":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"ead802b31faf4ff2b5344bcb2607d826":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"FloatProgressModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"2.0.0","_view_name":"ProgressView","bar_style":"success","description":"","description_allow_html":false,"layout":"IPY_MODEL_84d41ccf365c4424bf603c421704812f","max":12,"min":0,"orientation":"horizontal","style":"IPY_MODEL_4c406b2778864f76951855df83652ee7","tabbable":null,"tooltip":null,"value":12}},"ecd753fc32ca431a9bbe2e3ac0b68931":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"ProgressStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"f05add78e1174d1f95ebb069b43d0b62":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"2.0.0","_view_name":"HTMLView","description":"","description_allow_html":false,"layout":"IPY_MODEL_4e2f1a059a6648c791f3a2e84f2e4b33","placeholder":"​","style":"IPY_MODEL_0708cea9657141e2bfa8286812ca1e5b","tabbable":null,"tooltip":null,"value":" 1/1 [00:00&lt;00:00, 55.83it/s]"}},"f220dc020eec4aa2b739605af7ed504f":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"HTMLStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"HTMLStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"StyleView","background":null,"description_width":"","font_size":null,"text_color":null}},"f297451d877e42c7984788dd58284030":{"model_module":"@jupyter-widgets/base","model_module_version":"2.0.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"2.0.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border_bottom":null,"border_left":null,"border_right":null,"border_top":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"f59362e1c03d40cf90035fd7b95eaef5":{"model_module":"@jupyter-widgets/base","model_module_version":"2.0.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"2.0.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border_bottom":null,"border_left":null,"border_right":null,"border_top":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"f8390c05706349279b15c2b16a2dd1ab":{"model_module":"@jupyter-widgets/base","model_module_version":"2.0.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"2.0.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border_bottom":null,"border_left":null,"border_right":null,"border_top":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"f994dc0902134ab0bfd26d89cbfbfd43":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"2.0.0","_view_name":"HTMLView","description":"","description_allow_html":false,"layout":"IPY_MODEL_60e040355b1444e4be813869b27361b0","placeholder":"​","style":"IPY_MODEL_be7b73b5732a410996b210a51972f506","tabbable":null,"tooltip":null,"value":"Embedding batch: 100%"}},"fd12c2a4bc1c402cb72baa98e34b903e":{"model_module":"@jupyter-widgets/base","model_module_version":"2.0.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"2.0.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border_bottom":null,"border_left":null,"border_right":null,"border_top":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"fd95143e19e9426a81d50d9c55205047":{"model_module":"@jupyter-widgets/base","model_module_version":"2.0.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"2.0.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border_bottom":null,"border_left":null,"border_right":null,"border_top":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"ffaca5e42bcc4f9db8f1c9d8acddc0d4":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"ProgressStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"StyleView","bar_color":null,"description_width":""}}},"version_major":2,"version_minor":0}
</script>
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/pedroleitao\.nl");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Written with love, take time to think and ponder.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://quarto.org">
      <i class="bi bi-arrow-through-heart" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="http://www.frankscanteen.com">
      <i class="bi bi-cup-hot" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://www.instagram.com/bilhanovarestaurante">
      <i class="bi bi-egg-fried" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>