<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2024-03-02">

<title>Instance vs Model Learning – Pedro Leitão</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../_static/logo.jpg" rel="icon" type="image/jpeg">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-a185852c63625fd9ffbdc57047c9a77e.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap-dd9bfc32d3675b3baf78b59fb821356c.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="../../../site_libs/quarto-contrib/nutshell-1.0.7/nutshell.js"></script>
<script src="../../../site_libs/quarto-contrib/nutshell-1.0.7/nutshell_options.js"></script>
<script src="../../../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../../../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../../../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>

      .quarto-title-block .quarto-title-banner {
        background-image: url(../../../_static/banner-waves-partial.jpg);
background-size: cover;
      }
</style>
<script data-collect-dnt="true" async="" src="https://scripts.simpleanalyticscdn.com/latest.js"></script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../../styles.css">
<meta property="og:title" content="Instance vs Model Learning – Pedro Leitão">
<meta property="og:description" content="a comparison of two machine learning approaches">
<meta property="og:image" content="https://pedroleitao.nl/posts/experiments/instance-vs-model/index_files/figure-html/cell-2-output-2.png">
<meta property="og:site_name" content="Pedro Leitão">
<meta property="og:image:height" content="584">
<meta property="og:image:width" content="760">
<meta name="twitter:title" content="Instance vs Model Learning – Pedro Leitão">
<meta name="twitter:description" content="a comparison of two machine learning approaches">
<meta name="twitter:image" content="https://pedroleitao.nl/posts/experiments/instance-vs-model/index_files/figure-html/cell-2-output-2.png">
<meta name="twitter:image-height" content="584">
<meta name="twitter:image-width" content="760">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../../_static/logo.jpg" alt="" class="navbar-logo">
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../index.html"> 
<span class="menu-text">Bio</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../posts.html"> 
<span class="menu-text">All posts</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../experiments.html"> 
<span class="menu-text">Experiments</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../thoughts.html"> 
<span class="menu-text">Thoughts</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../howtos.html"> 
<span class="menu-text">Howto’s</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/pedro-leitao"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://linkedin.com/in/nunoleitao"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../../posts.xml"> <i class="bi bi-rss" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Instance vs Model Learning</h1>
            <p class="subtitle lead">a comparison of two machine learning approaches</p>
                                <div class="quarto-categories">
                <div class="quarto-category">Experiments</div>
                <div class="quarto-category">Machine Learning</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">March 2, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#an-example-instance-approach-predictor" id="toc-an-example-instance-approach-predictor" class="nav-link active" data-scroll-target="#an-example-instance-approach-predictor">An example instance approach predictor</a></li>
  <li><a href="#solving-the-same-problem-with-a-model-approach" id="toc-solving-the-same-problem-with-a-model-approach" class="nav-link" data-scroll-target="#solving-the-same-problem-with-a-model-approach">Solving the same problem with a model approach</a></li>
  <li><a href="#suggestions-for-improvement" id="toc-suggestions-for-improvement" class="nav-link" data-scroll-target="#suggestions-for-improvement">Suggestions for improvement</a></li>
  <li><a href="#final-remarks" id="toc-final-remarks" class="nav-link" data-scroll-target="#final-remarks">Final remarks</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p>Instance-based machine learning and model-based machine learning are two broad categories of machine learning algorithms that differ in their approach to learning and making predictions.</p>
<p>Instance-based learning algorithms, also known as lazy learning algorithms, do not build an explicit model from the training data. Instead, they store the entire training set and make predictions based on the similarity between new data points and the stored training data. Examples of instance-based learning algorithms include k-nearest neighbors, locally weighted learning, and instance-based learning algorithms.</p>
<p>Model-based learning algorithms, on the other hand, build an explicit model from the training data. This model can be used to make predictions on new data points. Examples of model-based learning algorithms include linear regression, logistic regression, and decision trees.</p>
<p>One of the key differences between instance-based and model-based learning algorithms is the way they handle unseen data. Instance-based learning algorithms make predictions based on the similarity between new data points and the stored training data. This means that they can make accurate predictions on unseen data, even if the data is not linearly separable. However, instance-based learning algorithms can be computationally expensive, especially when the training set is large.</p>
<p>Model-based learning algorithms, on the other hand, make predictions based on the model that has been built from the training data. This means that they can make accurate predictions on unseen data, even if the data is not linearly separable. However, model-based learning algorithms can be less accurate than instance-based learning algorithms on small training sets.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
About Linearly Separable
</div>
</div>
<div class="callout-body-container callout-body">
<p>Linearly separable refers to a scenario in data classification where two sets of points in a feature space can be completely separated by a straight line (in 2D), a plane (in 3D), or a hyperplane in higher dimensions. Essentially, if you can draw a line (or its higher-dimensional analog) such that all points of one class fall on one side of the line and all points of the other class fall on the other side, those points are considered linearly separable.</p>
</div>
</div>
<p>Another key difference between instance-based and model-based learning algorithms is the way they handle noise in the training data. Instance-based learning algorithms are more robust to noise in the training data than model-based learning algorithms. This is because instance-based learning algorithms do not build an explicit model from the training data. Instead, they store the entire training set and make predictions based on the similarity between new data points and the stored training data. This means that they are less likely to be affected by noise.</p>
<p>Model-based learning algorithms, on the other hand, are less robust to noise. This is because model-based learning algorithms build an explicit model from the training data. This model can be affected by noise, which can lead to inaccurate predictions on new data points.</p>
<section id="an-example-instance-approach-predictor" class="level2">
<h2 class="anchored" data-anchor-id="an-example-instance-approach-predictor">An example instance approach predictor</h2>
<p>To illustrate the above, let us build a simple instance based predictor - in this case, based on the California Housing dataset which can be found both on Keras and SKLearn. This predictor will attempt to “guess” the median house price for a given California district census block group.</p>
<p>Let us start by getting a sense of what the dataset is about.</p>
<div id="ec873cf1" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="ec873cf1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="ec873cf1-1"><a href="#ec873cf1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="ec873cf1-2"><a href="#ec873cf1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.datasets <span class="im">import</span> fetch_california_housing</span>
<span id="ec873cf1-3"><a href="#ec873cf1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="ec873cf1-4"><a href="#ec873cf1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="ec873cf1-5"><a href="#ec873cf1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="ec873cf1-6"><a href="#ec873cf1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="ec873cf1-7"><a href="#ec873cf1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the California housing dataset</span></span>
<span id="ec873cf1-8"><a href="#ec873cf1-8" aria-hidden="true" tabindex="-1"></a>housing <span class="op">=</span> fetch_california_housing()</span>
<span id="ec873cf1-9"><a href="#ec873cf1-9" aria-hidden="true" tabindex="-1"></a>housing_df <span class="op">=</span> pd.DataFrame(housing.data, columns<span class="op">=</span>housing.feature_names)</span>
<span id="ec873cf1-10"><a href="#ec873cf1-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(housing.DESCR)</span>
<span id="ec873cf1-11"><a href="#ec873cf1-11" aria-hidden="true" tabindex="-1"></a>housing_df[<span class="st">"MedianHouseValue"</span>] <span class="op">=</span> housing.target</span>
<span id="ec873cf1-12"><a href="#ec873cf1-12" aria-hidden="true" tabindex="-1"></a>housing_df.plot(</span>
<span id="ec873cf1-13"><a href="#ec873cf1-13" aria-hidden="true" tabindex="-1"></a>    kind<span class="op">=</span><span class="st">"scatter"</span>,</span>
<span id="ec873cf1-14"><a href="#ec873cf1-14" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"Longitude"</span>,</span>
<span id="ec873cf1-15"><a href="#ec873cf1-15" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">"Latitude"</span>,</span>
<span id="ec873cf1-16"><a href="#ec873cf1-16" aria-hidden="true" tabindex="-1"></a>    alpha<span class="op">=</span><span class="fl">0.4</span>,</span>
<span id="ec873cf1-17"><a href="#ec873cf1-17" aria-hidden="true" tabindex="-1"></a>    s<span class="op">=</span>housing_df[<span class="st">"Population"</span>] <span class="op">/</span> <span class="dv">100</span>,</span>
<span id="ec873cf1-18"><a href="#ec873cf1-18" aria-hidden="true" tabindex="-1"></a>    label<span class="op">=</span><span class="st">"Population"</span>,</span>
<span id="ec873cf1-19"><a href="#ec873cf1-19" aria-hidden="true" tabindex="-1"></a>    figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">7</span>),</span>
<span id="ec873cf1-20"><a href="#ec873cf1-20" aria-hidden="true" tabindex="-1"></a>    c<span class="op">=</span><span class="st">"MedianHouseValue"</span>,</span>
<span id="ec873cf1-21"><a href="#ec873cf1-21" aria-hidden="true" tabindex="-1"></a>    cmap<span class="op">=</span>plt.get_cmap(<span class="st">"jet"</span>),</span>
<span id="ec873cf1-22"><a href="#ec873cf1-22" aria-hidden="true" tabindex="-1"></a>    colorbar<span class="op">=</span><span class="va">True</span>,</span>
<span id="ec873cf1-23"><a href="#ec873cf1-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="ec873cf1-24"><a href="#ec873cf1-24" aria-hidden="true" tabindex="-1"></a>plt.legend()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>.. _california_housing_dataset:

California Housing dataset
--------------------------

**Data Set Characteristics:**

:Number of Instances: 20640

:Number of Attributes: 8 numeric, predictive attributes and the target

:Attribute Information:
    - MedInc        median income in block group
    - HouseAge      median house age in block group
    - AveRooms      average number of rooms per household
    - AveBedrms     average number of bedrooms per household
    - Population    block group population
    - AveOccup      average number of household members
    - Latitude      block group latitude
    - Longitude     block group longitude

:Missing Attribute Values: None

This dataset was obtained from the StatLib repository.
https://www.dcc.fc.up.pt/~ltorgo/Regression/cal_housing.html

The target variable is the median house value for California districts,
expressed in hundreds of thousands of dollars ($100,000).

This dataset was derived from the 1990 U.S. census, using one row per census
block group. A block group is the smallest geographical unit for which the U.S.
Census Bureau publishes sample data (a block group typically has a population
of 600 to 3,000 people).

A household is a group of people residing within a home. Since the average
number of rooms and bedrooms in this dataset are provided per household, these
columns may take surprisingly large values for block groups with few households
and many empty houses, such as vacation resorts.

It can be downloaded/loaded using the
:func:`sklearn.datasets.fetch_california_housing` function.

.. rubric:: References

- Pace, R. Kelley and Ronald Barry, Sparse Spatial Autoregressions,
  Statistics and Probability Letters, 33 (1997) 291-297
</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/cell-2-output-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="index_files/figure-html/cell-2-output-2.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<p>And now that we have a reasonable idea of what data we are dealing with, let us define the predictor. In our case, we will be using a k-Nearest Neighbors regressor set for 10 neighbour groups.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
About k-Nearest Neighbors
</div>
</div>
<div class="callout-body-container callout-body">
<p>The k-nearest neighbors (k-NN) regressor is a straightforward method used in machine learning for predicting the value of an unknown point based on the values of its nearest neighbors. Imagine you’re at a park trying to guess the age of a tree you’re standing next to but have no idea how to do it. What you can do, however, is look at the nearby trees whose ages you do know. You decide to consider the ages of the 3 trees closest to the one you’re interested in. If those trees are 50, 55, and 60 years old, you might guess that the tree you’re looking at is around 55 years old—the average age of its “nearest neighbors.”</p>
</div>
</div>
<div id="89559447" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="89559447"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="89559447-1"><a href="#89559447-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="89559447-2"><a href="#89559447-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="89559447-3"><a href="#89559447-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.neighbors <span class="im">import</span> KNeighborsRegressor</span>
<span id="89559447-4"><a href="#89559447-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="89559447-5"><a href="#89559447-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch</span>
<span id="89559447-6"><a href="#89559447-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="89559447-7"><a href="#89559447-7" aria-hidden="true" tabindex="-1"></a>X, y <span class="op">=</span> housing.data, housing.target</span>
<span id="89559447-8"><a href="#89559447-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="89559447-9"><a href="#89559447-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize and seed random number generators</span></span>
<span id="89559447-10"><a href="#89559447-10" aria-hidden="true" tabindex="-1"></a>seed <span class="op">=</span> <span class="dv">42</span></span>
<span id="89559447-11"><a href="#89559447-11" aria-hidden="true" tabindex="-1"></a>np.random.seed(seed)</span>
<span id="89559447-12"><a href="#89559447-12" aria-hidden="true" tabindex="-1"></a>random.seed(seed)</span>
<span id="89559447-13"><a href="#89559447-13" aria-hidden="true" tabindex="-1"></a>torch.manual_seed(seed)</span>
<span id="89559447-14"><a href="#89559447-14" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> torch.cuda.is_available():</span>
<span id="89559447-15"><a href="#89559447-15" aria-hidden="true" tabindex="-1"></a>    torch.cuda.manual_seed(seed)</span>
<span id="89559447-16"><a href="#89559447-16" aria-hidden="true" tabindex="-1"></a>    torch.cuda.manual_seed_all(seed)</span>
<span id="89559447-17"><a href="#89559447-17" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> torch.backends.mps.is_available():</span>
<span id="89559447-18"><a href="#89559447-18" aria-hidden="true" tabindex="-1"></a>    torch.manual_seed(seed)</span>
<span id="89559447-19"><a href="#89559447-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="89559447-20"><a href="#89559447-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="89559447-21"><a href="#89559447-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Load and split the California housing dataset</span></span>
<span id="89559447-22"><a href="#89559447-22" aria-hidden="true" tabindex="-1"></a>X_train_full, X_test, y_train_full, y_test <span class="op">=</span> train_test_split(</span>
<span id="89559447-23"><a href="#89559447-23" aria-hidden="true" tabindex="-1"></a>    X, y, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state<span class="op">=</span>seed</span>
<span id="89559447-24"><a href="#89559447-24" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="89559447-25"><a href="#89559447-25" aria-hidden="true" tabindex="-1"></a>X_train, X_valid, y_train, y_valid <span class="op">=</span> train_test_split(X_train_full, y_train_full)</span>
<span id="89559447-26"><a href="#89559447-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="89559447-27"><a href="#89559447-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Scale the features</span></span>
<span id="89559447-28"><a href="#89559447-28" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler()</span>
<span id="89559447-29"><a href="#89559447-29" aria-hidden="true" tabindex="-1"></a>X_train_scaled <span class="op">=</span> scaler.fit_transform(X_train)</span>
<span id="89559447-30"><a href="#89559447-30" aria-hidden="true" tabindex="-1"></a>X_valid_scaled <span class="op">=</span> scaler.transform(X_valid)</span>
<span id="89559447-31"><a href="#89559447-31" aria-hidden="true" tabindex="-1"></a>X_test_scaled <span class="op">=</span> scaler.transform(X_test)</span>
<span id="89559447-32"><a href="#89559447-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="89559447-33"><a href="#89559447-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize the k-NN regressor</span></span>
<span id="89559447-34"><a href="#89559447-34" aria-hidden="true" tabindex="-1"></a>knn_reg <span class="op">=</span> KNeighborsRegressor(n_neighbors<span class="op">=</span><span class="dv">10</span>)</span>
<span id="89559447-35"><a href="#89559447-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="89559447-36"><a href="#89559447-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Train the k-NN model</span></span>
<span id="89559447-37"><a href="#89559447-37" aria-hidden="true" tabindex="-1"></a>knn_reg.fit(X_train_scaled, y_train)</span>
<span id="89559447-38"><a href="#89559447-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="89559447-39"><a href="#89559447-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate the model</span></span>
<span id="89559447-40"><a href="#89559447-40" aria-hidden="true" tabindex="-1"></a>score <span class="op">=</span> knn_reg.score(</span>
<span id="89559447-41"><a href="#89559447-41" aria-hidden="true" tabindex="-1"></a>    X_test_scaled, y_test</span>
<span id="89559447-42"><a href="#89559447-42" aria-hidden="true" tabindex="-1"></a>)  <span class="co"># This returns the R^2 score of the prediction</span></span>
<span id="89559447-43"><a href="#89559447-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="89559447-44"><a href="#89559447-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Making predictions</span></span>
<span id="89559447-45"><a href="#89559447-45" aria-hidden="true" tabindex="-1"></a>predictions <span class="op">=</span> knn_reg.predict(X_test_scaled[:<span class="dv">5</span>])</span>
<span id="89559447-46"><a href="#89559447-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="89559447-47"><a href="#89559447-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate relative differences as percentages</span></span>
<span id="89559447-48"><a href="#89559447-48" aria-hidden="true" tabindex="-1"></a>relative_differences <span class="op">=</span> ((predictions <span class="op">-</span> y_test[:<span class="dv">5</span>]) <span class="op">/</span> y_test[:<span class="dv">5</span>]) <span class="op">*</span> <span class="dv">100</span></span>
<span id="89559447-49"><a href="#89559447-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="89559447-50"><a href="#89559447-50" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Model R^2 score: </span><span class="sc">{</span>score<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="89559447-51"><a href="#89559447-51" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Predictions for first 5 instances: </span><span class="sc">{</span>predictions<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="89559447-52"><a href="#89559447-52" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Actual values for first 5 instances: </span><span class="sc">{</span>y_test[:<span class="dv">5</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="89559447-53"><a href="#89559447-53" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Relative differences (%): </span><span class="sc">{</span>relative_differences<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Model R^2 score: 0.6863935783148378
Predictions for first 5 instances: [0.5714   0.6634   4.395005 2.6315   2.5254  ]
Actual values for first 5 instances: [0.477   0.458   5.00001 2.186   2.78   ]
Relative differences (%): [ 19.79035639  44.84716157 -12.1000758   20.37968893  -9.15827338]</code></pre>
</div>
</div>
<p>We can see that based on the above regressor, our <span class="math inline">\(R^2\)</span> is about 0.68. What this means is that 68% of the variance in the target variable can be explained by the features used in the model. In practical terms, this indicates a moderate to good fit, depending on the context and the complexity of the problem being modeled. However, it also means that 32% of the variance is not captured by the model, which could be due to various factors like missing important features, model underfitting, or the data inherently containing a significant amount of unexplainable variability.</p>
</section>
<section id="solving-the-same-problem-with-a-model-approach" class="level2">
<h2 class="anchored" data-anchor-id="solving-the-same-problem-with-a-model-approach">Solving the same problem with a model approach</h2>
<p>Let’s explore a model-based method for making predictions by utilizing a straightforward neural network structure. it is a simple feedforward model built for regression tasks. It starts with an input layer that directly connects to a hidden layer of 50 neurons. This hidden layer uses the ReLU activation function, which helps the model capture non-linear relationships in the data. After processing through this hidden layer, the data is passed to a single neuron in the output layer that produces the final prediction.</p>
<p>Additionally, the model is trained using the mean squared error (MSE) loss function, which is well-suited for regression because it penalizes larger errors more heavily. The use of stochastic gradient descent (SGD) helps in efficiently updating the model’s weights. We also add an early stopping mechanism to halt training when the validation loss stops improving, thereby preventing overfitting.</p>
<div id="2f0b6b2f" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="2f0b6b2f"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="2f0b6b2f-1"><a href="#2f0b6b2f-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch.nn <span class="im">as</span> nn</span>
<span id="2f0b6b2f-2"><a href="#2f0b6b2f-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pytorch_lightning <span class="im">as</span> pl</span>
<span id="2f0b6b2f-3"><a href="#2f0b6b2f-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> torch.utils.data <span class="im">import</span> DataLoader, TensorDataset</span>
<span id="2f0b6b2f-4"><a href="#2f0b6b2f-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pytorch_lightning.callbacks.early_stopping <span class="im">import</span> EarlyStopping</span>
<span id="2f0b6b2f-5"><a href="#2f0b6b2f-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="2f0b6b2f-6"><a href="#2f0b6b2f-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="2f0b6b2f-7"><a href="#2f0b6b2f-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the LightningModule</span></span>
<span id="2f0b6b2f-8"><a href="#2f0b6b2f-8" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> RegressionModel(pl.LightningModule):</span>
<span id="2f0b6b2f-9"><a href="#2f0b6b2f-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, input_dim):</span>
<span id="2f0b6b2f-10"><a href="#2f0b6b2f-10" aria-hidden="true" tabindex="-1"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>()</span>
<span id="2f0b6b2f-11"><a href="#2f0b6b2f-11" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.model <span class="op">=</span> nn.Sequential(</span>
<span id="2f0b6b2f-12"><a href="#2f0b6b2f-12" aria-hidden="true" tabindex="-1"></a>            nn.Linear(input_dim, <span class="dv">50</span>), nn.ReLU(), nn.Linear(<span class="dv">50</span>, <span class="dv">1</span>)</span>
<span id="2f0b6b2f-13"><a href="#2f0b6b2f-13" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="2f0b6b2f-14"><a href="#2f0b6b2f-14" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.loss_fn <span class="op">=</span> nn.MSELoss()</span>
<span id="2f0b6b2f-15"><a href="#2f0b6b2f-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="2f0b6b2f-16"><a href="#2f0b6b2f-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> forward(<span class="va">self</span>, x):</span>
<span id="2f0b6b2f-17"><a href="#2f0b6b2f-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.model(x)</span>
<span id="2f0b6b2f-18"><a href="#2f0b6b2f-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="2f0b6b2f-19"><a href="#2f0b6b2f-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> training_step(<span class="va">self</span>, batch, batch_idx):</span>
<span id="2f0b6b2f-20"><a href="#2f0b6b2f-20" aria-hidden="true" tabindex="-1"></a>        x, y <span class="op">=</span> batch</span>
<span id="2f0b6b2f-21"><a href="#2f0b6b2f-21" aria-hidden="true" tabindex="-1"></a>        y <span class="op">=</span> y.view(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>)  <span class="co"># Ensure proper shape</span></span>
<span id="2f0b6b2f-22"><a href="#2f0b6b2f-22" aria-hidden="true" tabindex="-1"></a>        y_hat <span class="op">=</span> <span class="va">self</span>(x)</span>
<span id="2f0b6b2f-23"><a href="#2f0b6b2f-23" aria-hidden="true" tabindex="-1"></a>        loss <span class="op">=</span> <span class="va">self</span>.loss_fn(y_hat, y)</span>
<span id="2f0b6b2f-24"><a href="#2f0b6b2f-24" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.log(<span class="st">"train_loss"</span>, loss)</span>
<span id="2f0b6b2f-25"><a href="#2f0b6b2f-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> loss</span>
<span id="2f0b6b2f-26"><a href="#2f0b6b2f-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="2f0b6b2f-27"><a href="#2f0b6b2f-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> validation_step(<span class="va">self</span>, batch, batch_idx):</span>
<span id="2f0b6b2f-28"><a href="#2f0b6b2f-28" aria-hidden="true" tabindex="-1"></a>        x, y <span class="op">=</span> batch</span>
<span id="2f0b6b2f-29"><a href="#2f0b6b2f-29" aria-hidden="true" tabindex="-1"></a>        y <span class="op">=</span> y.view(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="2f0b6b2f-30"><a href="#2f0b6b2f-30" aria-hidden="true" tabindex="-1"></a>        y_hat <span class="op">=</span> <span class="va">self</span>(x)</span>
<span id="2f0b6b2f-31"><a href="#2f0b6b2f-31" aria-hidden="true" tabindex="-1"></a>        loss <span class="op">=</span> <span class="va">self</span>.loss_fn(y_hat, y)</span>
<span id="2f0b6b2f-32"><a href="#2f0b6b2f-32" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.log(<span class="st">"val_loss"</span>, loss, prog_bar<span class="op">=</span><span class="va">True</span>)</span>
<span id="2f0b6b2f-33"><a href="#2f0b6b2f-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> loss</span>
<span id="2f0b6b2f-34"><a href="#2f0b6b2f-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="2f0b6b2f-35"><a href="#2f0b6b2f-35" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> test_step(<span class="va">self</span>, batch, batch_idx):</span>
<span id="2f0b6b2f-36"><a href="#2f0b6b2f-36" aria-hidden="true" tabindex="-1"></a>        x, y <span class="op">=</span> batch</span>
<span id="2f0b6b2f-37"><a href="#2f0b6b2f-37" aria-hidden="true" tabindex="-1"></a>        y <span class="op">=</span> y.view(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="2f0b6b2f-38"><a href="#2f0b6b2f-38" aria-hidden="true" tabindex="-1"></a>        y_hat <span class="op">=</span> <span class="va">self</span>(x)</span>
<span id="2f0b6b2f-39"><a href="#2f0b6b2f-39" aria-hidden="true" tabindex="-1"></a>        loss <span class="op">=</span> <span class="va">self</span>.loss_fn(y_hat, y)</span>
<span id="2f0b6b2f-40"><a href="#2f0b6b2f-40" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.log(<span class="st">"test_loss"</span>, loss)</span>
<span id="2f0b6b2f-41"><a href="#2f0b6b2f-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> loss</span>
<span id="2f0b6b2f-42"><a href="#2f0b6b2f-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="2f0b6b2f-43"><a href="#2f0b6b2f-43" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> configure_optimizers(<span class="va">self</span>):</span>
<span id="2f0b6b2f-44"><a href="#2f0b6b2f-44" aria-hidden="true" tabindex="-1"></a>        optimizer <span class="op">=</span> torch.optim.SGD(<span class="va">self</span>.parameters(), lr<span class="op">=</span><span class="fl">0.01</span>)</span>
<span id="2f0b6b2f-45"><a href="#2f0b6b2f-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> optimizer</span>
<span id="2f0b6b2f-46"><a href="#2f0b6b2f-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="2f0b6b2f-47"><a href="#2f0b6b2f-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="2f0b6b2f-48"><a href="#2f0b6b2f-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Create TensorDatasets and DataLoaders</span></span>
<span id="2f0b6b2f-49"><a href="#2f0b6b2f-49" aria-hidden="true" tabindex="-1"></a>train_dataset <span class="op">=</span> TensorDataset(</span>
<span id="2f0b6b2f-50"><a href="#2f0b6b2f-50" aria-hidden="true" tabindex="-1"></a>    torch.tensor(X_train_scaled, dtype<span class="op">=</span>torch.float32),</span>
<span id="2f0b6b2f-51"><a href="#2f0b6b2f-51" aria-hidden="true" tabindex="-1"></a>    torch.tensor(y_train, dtype<span class="op">=</span>torch.float32),</span>
<span id="2f0b6b2f-52"><a href="#2f0b6b2f-52" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="2f0b6b2f-53"><a href="#2f0b6b2f-53" aria-hidden="true" tabindex="-1"></a>valid_dataset <span class="op">=</span> TensorDataset(</span>
<span id="2f0b6b2f-54"><a href="#2f0b6b2f-54" aria-hidden="true" tabindex="-1"></a>    torch.tensor(X_valid_scaled, dtype<span class="op">=</span>torch.float32),</span>
<span id="2f0b6b2f-55"><a href="#2f0b6b2f-55" aria-hidden="true" tabindex="-1"></a>    torch.tensor(y_valid, dtype<span class="op">=</span>torch.float32),</span>
<span id="2f0b6b2f-56"><a href="#2f0b6b2f-56" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="2f0b6b2f-57"><a href="#2f0b6b2f-57" aria-hidden="true" tabindex="-1"></a>test_dataset <span class="op">=</span> TensorDataset(</span>
<span id="2f0b6b2f-58"><a href="#2f0b6b2f-58" aria-hidden="true" tabindex="-1"></a>    torch.tensor(X_test_scaled, dtype<span class="op">=</span>torch.float32),</span>
<span id="2f0b6b2f-59"><a href="#2f0b6b2f-59" aria-hidden="true" tabindex="-1"></a>    torch.tensor(y_test, dtype<span class="op">=</span>torch.float32),</span>
<span id="2f0b6b2f-60"><a href="#2f0b6b2f-60" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="2f0b6b2f-61"><a href="#2f0b6b2f-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="2f0b6b2f-62"><a href="#2f0b6b2f-62" aria-hidden="true" tabindex="-1"></a>train_loader <span class="op">=</span> DataLoader(train_dataset, batch_size<span class="op">=</span><span class="dv">32</span>, shuffle<span class="op">=</span><span class="va">True</span>)</span>
<span id="2f0b6b2f-63"><a href="#2f0b6b2f-63" aria-hidden="true" tabindex="-1"></a>valid_loader <span class="op">=</span> DataLoader(valid_dataset, batch_size<span class="op">=</span><span class="dv">32</span>)</span>
<span id="2f0b6b2f-64"><a href="#2f0b6b2f-64" aria-hidden="true" tabindex="-1"></a>test_loader <span class="op">=</span> DataLoader(test_dataset, batch_size<span class="op">=</span><span class="dv">32</span>)</span>
<span id="2f0b6b2f-65"><a href="#2f0b6b2f-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="2f0b6b2f-66"><a href="#2f0b6b2f-66" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize the model with the correct input dimension</span></span>
<span id="2f0b6b2f-67"><a href="#2f0b6b2f-67" aria-hidden="true" tabindex="-1"></a>input_dim <span class="op">=</span> X_train_scaled.shape[<span class="dv">1</span>]</span>
<span id="2f0b6b2f-68"><a href="#2f0b6b2f-68" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> RegressionModel(input_dim<span class="op">=</span>input_dim)</span>
<span id="2f0b6b2f-69"><a href="#2f0b6b2f-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="2f0b6b2f-70"><a href="#2f0b6b2f-70" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up EarlyStopping callback</span></span>
<span id="2f0b6b2f-71"><a href="#2f0b6b2f-71" aria-hidden="true" tabindex="-1"></a>early_stop_callback <span class="op">=</span> EarlyStopping(</span>
<span id="2f0b6b2f-72"><a href="#2f0b6b2f-72" aria-hidden="true" tabindex="-1"></a>    monitor<span class="op">=</span><span class="st">"val_loss"</span>, patience<span class="op">=</span><span class="dv">3</span>, mode<span class="op">=</span><span class="st">"min"</span>, verbose<span class="op">=</span><span class="va">False</span></span>
<span id="2f0b6b2f-73"><a href="#2f0b6b2f-73" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="2f0b6b2f-74"><a href="#2f0b6b2f-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="2f0b6b2f-75"><a href="#2f0b6b2f-75" aria-hidden="true" tabindex="-1"></a><span class="co"># Train the model using PyTorch-Lightning's Trainer</span></span>
<span id="2f0b6b2f-76"><a href="#2f0b6b2f-76" aria-hidden="true" tabindex="-1"></a>trainer <span class="op">=</span> pl.Trainer(</span>
<span id="2f0b6b2f-77"><a href="#2f0b6b2f-77" aria-hidden="true" tabindex="-1"></a>    max_epochs<span class="op">=</span><span class="dv">50</span>,</span>
<span id="2f0b6b2f-78"><a href="#2f0b6b2f-78" aria-hidden="true" tabindex="-1"></a>    callbacks<span class="op">=</span>[early_stop_callback],</span>
<span id="2f0b6b2f-79"><a href="#2f0b6b2f-79" aria-hidden="true" tabindex="-1"></a>    logger<span class="op">=</span><span class="va">False</span>,</span>
<span id="2f0b6b2f-80"><a href="#2f0b6b2f-80" aria-hidden="true" tabindex="-1"></a>    enable_progress_bar<span class="op">=</span><span class="va">False</span>,</span>
<span id="2f0b6b2f-81"><a href="#2f0b6b2f-81" aria-hidden="true" tabindex="-1"></a>    enable_checkpointing<span class="op">=</span><span class="va">False</span>,</span>
<span id="2f0b6b2f-82"><a href="#2f0b6b2f-82" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="2f0b6b2f-83"><a href="#2f0b6b2f-83" aria-hidden="true" tabindex="-1"></a>trainer.fit(model, train_loader, valid_loader)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>With the model trained, let us evaluate performance and run a few predictions.</p>
<div id="1ee31f36" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="1ee31f36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="1ee31f36-1"><a href="#1ee31f36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate the model on the test set</span></span>
<span id="1ee31f36-2"><a href="#1ee31f36-2" aria-hidden="true" tabindex="-1"></a>test_results <span class="op">=</span> trainer.test(model, test_loader)</span>
<span id="1ee31f36-3"><a href="#1ee31f36-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Test MSE: </span><span class="sc">{</span>test_results<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
       Test metric             DataLoader 0
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
        test_loss           0.3777255415916443
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
Test MSE: [{'test_loss': 0.3777255415916443}]</code></pre>
</div>
</div>
<div id="4c0f6a21" class="cell" data-execution_count="6">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="4c0f6a21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="4c0f6a21-1"><a href="#4c0f6a21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make predictions for the first 5 test instances</span></span>
<span id="4c0f6a21-2"><a href="#4c0f6a21-2" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">eval</span>()</span>
<span id="4c0f6a21-3"><a href="#4c0f6a21-3" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> torch.no_grad():</span>
<span id="4c0f6a21-4"><a href="#4c0f6a21-4" aria-hidden="true" tabindex="-1"></a>    test_samples <span class="op">=</span> torch.tensor(X_test_scaled[:<span class="dv">5</span>], dtype<span class="op">=</span>torch.float32)</span>
<span id="4c0f6a21-5"><a href="#4c0f6a21-5" aria-hidden="true" tabindex="-1"></a>    predictions <span class="op">=</span> model(test_samples).view(<span class="op">-</span><span class="dv">1</span>).numpy()</span>
<span id="4c0f6a21-6"><a href="#4c0f6a21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="4c0f6a21-7"><a href="#4c0f6a21-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate relative differences as percentages</span></span>
<span id="4c0f6a21-8"><a href="#4c0f6a21-8" aria-hidden="true" tabindex="-1"></a>relative_differences <span class="op">=</span> ((predictions <span class="op">-</span> y_test[:<span class="dv">5</span>]) <span class="op">/</span> y_test[:<span class="dv">5</span>]) <span class="op">*</span> <span class="dv">100</span></span>
<span id="4c0f6a21-9"><a href="#4c0f6a21-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="4c0f6a21-10"><a href="#4c0f6a21-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Predictions for first 5 instances: </span><span class="sc">{</span>predictions<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="4c0f6a21-11"><a href="#4c0f6a21-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Actual values for first 5 instances: </span><span class="sc">{</span>y_test[:<span class="dv">5</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="4c0f6a21-12"><a href="#4c0f6a21-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Relative differences (%): </span><span class="sc">{</span>relative_differences<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Predictions for first 5 instances: [0.5031792 1.6951654 3.744416  2.57257   2.807933 ]
Actual values for first 5 instances: [0.477   0.458   5.00001 2.186   2.78   ]
Relative differences (%): [  5.48830032 270.12344885 -25.11182981  17.68390144   1.00478749]</code></pre>
</div>
</div>
</section>
<section id="suggestions-for-improvement" class="level2">
<h2 class="anchored" data-anchor-id="suggestions-for-improvement">Suggestions for improvement</h2>
<p>While we’ve covered the basics, here are a few ideas to take this experiment further:</p>
<ul>
<li><strong>Dive deeper into the data</strong>: Understand which features most affect housing prices and why.</li>
<li><strong>Tune the models</strong>: Experiment with different settings and configurations to improve accuracy.</li>
<li><strong>Compare more metrics</strong>: Look beyond the <span class="math inline">\(R^2\)</span> score to other metrics like MAE or MSE for a fuller picture of model performance.</li>
<li><strong>Explore model limitations</strong>: Identify and address any shortcomings in the models used.</li>
</ul>
</section>
<section id="final-remarks" class="level2">
<h2 class="anchored" data-anchor-id="final-remarks">Final remarks</h2>
<p>In this experiment, we’ve explored two different ways to predict housing prices in California: using instance-based learning with a k-Nearest Neighbors (k-NN) regressor and model-based learning with a neural network. Here’s a straightforward recap of what we learned:</p>
<ul>
<li><p><strong>Instance-Based Learning with k-NN</strong>: This method relies on comparing new data points to existing ones to make predictions. It’s pretty straightforward and works well for datasets where the relationship between data points is clear. Our k-NN model did a decent job, explaining about 68% of the variance in housing prices, showing it’s a viable option but also highlighting some limits, especially when dealing with very large datasets.</p></li>
<li><p><strong>Model-Based Learning with Neural Networks</strong>: This approach creates a generalized model from the data it’s trained on. Our simple neural network, equipped with early stopping to prevent overfitting, showcased the ability to capture complex patterns in the data. It requires a bit more setup and tuning but has the potential to tackle more complicated relationships in data.</p></li>
</ul>
<p>Each method has its place, depending on the specific needs of your project and the characteristics of your dataset. Instance-based learning is great for simplicity and direct interpretations of data, while model-based learning can handle more complex patterns at the expense of needing more computational resources and tuning.</p>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a></div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/pedroleitao\.nl");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>© 2025 Pedro Leitão</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>Built with Quarto</p>
</div>
  </div>
</footer>
<script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","descPosition":"bottom","loop":false,"openEffect":"zoom","selector":".lightbox"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>




</body></html>