<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2024-06-19">

<title>Text Tasks without Neural Networks – Pedro Leitão</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../_static/logo.jpg" rel="icon" type="image/jpeg">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-a185852c63625fd9ffbdc57047c9a77e.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap-dd9bfc32d3675b3baf78b59fb821356c.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="../../../site_libs/quarto-contrib/nutshell-1.0.7/nutshell.js"></script>
<script src="../../../site_libs/quarto-contrib/nutshell-1.0.7/nutshell_options.js"></script>
<script src="../../../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../../../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../../../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>

      .quarto-title-block .quarto-title-banner {
        background-image: url(../../../_static/banner-waves-partial.jpg);
background-size: cover;
      }
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<script data-collect-dnt="true" async="" src="https://scripts.simpleanalyticscdn.com/latest.js"></script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../../styles.css">
<meta property="og:title" content="Text Tasks without Neural Networks – Pedro Leitão">
<meta property="og:description" content="random forests and embeddings for sentiment analysis">
<meta property="og:image" content="https://pedroleitao.nl/posts/experiments/random-forests-embeddings/index_files/figure-html/cell-11-output-1.png">
<meta property="og:site_name" content="Pedro Leitão">
<meta property="og:image:height" content="525">
<meta property="og:image:width" content="679">
<meta name="twitter:title" content="Text Tasks without Neural Networks – Pedro Leitão">
<meta name="twitter:description" content="random forests and embeddings for sentiment analysis">
<meta name="twitter:image" content="https://pedroleitao.nl/posts/experiments/random-forests-embeddings/index_files/figure-html/cell-11-output-1.png">
<meta name="twitter:image-height" content="525">
<meta name="twitter:image-width" content="679">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../../_static/logo.jpg" alt="" class="navbar-logo">
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../index.html"> 
<span class="menu-text">Bio</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../posts.html"> 
<span class="menu-text">All posts</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../experiments.html"> 
<span class="menu-text">Experiments</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../thoughts.html"> 
<span class="menu-text">Thoughts</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../howtos.html"> 
<span class="menu-text">Howto’s</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/pedro-leitao"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://linkedin.com/in/nunoleitao"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../../posts.xml"> <i class="bi bi-rss" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Text Tasks without Neural Networks</h1>
            <p class="subtitle lead">random forests and embeddings for sentiment analysis</p>
                                <div class="quarto-categories">
                <div class="quarto-category">Experiments</div>
                <div class="quarto-category">Machine Learning</div>
                <div class="quarto-category">NLP</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">June 19, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#loading-and-understanding-the-data" id="toc-loading-and-understanding-the-data" class="nav-link active" data-scroll-target="#loading-and-understanding-the-data">Loading and understanding the data</a></li>
  <li><a href="#calculating-embeddings-using-bert" id="toc-calculating-embeddings-using-bert" class="nav-link" data-scroll-target="#calculating-embeddings-using-bert">Calculating embeddings using BERT</a></li>
  <li><a href="#evaluating-traditional-machine-learning-algorithms" id="toc-evaluating-traditional-machine-learning-algorithms" class="nav-link" data-scroll-target="#evaluating-traditional-machine-learning-algorithms">Evaluating traditional machine learning algorithms</a></li>
  <li><a href="#final-remarks" id="toc-final-remarks" class="nav-link" data-scroll-target="#final-remarks">Final remarks</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p>Natural language processing (NLP) is often associated with deep learning and neural networks. However, there are efficient methods for text classification that do not rely on neural networks. In this exploration, we will demonstrate a sentiment analysis classification problem using text embeddings combined with traditional machine learning algorithms.</p>
<p>The task at hand is sentiment analysis: classifying tweets as positive, negative, neutral, or irrelevant. Sentiment analysis determines the emotional tone of text. Although neural networks, particularly models like BERT, are popular for this task, traditional machine learning algorithms can also be effective when used with modern text embeddings.</p>
<p>We will use a Twitter dataset containing labeled tweets to classify their sentiment. Our approach involves using the BERT tokenizer and embeddings (we previously <a href="../../../posts/experiments/gensim">looked at the basics of embeddings</a>) for text preprocessing, followed by traditional machine learning algorithms for classification.</p>
<p>Using traditional machine learning algorithms offers several advantages. They are generally faster and require less computational power compared to deep learning models, making them suitable for resource-limited scenarios. Additionally, traditional algorithms are often easier to interpret, providing more transparency in decision-making processes. Moreover, traditional algorithms can achieve competitive performance when combined with powerful text embeddings like those from BERT.</p>
<section id="loading-and-understanding-the-data" class="level2">
<h2 class="anchored" data-anchor-id="loading-and-understanding-the-data">Loading and understanding the data</h2>
<p>Let’s start by loading the dataset and understanding its structure. The dataset contains tweets labeled as positive, negative, neutral, or irrelevant. We will load the data and examine a few samples to understand the text and labels.</p>
<div id="3b1689a3" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="3b1689a3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="3b1689a3-1"><a href="#3b1689a3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Download the dataset</span></span>
<span id="3b1689a3-2"><a href="#3b1689a3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="3b1689a3-3"><a href="#3b1689a3-3" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>kaggle datasets download <span class="op">-</span>d jp797498e<span class="op">/</span>twitter<span class="op">-</span>entity<span class="op">-</span>sentiment<span class="op">-</span>analysis <span class="op">-</span>p .data<span class="op">/</span> <span class="op">--</span>unzip</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset URL: https://www.kaggle.com/datasets/jp797498e/twitter-entity-sentiment-analysis
License(s): CC0-1.0
Downloading twitter-entity-sentiment-analysis.zip to .data
  0%|                                               | 0.00/1.99M [00:00&lt;?, ?B/s] 50%|███████████████████                   | 1.00M/1.99M [00:00&lt;00:00, 2.11MB/s]100%|██████████████████████████████████████| 1.99M/1.99M [00:00&lt;00:00, 3.63MB/s]
100%|██████████████████████████████████████| 1.99M/1.99M [00:00&lt;00:00, 3.27MB/s]</code></pre>
</div>
</div>
<div id="d4b9e059" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="d4b9e059"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="d4b9e059-1"><a href="#d4b9e059-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load dataset</span></span>
<span id="d4b9e059-2"><a href="#d4b9e059-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="d4b9e059-3"><a href="#d4b9e059-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="d4b9e059-4"><a href="#d4b9e059-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="d4b9e059-5"><a href="#d4b9e059-5" aria-hidden="true" tabindex="-1"></a>sentiment <span class="op">=</span> pd.read_csv(<span class="st">".data/twitter_training.csv"</span>)</span>
<span id="d4b9e059-6"><a href="#d4b9e059-6" aria-hidden="true" tabindex="-1"></a>sentiment_validation <span class="op">=</span> pd.read_csv(<span class="st">".data/twitter_validation.csv"</span>)</span>
<span id="d4b9e059-7"><a href="#d4b9e059-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="d4b9e059-8"><a href="#d4b9e059-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Add column names</span></span>
<span id="d4b9e059-9"><a href="#d4b9e059-9" aria-hidden="true" tabindex="-1"></a>sentiment.columns <span class="op">=</span> [<span class="st">"id"</span>, <span class="st">"tag"</span>, <span class="st">"sentiment"</span>, <span class="st">"text"</span>]</span>
<span id="d4b9e059-10"><a href="#d4b9e059-10" aria-hidden="true" tabindex="-1"></a>sentiment_validation.columns <span class="op">=</span> [<span class="st">"id"</span>, <span class="st">"tag"</span>, <span class="st">"sentiment"</span>, <span class="st">"text"</span>]</span>
<span id="d4b9e059-11"><a href="#d4b9e059-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="d4b9e059-12"><a href="#d4b9e059-12" aria-hidden="true" tabindex="-1"></a>sentiment</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="2">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th">tag</th>
<th data-quarto-table-cell-role="th">sentiment</th>
<th data-quarto-table-cell-role="th">text</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2401</td>
<td>Borderlands</td>
<td>Positive</td>
<td>I am coming to the borders and I will kill you...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2401</td>
<td>Borderlands</td>
<td>Positive</td>
<td>im getting on borderlands and i will kill you ...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2401</td>
<td>Borderlands</td>
<td>Positive</td>
<td>im coming on borderlands and i will murder you...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2401</td>
<td>Borderlands</td>
<td>Positive</td>
<td>im getting on borderlands 2 and i will murder ...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2401</td>
<td>Borderlands</td>
<td>Positive</td>
<td>im getting into borderlands and i can murder y...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">74676</td>
<td>9200</td>
<td>Nvidia</td>
<td>Positive</td>
<td>Just realized that the Windows partition of my...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">74677</td>
<td>9200</td>
<td>Nvidia</td>
<td>Positive</td>
<td>Just realized that my Mac window partition is ...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">74678</td>
<td>9200</td>
<td>Nvidia</td>
<td>Positive</td>
<td>Just realized the windows partition of my Mac ...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">74679</td>
<td>9200</td>
<td>Nvidia</td>
<td>Positive</td>
<td>Just realized between the windows partition of...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">74680</td>
<td>9200</td>
<td>Nvidia</td>
<td>Positive</td>
<td>Just like the windows partition of my Mac is l...</td>
</tr>
</tbody>
</table>

<p>74681 rows × 4 columns</p>
</div>
</div>
</div>
<p>Let’s count the number of samples for each sentiment category in the dataset, so we can understand the distribution of labels.</p>
<div id="ab1a582b" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="ab1a582b"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="ab1a582b-1"><a href="#ab1a582b-1" aria-hidden="true" tabindex="-1"></a>sentiment[<span class="st">"sentiment"</span>].value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="3">
<pre><code>sentiment
Negative      22542
Positive      20831
Neutral       18318
Irrelevant    12990
Name: count, dtype: int64</code></pre>
</div>
</div>
<p>Note how the <code>Irrelevant</code> category has the least number of samples, which might pose a challenge for training a classifier. Let us also check the category distribution for the validation set.</p>
<div id="7a14a560" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="7a14a560"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="7a14a560-1"><a href="#7a14a560-1" aria-hidden="true" tabindex="-1"></a>sentiment_validation[<span class="st">"sentiment"</span>].value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre><code>sentiment
Neutral       285
Positive      277
Negative      266
Irrelevant    171
Name: count, dtype: int64</code></pre>
</div>
</div>
<p>Before continuing, we will also drop any rows with missing values in the text column.</p>
<div id="5d7065ad" class="cell" data-execution_count="6">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="5d7065ad"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="5d7065ad-1"><a href="#5d7065ad-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Validate that 'text' is not null or empty</span></span>
<span id="5d7065ad-2"><a href="#5d7065ad-2" aria-hidden="true" tabindex="-1"></a>sentiment <span class="op">=</span> sentiment.dropna(subset<span class="op">=</span>[<span class="st">"text"</span>])</span>
<span id="5d7065ad-3"><a href="#5d7065ad-3" aria-hidden="true" tabindex="-1"></a>sentiment_validation <span class="op">=</span> sentiment_validation.dropna(subset<span class="op">=</span>[<span class="st">"text"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="calculating-embeddings-using-bert" class="level2">
<h2 class="anchored" data-anchor-id="calculating-embeddings-using-bert">Calculating embeddings using BERT</h2>
<p>We will be using the <a href="https://huggingface.co/docs/transformers/en/model_doc/bert">BERT</a> model for generating embeddings for the text data. BERT (Bidirectional Encoder Representations from Transformers) is a powerful pre-trained language model that can be fine-tuned for various NLP tasks. In this case, we will use BERT to generate embeddings for the tweets in our dataset.</p>
<p>We have explored BERT embeddings in a <a href="../../../posts/experiments/bert-emotions">previous experiment</a>. As reference, in that experiment, a fine tuned BERT model achieved an accuracy of 0.87.</p>
<div id="2e6e523d" class="cell" data-execution_count="7">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="2e6e523d"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="2e6e523d-1"><a href="#2e6e523d-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch</span>
<span id="2e6e523d-2"><a href="#2e6e523d-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> transformers <span class="im">import</span> BertTokenizer, BertModel</span>
<span id="2e6e523d-3"><a href="#2e6e523d-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pytorch_lightning <span class="im">as</span> pl</span>
<span id="2e6e523d-4"><a href="#2e6e523d-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="2e6e523d-5"><a href="#2e6e523d-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="2e6e523d-6"><a href="#2e6e523d-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="2e6e523d-7"><a href="#2e6e523d-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a LightningModule that wraps the BERT model and tokenizer</span></span>
<span id="2e6e523d-8"><a href="#2e6e523d-8" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> BERTEmbeddingModule(pl.LightningModule):</span>
<span id="2e6e523d-9"><a href="#2e6e523d-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="2e6e523d-10"><a href="#2e6e523d-10" aria-hidden="true" tabindex="-1"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>()</span>
<span id="2e6e523d-11"><a href="#2e6e523d-11" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.tokenizer <span class="op">=</span> BertTokenizer.from_pretrained(<span class="st">"bert-base-uncased"</span>)</span>
<span id="2e6e523d-12"><a href="#2e6e523d-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.bert_model <span class="op">=</span> BertModel.from_pretrained(<span class="st">"bert-base-uncased"</span>)</span>
<span id="2e6e523d-13"><a href="#2e6e523d-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="2e6e523d-14"><a href="#2e6e523d-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> forward(<span class="va">self</span>, texts):</span>
<span id="2e6e523d-15"><a href="#2e6e523d-15" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Tokenize the input texts</span></span>
<span id="2e6e523d-16"><a href="#2e6e523d-16" aria-hidden="true" tabindex="-1"></a>        inputs <span class="op">=</span> <span class="va">self</span>.tokenizer(</span>
<span id="2e6e523d-17"><a href="#2e6e523d-17" aria-hidden="true" tabindex="-1"></a>            texts, return_tensors<span class="op">=</span><span class="st">"pt"</span>, truncation<span class="op">=</span><span class="va">True</span>, padding<span class="op">=</span><span class="va">True</span>, max_length<span class="op">=</span><span class="dv">512</span></span>
<span id="2e6e523d-18"><a href="#2e6e523d-18" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="2e6e523d-19"><a href="#2e6e523d-19" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Ensure inputs are on the same device as the model</span></span>
<span id="2e6e523d-20"><a href="#2e6e523d-20" aria-hidden="true" tabindex="-1"></a>        device <span class="op">=</span> <span class="bu">next</span>(<span class="va">self</span>.parameters()).device</span>
<span id="2e6e523d-21"><a href="#2e6e523d-21" aria-hidden="true" tabindex="-1"></a>        inputs <span class="op">=</span> {k: v.to(device) <span class="cf">for</span> k, v <span class="kw">in</span> inputs.items()}</span>
<span id="2e6e523d-22"><a href="#2e6e523d-22" aria-hidden="true" tabindex="-1"></a>        outputs <span class="op">=</span> <span class="va">self</span>.bert_model(<span class="op">**</span>inputs)</span>
<span id="2e6e523d-23"><a href="#2e6e523d-23" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Average the last hidden state over the sequence length dimension</span></span>
<span id="2e6e523d-24"><a href="#2e6e523d-24" aria-hidden="true" tabindex="-1"></a>        embeddings <span class="op">=</span> outputs.last_hidden_state.mean(dim<span class="op">=</span><span class="dv">1</span>)</span>
<span id="2e6e523d-25"><a href="#2e6e523d-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> embeddings</span>
<span id="2e6e523d-26"><a href="#2e6e523d-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="2e6e523d-27"><a href="#2e6e523d-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="2e6e523d-28"><a href="#2e6e523d-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Determine the device: CUDA, MPS, or CPU</span></span>
<span id="2e6e523d-29"><a href="#2e6e523d-29" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> torch.cuda.is_available():</span>
<span id="2e6e523d-30"><a href="#2e6e523d-30" aria-hidden="true" tabindex="-1"></a>    device <span class="op">=</span> torch.device(<span class="st">"cuda"</span>)</span>
<span id="2e6e523d-31"><a href="#2e6e523d-31" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> torch.backends.mps.is_available():</span>
<span id="2e6e523d-32"><a href="#2e6e523d-32" aria-hidden="true" tabindex="-1"></a>    device <span class="op">=</span> torch.device(<span class="st">"mps"</span>)</span>
<span id="2e6e523d-33"><a href="#2e6e523d-33" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="2e6e523d-34"><a href="#2e6e523d-34" aria-hidden="true" tabindex="-1"></a>    device <span class="op">=</span> torch.device(<span class="st">"cpu"</span>)</span>
<span id="2e6e523d-35"><a href="#2e6e523d-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="2e6e523d-36"><a href="#2e6e523d-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize the model, move it to the correct device, and set it to evaluation mode</span></span>
<span id="2e6e523d-37"><a href="#2e6e523d-37" aria-hidden="true" tabindex="-1"></a>bert_model <span class="op">=</span> BERTEmbeddingModule()</span>
<span id="2e6e523d-38"><a href="#2e6e523d-38" aria-hidden="true" tabindex="-1"></a>bert_model.to(device)</span>
<span id="2e6e523d-39"><a href="#2e6e523d-39" aria-hidden="true" tabindex="-1"></a>bert_model.<span class="bu">eval</span>()</span>
<span id="2e6e523d-40"><a href="#2e6e523d-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="2e6e523d-41"><a href="#2e6e523d-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert text columns to lists</span></span>
<span id="2e6e523d-42"><a href="#2e6e523d-42" aria-hidden="true" tabindex="-1"></a>sentiment_texts <span class="op">=</span> sentiment[<span class="st">"text"</span>].tolist()</span>
<span id="2e6e523d-43"><a href="#2e6e523d-43" aria-hidden="true" tabindex="-1"></a>sentiment_validation_texts <span class="op">=</span> sentiment_validation[<span class="st">"text"</span>].tolist()</span>
<span id="2e6e523d-44"><a href="#2e6e523d-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="2e6e523d-45"><a href="#2e6e523d-45" aria-hidden="true" tabindex="-1"></a>batch_size <span class="op">=</span> <span class="dv">64</span></span>
<span id="2e6e523d-46"><a href="#2e6e523d-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="2e6e523d-47"><a href="#2e6e523d-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute embeddings in batches for the sentiment DataFrame</span></span>
<span id="2e6e523d-48"><a href="#2e6e523d-48" aria-hidden="true" tabindex="-1"></a>sentiment_embeddings <span class="op">=</span> []</span>
<span id="2e6e523d-49"><a href="#2e6e523d-49" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> torch.no_grad():</span>
<span id="2e6e523d-50"><a href="#2e6e523d-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, <span class="bu">len</span>(sentiment_texts), batch_size):</span>
<span id="2e6e523d-51"><a href="#2e6e523d-51" aria-hidden="true" tabindex="-1"></a>        batch_texts <span class="op">=</span> sentiment_texts[i : i <span class="op">+</span> batch_size]</span>
<span id="2e6e523d-52"><a href="#2e6e523d-52" aria-hidden="true" tabindex="-1"></a>        batch_embeddings <span class="op">=</span> bert_model(batch_texts)</span>
<span id="2e6e523d-53"><a href="#2e6e523d-53" aria-hidden="true" tabindex="-1"></a>        sentiment_embeddings.extend(batch_embeddings.cpu().numpy())</span>
<span id="2e6e523d-54"><a href="#2e6e523d-54" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (i <span class="op">//</span> batch_size) <span class="op">%</span> <span class="dv">20</span> <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="2e6e523d-55"><a href="#2e6e523d-55" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"Processed </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss"> sentences"</span>, end<span class="op">=</span><span class="st">"</span><span class="ch">\r</span><span class="st">"</span>)</span>
<span id="2e6e523d-56"><a href="#2e6e523d-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="2e6e523d-57"><a href="#2e6e523d-57" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the embeddings to the sentiment DataFrame</span></span>
<span id="2e6e523d-58"><a href="#2e6e523d-58" aria-hidden="true" tabindex="-1"></a>sentiment.loc[:, <span class="st">"embedding"</span>] <span class="op">=</span> sentiment_embeddings</span>
<span id="2e6e523d-59"><a href="#2e6e523d-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="2e6e523d-60"><a href="#2e6e523d-60" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute embeddings in batches for the sentiment_validation DataFrame</span></span>
<span id="2e6e523d-61"><a href="#2e6e523d-61" aria-hidden="true" tabindex="-1"></a>sentiment_validation_embeddings <span class="op">=</span> []</span>
<span id="2e6e523d-62"><a href="#2e6e523d-62" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> torch.no_grad():</span>
<span id="2e6e523d-63"><a href="#2e6e523d-63" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, <span class="bu">len</span>(sentiment_validation_texts), batch_size):</span>
<span id="2e6e523d-64"><a href="#2e6e523d-64" aria-hidden="true" tabindex="-1"></a>        batch_texts <span class="op">=</span> sentiment_validation_texts[i : i <span class="op">+</span> batch_size]</span>
<span id="2e6e523d-65"><a href="#2e6e523d-65" aria-hidden="true" tabindex="-1"></a>        batch_embeddings <span class="op">=</span> bert_model(batch_texts)</span>
<span id="2e6e523d-66"><a href="#2e6e523d-66" aria-hidden="true" tabindex="-1"></a>        sentiment_validation_embeddings.extend(batch_embeddings.cpu().numpy())</span>
<span id="2e6e523d-67"><a href="#2e6e523d-67" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (i <span class="op">//</span> batch_size) <span class="op">%</span> <span class="dv">20</span> <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="2e6e523d-68"><a href="#2e6e523d-68" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"Processed </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss"> validation sentences"</span>, end<span class="op">=</span><span class="st">"</span><span class="ch">\r</span><span class="st">"</span>)</span>
<span id="2e6e523d-69"><a href="#2e6e523d-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="2e6e523d-70"><a href="#2e6e523d-70" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the embeddings to the sentiment_validation DataFrame</span></span>
<span id="2e6e523d-71"><a href="#2e6e523d-71" aria-hidden="true" tabindex="-1"></a>sentiment_validation.loc[:, <span class="st">"embedding"</span>] <span class="op">=</span> sentiment_validation_embeddings</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Processed 0 sentencesProcessed 1280 sentencesProcessed 2560 sentencesProcessed 3840 sentencesProcessed 5120 sentencesProcessed 6400 sentencesProcessed 7680 sentencesProcessed 8960 sentencesProcessed 10240 sentencesProcessed 11520 sentencesProcessed 12800 sentencesProcessed 14080 sentencesProcessed 15360 sentencesProcessed 16640 sentencesProcessed 17920 sentencesProcessed 19200 sentencesProcessed 20480 sentencesProcessed 21760 sentencesProcessed 23040 sentencesProcessed 24320 sentencesProcessed 25600 sentencesProcessed 26880 sentencesProcessed 28160 sentencesProcessed 29440 sentencesProcessed 30720 sentencesProcessed 32000 sentencesProcessed 33280 sentencesProcessed 34560 sentencesProcessed 35840 sentencesProcessed 37120 sentencesProcessed 38400 sentencesProcessed 39680 sentencesProcessed 40960 sentencesProcessed 42240 sentencesProcessed 43520 sentencesProcessed 44800 sentencesProcessed 46080 sentencesProcessed 47360 sentencesProcessed 48640 sentencesProcessed 49920 sentencesProcessed 51200 sentencesProcessed 52480 sentencesProcessed 53760 sentencesProcessed 55040 sentencesProcessed 56320 sentencesProcessed 57600 sentencesProcessed 58880 sentencesProcessed 60160 sentencesProcessed 61440 sentencesProcessed 62720 sentencesProcessed 64000 sentencesProcessed 65280 sentencesProcessed 66560 sentencesProcessed 67840 sentencesProcessed 69120 sentencesProcessed 70400 sentencesProcessed 71680 sentencesProcessed 72960 sentences</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Processed 0 validation sentences</code></pre>
</div>
</div>
<p>Let’s check what the embeddings look like for a sample tweet.</p>
<div id="17edc300" class="cell" data-execution_count="8">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="17edc300"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="17edc300-1"><a href="#17edc300-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Show a few random samples of the sentiment DataFrame</span></span>
<span id="17edc300-2"><a href="#17edc300-2" aria-hidden="true" tabindex="-1"></a>sentiment.sample(<span class="dv">3</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="7">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th">tag</th>
<th data-quarto-table-cell-role="th">sentiment</th>
<th data-quarto-table-cell-role="th">text</th>
<th data-quarto-table-cell-role="th">embedding</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">61734</td>
<td>4984</td>
<td>GrandTheftAuto(GTA)</td>
<td>Irrelevant</td>
<td>Do you think you can hurt me?</td>
<td>[0.088924035, 0.2648258, -0.06746819, -0.00819...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11260</td>
<td>13136</td>
<td>Xbox(Xseries)</td>
<td>Positive</td>
<td>About The time!!</td>
<td>[0.1783046, -0.09880821, 0.32188007, -0.059730...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">55969</td>
<td>11207</td>
<td>TomClancysRainbowSix</td>
<td>Neutral</td>
<td>Calls from _ z1rv _ &amp; @ Tweet98 got me this so...</td>
<td>[0.16375743, -0.028547501, 0.36362448, -0.0574...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Notice the computed embedding vector for the tweet. This vector captures the semantic information of the text, which can be used as input for traditional machine learning algorithms. Let us look at the embedding in more detail.</p>
<div id="9e985552" class="cell" data-execution_count="9">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="9e985552"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="9e985552-1"><a href="#9e985552-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the first 20 embedding values for row 0 of the sentiment DataFrame, and its shape</span></span>
<span id="9e985552-2"><a href="#9e985552-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(sentiment.loc[<span class="dv">0</span>, <span class="st">"embedding"</span>][:<span class="dv">20</span>])</span>
<span id="9e985552-3"><a href="#9e985552-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(sentiment.loc[<span class="dv">0</span>, <span class="st">"embedding"</span>].shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[ 0.12490085  0.07007872  0.48918858  0.10717066 -0.03190782 -0.15545483
  0.34947166  0.361875    0.09188402 -0.43680927 -0.18374635  0.0527963
 -0.26954496  0.50003046  0.15609427  0.0102438  -0.16239779  0.23513223
 -0.13041304  0.27242425]
(768,)</code></pre>
</div>
</div>
<p>The embedding vector has 768 dimensions, encoding the semantic information of the text data. Different models may have different embedding dimensions, but BERT embeddings are typically 768 or 1024 dimensions.</p>
<p>Let us also drop the <code>tag</code> and <code>id</code> columns from the training and validation sets, as they are not needed for classification.</p>
<div id="4ae4d170" class="cell" data-execution_count="10">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="4ae4d170"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="4ae4d170-1"><a href="#4ae4d170-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop the 'tag' and 'id' columns</span></span>
<span id="4ae4d170-2"><a href="#4ae4d170-2" aria-hidden="true" tabindex="-1"></a>sentiment <span class="op">=</span> sentiment.drop(columns<span class="op">=</span>[<span class="st">"tag"</span>, <span class="st">"id"</span>])</span>
<span id="4ae4d170-3"><a href="#4ae4d170-3" aria-hidden="true" tabindex="-1"></a>sentiment_validation <span class="op">=</span> sentiment_validation.drop(columns<span class="op">=</span>[<span class="st">"tag"</span>, <span class="st">"id"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>And finally before we continue, let us evaluate the degree of separation between the classes in the embedding space. We will use <a href="../../../posts/experiments/pca-vs-tsne">t-SNE</a> to visualize the embeddings in 2D space.</p>
<div id="4695ff7a" class="cell" data-execution_count="11">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="4695ff7a"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="4695ff7a-1"><a href="#4695ff7a-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot a t-SNE visualization of the embeddings</span></span>
<span id="4695ff7a-2"><a href="#4695ff7a-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.manifold <span class="im">import</span> TSNE</span>
<span id="4695ff7a-3"><a href="#4695ff7a-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="4695ff7a-4"><a href="#4695ff7a-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="4695ff7a-5"><a href="#4695ff7a-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="4695ff7a-6"><a href="#4695ff7a-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Copy the sentiment DataFrame to avoid modifying the original</span></span>
<span id="4695ff7a-7"><a href="#4695ff7a-7" aria-hidden="true" tabindex="-1"></a>sentiment_tsne <span class="op">=</span> sentiment.copy()</span>
<span id="4695ff7a-8"><a href="#4695ff7a-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="4695ff7a-9"><a href="#4695ff7a-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert sentiment labels to numerical values</span></span>
<span id="4695ff7a-10"><a href="#4695ff7a-10" aria-hidden="true" tabindex="-1"></a>sentiment_tsne[<span class="st">"sentiment_num"</span>] <span class="op">=</span> sentiment[<span class="st">"sentiment"</span>].astype(<span class="st">"category"</span>).cat.codes</span>
<span id="4695ff7a-11"><a href="#4695ff7a-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="4695ff7a-12"><a href="#4695ff7a-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute a t-SNE embedding of the embeddings</span></span>
<span id="4695ff7a-13"><a href="#4695ff7a-13" aria-hidden="true" tabindex="-1"></a>tsne <span class="op">=</span> TSNE(n_components<span class="op">=</span><span class="dv">2</span>)</span>
<span id="4695ff7a-14"><a href="#4695ff7a-14" aria-hidden="true" tabindex="-1"></a>tsne_results <span class="op">=</span> tsne.fit_transform(np.stack(sentiment_tsne[<span class="st">"embedding"</span>]))</span>
<span id="4695ff7a-15"><a href="#4695ff7a-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="4695ff7a-16"><a href="#4695ff7a-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the t-SNE visualization</span></span>
<span id="4695ff7a-17"><a href="#4695ff7a-17" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="4695ff7a-18"><a href="#4695ff7a-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="4695ff7a-19"><a href="#4695ff7a-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Map the numerical values back to the original sentiment labels</span></span>
<span id="4695ff7a-20"><a href="#4695ff7a-20" aria-hidden="true" tabindex="-1"></a>unique_sentiments <span class="op">=</span> sentiment_tsne[<span class="st">"sentiment"</span>].unique()</span>
<span id="4695ff7a-21"><a href="#4695ff7a-21" aria-hidden="true" tabindex="-1"></a>colors <span class="op">=</span> plt.cm.summer_r(np.linspace(<span class="dv">0</span>, <span class="dv">1</span>, <span class="bu">len</span>(unique_sentiments)))</span>
<span id="4695ff7a-22"><a href="#4695ff7a-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="4695ff7a-23"><a href="#4695ff7a-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a scatter plot with a legend</span></span>
<span id="4695ff7a-24"><a href="#4695ff7a-24" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, sentiment_label <span class="kw">in</span> <span class="bu">enumerate</span>(unique_sentiments):</span>
<span id="4695ff7a-25"><a href="#4695ff7a-25" aria-hidden="true" tabindex="-1"></a>    indices <span class="op">=</span> sentiment_tsne[<span class="st">"sentiment"</span>] <span class="op">==</span> sentiment_label</span>
<span id="4695ff7a-26"><a href="#4695ff7a-26" aria-hidden="true" tabindex="-1"></a>    plt.scatter(</span>
<span id="4695ff7a-27"><a href="#4695ff7a-27" aria-hidden="true" tabindex="-1"></a>        tsne_results[indices, <span class="dv">0</span>],</span>
<span id="4695ff7a-28"><a href="#4695ff7a-28" aria-hidden="true" tabindex="-1"></a>        tsne_results[indices, <span class="dv">1</span>],</span>
<span id="4695ff7a-29"><a href="#4695ff7a-29" aria-hidden="true" tabindex="-1"></a>        label<span class="op">=</span>sentiment_label,</span>
<span id="4695ff7a-30"><a href="#4695ff7a-30" aria-hidden="true" tabindex="-1"></a>        c<span class="op">=</span>[colors[i]],</span>
<span id="4695ff7a-31"><a href="#4695ff7a-31" aria-hidden="true" tabindex="-1"></a>        alpha<span class="op">=</span><span class="fl">0.5</span>,</span>
<span id="4695ff7a-32"><a href="#4695ff7a-32" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="4695ff7a-33"><a href="#4695ff7a-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="4695ff7a-34"><a href="#4695ff7a-34" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"t-SNE Component 1"</span>)</span>
<span id="4695ff7a-35"><a href="#4695ff7a-35" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"t-SNE Component 2"</span>)</span>
<span id="4695ff7a-36"><a href="#4695ff7a-36" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"t-SNE visualization of text embeddings"</span>)</span>
<span id="4695ff7a-37"><a href="#4695ff7a-37" aria-hidden="true" tabindex="-1"></a>plt.legend(title<span class="op">=</span><span class="st">"Sentiment"</span>)</span>
<span id="4695ff7a-38"><a href="#4695ff7a-38" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/cell-11-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="index_files/figure-html/cell-11-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<p>It’s hard to discern much separation between the classes in the 2D t-SNE plot. This suggests that the classes are not easily separable in the embedding space, which might pose a challenge for classification.</p>
</section>
<section id="evaluating-traditional-machine-learning-algorithms" class="level2">
<h2 class="anchored" data-anchor-id="evaluating-traditional-machine-learning-algorithms">Evaluating traditional machine learning algorithms</h2>
<p>In this experiment, we will evaluate the performance of both Random Forest and XGBoost classifiers on the dataset. We will train these classifiers on the BERT embeddings and evaluate their performance on the validation set.</p>
<p>Both <a href="../../../posts/experiments/random-forests">Random Forest</a> and XGBoost are powerful ensemble learning algorithms that can handle high-dimensional data but may be prone to overfitting. We will tune their hyperparameters using grid search to optimize performance.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
About Cross validation
</div>
</div>
<div class="callout-body-container callout-body">
<p>Cross-validation is a technique used in machine learning to assess how a model will generalize to an independent dataset. It involves partitioning the original dataset into a set of training and validation subsets. The most common form of cross-validation is k-fold cross-validation, where the dataset is randomly divided into <span class="math inline">\(\mathbf{k}\)</span> equally sized folds.</p>
<p>The model is trained on <span class="math inline">\(\mathbf{k-1}\)</span> folds and tested on the remaining fold. This process is repeated <span class="math inline">\(\mathbf{k}\)</span> times, with each fold serving as the validation set once. The performance metric (such as accuracy, precision, recall, or mean squared error) is averaged over the k iterations to provide a more robust estimate of the model’s performance.</p>
<p>This method helps in detecting overfitting and ensures that the model’s evaluation is not overly dependent on a particular subset of the data. By using cross-validation, one can make better decisions about model selection and hyperparameter tuning, leading to more reliable and generalizable models.</p>
</div>
</div>
<div id="1b794d5b" class="cell" data-execution_count="12">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="1b794d5b"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="1b794d5b-1"><a href="#1b794d5b-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="1b794d5b-2"><a href="#1b794d5b-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier</span>
<span id="1b794d5b-3"><a href="#1b794d5b-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> xgboost <span class="im">import</span> XGBClassifier</span>
<span id="1b794d5b-4"><a href="#1b794d5b-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> classification_report, accuracy_score, make_scorer, f1_score</span>
<span id="1b794d5b-5"><a href="#1b794d5b-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split, GridSearchCV</span>
<span id="1b794d5b-6"><a href="#1b794d5b-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> LabelEncoder</span>
<span id="1b794d5b-7"><a href="#1b794d5b-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.base <span class="im">import</span> BaseEstimator, ClassifierMixin</span>
<span id="1b794d5b-8"><a href="#1b794d5b-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="1b794d5b-9"><a href="#1b794d5b-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="1b794d5b-10"><a href="#1b794d5b-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a wrapper class for XGBoost, so we can keep categories as strings</span></span>
<span id="1b794d5b-11"><a href="#1b794d5b-11" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> XGBClassifierWrapper(BaseEstimator, ClassifierMixin):</span>
<span id="1b794d5b-12"><a href="#1b794d5b-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, <span class="op">**</span>params):</span>
<span id="1b794d5b-13"><a href="#1b794d5b-13" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.params <span class="op">=</span> params</span>
<span id="1b794d5b-14"><a href="#1b794d5b-14" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.model <span class="op">=</span> XGBClassifier(<span class="op">**</span>params)</span>
<span id="1b794d5b-15"><a href="#1b794d5b-15" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.label_encoder <span class="op">=</span> LabelEncoder()</span>
<span id="1b794d5b-16"><a href="#1b794d5b-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="1b794d5b-17"><a href="#1b794d5b-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> fit(<span class="va">self</span>, X, y):</span>
<span id="1b794d5b-18"><a href="#1b794d5b-18" aria-hidden="true" tabindex="-1"></a>        y_encoded <span class="op">=</span> <span class="va">self</span>.label_encoder.fit_transform(y)</span>
<span id="1b794d5b-19"><a href="#1b794d5b-19" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.classes_ <span class="op">=</span> <span class="va">self</span>.label_encoder.classes_</span>
<span id="1b794d5b-20"><a href="#1b794d5b-20" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.model.set_params(<span class="op">**</span><span class="va">self</span>.params)</span>
<span id="1b794d5b-21"><a href="#1b794d5b-21" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.model.fit(X, y_encoded)</span>
<span id="1b794d5b-22"><a href="#1b794d5b-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span></span>
<span id="1b794d5b-23"><a href="#1b794d5b-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="1b794d5b-24"><a href="#1b794d5b-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> predict(<span class="va">self</span>, X):</span>
<span id="1b794d5b-25"><a href="#1b794d5b-25" aria-hidden="true" tabindex="-1"></a>        y_pred <span class="op">=</span> <span class="va">self</span>.model.predict(X)</span>
<span id="1b794d5b-26"><a href="#1b794d5b-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.label_encoder.inverse_transform(y_pred)</span>
<span id="1b794d5b-27"><a href="#1b794d5b-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="1b794d5b-28"><a href="#1b794d5b-28" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> predict_proba(<span class="va">self</span>, X):</span>
<span id="1b794d5b-29"><a href="#1b794d5b-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.model.predict_proba(X)</span>
<span id="1b794d5b-30"><a href="#1b794d5b-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="1b794d5b-31"><a href="#1b794d5b-31" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> get_params(<span class="va">self</span>, deep<span class="op">=</span><span class="va">True</span>):</span>
<span id="1b794d5b-32"><a href="#1b794d5b-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.params</span>
<span id="1b794d5b-33"><a href="#1b794d5b-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="1b794d5b-34"><a href="#1b794d5b-34" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> set_params(<span class="va">self</span>, <span class="op">**</span>params):</span>
<span id="1b794d5b-35"><a href="#1b794d5b-35" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.params.update(params)</span>
<span id="1b794d5b-36"><a href="#1b794d5b-36" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.model.set_params(<span class="op">**</span><span class="va">self</span>.params)</span>
<span id="1b794d5b-37"><a href="#1b794d5b-37" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span></span>
<span id="1b794d5b-38"><a href="#1b794d5b-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="1b794d5b-39"><a href="#1b794d5b-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="1b794d5b-40"><a href="#1b794d5b-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract features (embeddings) and labels</span></span>
<span id="1b794d5b-41"><a href="#1b794d5b-41" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> np.vstack(sentiment[<span class="st">"embedding"</span>].values)</span>
<span id="1b794d5b-42"><a href="#1b794d5b-42" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> sentiment[<span class="st">"sentiment"</span>].values</span>
<span id="1b794d5b-43"><a href="#1b794d5b-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="1b794d5b-44"><a href="#1b794d5b-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Split the dataset into training and test sets</span></span>
<span id="1b794d5b-45"><a href="#1b794d5b-45" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(</span>
<span id="1b794d5b-46"><a href="#1b794d5b-46" aria-hidden="true" tabindex="-1"></a>    X, y, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state<span class="op">=</span><span class="dv">42</span></span>
<span id="1b794d5b-47"><a href="#1b794d5b-47" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="1b794d5b-48"><a href="#1b794d5b-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="1b794d5b-49"><a href="#1b794d5b-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the classifiers and their respective parameter grids</span></span>
<span id="1b794d5b-50"><a href="#1b794d5b-50" aria-hidden="true" tabindex="-1"></a>classifiers <span class="op">=</span> {</span>
<span id="1b794d5b-51"><a href="#1b794d5b-51" aria-hidden="true" tabindex="-1"></a>    <span class="st">"RandomForest"</span>: RandomForestClassifier(random_state<span class="op">=</span><span class="dv">42</span>, n_jobs<span class="op">=-</span><span class="dv">1</span>),</span>
<span id="1b794d5b-52"><a href="#1b794d5b-52" aria-hidden="true" tabindex="-1"></a>    <span class="st">"XGBoost"</span>: XGBClassifierWrapper(),</span>
<span id="1b794d5b-53"><a href="#1b794d5b-53" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="1b794d5b-54"><a href="#1b794d5b-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="1b794d5b-55"><a href="#1b794d5b-55" aria-hidden="true" tabindex="-1"></a>param_grids <span class="op">=</span> {</span>
<span id="1b794d5b-56"><a href="#1b794d5b-56" aria-hidden="true" tabindex="-1"></a>    <span class="st">"RandomForest"</span>: {</span>
<span id="1b794d5b-57"><a href="#1b794d5b-57" aria-hidden="true" tabindex="-1"></a>        <span class="st">"n_estimators"</span>: [<span class="dv">200</span>, <span class="dv">300</span>],</span>
<span id="1b794d5b-58"><a href="#1b794d5b-58" aria-hidden="true" tabindex="-1"></a>        <span class="st">"max_depth"</span>: [<span class="dv">10</span>, <span class="dv">20</span>],</span>
<span id="1b794d5b-59"><a href="#1b794d5b-59" aria-hidden="true" tabindex="-1"></a>        <span class="st">"min_samples_split"</span>: [<span class="dv">2</span>, <span class="dv">5</span>],</span>
<span id="1b794d5b-60"><a href="#1b794d5b-60" aria-hidden="true" tabindex="-1"></a>        <span class="st">"min_samples_leaf"</span>: [<span class="dv">1</span>, <span class="dv">5</span>],</span>
<span id="1b794d5b-61"><a href="#1b794d5b-61" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="1b794d5b-62"><a href="#1b794d5b-62" aria-hidden="true" tabindex="-1"></a>    <span class="st">"XGBoost"</span>: {</span>
<span id="1b794d5b-63"><a href="#1b794d5b-63" aria-hidden="true" tabindex="-1"></a>        <span class="st">"n_estimators"</span>: [<span class="dv">200</span>, <span class="dv">300</span>],</span>
<span id="1b794d5b-64"><a href="#1b794d5b-64" aria-hidden="true" tabindex="-1"></a>        <span class="st">"max_depth"</span>: [<span class="dv">3</span>, <span class="dv">6</span>],</span>
<span id="1b794d5b-65"><a href="#1b794d5b-65" aria-hidden="true" tabindex="-1"></a>        <span class="st">"reg_alpha"</span>: [<span class="dv">0</span>, <span class="fl">0.1</span>],  <span class="co"># L1 regularization term on weights</span></span>
<span id="1b794d5b-66"><a href="#1b794d5b-66" aria-hidden="true" tabindex="-1"></a>        <span class="st">"reg_lambda"</span>: [<span class="dv">1</span>, <span class="dv">2</span>],  <span class="co"># L2 regularization term on weights</span></span>
<span id="1b794d5b-67"><a href="#1b794d5b-67" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="1b794d5b-68"><a href="#1b794d5b-68" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="1b794d5b-69"><a href="#1b794d5b-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="1b794d5b-70"><a href="#1b794d5b-70" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a custom scoring function that balances precision, recall, and accuracy</span></span>
<span id="1b794d5b-71"><a href="#1b794d5b-71" aria-hidden="true" tabindex="-1"></a>scoring <span class="op">=</span> {<span class="st">"accuracy"</span>: <span class="st">"accuracy"</span>, <span class="st">"f1"</span>: make_scorer(f1_score, average<span class="op">=</span><span class="st">"weighted"</span>)}</span>
<span id="1b794d5b-72"><a href="#1b794d5b-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="1b794d5b-73"><a href="#1b794d5b-73" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform grid search for each classifier, and store the best models</span></span>
<span id="1b794d5b-74"><a href="#1b794d5b-74" aria-hidden="true" tabindex="-1"></a>best_models <span class="op">=</span> {}</span>
<span id="1b794d5b-75"><a href="#1b794d5b-75" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> name, clf <span class="kw">in</span> classifiers.items():</span>
<span id="1b794d5b-76"><a href="#1b794d5b-76" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Perform grid search with cross-validation, using f1 score as the metric (balancing precision and recall)</span></span>
<span id="1b794d5b-77"><a href="#1b794d5b-77" aria-hidden="true" tabindex="-1"></a>    grid_search <span class="op">=</span> GridSearchCV(</span>
<span id="1b794d5b-78"><a href="#1b794d5b-78" aria-hidden="true" tabindex="-1"></a>        clf, param_grids[name], cv<span class="op">=</span><span class="dv">3</span>, scoring<span class="op">=</span>scoring, n_jobs<span class="op">=-</span><span class="dv">1</span>, verbose<span class="op">=</span><span class="dv">1</span>, refit<span class="op">=</span><span class="st">"f1"</span></span>
<span id="1b794d5b-79"><a href="#1b794d5b-79" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="1b794d5b-80"><a href="#1b794d5b-80" aria-hidden="true" tabindex="-1"></a>    grid_search.fit(X_train, y_train)</span>
<span id="1b794d5b-81"><a href="#1b794d5b-81" aria-hidden="true" tabindex="-1"></a>    best_models[name] <span class="op">=</span> grid_search.best_estimator_</span>
<span id="1b794d5b-82"><a href="#1b794d5b-82" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>name<span class="sc">}</span><span class="ss"> best parameters:"</span>, grid_search.best_params_)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Fitting 3 folds for each of 16 candidates, totalling 48 fits</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>RandomForest best parameters: {'max_depth': 20, 'min_samples_leaf': 1, 'min_samples_split': 2, 'n_estimators': 300}
Fitting 3 folds for each of 16 candidates, totalling 48 fits</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>XGBoost best parameters: {'max_depth': 6, 'n_estimators': 300, 'reg_alpha': 0.1, 'reg_lambda': 2}</code></pre>
</div>
</div>
<p>We trained both Random Forest and XGBoost classifiers on the training set. We used the F1 score as the evaluation metric, as it provides a balance between precision and recall. The F1 score is particularly useful for imbalanced datasets, like the one we have, where the number of samples in each class is not equal. In particular, we used L1 and L2 regularization for XGBoost to prevent overfitting.</p>
<p>Now, we will evaluate the performance of the Random Forest and XGBoost classifiers on the validation set to choose the best performing model.</p>
<div id="187234e2" class="cell" data-execution_count="13">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="187234e2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="187234e2-1"><a href="#187234e2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Validation set</span></span>
<span id="187234e2-2"><a href="#187234e2-2" aria-hidden="true" tabindex="-1"></a>X_val <span class="op">=</span> np.vstack(sentiment_validation[<span class="st">"embedding"</span>].values)</span>
<span id="187234e2-3"><a href="#187234e2-3" aria-hidden="true" tabindex="-1"></a>y_val <span class="op">=</span> sentiment_validation[<span class="st">"sentiment"</span>].values</span>
<span id="187234e2-4"><a href="#187234e2-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X_val.shape)</span>
<span id="187234e2-5"><a href="#187234e2-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(y_val.shape)</span>
<span id="187234e2-6"><a href="#187234e2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="187234e2-7"><a href="#187234e2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate the best models on the validation set and choose the best one</span></span>
<span id="187234e2-8"><a href="#187234e2-8" aria-hidden="true" tabindex="-1"></a>best_model <span class="op">=</span> <span class="va">None</span></span>
<span id="187234e2-9"><a href="#187234e2-9" aria-hidden="true" tabindex="-1"></a>best_accuracy <span class="op">=</span> <span class="dv">0</span></span>
<span id="187234e2-10"><a href="#187234e2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="187234e2-11"><a href="#187234e2-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> name, model <span class="kw">in</span> best_models.items():</span>
<span id="187234e2-12"><a href="#187234e2-12" aria-hidden="true" tabindex="-1"></a>    y_val_pred <span class="op">=</span> model.predict(X_val)</span>
<span id="187234e2-13"><a href="#187234e2-13" aria-hidden="true" tabindex="-1"></a>    accuracy_val <span class="op">=</span> accuracy_score(y_val, y_val_pred)</span>
<span id="187234e2-14"><a href="#187234e2-14" aria-hidden="true" tabindex="-1"></a>    report_val <span class="op">=</span> classification_report(y_val, y_val_pred)</span>
<span id="187234e2-15"><a href="#187234e2-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="187234e2-16"><a href="#187234e2-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Validation Accuracy for </span><span class="sc">{</span>name<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>accuracy_val<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="187234e2-17"><a href="#187234e2-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Classification Report for </span><span class="sc">{</span>name<span class="sc">}</span><span class="ss">:</span><span class="ch">\n</span><span class="sc">{</span>report_val<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="187234e2-18"><a href="#187234e2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="187234e2-19"><a href="#187234e2-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> accuracy_val <span class="op">&gt;</span> best_accuracy:</span>
<span id="187234e2-20"><a href="#187234e2-20" aria-hidden="true" tabindex="-1"></a>        best_accuracy <span class="op">=</span> accuracy_val</span>
<span id="187234e2-21"><a href="#187234e2-21" aria-hidden="true" tabindex="-1"></a>        best_model <span class="op">=</span> model</span>
<span id="187234e2-22"><a href="#187234e2-22" aria-hidden="true" tabindex="-1"></a>        best_y_val_pred <span class="op">=</span> y_val_pred</span>
<span id="187234e2-23"><a href="#187234e2-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="187234e2-24"><a href="#187234e2-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Best Model: </span><span class="sc">{</span>best_model<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="187234e2-25"><a href="#187234e2-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Best Validation Accuracy: </span><span class="sc">{</span>best_accuracy<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(999, 768)
(999,)
Validation Accuracy for RandomForest: 0.7507507507507507
Classification Report for RandomForest:
              precision    recall  f1-score   support

  Irrelevant       0.98      0.49      0.65       171
    Negative       0.70      0.88      0.78       266
     Neutral       0.71      0.75      0.73       285
    Positive       0.78      0.79      0.78       277

    accuracy                           0.75       999
   macro avg       0.79      0.73      0.74       999
weighted avg       0.77      0.75      0.75       999


Validation Accuracy for XGBoost: 0.8198198198198198
Classification Report for XGBoost:
              precision    recall  f1-score   support

  Irrelevant       0.89      0.67      0.76       171
    Negative       0.82      0.90      0.86       266
     Neutral       0.79      0.79      0.79       285
    Positive       0.82      0.86      0.84       277

    accuracy                           0.82       999
   macro avg       0.83      0.81      0.81       999
weighted avg       0.82      0.82      0.82       999


Best Model: XGBClassifierWrapper(max_depth=6, n_estimators=300, reg_alpha=0.1, reg_lambda=2)
Best Validation Accuracy: 0.8198198198198198</code></pre>
</div>
</div>
<p>The XGBoost classifier outperforms the Random Forest classifier on the validation set, achieving an F1 score of 0.81, significantly higher than the Random Forest’s F1 score of 0.74.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
About the F1 score
</div>
</div>
<div class="callout-body-container callout-body">
<p>The F1 score is a metric that combines precision and recall into a single value. It is calculated as the harmonic mean of precision and recall:</p>
<p><span class="math display">\[
F1 = 2 \times \frac{precision \times recall}{precision + recall}
\]</span></p>
<p>The F1 score ranges from 0 to 1, with 1 being the best possible score. It is particularly useful when dealing with imbalanced datasets, as it provides a balance between precision and recall. A high F1 score indicates that the classifier has both high precision and high recall, making it a good choice for evaluating models on imbalanced datasets.</p>
</div>
</div>
<p>The <code>Irrelevant</code> class has the lowest F1-score, which is expected given the class imbalance in the dataset. Removing the <code>Irrelevant</code> class from the dataset, or merging it with <code>Neutral</code> would improve the overall performance of the classifier by quite a few points.</p>
<p>The confusion matrix for the XGBoost classifier on the validation set looks as follows:</p>
<div id="80dbd49f" class="cell" data-execution_count="14">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="80dbd49f"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="80dbd49f-1"><a href="#80dbd49f-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot a confusion matrix with a summer_r colormap</span></span>
<span id="80dbd49f-2"><a href="#80dbd49f-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="80dbd49f-3"><a href="#80dbd49f-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="80dbd49f-4"><a href="#80dbd49f-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="80dbd49f-5"><a href="#80dbd49f-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> confusion_matrix</span>
<span id="80dbd49f-6"><a href="#80dbd49f-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="80dbd49f-7"><a href="#80dbd49f-7" aria-hidden="true" tabindex="-1"></a>cm <span class="op">=</span> confusion_matrix(y_val, best_y_val_pred)</span>
<span id="80dbd49f-8"><a href="#80dbd49f-8" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="80dbd49f-9"><a href="#80dbd49f-9" aria-hidden="true" tabindex="-1"></a>sns.heatmap(</span>
<span id="80dbd49f-10"><a href="#80dbd49f-10" aria-hidden="true" tabindex="-1"></a>    cm,</span>
<span id="80dbd49f-11"><a href="#80dbd49f-11" aria-hidden="true" tabindex="-1"></a>    annot<span class="op">=</span><span class="va">True</span>,</span>
<span id="80dbd49f-12"><a href="#80dbd49f-12" aria-hidden="true" tabindex="-1"></a>    fmt<span class="op">=</span><span class="st">"d"</span>,</span>
<span id="80dbd49f-13"><a href="#80dbd49f-13" aria-hidden="true" tabindex="-1"></a>    cmap<span class="op">=</span><span class="st">"summer_r"</span>,</span>
<span id="80dbd49f-14"><a href="#80dbd49f-14" aria-hidden="true" tabindex="-1"></a>    xticklabels<span class="op">=</span>best_model.classes_,</span>
<span id="80dbd49f-15"><a href="#80dbd49f-15" aria-hidden="true" tabindex="-1"></a>    yticklabels<span class="op">=</span>best_model.classes_,</span>
<span id="80dbd49f-16"><a href="#80dbd49f-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="80dbd49f-17"><a href="#80dbd49f-17" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Predicted"</span>)</span>
<span id="80dbd49f-18"><a href="#80dbd49f-18" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Actual"</span>)</span>
<span id="80dbd49f-19"><a href="#80dbd49f-19" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Confusion Matrix"</span>)</span>
<span id="80dbd49f-20"><a href="#80dbd49f-20" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/cell-14-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img src="index_files/figure-html/cell-14-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<p>As expected, the <code>Irrelevant</code> class has the lowest precision and recall, while the <code>Positive</code> class has the highest precision and recall. The confusion matrix provides a detailed breakdown of the classifier’s performance on each class.</p>
<p>Let us also calculate the per-class accuracy for the XGBoost classifier on the validation set.</p>
<div id="c6587e5f" class="cell" data-execution_count="15">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="c6587e5f"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="c6587e5f-1"><a href="#c6587e5f-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot accuracy for each class</span></span>
<span id="c6587e5f-2"><a href="#c6587e5f-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="c6587e5f-3"><a href="#c6587e5f-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score</span>
<span id="c6587e5f-4"><a href="#c6587e5f-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="c6587e5f-5"><a href="#c6587e5f-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="c6587e5f-6"><a href="#c6587e5f-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate accuracy for each class</span></span>
<span id="c6587e5f-7"><a href="#c6587e5f-7" aria-hidden="true" tabindex="-1"></a>class_accuracies <span class="op">=</span> {}</span>
<span id="c6587e5f-8"><a href="#c6587e5f-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, class_name <span class="kw">in</span> <span class="bu">enumerate</span>(best_model.classes_):</span>
<span id="c6587e5f-9"><a href="#c6587e5f-9" aria-hidden="true" tabindex="-1"></a>    class_accuracies[class_name] <span class="op">=</span> accuracy_score(</span>
<span id="c6587e5f-10"><a href="#c6587e5f-10" aria-hidden="true" tabindex="-1"></a>        y_val[y_val <span class="op">==</span> class_name], best_y_val_pred[y_val <span class="op">==</span> class_name]</span>
<span id="c6587e5f-11"><a href="#c6587e5f-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="c6587e5f-12"><a href="#c6587e5f-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="c6587e5f-13"><a href="#c6587e5f-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort classes by accuracy</span></span>
<span id="c6587e5f-14"><a href="#c6587e5f-14" aria-hidden="true" tabindex="-1"></a>class_accuracies <span class="op">=</span> <span class="bu">dict</span>(</span>
<span id="c6587e5f-15"><a href="#c6587e5f-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">sorted</span>(class_accuracies.items(), key<span class="op">=</span><span class="kw">lambda</span> x: x[<span class="dv">1</span>], reverse<span class="op">=</span><span class="va">True</span>)</span>
<span id="c6587e5f-16"><a href="#c6587e5f-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="c6587e5f-17"><a href="#c6587e5f-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="c6587e5f-18"><a href="#c6587e5f-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot accuracy for each class using summer_r colormap</span></span>
<span id="c6587e5f-19"><a href="#c6587e5f-19" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="c6587e5f-20"><a href="#c6587e5f-20" aria-hidden="true" tabindex="-1"></a>colors <span class="op">=</span> plt.cm.summer_r(np.linspace(<span class="dv">0</span>, <span class="dv">1</span>, <span class="bu">len</span>(class_accuracies)))</span>
<span id="c6587e5f-21"><a href="#c6587e5f-21" aria-hidden="true" tabindex="-1"></a>bars <span class="op">=</span> plt.barh(</span>
<span id="c6587e5f-22"><a href="#c6587e5f-22" aria-hidden="true" tabindex="-1"></a>    <span class="bu">list</span>(class_accuracies.keys()), <span class="bu">list</span>(class_accuracies.values()), color<span class="op">=</span>colors</span>
<span id="c6587e5f-23"><a href="#c6587e5f-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="c6587e5f-24"><a href="#c6587e5f-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="c6587e5f-25"><a href="#c6587e5f-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Add accuracy values to each color bar</span></span>
<span id="c6587e5f-26"><a href="#c6587e5f-26" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> bar <span class="kw">in</span> bars:</span>
<span id="c6587e5f-27"><a href="#c6587e5f-27" aria-hidden="true" tabindex="-1"></a>    width <span class="op">=</span> bar.get_width()</span>
<span id="c6587e5f-28"><a href="#c6587e5f-28" aria-hidden="true" tabindex="-1"></a>    plt.text(</span>
<span id="c6587e5f-29"><a href="#c6587e5f-29" aria-hidden="true" tabindex="-1"></a>        width <span class="op">+</span> <span class="fl">0.01</span>, bar.get_y() <span class="op">+</span> bar.get_height() <span class="op">/</span> <span class="dv">2</span>, <span class="ss">f"</span><span class="sc">{</span>width<span class="sc">:.2f}</span><span class="ss">"</span>, va<span class="op">=</span><span class="st">"center"</span></span>
<span id="c6587e5f-30"><a href="#c6587e5f-30" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="c6587e5f-31"><a href="#c6587e5f-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="c6587e5f-32"><a href="#c6587e5f-32" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Accuracy"</span>)</span>
<span id="c6587e5f-33"><a href="#c6587e5f-33" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Class"</span>)</span>
<span id="c6587e5f-34"><a href="#c6587e5f-34" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Accuracy by Class"</span>)</span>
<span id="c6587e5f-35"><a href="#c6587e5f-35" aria-hidden="true" tabindex="-1"></a>plt.gca().invert_yaxis()  <span class="co"># Invert y-axis to have the highest accuracy at the top</span></span>
<span id="c6587e5f-36"><a href="#c6587e5f-36" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/cell-15-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3"><img src="index_files/figure-html/cell-15-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<p>And finally let us evaluate the performance of the XGBoost classifier on a set of entirely new, general sentences. These are sentences that the model has not seen before or which originate from the original dataset, and will help us understand how well the model generalizes to unseen data.</p>
<div id="0f072dd6" class="cell" data-execution_count="16">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="0f072dd6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="0f072dd6-1"><a href="#0f072dd6-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="0f072dd6-2"><a href="#0f072dd6-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score</span>
<span id="0f072dd6-3"><a href="#0f072dd6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="0f072dd6-4"><a href="#0f072dd6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Test sentences with their corresponding true sentiments (Positive/Negative/Neutral/Irrelevant)</span></span>
<span id="0f072dd6-5"><a href="#0f072dd6-5" aria-hidden="true" tabindex="-1"></a>test_sentences <span class="op">=</span> [</span>
<span id="0f072dd6-6"><a href="#0f072dd6-6" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"This ice cream is delicious!"</span>, <span class="st">"Positive"</span>),</span>
<span id="0f072dd6-7"><a href="#0f072dd6-7" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"I hate this phone."</span>, <span class="st">"Negative"</span>),</span>
<span id="0f072dd6-8"><a href="#0f072dd6-8" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"I love this car."</span>, <span class="st">"Positive"</span>),</span>
<span id="0f072dd6-9"><a href="#0f072dd6-9" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"I don't like this book."</span>, <span class="st">"Negative"</span>),</span>
<span id="0f072dd6-10"><a href="#0f072dd6-10" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"This sandwich couldn't be worse!"</span>, <span class="st">"Negative"</span>),</span>
<span id="0f072dd6-11"><a href="#0f072dd6-11" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"I'm in love with this song."</span>, <span class="st">"Positive"</span>),</span>
<span id="0f072dd6-12"><a href="#0f072dd6-12" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"Why is this happening to me?"</span>, <span class="st">"Negative"</span>),</span>
<span id="0f072dd6-13"><a href="#0f072dd6-13" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"This is the worst day ever."</span>, <span class="st">"Negative"</span>),</span>
<span id="0f072dd6-14"><a href="#0f072dd6-14" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"Ha! Ha! Ha! This is so funny"</span>, <span class="st">"Positive"</span>),</span>
<span id="0f072dd6-15"><a href="#0f072dd6-15" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"I'm so sad right now."</span>, <span class="st">"Negative"</span>),</span>
<span id="0f072dd6-16"><a href="#0f072dd6-16" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"That phone really sucks."</span>, <span class="st">"Negative"</span>),</span>
<span id="0f072dd6-17"><a href="#0f072dd6-17" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"What a fantastic performance!"</span>, <span class="st">"Positive"</span>),</span>
<span id="0f072dd6-18"><a href="#0f072dd6-18" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"This place is amazing!"</span>, <span class="st">"Positive"</span>),</span>
<span id="0f072dd6-19"><a href="#0f072dd6-19" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"I'm extremely disappointed in this service."</span>, <span class="st">"Negative"</span>),</span>
<span id="0f072dd6-20"><a href="#0f072dd6-20" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"This is the best thing ever!"</span>, <span class="st">"Positive"</span>),</span>
<span id="0f072dd6-21"><a href="#0f072dd6-21" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"I can't stand this anymore."</span>, <span class="st">"Negative"</span>),</span>
<span id="0f072dd6-22"><a href="#0f072dd6-22" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"This movie is a masterpiece."</span>, <span class="st">"Positive"</span>),</span>
<span id="0f072dd6-23"><a href="#0f072dd6-23" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"I feel utterly miserable."</span>, <span class="st">"Negative"</span>),</span>
<span id="0f072dd6-24"><a href="#0f072dd6-24" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"What a wonderful surprise!"</span>, <span class="st">"Positive"</span>),</span>
<span id="0f072dd6-25"><a href="#0f072dd6-25" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"This is a total disaster."</span>, <span class="st">"Negative"</span>),</span>
<span id="0f072dd6-26"><a href="#0f072dd6-26" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"I'm thrilled with the results."</span>, <span class="st">"Positive"</span>),</span>
<span id="0f072dd6-27"><a href="#0f072dd6-27" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"I detest this kind of behavior."</span>, <span class="st">"Negative"</span>),</span>
<span id="0f072dd6-28"><a href="#0f072dd6-28" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"This experience was phenomenal."</span>, <span class="st">"Positive"</span>),</span>
<span id="0f072dd6-29"><a href="#0f072dd6-29" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"I regret buying this product."</span>, <span class="st">"Negative"</span>),</span>
<span id="0f072dd6-30"><a href="#0f072dd6-30" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"I'm ecstatic about the news!"</span>, <span class="st">"Positive"</span>),</span>
<span id="0f072dd6-31"><a href="#0f072dd6-31" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"This is utterly ridiculous."</span>, <span class="st">"Negative"</span>),</span>
<span id="0f072dd6-32"><a href="#0f072dd6-32" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"I couldn't be happier with my decision."</span>, <span class="st">"Positive"</span>),</span>
<span id="0f072dd6-33"><a href="#0f072dd6-33" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"This is an absolute failure."</span>, <span class="st">"Negative"</span>),</span>
<span id="0f072dd6-34"><a href="#0f072dd6-34" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"I'm over the moon with joy!"</span>, <span class="st">"Positive"</span>),</span>
<span id="0f072dd6-35"><a href="#0f072dd6-35" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"This is the last straw."</span>, <span class="st">"Negative"</span>),</span>
<span id="0f072dd6-36"><a href="#0f072dd6-36" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"I'm feeling great today!"</span>, <span class="st">"Positive"</span>),</span>
<span id="0f072dd6-37"><a href="#0f072dd6-37" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"This product is amazing!"</span>, <span class="st">"Positive"</span>),</span>
<span id="0f072dd6-38"><a href="#0f072dd6-38" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"I'm very unhappy with this."</span>, <span class="st">"Negative"</span>),</span>
<span id="0f072dd6-39"><a href="#0f072dd6-39" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"What a terrible experience!"</span>, <span class="st">"Negative"</span>),</span>
<span id="0f072dd6-40"><a href="#0f072dd6-40" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"This is just perfect."</span>, <span class="st">"Positive"</span>),</span>
<span id="0f072dd6-41"><a href="#0f072dd6-41" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"I love the way this looks."</span>, <span class="st">"Positive"</span>),</span>
<span id="0f072dd6-42"><a href="#0f072dd6-42" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"I'm so frustrated right now."</span>, <span class="st">"Negative"</span>),</span>
<span id="0f072dd6-43"><a href="#0f072dd6-43" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"This is absolutely fantastic!"</span>, <span class="st">"Positive"</span>),</span>
<span id="0f072dd6-44"><a href="#0f072dd6-44" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"I can't believe how bad this is."</span>, <span class="st">"Negative"</span>),</span>
<span id="0f072dd6-45"><a href="#0f072dd6-45" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"I'm delighted with the outcome."</span>, <span class="st">"Positive"</span>),</span>
<span id="0f072dd6-46"><a href="#0f072dd6-46" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"This is so disappointing."</span>, <span class="st">"Negative"</span>),</span>
<span id="0f072dd6-47"><a href="#0f072dd6-47" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"What a lovely day!"</span>, <span class="st">"Positive"</span>),</span>
<span id="0f072dd6-48"><a href="#0f072dd6-48" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"I'm completely heartbroken."</span>, <span class="st">"Negative"</span>),</span>
<span id="0f072dd6-49"><a href="#0f072dd6-49" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"This is pure bliss."</span>, <span class="st">"Positive"</span>),</span>
<span id="0f072dd6-50"><a href="#0f072dd6-50" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"I despise this kind of thing."</span>, <span class="st">"Negative"</span>),</span>
<span id="0f072dd6-51"><a href="#0f072dd6-51" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"I'm overjoyed with the results."</span>, <span class="st">"Positive"</span>),</span>
<span id="0f072dd6-52"><a href="#0f072dd6-52" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"This is simply dreadful."</span>, <span class="st">"Negative"</span>),</span>
<span id="0f072dd6-53"><a href="#0f072dd6-53" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"I'm very pleased with this."</span>, <span class="st">"Positive"</span>),</span>
<span id="0f072dd6-54"><a href="#0f072dd6-54" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"This is a nightmare."</span>, <span class="st">"Negative"</span>),</span>
<span id="0f072dd6-55"><a href="#0f072dd6-55" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"I'm so happy right now!"</span>, <span class="st">"Positive"</span>),</span>
<span id="0f072dd6-56"><a href="#0f072dd6-56" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"This is not acceptable."</span>, <span class="st">"Negative"</span>),</span>
<span id="0f072dd6-57"><a href="#0f072dd6-57" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"I'm really enjoying this."</span>, <span class="st">"Positive"</span>),</span>
<span id="0f072dd6-58"><a href="#0f072dd6-58" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"This is absolutely horrible."</span>, <span class="st">"Negative"</span>),</span>
<span id="0f072dd6-59"><a href="#0f072dd6-59" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"I love spending time here."</span>, <span class="st">"Positive"</span>),</span>
<span id="0f072dd6-60"><a href="#0f072dd6-60" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"This is the most frustrating thing ever."</span>, <span class="st">"Negative"</span>),</span>
<span id="0f072dd6-61"><a href="#0f072dd6-61" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"I'm incredibly satisfied with this."</span>, <span class="st">"Positive"</span>),</span>
<span id="0f072dd6-62"><a href="#0f072dd6-62" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"This is a complete mess."</span>, <span class="st">"Negative"</span>),</span>
<span id="0f072dd6-63"><a href="#0f072dd6-63" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"What an extraordinary event!"</span>, <span class="st">"Positive"</span>),</span>
<span id="0f072dd6-64"><a href="#0f072dd6-64" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"This is beyond disappointing."</span>, <span class="st">"Negative"</span>),</span>
<span id="0f072dd6-65"><a href="#0f072dd6-65" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"I'm elated with my progress."</span>, <span class="st">"Positive"</span>),</span>
<span id="0f072dd6-66"><a href="#0f072dd6-66" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"This is such a waste of time."</span>, <span class="st">"Negative"</span>),</span>
<span id="0f072dd6-67"><a href="#0f072dd6-67" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"I'm absolutely thrilled!"</span>, <span class="st">"Positive"</span>),</span>
<span id="0f072dd6-68"><a href="#0f072dd6-68" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"This situation is unbearable."</span>, <span class="st">"Negative"</span>),</span>
<span id="0f072dd6-69"><a href="#0f072dd6-69" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"I can't express how happy I am."</span>, <span class="st">"Positive"</span>),</span>
<span id="0f072dd6-70"><a href="#0f072dd6-70" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"This is a total failure."</span>, <span class="st">"Negative"</span>),</span>
<span id="0f072dd6-71"><a href="#0f072dd6-71" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"I'm so grateful for this opportunity."</span>, <span class="st">"Positive"</span>),</span>
<span id="0f072dd6-72"><a href="#0f072dd6-72" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"This is driving me crazy."</span>, <span class="st">"Negative"</span>),</span>
<span id="0f072dd6-73"><a href="#0f072dd6-73" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"I'm in awe of this beauty."</span>, <span class="st">"Positive"</span>),</span>
<span id="0f072dd6-74"><a href="#0f072dd6-74" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"This is utterly pointless."</span>, <span class="st">"Negative"</span>),</span>
<span id="0f072dd6-75"><a href="#0f072dd6-75" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"I'm having the time of my life!"</span>, <span class="st">"Positive"</span>),</span>
<span id="0f072dd6-76"><a href="#0f072dd6-76" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"This is so infuriating."</span>, <span class="st">"Negative"</span>),</span>
<span id="0f072dd6-77"><a href="#0f072dd6-77" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"I absolutely love this place."</span>, <span class="st">"Positive"</span>),</span>
<span id="0f072dd6-78"><a href="#0f072dd6-78" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"This is the worst experience ever."</span>, <span class="st">"Negative"</span>),</span>
<span id="0f072dd6-79"><a href="#0f072dd6-79" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"I'm overjoyed to be here."</span>, <span class="st">"Positive"</span>),</span>
<span id="0f072dd6-80"><a href="#0f072dd6-80" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"This is a huge disappointment."</span>, <span class="st">"Negative"</span>),</span>
<span id="0f072dd6-81"><a href="#0f072dd6-81" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"I'm very content with this."</span>, <span class="st">"Positive"</span>),</span>
<span id="0f072dd6-82"><a href="#0f072dd6-82" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"This is the most annoying thing."</span>, <span class="st">"Negative"</span>),</span>
<span id="0f072dd6-83"><a href="#0f072dd6-83" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"I'm extremely happy with the results."</span>, <span class="st">"Positive"</span>),</span>
<span id="0f072dd6-84"><a href="#0f072dd6-84" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"This is totally unacceptable."</span>, <span class="st">"Negative"</span>),</span>
<span id="0f072dd6-85"><a href="#0f072dd6-85" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"I'm so excited about this!"</span>, <span class="st">"Positive"</span>),</span>
<span id="0f072dd6-86"><a href="#0f072dd6-86" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"This is very upsetting."</span>, <span class="st">"Negative"</span>),</span>
<span id="0f072dd6-87"><a href="#0f072dd6-87" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"The sky is blue."</span>, <span class="st">"Neutral"</span>),</span>
<span id="0f072dd6-88"><a href="#0f072dd6-88" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"Water is wet."</span>, <span class="st">"Neutral"</span>),</span>
<span id="0f072dd6-89"><a href="#0f072dd6-89" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"I have a meeting tomorrow."</span>, <span class="st">"Irrelevant"</span>),</span>
<span id="0f072dd6-90"><a href="#0f072dd6-90" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"The cat is on the roof."</span>, <span class="st">"Neutral"</span>),</span>
<span id="0f072dd6-91"><a href="#0f072dd6-91" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"I'm planning to go shopping."</span>, <span class="st">"Irrelevant"</span>),</span>
<span id="0f072dd6-92"><a href="#0f072dd6-92" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"This text is written in English."</span>, <span class="st">"Neutral"</span>),</span>
<span id="0f072dd6-93"><a href="#0f072dd6-93" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"It's raining outside."</span>, <span class="st">"Neutral"</span>),</span>
<span id="0f072dd6-94"><a href="#0f072dd6-94" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"I need to buy groceries."</span>, <span class="st">"Irrelevant"</span>),</span>
<span id="0f072dd6-95"><a href="#0f072dd6-95" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"My favorite color is blue."</span>, <span class="st">"Neutral"</span>),</span>
<span id="0f072dd6-96"><a href="#0f072dd6-96" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"I watched a movie yesterday."</span>, <span class="st">"Irrelevant"</span>),</span>
<span id="0f072dd6-97"><a href="#0f072dd6-97" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"Grass is green."</span>, <span class="st">"Neutral"</span>),</span>
<span id="0f072dd6-98"><a href="#0f072dd6-98" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"The sun rises in the east."</span>, <span class="st">"Neutral"</span>),</span>
<span id="0f072dd6-99"><a href="#0f072dd6-99" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"I need to finish my homework."</span>, <span class="st">"Irrelevant"</span>),</span>
<span id="0f072dd6-100"><a href="#0f072dd6-100" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"Birds are chirping."</span>, <span class="st">"Neutral"</span>),</span>
<span id="0f072dd6-101"><a href="#0f072dd6-101" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"I'm thinking about dinner."</span>, <span class="st">"Irrelevant"</span>),</span>
<span id="0f072dd6-102"><a href="#0f072dd6-102" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"Trees provide oxygen."</span>, <span class="st">"Neutral"</span>),</span>
<span id="0f072dd6-103"><a href="#0f072dd6-103" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"I'm planning a trip next week."</span>, <span class="st">"Irrelevant"</span>),</span>
<span id="0f072dd6-104"><a href="#0f072dd6-104" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"The earth orbits the sun."</span>, <span class="st">"Neutral"</span>),</span>
<span id="0f072dd6-105"><a href="#0f072dd6-105" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"I have to call my friend."</span>, <span class="st">"Irrelevant"</span>),</span>
<span id="0f072dd6-106"><a href="#0f072dd6-106" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"The book is on the table."</span>, <span class="st">"Neutral"</span>),</span>
<span id="0f072dd6-107"><a href="#0f072dd6-107" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"I need to wash the dishes."</span>, <span class="st">"Irrelevant"</span>),</span>
<span id="0f072dd6-108"><a href="#0f072dd6-108" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="0f072dd6-109"><a href="#0f072dd6-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="0f072dd6-110"><a href="#0f072dd6-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="0f072dd6-111"><a href="#0f072dd6-111" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_embedding(model, text):</span>
<span id="0f072dd6-112"><a href="#0f072dd6-112" aria-hidden="true" tabindex="-1"></a>    model.<span class="bu">eval</span>()</span>
<span id="0f072dd6-113"><a href="#0f072dd6-113" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> torch.no_grad():</span>
<span id="0f072dd6-114"><a href="#0f072dd6-114" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Wrap the single text in a list since our forward method expects a list of texts</span></span>
<span id="0f072dd6-115"><a href="#0f072dd6-115" aria-hidden="true" tabindex="-1"></a>        embedding <span class="op">=</span> model([text])</span>
<span id="0f072dd6-116"><a href="#0f072dd6-116" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> embedding.cpu().numpy().squeeze()</span>
<span id="0f072dd6-117"><a href="#0f072dd6-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="0f072dd6-118"><a href="#0f072dd6-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="0f072dd6-119"><a href="#0f072dd6-119" aria-hidden="true" tabindex="-1"></a><span class="co"># Separate the sentences and their true sentiments</span></span>
<span id="0f072dd6-120"><a href="#0f072dd6-120" aria-hidden="true" tabindex="-1"></a>sentences, true_sentiments <span class="op">=</span> <span class="bu">zip</span>(<span class="op">*</span>test_sentences)</span>
<span id="0f072dd6-121"><a href="#0f072dd6-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="0f072dd6-122"><a href="#0f072dd6-122" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate embeddings for the test sentences</span></span>
<span id="0f072dd6-123"><a href="#0f072dd6-123" aria-hidden="true" tabindex="-1"></a>test_embeddings <span class="op">=</span> np.array(</span>
<span id="0f072dd6-124"><a href="#0f072dd6-124" aria-hidden="true" tabindex="-1"></a>    [get_embedding(bert_model, sentence) <span class="cf">for</span> sentence <span class="kw">in</span> sentences]</span>
<span id="0f072dd6-125"><a href="#0f072dd6-125" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="0f072dd6-126"><a href="#0f072dd6-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="0f072dd6-127"><a href="#0f072dd6-127" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict the sentiments using the trained model</span></span>
<span id="0f072dd6-128"><a href="#0f072dd6-128" aria-hidden="true" tabindex="-1"></a>predictions <span class="op">=</span> best_model.predict(test_embeddings)</span>
<span id="0f072dd6-129"><a href="#0f072dd6-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="0f072dd6-130"><a href="#0f072dd6-130" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the results and calculate accuracy</span></span>
<span id="0f072dd6-131"><a href="#0f072dd6-131" aria-hidden="true" tabindex="-1"></a>correct_predictions <span class="op">=</span> <span class="dv">0</span></span>
<span id="0f072dd6-132"><a href="#0f072dd6-132" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> sentence, true_sentiment, prediction <span class="kw">in</span> <span class="bu">zip</span>(</span>
<span id="0f072dd6-133"><a href="#0f072dd6-133" aria-hidden="true" tabindex="-1"></a>    sentences, true_sentiments, predictions</span>
<span id="0f072dd6-134"><a href="#0f072dd6-134" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="0f072dd6-135"><a href="#0f072dd6-135" aria-hidden="true" tabindex="-1"></a>    is_correct <span class="op">=</span> prediction <span class="op">==</span> true_sentiment</span>
<span id="0f072dd6-136"><a href="#0f072dd6-136" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> is_correct:</span>
<span id="0f072dd6-137"><a href="#0f072dd6-137" aria-hidden="true" tabindex="-1"></a>        correct_predictions <span class="op">+=</span> <span class="dv">1</span></span>
<span id="0f072dd6-138"><a href="#0f072dd6-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="0f072dd6-139"><a href="#0f072dd6-139" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate and print the accuracy</span></span>
<span id="0f072dd6-140"><a href="#0f072dd6-140" aria-hidden="true" tabindex="-1"></a>accuracy <span class="op">=</span> correct_predictions <span class="op">/</span> <span class="bu">len</span>(sentences)</span>
<span id="0f072dd6-141"><a href="#0f072dd6-141" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(</span>
<span id="0f072dd6-142"><a href="#0f072dd6-142" aria-hidden="true" tabindex="-1"></a>    <span class="ss">f"Accuracy: </span><span class="sc">{</span>accuracy <span class="op">*</span> <span class="dv">100</span><span class="sc">:.2f}</span><span class="ss">%, for </span><span class="sc">{</span>correct_predictions<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span><span class="bu">len</span>(sentences)<span class="sc">}</span><span class="ss"> correct predictions."</span></span>
<span id="0f072dd6-143"><a href="#0f072dd6-143" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Accuracy: 68.63%, for 70/102 correct predictions.</code></pre>
</div>
</div>
</section>
<section id="final-remarks" class="level2">
<h2 class="anchored" data-anchor-id="final-remarks">Final remarks</h2>
<p>In this exploration, we demonstrated the effectiveness of traditional machine learning algorithms when combined with modern text embeddings for sentiment analysis. While deep learning models like BERT have set a high standard in NLP tasks, traditional algorithms such as Random Forest and XGBoost can still achieve competitive performance with significantly lower computational requirements.</p>
<p>Traditional machine learning algorithms are generally faster and require less computational power compared to deep learning models, making them suitable for scenarios where computational resources are limited. Additionally, traditional algorithms offer more transparency, allowing us to better understand how decisions are made. This is particularly valuable in applications where model interpretability is crucial.</p>
<p>When paired with powerful text embeddings like those generated by BERT, traditional machine learning algorithms can deliver strong performance. Our experiments showed that XGBoost, in particular, outperformed Random Forest in terms of accuracy and F1 score on the validation set. The challenge of class imbalance was evident in the lower performance of the <code>Irrelevant</code> class, and techniques such as re-sampling, cost-sensitive learning, or refining the model’s hyperparameters could further improve performance in future studies.</p>
<p>The methodology presented is practical and can be easily adapted to various text classification problems beyond sentiment analysis. This flexibility underscores the value of combining traditional machine learning algorithms with modern text embeddings.</p>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a></div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/pedroleitao\.nl");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>© 2025 Pedro Leitão</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>Built with Quarto</p>
</div>
  </div>
</footer>
<script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","descPosition":"bottom","loop":false,"openEffect":"zoom","selector":".lightbox"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>




</body></html>