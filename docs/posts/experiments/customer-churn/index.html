<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2024-07-09">

<title>A Classical Machine Learning Problem: Predicting Customer Churn – Pedro Leitão</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../_static/logo.jpg" rel="icon" type="image/jpeg">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-a185852c63625fd9ffbdc57047c9a77e.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap-6b5169cd70b11e3ab71bd7bb77c8208f.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="../../../site_libs/quarto-contrib/nutshell-1.0.7/nutshell.js"></script>
<script src="../../../site_libs/quarto-contrib/nutshell-1.0.7/nutshell_options.js"></script>
<script src="../../../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../../../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../../../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>

      .quarto-title-block .quarto-title-banner {
        background-image: url(../../../_static/banner-waves-partial.jpg);
background-size: cover;
      }
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<script data-collect-dnt="true" async="" src="https://scripts.simpleanalyticscdn.com/latest.js"></script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../../styles.css">
<meta property="og:title" content="A Classical Machine Learning Problem: Predicting Customer Churn – Pedro Leitão">
<meta property="og:description" content="using machine learning to solve a common business problem">
<meta property="og:image" content="https://pedroleitao.nl/_static/logo.jpg">
<meta property="og:site_name" content="Pedro Leitão">
<meta name="twitter:title" content="A Classical Machine Learning Problem: Predicting Customer Churn – Pedro Leitão">
<meta name="twitter:description" content="using machine learning to solve a common business problem">
<meta name="twitter:image" content="https://pedroleitao.nl/posts/experiments/customer-churn/index_files/figure-html/cell-9-output-1.png">
<meta name="twitter:image-height" content="1526">
<meta name="twitter:image-width" content="758">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../../_static/logo.jpg" alt="" class="navbar-logo">
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../index.html"> 
<span class="menu-text">Bio</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../posts.html"> 
<span class="menu-text">All posts</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../experiments.html"> 
<span class="menu-text">Experiments</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../thoughts.html"> 
<span class="menu-text">Thoughts</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../howtos.html"> 
<span class="menu-text">Howto’s</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/pedro-leitao"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://linkedin.com/in/nunoleitao"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../../posts.xml"> <i class="bi bi-rss" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">A Classical Machine Learning Problem: Predicting Customer Churn</h1>
            <p class="subtitle lead">using machine learning to solve a common business problem</p>
                                <div class="quarto-categories">
                <div class="quarto-category">Experiments</div>
                <div class="quarto-category">Machine Learning</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">July 9, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#the-dataset" id="toc-the-dataset" class="nav-link active" data-scroll-target="#the-dataset">The dataset</a></li>
  <li><a href="#understanding-the-data-better" id="toc-understanding-the-data-better" class="nav-link" data-scroll-target="#understanding-the-data-better">Understanding the data better</a></li>
  <li><a href="#balancing-the-dataset-and-creating-a-holdout-set" id="toc-balancing-the-dataset-and-creating-a-holdout-set" class="nav-link" data-scroll-target="#balancing-the-dataset-and-creating-a-holdout-set">Balancing the dataset and creating a holdout set</a></li>
  <li><a href="#model-selection-and-evaluation" id="toc-model-selection-and-evaluation" class="nav-link" data-scroll-target="#model-selection-and-evaluation">Model selection and evaluation</a>
  <ul class="collapse">
  <li><a href="#model-selection" id="toc-model-selection" class="nav-link" data-scroll-target="#model-selection">Model selection</a></li>
  <li><a href="#understanding-the-most-important-features" id="toc-understanding-the-most-important-features" class="nav-link" data-scroll-target="#understanding-the-most-important-features">Understanding the most important features</a></li>
  </ul></li>
  <li><a href="#model-evaluation-on-the-holdout-set" id="toc-model-evaluation-on-the-holdout-set" class="nav-link" data-scroll-target="#model-evaluation-on-the-holdout-set">Model evaluation on the holdout set</a>
  <ul class="collapse">
  <li><a href="#chosing-between-classification-reports-and-roc-curves" id="toc-chosing-between-classification-reports-and-roc-curves" class="nav-link" data-scroll-target="#chosing-between-classification-reports-and-roc-curves">Chosing between classification reports and ROC curves</a></li>
  </ul></li>
  <li><a href="#final-remarks" id="toc-final-remarks" class="nav-link" data-scroll-target="#final-remarks">Final remarks</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p>Customer churn, where customers stop using a company’s services, is a major concern for businesses as it directly impacts revenue. Traditionally, companies tackled this issue by manually analyzing past data and relying on the intuition of marketing and sales teams. They used methods like customer surveys, simple statistical analysis, and basic segmentation based on purchase history and customer interactions. These approaches provided some insights but were often reactive and lacked precision.</p>
<p>With the advent of machine learning, predicting and managing customer churn has become more efficient and accurate. Machine learning models can analyze vast amounts of data to identify patterns and predict which customers are likely to leave. These models consider various factors such as customer behavior, transaction history, and engagement metrics, providing a comprehensive analysis that traditional methods cannot match.</p>
<p>Machine learning enables real-time data processing, allowing businesses to react swiftly to at-risk customers. It also allows for personalized retention strategies, as models can segment customers into detailed groups and suggest specific actions for each group. Moreover, machine learning models continuously improve by learning from new data, ensuring they stay relevant as customer behaviors and market conditions change.</p>
<p>In this experiment, we will explore a small dataset which includes customer information and churn status. We will build a machine learning model to predict customer churn and evaluate its performance. By the end of this experiment, you will have a better understanding of how machine learning addresses this kind of business problem and how to apply it to real-world scenarios.</p>
<p>We will use a <a href="https://www.kaggle.com/datasets/radheshyamkollipara/bank-customer-churn">bank customer churn dataset</a> from Kaggle, which contains information about bank customers and whether they churned or not.</p>
<section id="the-dataset" class="level2">
<h2 class="anchored" data-anchor-id="the-dataset">The dataset</h2>
<p>Let’s start by loading the dataset and examining its features.</p>
<div id="cb7c08f8" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb7c08f8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7c08f8-1"><a href="#cb7c08f8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Download dataset</span></span>
<span id="cb7c08f8-2"><a href="#cb7c08f8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7c08f8-3"><a href="#cb7c08f8-3" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>kaggle datasets download <span class="op">-</span>d radheshyamkollipara<span class="op">/</span>bank<span class="op">-</span>customer<span class="op">-</span>churn <span class="op">-</span>p .data<span class="op">/</span> <span class="op">--</span>unzip</span>
<span id="cb7c08f8-4"><a href="#cb7c08f8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7c08f8-5"><a href="#cb7c08f8-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Load dataset</span></span>
<span id="cb7c08f8-6"><a href="#cb7c08f8-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb7c08f8-7"><a href="#cb7c08f8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7c08f8-8"><a href="#cb7c08f8-8" aria-hidden="true" tabindex="-1"></a>churn <span class="op">=</span> pd.read_csv(<span class="st">'.data/Customer-Churn-Records.csv'</span>)</span>
<span id="cb7c08f8-9"><a href="#cb7c08f8-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train:"</span>, churn.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset URL: https://www.kaggle.com/datasets/radheshyamkollipara/bank-customer-churn
License(s): other
Downloading bank-customer-churn.zip to .data
  0%|                                                | 0.00/307k [00:00&lt;?, ?B/s]100%|█████████████████████████████████████████| 307k/307k [00:00&lt;00:00, 889kB/s]
100%|█████████████████████████████████████████| 307k/307k [00:00&lt;00:00, 887kB/s]
Train: (10000, 18)</code></pre>
</div>
</div>
<p>We have 10000 rows, and 14 columns, not particularly large, but enough to build a simple model. Let’s look at the available columns.</p>
<div id="060fdf92" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="060fdf92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="060fdf92-1"><a href="#060fdf92-1" aria-hidden="true" tabindex="-1"></a>churn</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="2">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">RowNumber</th>
<th data-quarto-table-cell-role="th">CustomerId</th>
<th data-quarto-table-cell-role="th">Surname</th>
<th data-quarto-table-cell-role="th">CreditScore</th>
<th data-quarto-table-cell-role="th">Geography</th>
<th data-quarto-table-cell-role="th">Gender</th>
<th data-quarto-table-cell-role="th">Age</th>
<th data-quarto-table-cell-role="th">Tenure</th>
<th data-quarto-table-cell-role="th">Balance</th>
<th data-quarto-table-cell-role="th">NumOfProducts</th>
<th data-quarto-table-cell-role="th">HasCrCard</th>
<th data-quarto-table-cell-role="th">IsActiveMember</th>
<th data-quarto-table-cell-role="th">EstimatedSalary</th>
<th data-quarto-table-cell-role="th">Exited</th>
<th data-quarto-table-cell-role="th">Complain</th>
<th data-quarto-table-cell-role="th">Satisfaction Score</th>
<th data-quarto-table-cell-role="th">Card Type</th>
<th data-quarto-table-cell-role="th">Point Earned</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>15634602</td>
<td>Hargrave</td>
<td>619</td>
<td>France</td>
<td>Female</td>
<td>42</td>
<td>2</td>
<td>0.00</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>101348.88</td>
<td>1</td>
<td>1</td>
<td>2</td>
<td>DIAMOND</td>
<td>464</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2</td>
<td>15647311</td>
<td>Hill</td>
<td>608</td>
<td>Spain</td>
<td>Female</td>
<td>41</td>
<td>1</td>
<td>83807.86</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>112542.58</td>
<td>0</td>
<td>1</td>
<td>3</td>
<td>DIAMOND</td>
<td>456</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3</td>
<td>15619304</td>
<td>Onio</td>
<td>502</td>
<td>France</td>
<td>Female</td>
<td>42</td>
<td>8</td>
<td>159660.80</td>
<td>3</td>
<td>1</td>
<td>0</td>
<td>113931.57</td>
<td>1</td>
<td>1</td>
<td>3</td>
<td>DIAMOND</td>
<td>377</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>4</td>
<td>15701354</td>
<td>Boni</td>
<td>699</td>
<td>France</td>
<td>Female</td>
<td>39</td>
<td>1</td>
<td>0.00</td>
<td>2</td>
<td>0</td>
<td>0</td>
<td>93826.63</td>
<td>0</td>
<td>0</td>
<td>5</td>
<td>GOLD</td>
<td>350</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>5</td>
<td>15737888</td>
<td>Mitchell</td>
<td>850</td>
<td>Spain</td>
<td>Female</td>
<td>43</td>
<td>2</td>
<td>125510.82</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>79084.10</td>
<td>0</td>
<td>0</td>
<td>5</td>
<td>GOLD</td>
<td>425</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9995</td>
<td>9996</td>
<td>15606229</td>
<td>Obijiaku</td>
<td>771</td>
<td>France</td>
<td>Male</td>
<td>39</td>
<td>5</td>
<td>0.00</td>
<td>2</td>
<td>1</td>
<td>0</td>
<td>96270.64</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>DIAMOND</td>
<td>300</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9996</td>
<td>9997</td>
<td>15569892</td>
<td>Johnstone</td>
<td>516</td>
<td>France</td>
<td>Male</td>
<td>35</td>
<td>10</td>
<td>57369.61</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>101699.77</td>
<td>0</td>
<td>0</td>
<td>5</td>
<td>PLATINUM</td>
<td>771</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9997</td>
<td>9998</td>
<td>15584532</td>
<td>Liu</td>
<td>709</td>
<td>France</td>
<td>Female</td>
<td>36</td>
<td>7</td>
<td>0.00</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>42085.58</td>
<td>1</td>
<td>1</td>
<td>3</td>
<td>SILVER</td>
<td>564</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9998</td>
<td>9999</td>
<td>15682355</td>
<td>Sabbatini</td>
<td>772</td>
<td>Germany</td>
<td>Male</td>
<td>42</td>
<td>3</td>
<td>75075.31</td>
<td>2</td>
<td>1</td>
<td>0</td>
<td>92888.52</td>
<td>1</td>
<td>1</td>
<td>2</td>
<td>GOLD</td>
<td>339</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9999</td>
<td>10000</td>
<td>15628319</td>
<td>Walker</td>
<td>792</td>
<td>France</td>
<td>Female</td>
<td>28</td>
<td>4</td>
<td>130142.79</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>38190.78</td>
<td>0</td>
<td>0</td>
<td>3</td>
<td>DIAMOND</td>
<td>911</td>
</tr>
</tbody>
</table>

<p>10000 rows × 18 columns</p>
</div>
</div>
</div>
<p>We have a mix of categorical and numerical features, some will clearly be of no use for our model (<code>CustomerId</code>, <code>Surname</code>, <code>RowNumber</code>), so let us perform a little bit of cleansing. We will drop any rows with missing values and remove the columns mentioned above.</p>
<div id="9aa291ce" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="9aa291ce"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="9aa291ce-1"><a href="#9aa291ce-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove missing values, if any</span></span>
<span id="9aa291ce-2"><a href="#9aa291ce-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="9aa291ce-3"><a href="#9aa291ce-3" aria-hidden="true" tabindex="-1"></a>churn <span class="op">=</span> churn.dropna()</span>
<span id="9aa291ce-4"><a href="#9aa291ce-4" aria-hidden="true" tabindex="-1"></a>churn.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="3">
<pre><code>(10000, 18)</code></pre>
</div>
</div>
<div id="1d8ce1f8" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="1d8ce1f8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="1d8ce1f8-1"><a href="#1d8ce1f8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove whitespaces from column names</span></span>
<span id="1d8ce1f8-2"><a href="#1d8ce1f8-2" aria-hidden="true" tabindex="-1"></a>churn.columns <span class="op">=</span> churn.columns.<span class="bu">str</span>.strip()</span>
<span id="1d8ce1f8-3"><a href="#1d8ce1f8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="1d8ce1f8-4"><a href="#1d8ce1f8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop CustomerID, RowNumber and Surname columns</span></span>
<span id="1d8ce1f8-5"><a href="#1d8ce1f8-5" aria-hidden="true" tabindex="-1"></a>churn <span class="op">=</span> churn.drop(columns<span class="op">=</span>[<span class="st">"CustomerId"</span>, <span class="st">"RowNumber"</span>, <span class="st">"Surname"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>That’s better. Let’s look at the data types of the various columns.</p>
<div id="2328d750" class="cell" data-execution_count="6">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="2328d750"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="2328d750-1"><a href="#2328d750-1" aria-hidden="true" tabindex="-1"></a>churn.dtypes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre><code>CreditScore             int64
Geography              object
Gender                 object
Age                     int64
Tenure                  int64
Balance               float64
NumOfProducts           int64
HasCrCard               int64
IsActiveMember          int64
EstimatedSalary       float64
Exited                  int64
Complain                int64
Satisfaction Score      int64
Card Type              object
Point Earned            int64
dtype: object</code></pre>
</div>
</div>
<p>Some of the numerical columns are just truth values - we will convert them to booleans. We will also convert the categorical columns to one-hot encoded columns.</p>
<div id="1b59ff6b" class="cell" data-execution_count="7">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="1b59ff6b"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="1b59ff6b-1"><a href="#1b59ff6b-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert binary features to booleans, 1 as True, 0 as False</span></span>
<span id="1b59ff6b-2"><a href="#1b59ff6b-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="1b59ff6b-3"><a href="#1b59ff6b-3" aria-hidden="true" tabindex="-1"></a>churn[<span class="st">"Exited"</span>] <span class="op">=</span> churn[<span class="st">"Exited"</span>].astype(<span class="bu">bool</span>)</span>
<span id="1b59ff6b-4"><a href="#1b59ff6b-4" aria-hidden="true" tabindex="-1"></a>churn[<span class="st">"Complain"</span>] <span class="op">=</span> churn[<span class="st">"Complain"</span>].astype(<span class="bu">bool</span>)</span>
<span id="1b59ff6b-5"><a href="#1b59ff6b-5" aria-hidden="true" tabindex="-1"></a>churn[<span class="st">"HasCrCard"</span>] <span class="op">=</span> churn[<span class="st">"HasCrCard"</span>].astype(<span class="bu">bool</span>)</span>
<span id="1b59ff6b-6"><a href="#1b59ff6b-6" aria-hidden="true" tabindex="-1"></a>churn[<span class="st">"IsActiveMember"</span>] <span class="op">=</span> churn[<span class="st">"IsActiveMember"</span>].astype(<span class="bu">bool</span>)</span>
<span id="1b59ff6b-7"><a href="#1b59ff6b-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="1b59ff6b-8"><a href="#1b59ff6b-8" aria-hidden="true" tabindex="-1"></a><span class="co"># One-hot encode categorical features</span></span>
<span id="1b59ff6b-9"><a href="#1b59ff6b-9" aria-hidden="true" tabindex="-1"></a>churn_encoded <span class="op">=</span> pd.get_dummies(churn, drop_first<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
About One-hot vs label encoding
</div>
</div>
<div class="callout-body-container callout-body">
<p>One-hot encoding and label encoding are two common techniques for converting categorical data into a numerical format that machine learning algorithms can process. One-hot encoding is used when the categorical variables are nominal, meaning there is no inherent order among the categories. This technique creates a new binary column for each category, with a 1 indicating the presence of the category and a 0 indicating its absence. This approach ensures that the model does not assume any ordinal relationship between the categories, making it suitable for algorithms that are sensitive to numerical relationships, such as linear regression and K-nearest neighbors.</p>
<p>On the other hand, label encoding assigns a unique integer to each category, which is more suitable for ordinal categorical variables where the categories have a meaningful order. This method is straightforward and efficient in terms of memory and computational resources, especially when dealing with a large number of categories. However, it may introduce an artificial ordinal relationship if used on nominal variables, potentially misleading the model.</p>
<p>While one-hot encoding can lead to high-dimensional data, especially with many categories, it prevents the introduction of unintended ordinal relationships. Label encoding, being more compact, works well with tree-based algorithms like decision trees and random forests that can handle numerical encodings without assuming any specific order. The choice between the two methods depends on the nature of the categorical data and the requirements of the machine learning algorithm used. One-hot encoding is preferred for non-ordinal data and algorithms sensitive to numerical relationships, while label encoding is ideal for ordinal data and tree-based algorithms.</p>
</div>
</div>
<p>Let’s look at what the data looks like now.</p>
<div id="b1ad3905" class="cell" data-execution_count="8">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="b1ad3905"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="b1ad3905-1"><a href="#b1ad3905-1" aria-hidden="true" tabindex="-1"></a>churn_encoded</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="7">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">CreditScore</th>
<th data-quarto-table-cell-role="th">Age</th>
<th data-quarto-table-cell-role="th">Tenure</th>
<th data-quarto-table-cell-role="th">Balance</th>
<th data-quarto-table-cell-role="th">NumOfProducts</th>
<th data-quarto-table-cell-role="th">HasCrCard</th>
<th data-quarto-table-cell-role="th">IsActiveMember</th>
<th data-quarto-table-cell-role="th">EstimatedSalary</th>
<th data-quarto-table-cell-role="th">Exited</th>
<th data-quarto-table-cell-role="th">Complain</th>
<th data-quarto-table-cell-role="th">Satisfaction Score</th>
<th data-quarto-table-cell-role="th">Point Earned</th>
<th data-quarto-table-cell-role="th">Geography_Germany</th>
<th data-quarto-table-cell-role="th">Geography_Spain</th>
<th data-quarto-table-cell-role="th">Gender_Male</th>
<th data-quarto-table-cell-role="th">Card Type_GOLD</th>
<th data-quarto-table-cell-role="th">Card Type_PLATINUM</th>
<th data-quarto-table-cell-role="th">Card Type_SILVER</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>619</td>
<td>42</td>
<td>2</td>
<td>0.00</td>
<td>1</td>
<td>True</td>
<td>True</td>
<td>101348.88</td>
<td>True</td>
<td>True</td>
<td>2</td>
<td>464</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>608</td>
<td>41</td>
<td>1</td>
<td>83807.86</td>
<td>1</td>
<td>False</td>
<td>True</td>
<td>112542.58</td>
<td>False</td>
<td>True</td>
<td>3</td>
<td>456</td>
<td>False</td>
<td>True</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>502</td>
<td>42</td>
<td>8</td>
<td>159660.80</td>
<td>3</td>
<td>True</td>
<td>False</td>
<td>113931.57</td>
<td>True</td>
<td>True</td>
<td>3</td>
<td>377</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>699</td>
<td>39</td>
<td>1</td>
<td>0.00</td>
<td>2</td>
<td>False</td>
<td>False</td>
<td>93826.63</td>
<td>False</td>
<td>False</td>
<td>5</td>
<td>350</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>True</td>
<td>False</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>850</td>
<td>43</td>
<td>2</td>
<td>125510.82</td>
<td>1</td>
<td>True</td>
<td>True</td>
<td>79084.10</td>
<td>False</td>
<td>False</td>
<td>5</td>
<td>425</td>
<td>False</td>
<td>True</td>
<td>False</td>
<td>True</td>
<td>False</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9995</td>
<td>771</td>
<td>39</td>
<td>5</td>
<td>0.00</td>
<td>2</td>
<td>True</td>
<td>False</td>
<td>96270.64</td>
<td>False</td>
<td>False</td>
<td>1</td>
<td>300</td>
<td>False</td>
<td>False</td>
<td>True</td>
<td>False</td>
<td>False</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9996</td>
<td>516</td>
<td>35</td>
<td>10</td>
<td>57369.61</td>
<td>1</td>
<td>True</td>
<td>True</td>
<td>101699.77</td>
<td>False</td>
<td>False</td>
<td>5</td>
<td>771</td>
<td>False</td>
<td>False</td>
<td>True</td>
<td>False</td>
<td>True</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9997</td>
<td>709</td>
<td>36</td>
<td>7</td>
<td>0.00</td>
<td>1</td>
<td>False</td>
<td>True</td>
<td>42085.58</td>
<td>True</td>
<td>True</td>
<td>3</td>
<td>564</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>True</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9998</td>
<td>772</td>
<td>42</td>
<td>3</td>
<td>75075.31</td>
<td>2</td>
<td>True</td>
<td>False</td>
<td>92888.52</td>
<td>True</td>
<td>True</td>
<td>2</td>
<td>339</td>
<td>True</td>
<td>False</td>
<td>True</td>
<td>True</td>
<td>False</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9999</td>
<td>792</td>
<td>28</td>
<td>4</td>
<td>130142.79</td>
<td>1</td>
<td>True</td>
<td>False</td>
<td>38190.78</td>
<td>False</td>
<td>False</td>
<td>3</td>
<td>911</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
</tr>
</tbody>
</table>

<p>10000 rows × 18 columns</p>
</div>
</div>
</div>
<p>We now have all the columns in the best possible shape for a model, and we are ready to continue. Note the hot-encoded columns, which have been added to the dataset, such as <code>Gender_Male</code> and <code>Geography_Germany</code>.</p>
</section>
<section id="understanding-the-data-better" class="level2">
<h2 class="anchored" data-anchor-id="understanding-the-data-better">Understanding the data better</h2>
<p>It is always a good idea to develop an intuition about the data we are using before diving into building a model. One important first step is understanding the distribution types of the features, as this can help in selecting the appropriate machine learning algorithms and preprocessing techniques, especially for numerical features whose scales may vary significantly.</p>
<p>We will star by looking at the distribution of the numerical features, let us plot histograms for all the numerical columns, together with QQ plots to check for normality.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
About the QQ plot
</div>
</div>
<div class="callout-body-container callout-body">
<p>A QQ plot, or quantile-quantile plot, is a graphical tool used to compare two probability distributions by plotting their quantiles against each other. It helps to determine if the distributions are similar by showing how well the points follow a straight line. If the points lie approximately along a 45-degree line, it indicates that the distributions being compared are similar. QQ plots are commonly used to check the normality of a dataset by comparing the sample distribution to a theoretical normal distribution. Deviations from the straight line can indicate departures from normality or highlight differences between the two distributions. This tool is particularly useful in statistical analysis for assessing assumptions and identifying anomalies.</p>
</div>
</div>
<div id="d8617b97" class="cell" data-execution_count="9">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="d8617b97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="d8617b97-1"><a href="#d8617b97-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="d8617b97-2"><a href="#d8617b97-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="d8617b97-3"><a href="#d8617b97-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scipy.stats <span class="im">as</span> stats</span>
<span id="d8617b97-4"><a href="#d8617b97-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="d8617b97-5"><a href="#d8617b97-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="d8617b97-6"><a href="#d8617b97-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_distributions_grid(data):</span>
<span id="d8617b97-7"><a href="#d8617b97-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Select numeric columns</span></span>
<span id="d8617b97-8"><a href="#d8617b97-8" aria-hidden="true" tabindex="-1"></a>    numeric_cols <span class="op">=</span> data.select_dtypes(include<span class="op">=</span>[<span class="st">"int64"</span>, <span class="st">"float64"</span>]).columns</span>
<span id="d8617b97-9"><a href="#d8617b97-9" aria-hidden="true" tabindex="-1"></a>    num_cols <span class="op">=</span> <span class="bu">len</span>(numeric_cols)</span>
<span id="d8617b97-10"><a href="#d8617b97-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="d8617b97-11"><a href="#d8617b97-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate grid size</span></span>
<span id="d8617b97-12"><a href="#d8617b97-12" aria-hidden="true" tabindex="-1"></a>    grid_rows <span class="op">=</span> num_cols</span>
<span id="d8617b97-13"><a href="#d8617b97-13" aria-hidden="true" tabindex="-1"></a>    grid_cols <span class="op">=</span> <span class="dv">2</span>  <span class="co"># one for histogram, one for QQ-plot</span></span>
<span id="d8617b97-14"><a href="#d8617b97-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="d8617b97-15"><a href="#d8617b97-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create subplots</span></span>
<span id="d8617b97-16"><a href="#d8617b97-16" aria-hidden="true" tabindex="-1"></a>    fig, axes <span class="op">=</span> plt.subplots(grid_rows, grid_cols, figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">2</span> <span class="op">*</span> num_cols))</span>
<span id="d8617b97-17"><a href="#d8617b97-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="d8617b97-18"><a href="#d8617b97-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Generate colors from the summer_r palette</span></span>
<span id="d8617b97-19"><a href="#d8617b97-19" aria-hidden="true" tabindex="-1"></a>    palette <span class="op">=</span> sns.color_palette(<span class="st">"summer_r"</span>, num_cols)</span>
<span id="d8617b97-20"><a href="#d8617b97-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="d8617b97-21"><a href="#d8617b97-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, column <span class="kw">in</span> <span class="bu">enumerate</span>(numeric_cols):</span>
<span id="d8617b97-22"><a href="#d8617b97-22" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Plot histogram and density plot</span></span>
<span id="d8617b97-23"><a href="#d8617b97-23" aria-hidden="true" tabindex="-1"></a>        sns.histplot(</span>
<span id="d8617b97-24"><a href="#d8617b97-24" aria-hidden="true" tabindex="-1"></a>            data[column], kde<span class="op">=</span><span class="va">True</span>, ax<span class="op">=</span>axes[idx, <span class="dv">0</span>], color<span class="op">=</span>palette[idx <span class="op">%</span> <span class="bu">len</span>(palette)]</span>
<span id="d8617b97-25"><a href="#d8617b97-25" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="d8617b97-26"><a href="#d8617b97-26" aria-hidden="true" tabindex="-1"></a>        axes[idx, <span class="dv">0</span>].set_title(<span class="ss">f"Histogram and Density Plot of </span><span class="sc">{</span>column<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="d8617b97-27"><a href="#d8617b97-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="d8617b97-28"><a href="#d8617b97-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Plot QQ-plot</span></span>
<span id="d8617b97-29"><a href="#d8617b97-29" aria-hidden="true" tabindex="-1"></a>        stats.probplot(data[column], dist<span class="op">=</span><span class="st">"norm"</span>, plot<span class="op">=</span>axes[idx, <span class="dv">1</span>])</span>
<span id="d8617b97-30"><a href="#d8617b97-30" aria-hidden="true" tabindex="-1"></a>        axes[idx, <span class="dv">1</span>].set_title(<span class="ss">f"QQ-Plot of </span><span class="sc">{</span>column<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="d8617b97-31"><a href="#d8617b97-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="d8617b97-32"><a href="#d8617b97-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Adjust layout</span></span>
<span id="d8617b97-33"><a href="#d8617b97-33" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="d8617b97-34"><a href="#d8617b97-34" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="d8617b97-35"><a href="#d8617b97-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="d8617b97-36"><a href="#d8617b97-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="d8617b97-37"><a href="#d8617b97-37" aria-hidden="true" tabindex="-1"></a>plot_distributions_grid(churn_encoded)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/cell-9-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="index_files/figure-html/cell-9-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<p>From the histograms and QQ plots, we can see that most of the numerical features are not normally distributed. This is important to note, as some machine learning algorithms assume this is the case. In such cases, we may need to apply transformations to make the data more normally distributed or use algorithms that are robust to non-normal data (for example, tree-based models or support vector machines).</p>
<p>We can say from the above that:</p>
<ul>
<li><code>CreditScore</code> is normally distributed, with some outliers;</li>
<li><code>Age</code> is not normally distributed, with a left skew;</li>
<li><code>Tenure</code> is a uniform distribution with descrete values;</li>
<li><code>Balance</code> is roughly normally distributed, with a large number of near-zero values;</li>
<li><code>NumOfProducts</code> is discrete and multimodal;</li>
<li><code>EstimatedSalary</code> is uniform;</li>
<li><code>SatisfactionScore</code> is discrete and multimodal;</li>
<li><code>Point Earned</code> is uniform with some skewness and lower end outliers.</li>
</ul>
<p>We consider these distribution later when we define scaling and transformation strategies for the numerical features.</p>
<p>Let us now look at the distribution of the target variable, <code>Exited</code>, which indicates whether a customer churned or not, and the interdependencies between some of the features. A useful tool for this is a pair plot, which shows the relationships between pairs of features and how they correlate with the target variable.</p>
<div id="03981561" class="cell" data-execution_count="10">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="03981561"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="03981561-1"><a href="#03981561-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pairplot of the dataset for non-categorical features, with Exited as the target (stick to a sample for performance)</span></span>
<span id="03981561-2"><a href="#03981561-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="03981561-3"><a href="#03981561-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Select non-categorical colums only</span></span>
<span id="03981561-4"><a href="#03981561-4" aria-hidden="true" tabindex="-1"></a>non_categorical_columns <span class="op">=</span> churn_encoded.select_dtypes(exclude<span class="op">=</span><span class="st">"bool"</span>).columns</span>
<span id="03981561-5"><a href="#03981561-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="03981561-6"><a href="#03981561-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the pairplot for the non-categorical columns only</span></span>
<span id="03981561-7"><a href="#03981561-7" aria-hidden="true" tabindex="-1"></a>sns.set_theme(context<span class="op">=</span><span class="st">"paper"</span>, style<span class="op">=</span><span class="st">"ticks"</span>)  <span class="co"># Set the style of the visualization</span></span>
<span id="03981561-8"><a href="#03981561-8" aria-hidden="true" tabindex="-1"></a>pairplot <span class="op">=</span> sns.pairplot(</span>
<span id="03981561-9"><a href="#03981561-9" aria-hidden="true" tabindex="-1"></a>    churn,</span>
<span id="03981561-10"><a href="#03981561-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">vars</span><span class="op">=</span>non_categorical_columns,</span>
<span id="03981561-11"><a href="#03981561-11" aria-hidden="true" tabindex="-1"></a>    hue<span class="op">=</span><span class="st">"Exited"</span>,</span>
<span id="03981561-12"><a href="#03981561-12" aria-hidden="true" tabindex="-1"></a>    palette<span class="op">=</span><span class="st">"summer_r"</span>,</span>
<span id="03981561-13"><a href="#03981561-13" aria-hidden="true" tabindex="-1"></a>    corner<span class="op">=</span><span class="va">True</span>,</span>
<span id="03981561-14"><a href="#03981561-14" aria-hidden="true" tabindex="-1"></a>    height<span class="op">=</span><span class="fl">1.15</span>,</span>
<span id="03981561-15"><a href="#03981561-15" aria-hidden="true" tabindex="-1"></a>    aspect<span class="op">=</span><span class="fl">1.15</span>,</span>
<span id="03981561-16"><a href="#03981561-16" aria-hidden="true" tabindex="-1"></a>    markers<span class="op">=</span>[<span class="st">"."</span>, <span class="st">"."</span>],</span>
<span id="03981561-17"><a href="#03981561-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="03981561-18"><a href="#03981561-18" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/cell-10-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img src="index_files/figure-html/cell-10-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<p>The pair plot shows a few interesting patterns:</p>
<ul>
<li>There is a pattern between <code>Age</code> and <code>Exited</code>, with a band of churned customers in the middle age range;</li>
<li>Customers with a larger number of products are more likely to churn;</li>
<li>Counterintuitively, there is no clear relationship between customer satisfaction and churn.</li>
</ul>
<p>Let us also look at the correlation matrix of the numerical features to see if there are any strong correlations between them.</p>
<div id="c7c975bd" class="cell" data-execution_count="11">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="c7c975bd"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="c7c975bd-1"><a href="#c7c975bd-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot a correlation heatmap</span></span>
<span id="c7c975bd-2"><a href="#c7c975bd-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">9</span>, <span class="dv">6</span>))</span>
<span id="c7c975bd-3"><a href="#c7c975bd-3" aria-hidden="true" tabindex="-1"></a>correlation <span class="op">=</span> churn_encoded.corr()</span>
<span id="c7c975bd-4"><a href="#c7c975bd-4" aria-hidden="true" tabindex="-1"></a>heatmap <span class="op">=</span> sns.heatmap(correlation, annot<span class="op">=</span><span class="va">True</span>, cmap<span class="op">=</span><span class="st">"summer_r"</span>, fmt<span class="op">=</span><span class="st">".2f"</span>)</span>
<span id="c7c975bd-5"><a href="#c7c975bd-5" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/cell-11-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3"><img src="index_files/figure-html/cell-11-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<p>Notice that <code>Exited</code> and <code>Complain</code> correlate perfectly (1.0), suggesting that both are potentially measuring the same thing. We will remove <code>Complain</code> from the dataset, as it will not be a useful feature for our model.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
About Perfect Correlation
</div>
</div>
<div class="callout-body-container callout-body">
<p>Perfectly correlated features are those that have a direct and proportional relationship with each other. When one feature is the target variable and it is perfectly correlated with another feature, this implies that there is an exact linear relationship between them. In other words, the value of the target variable can be precisely predicted using the other feature without any error.</p>
<p>This situation typically suggests redundancy in the dataset because one feature contains all the information necessary to predict the other. If the feature that is perfectly correlated with the target variable is included in the model, it will lead to several implications.</p>
<p>Firstly, the model’s interpretability could be compromised. A perfectly correlated feature does not provide any additional insight because it simply replicates the information already present in the target variable. This redundancy can lead to an overestimation of the model’s predictive power during training since the model is essentially learning the direct relationship rather than discovering any underlying patterns.</p>
<p>Moreover, in practical scenarios, perfect correlation is often a sign of data leakage. Data leakage occurs when information from outside the training dataset is used to create the model, which can result in overly optimistic performance estimates and poor generalization to new data. It typically indicates that the feature used as a predictor might not be available or might not have the same predictive power in real-world applications.</p>
<p>For instance, if the target variable is a financial outcome like customer churn, and another feature is perfectly correlated with it, this might suggest that the feature contains post-event information that wouldn’t be available at the time of prediction. Including such features can lead to models that are highly accurate on historical data but fail in real-world deployment.</p>
<p>Additionally, perfect correlation can inflate the variance of the estimated coefficients in linear models, leading to issues with multicollinearity. This can make the model’s estimates highly sensitive to changes in the input data and can cause instability in the model’s predictions.</p>
<p>To address this, one should consider removing or combining the perfectly correlated feature with the target variable. This helps in ensuring that the model is not relying on redundant or potentially leaked information, thereby improving the model’s robustness and generalizability. It also encourages the model to learn from more subtle, underlying patterns in the data rather than from straightforward, but unrealistic, relationships.</p>
</div>
</div>
<div id="aa156962" class="cell" data-execution_count="12">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="aa156962"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="aa156962-1"><a href="#aa156962-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop the Complain feature</span></span>
<span id="aa156962-2"><a href="#aa156962-2" aria-hidden="true" tabindex="-1"></a>churn_encoded <span class="op">=</span> churn_encoded.drop(columns<span class="op">=</span>[<span class="st">"Complain"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Let us now visualise the dataset using dimensionality reduction, to assess if we can identify any patterns in the data, and the separability of the classes. This will give us a good first look at how likely our model is to perform well.</p>
<div id="e4eff2ca" class="cell" data-execution_count="13">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="e4eff2ca"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="e4eff2ca-1"><a href="#e4eff2ca-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.manifold <span class="im">import</span> TSNE</span>
<span id="e4eff2ca-2"><a href="#e4eff2ca-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.decomposition <span class="im">import</span> PCA</span>
<span id="e4eff2ca-3"><a href="#e4eff2ca-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="e4eff2ca-4"><a href="#e4eff2ca-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit and transform t-SNE</span></span>
<span id="e4eff2ca-5"><a href="#e4eff2ca-5" aria-hidden="true" tabindex="-1"></a>tsne <span class="op">=</span> TSNE(n_components<span class="op">=</span><span class="dv">2</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="e4eff2ca-6"><a href="#e4eff2ca-6" aria-hidden="true" tabindex="-1"></a>churn_tsne <span class="op">=</span> tsne.fit_transform(churn_encoded.drop(columns<span class="op">=</span>[<span class="st">"Exited"</span>]))</span>
<span id="e4eff2ca-7"><a href="#e4eff2ca-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="e4eff2ca-8"><a href="#e4eff2ca-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit and transform PCA</span></span>
<span id="e4eff2ca-9"><a href="#e4eff2ca-9" aria-hidden="true" tabindex="-1"></a>pca <span class="op">=</span> PCA(n_components<span class="op">=</span><span class="dv">2</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="e4eff2ca-10"><a href="#e4eff2ca-10" aria-hidden="true" tabindex="-1"></a>churn_pca <span class="op">=</span> pca.fit_transform(churn_encoded.drop(columns<span class="op">=</span>[<span class="st">"Exited"</span>]))</span>
<span id="e4eff2ca-11"><a href="#e4eff2ca-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="e4eff2ca-12"><a href="#e4eff2ca-12" aria-hidden="true" tabindex="-1"></a>hue_order <span class="op">=</span> churn_encoded[<span class="st">"Exited"</span>].unique()</span>
<span id="e4eff2ca-13"><a href="#e4eff2ca-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="e4eff2ca-14"><a href="#e4eff2ca-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot t-SNE and PCA side by side</span></span>
<span id="e4eff2ca-15"><a href="#e4eff2ca-15" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">9</span>, <span class="dv">6</span>))</span>
<span id="e4eff2ca-16"><a href="#e4eff2ca-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="e4eff2ca-17"><a href="#e4eff2ca-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot t-SNE</span></span>
<span id="e4eff2ca-18"><a href="#e4eff2ca-18" aria-hidden="true" tabindex="-1"></a>tsne_plot <span class="op">=</span> sns.scatterplot(</span>
<span id="e4eff2ca-19"><a href="#e4eff2ca-19" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>churn_tsne[:, <span class="dv">0</span>],</span>
<span id="e4eff2ca-20"><a href="#e4eff2ca-20" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span>churn_tsne[:, <span class="dv">1</span>],</span>
<span id="e4eff2ca-21"><a href="#e4eff2ca-21" aria-hidden="true" tabindex="-1"></a>    hue<span class="op">=</span>churn_encoded[<span class="st">"Exited"</span>],</span>
<span id="e4eff2ca-22"><a href="#e4eff2ca-22" aria-hidden="true" tabindex="-1"></a>    palette<span class="op">=</span><span class="st">"summer_r"</span>,</span>
<span id="e4eff2ca-23"><a href="#e4eff2ca-23" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>ax[<span class="dv">0</span>],</span>
<span id="e4eff2ca-24"><a href="#e4eff2ca-24" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="e4eff2ca-25"><a href="#e4eff2ca-25" aria-hidden="true" tabindex="-1"></a>tsne_plot.set_title(<span class="st">"t-SNE"</span>)</span>
<span id="e4eff2ca-26"><a href="#e4eff2ca-26" aria-hidden="true" tabindex="-1"></a>tsne_plot.legend(title<span class="op">=</span><span class="st">"Exited"</span>, loc<span class="op">=</span><span class="st">"upper right"</span>, labels<span class="op">=</span>[<span class="st">"No"</span>, <span class="st">"Yes"</span>])</span>
<span id="e4eff2ca-27"><a href="#e4eff2ca-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="e4eff2ca-28"><a href="#e4eff2ca-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot PCA</span></span>
<span id="e4eff2ca-29"><a href="#e4eff2ca-29" aria-hidden="true" tabindex="-1"></a>pca_plot <span class="op">=</span> sns.scatterplot(</span>
<span id="e4eff2ca-30"><a href="#e4eff2ca-30" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>churn_pca[:, <span class="dv">0</span>],</span>
<span id="e4eff2ca-31"><a href="#e4eff2ca-31" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span>churn_pca[:, <span class="dv">1</span>],</span>
<span id="e4eff2ca-32"><a href="#e4eff2ca-32" aria-hidden="true" tabindex="-1"></a>    hue<span class="op">=</span>churn_encoded[<span class="st">"Exited"</span>],</span>
<span id="e4eff2ca-33"><a href="#e4eff2ca-33" aria-hidden="true" tabindex="-1"></a>    palette<span class="op">=</span><span class="st">"summer_r"</span>,</span>
<span id="e4eff2ca-34"><a href="#e4eff2ca-34" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>ax[<span class="dv">1</span>],</span>
<span id="e4eff2ca-35"><a href="#e4eff2ca-35" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="e4eff2ca-36"><a href="#e4eff2ca-36" aria-hidden="true" tabindex="-1"></a>pca_plot.set_title(<span class="st">"PCA"</span>)</span>
<span id="e4eff2ca-37"><a href="#e4eff2ca-37" aria-hidden="true" tabindex="-1"></a>pca_plot.legend(title<span class="op">=</span><span class="st">"Exited"</span>, loc<span class="op">=</span><span class="st">"upper right"</span>, labels<span class="op">=</span>[<span class="st">"No"</span>, <span class="st">"Yes"</span>])</span>
<span id="e4eff2ca-38"><a href="#e4eff2ca-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="e4eff2ca-39"><a href="#e4eff2ca-39" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/cell-13-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4"><img src="index_files/figure-html/cell-13-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<p>The t-SNE plot showcases some interesting patterns, such as the elongated, snake-like shape observed on the left side. These intricate patterns suggest the presence of non-linear relationships within the data, which are effectively captured by the t-SNE algorithm. This non-linear nature of the data indicates that the relationships between features and the target variable might not be straightforward, necessitating models that can handle complex interactions.</p>
</section>
<section id="balancing-the-dataset-and-creating-a-holdout-set" class="level2">
<h2 class="anchored" data-anchor-id="balancing-the-dataset-and-creating-a-holdout-set">Balancing the dataset and creating a holdout set</h2>
<p>Before we proceed with building a model, let us try to address any class imbalance in the dataset. Class imbalance occurs when one class significantly outnumbers the other, leading to biased model predictions. In our case, the number of customers who churned (<code>Exited=1</code>) is much smaller than those who did not churn (<code>Exited=0</code>). We will also create a holdout set to evaluate the model’s performance on unseen data.</p>
<div id="3772a1eb" class="cell" data-execution_count="14">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="3772a1eb"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="3772a1eb-1"><a href="#3772a1eb-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Count the number of churned and non-churned samples</span></span>
<span id="3772a1eb-2"><a href="#3772a1eb-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="3772a1eb-3"><a href="#3772a1eb-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(churn_encoded[<span class="st">"Exited"</span>].value_counts())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Exited
False    7962
True     2038
Name: count, dtype: int64</code></pre>
</div>
</div>
<p>Only about 20% of the dataset contains churned customers, which is a significant class imbalance. We will address this by oversampling the minority class using the Synthetic Minority Over-sampling Technique (SMOTE). SMOTE generates synthetic samples by interpolating between existing samples of the minority class, thereby balancing the class distribution.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
About the Limitations of SMOTE
</div>
</div>
<div class="callout-body-container callout-body">
<p>SMOTE has several limitations. One significant issue is overfitting, particularly in small datasets. By generating synthetic examples, SMOTE can produce duplicates or near-duplicates that don’t add new information, leading to the model learning noise instead of useful patterns.</p>
<p>Additionally, SMOTE does not differentiate between noisy and informative data points. Consequently, if the minority class contains noise, SMOTE may generate synthetic instances based on this noise, which can degrade the model’s performance. Another challenge is class separation; SMOTE can create synthetic examples that fall into the majority class space, causing overlapping regions that confuse the classifier and reduce its ability to distinguish between classes.</p>
<p>In high-dimensional spaces, the synthetic examples generated by SMOTE might be less effective because distance metrics become less meaningful, a phenomenon known as the “curse of dimensionality.” This makes it harder to create realistic synthetic samples. Moreover, generating synthetic samples and training models on larger datasets can increase computational cost and time, which can be a significant drawback for very large datasets.</p>
<p>SMOTE also does not consider the importance of different features when generating new instances, potentially creating less realistic samples if some features are more important than others. Lastly, while SMOTE addresses overall class imbalance, it does not tackle any imbalance within the minority class itself. If there are sub-classes within the minority class with their own imbalances, SMOTE won’t address this issue.</p>
</div>
</div>
<div id="502f7a13" class="cell" data-execution_count="15">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="502f7a13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="502f7a13-1"><a href="#502f7a13-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> imblearn.over_sampling <span class="im">import</span> SMOTE</span>
<span id="502f7a13-2"><a href="#502f7a13-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="502f7a13-3"><a href="#502f7a13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="502f7a13-4"><a href="#502f7a13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Reserve 10% of the samples as a holdout set</span></span>
<span id="502f7a13-5"><a href="#502f7a13-5" aria-hidden="true" tabindex="-1"></a>X, X_holdout, y, y_holdout <span class="op">=</span> train_test_split(</span>
<span id="502f7a13-6"><a href="#502f7a13-6" aria-hidden="true" tabindex="-1"></a>    churn_encoded.drop(columns<span class="op">=</span>[<span class="st">"Exited"</span>]),</span>
<span id="502f7a13-7"><a href="#502f7a13-7" aria-hidden="true" tabindex="-1"></a>    churn_encoded[<span class="st">"Exited"</span>],</span>
<span id="502f7a13-8"><a href="#502f7a13-8" aria-hidden="true" tabindex="-1"></a>    stratify<span class="op">=</span>churn_encoded[<span class="st">"Exited"</span>],</span>
<span id="502f7a13-9"><a href="#502f7a13-9" aria-hidden="true" tabindex="-1"></a>    test_size<span class="op">=</span><span class="fl">0.2</span>,</span>
<span id="502f7a13-10"><a href="#502f7a13-10" aria-hidden="true" tabindex="-1"></a>    random_state<span class="op">=</span><span class="dv">42</span>,</span>
<span id="502f7a13-11"><a href="#502f7a13-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="502f7a13-12"><a href="#502f7a13-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="502f7a13-13"><a href="#502f7a13-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Rebalance the dataset with SMOTE</span></span>
<span id="502f7a13-14"><a href="#502f7a13-14" aria-hidden="true" tabindex="-1"></a>smote <span class="op">=</span> SMOTE(random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="502f7a13-15"><a href="#502f7a13-15" aria-hidden="true" tabindex="-1"></a>X_resampled, y_resampled <span class="op">=</span> smote.fit_resample(X, y)</span>
<span id="502f7a13-16"><a href="#502f7a13-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="502f7a13-17"><a href="#502f7a13-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Count the number of churned and non-churned samples after SMOTE</span></span>
<span id="502f7a13-18"><a href="#502f7a13-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X_holdout.shape)</span>
<span id="502f7a13-19"><a href="#502f7a13-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(y_holdout.shape)</span>
<span id="502f7a13-20"><a href="#502f7a13-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X_resampled.shape)</span>
<span id="502f7a13-21"><a href="#502f7a13-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(y_resampled.shape)</span>
<span id="502f7a13-22"><a href="#502f7a13-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(y_resampled.value_counts())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(2000, 16)
(2000,)
(12740, 16)
(12740,)
Exited
False    6370
True     6370
Name: count, dtype: int64</code></pre>
</div>
</div>
<p>We now have a separate holdout set composed of 2000 random samples, and a balanced training set with an equal number of churned and non-churned customers. We are ready to evaluate different models to predict customer churn.</p>
</section>
<section id="model-selection-and-evaluation" class="level2">
<h2 class="anchored" data-anchor-id="model-selection-and-evaluation">Model selection and evaluation</h2>
<p>Now that we have a balanced dataset, and a holdout set, let us further split the resampled dataset into training and test sets.</p>
<div id="e8ae88c4" class="cell" data-execution_count="16">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="e8ae88c4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="e8ae88c4-1"><a href="#e8ae88c4-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="e8ae88c4-2"><a href="#e8ae88c4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="e8ae88c4-3"><a href="#e8ae88c4-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Split the data into balanced train and test sets using stratified sampling</span></span>
<span id="e8ae88c4-4"><a href="#e8ae88c4-4" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(</span>
<span id="e8ae88c4-5"><a href="#e8ae88c4-5" aria-hidden="true" tabindex="-1"></a>    X_resampled, y_resampled, test_size<span class="op">=</span><span class="fl">0.3</span>, random_state<span class="op">=</span><span class="dv">42</span></span>
<span id="e8ae88c4-6"><a href="#e8ae88c4-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="e8ae88c4-7"><a href="#e8ae88c4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="e8ae88c4-8"><a href="#e8ae88c4-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the shapes of the resulting datasets</span></span>
<span id="e8ae88c4-9"><a href="#e8ae88c4-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"X_train:"</span>, X_train.shape, <span class="st">"y_train:"</span>, y_train.shape)</span>
<span id="e8ae88c4-10"><a href="#e8ae88c4-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"X_test:"</span>, X_test.shape, <span class="st">"y_test:"</span>, y_test.shape)</span>
<span id="e8ae88c4-11"><a href="#e8ae88c4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="e8ae88c4-12"><a href="#e8ae88c4-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify the proportions of the 'Churn' column in the train and test sets</span></span>
<span id="e8ae88c4-13"><a href="#e8ae88c4-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train set 'Exited' value counts:"</span>)</span>
<span id="e8ae88c4-14"><a href="#e8ae88c4-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(y_train.value_counts(normalize<span class="op">=</span><span class="va">False</span>))</span>
<span id="e8ae88c4-15"><a href="#e8ae88c4-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test set 'Exited' value counts:"</span>)</span>
<span id="e8ae88c4-16"><a href="#e8ae88c4-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(y_test.value_counts(normalize<span class="op">=</span><span class="va">False</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>X_train: (8918, 16) y_train: (8918,)
X_test: (3822, 16) y_test: (3822,)
Train set 'Exited' value counts:
Exited
True     4496
False    4422
Name: count, dtype: int64
Test set 'Exited' value counts:
Exited
False    1948
True     1874
Name: count, dtype: int64</code></pre>
</div>
</div>
<section id="model-selection" class="level3">
<h3 class="anchored" data-anchor-id="model-selection">Model selection</h3>
<p>We will perform a grid search over a few different models to find the best hyperparameters for each, evaluating the models using cross-validation on the training set, and later testing the best models against the holdout set. Note how we are selecting different scaling strategies for the numerical features based on their distributions from our earlier analysis.</p>
<div id="d3e050b0" class="cell" data-execution_count="17">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="d3e050b0"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="d3e050b0-1"><a href="#d3e050b0-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> (</span>
<span id="d3e050b0-2"><a href="#d3e050b0-2" aria-hidden="true" tabindex="-1"></a>    RandomForestClassifier,</span>
<span id="d3e050b0-3"><a href="#d3e050b0-3" aria-hidden="true" tabindex="-1"></a>    GradientBoostingClassifier,</span>
<span id="d3e050b0-4"><a href="#d3e050b0-4" aria-hidden="true" tabindex="-1"></a>    AdaBoostClassifier,</span>
<span id="d3e050b0-5"><a href="#d3e050b0-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="d3e050b0-6"><a href="#d3e050b0-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LogisticRegression</span>
<span id="d3e050b0-7"><a href="#d3e050b0-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> GridSearchCV</span>
<span id="d3e050b0-8"><a href="#d3e050b0-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> Pipeline</span>
<span id="d3e050b0-9"><a href="#d3e050b0-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler, MinMaxScaler, RobustScaler</span>
<span id="d3e050b0-10"><a href="#d3e050b0-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.compose <span class="im">import</span> ColumnTransformer</span>
<span id="d3e050b0-11"><a href="#d3e050b0-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.svm <span class="im">import</span> SVC</span>
<span id="d3e050b0-12"><a href="#d3e050b0-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.neighbors <span class="im">import</span> KNeighborsClassifier</span>
<span id="d3e050b0-13"><a href="#d3e050b0-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.naive_bayes <span class="im">import</span> GaussianNB</span>
<span id="d3e050b0-14"><a href="#d3e050b0-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> xgboost <span class="im">import</span> XGBClassifier</span>
<span id="d3e050b0-15"><a href="#d3e050b0-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.neural_network <span class="im">import</span> MLPClassifier</span>
<span id="d3e050b0-16"><a href="#d3e050b0-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="d3e050b0-17"><a href="#d3e050b0-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="d3e050b0-18"><a href="#d3e050b0-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a function to apply different scalers to different features</span></span>
<span id="d3e050b0-19"><a href="#d3e050b0-19" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_column_transformer(feature_scaler_mapping, default_scaler, all_features):</span>
<span id="d3e050b0-20"><a href="#d3e050b0-20" aria-hidden="true" tabindex="-1"></a>    transformers <span class="op">=</span> []</span>
<span id="d3e050b0-21"><a href="#d3e050b0-21" aria-hidden="true" tabindex="-1"></a>    specific_features <span class="op">=</span> feature_scaler_mapping.keys()</span>
<span id="d3e050b0-22"><a href="#d3e050b0-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> feature, scaler <span class="kw">in</span> feature_scaler_mapping.items():</span>
<span id="d3e050b0-23"><a href="#d3e050b0-23" aria-hidden="true" tabindex="-1"></a>        transformers.append(</span>
<span id="d3e050b0-24"><a href="#d3e050b0-24" aria-hidden="true" tabindex="-1"></a>            (<span class="ss">f"</span><span class="sc">{</span>scaler<span class="sc">.</span>__class__<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>feature<span class="sc">}</span><span class="ss">"</span>, scaler, [feature])</span>
<span id="d3e050b0-25"><a href="#d3e050b0-25" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="d3e050b0-26"><a href="#d3e050b0-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="d3e050b0-27"><a href="#d3e050b0-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Apply default scaler to all other features</span></span>
<span id="d3e050b0-28"><a href="#d3e050b0-28" aria-hidden="true" tabindex="-1"></a>    remaining_features <span class="op">=</span> [</span>
<span id="d3e050b0-29"><a href="#d3e050b0-29" aria-hidden="true" tabindex="-1"></a>        feature <span class="cf">for</span> feature <span class="kw">in</span> all_features <span class="cf">if</span> feature <span class="kw">not</span> <span class="kw">in</span> specific_features</span>
<span id="d3e050b0-30"><a href="#d3e050b0-30" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="d3e050b0-31"><a href="#d3e050b0-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> remaining_features:</span>
<span id="d3e050b0-32"><a href="#d3e050b0-32" aria-hidden="true" tabindex="-1"></a>        transformers.append((<span class="st">"default_scaler"</span>, default_scaler, remaining_features))</span>
<span id="d3e050b0-33"><a href="#d3e050b0-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="d3e050b0-34"><a href="#d3e050b0-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ColumnTransformer(transformers)</span>
<span id="d3e050b0-35"><a href="#d3e050b0-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="d3e050b0-36"><a href="#d3e050b0-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="d3e050b0-37"><a href="#d3e050b0-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a function to create pipelines and perform Grid Search</span></span>
<span id="d3e050b0-38"><a href="#d3e050b0-38" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_and_fit_model(</span>
<span id="d3e050b0-39"><a href="#d3e050b0-39" aria-hidden="true" tabindex="-1"></a>    model,</span>
<span id="d3e050b0-40"><a href="#d3e050b0-40" aria-hidden="true" tabindex="-1"></a>    param_grid,</span>
<span id="d3e050b0-41"><a href="#d3e050b0-41" aria-hidden="true" tabindex="-1"></a>    X_train,</span>
<span id="d3e050b0-42"><a href="#d3e050b0-42" aria-hidden="true" tabindex="-1"></a>    y_train,</span>
<span id="d3e050b0-43"><a href="#d3e050b0-43" aria-hidden="true" tabindex="-1"></a>    feature_scaler_mapping,</span>
<span id="d3e050b0-44"><a href="#d3e050b0-44" aria-hidden="true" tabindex="-1"></a>    default_scaler,</span>
<span id="d3e050b0-45"><a href="#d3e050b0-45" aria-hidden="true" tabindex="-1"></a>    all_features,</span>
<span id="d3e050b0-46"><a href="#d3e050b0-46" aria-hidden="true" tabindex="-1"></a>    cv<span class="op">=</span><span class="dv">3</span>,</span>
<span id="d3e050b0-47"><a href="#d3e050b0-47" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="d3e050b0-48"><a href="#d3e050b0-48" aria-hidden="true" tabindex="-1"></a>    column_transformer <span class="op">=</span> get_column_transformer(</span>
<span id="d3e050b0-49"><a href="#d3e050b0-49" aria-hidden="true" tabindex="-1"></a>        feature_scaler_mapping, default_scaler, all_features</span>
<span id="d3e050b0-50"><a href="#d3e050b0-50" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="d3e050b0-51"><a href="#d3e050b0-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="d3e050b0-52"><a href="#d3e050b0-52" aria-hidden="true" tabindex="-1"></a>    pipeline <span class="op">=</span> Pipeline([(<span class="st">"scaler"</span>, column_transformer), (<span class="st">"model"</span>, model)])</span>
<span id="d3e050b0-53"><a href="#d3e050b0-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="d3e050b0-54"><a href="#d3e050b0-54" aria-hidden="true" tabindex="-1"></a>    grid_search <span class="op">=</span> GridSearchCV(pipeline, param_grid, cv<span class="op">=</span>cv)</span>
<span id="d3e050b0-55"><a href="#d3e050b0-55" aria-hidden="true" tabindex="-1"></a>    grid_search.fit(X_train, y_train)</span>
<span id="d3e050b0-56"><a href="#d3e050b0-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="d3e050b0-57"><a href="#d3e050b0-57" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> grid_search</span>
<span id="d3e050b0-58"><a href="#d3e050b0-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="d3e050b0-59"><a href="#d3e050b0-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="d3e050b0-60"><a href="#d3e050b0-60" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the feature to scaler mapping</span></span>
<span id="d3e050b0-61"><a href="#d3e050b0-61" aria-hidden="true" tabindex="-1"></a>feature_scaler_mapping <span class="op">=</span> {</span>
<span id="d3e050b0-62"><a href="#d3e050b0-62" aria-hidden="true" tabindex="-1"></a>    <span class="st">"CreditScore"</span>: StandardScaler(),</span>
<span id="d3e050b0-63"><a href="#d3e050b0-63" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Age"</span>: RobustScaler(),</span>
<span id="d3e050b0-64"><a href="#d3e050b0-64" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Tenure"</span>: MinMaxScaler(),</span>
<span id="d3e050b0-65"><a href="#d3e050b0-65" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Balance"</span>: RobustScaler(),</span>
<span id="d3e050b0-66"><a href="#d3e050b0-66" aria-hidden="true" tabindex="-1"></a>    <span class="st">"NumOfProducts"</span>: MinMaxScaler(),</span>
<span id="d3e050b0-67"><a href="#d3e050b0-67" aria-hidden="true" tabindex="-1"></a>    <span class="st">"EstimatedSalary"</span>: MinMaxScaler(),</span>
<span id="d3e050b0-68"><a href="#d3e050b0-68" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Satisfaction Score"</span>: MinMaxScaler(),</span>
<span id="d3e050b0-69"><a href="#d3e050b0-69" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Point Earned"</span>: RobustScaler(),</span>
<span id="d3e050b0-70"><a href="#d3e050b0-70" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="d3e050b0-71"><a href="#d3e050b0-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="d3e050b0-72"><a href="#d3e050b0-72" aria-hidden="true" tabindex="-1"></a><span class="co"># Define all features present in the dataset</span></span>
<span id="d3e050b0-73"><a href="#d3e050b0-73" aria-hidden="true" tabindex="-1"></a>all_features <span class="op">=</span> X_train.columns</span>
<span id="d3e050b0-74"><a href="#d3e050b0-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="d3e050b0-75"><a href="#d3e050b0-75" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the default scaler to be used for other features</span></span>
<span id="d3e050b0-76"><a href="#d3e050b0-76" aria-hidden="true" tabindex="-1"></a>default_scaler <span class="op">=</span> RobustScaler()</span>
<span id="d3e050b0-77"><a href="#d3e050b0-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="d3e050b0-78"><a href="#d3e050b0-78" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the models and their respective hyperparameters</span></span>
<span id="d3e050b0-79"><a href="#d3e050b0-79" aria-hidden="true" tabindex="-1"></a>models_and_params <span class="op">=</span> [</span>
<span id="d3e050b0-80"><a href="#d3e050b0-80" aria-hidden="true" tabindex="-1"></a>    (</span>
<span id="d3e050b0-81"><a href="#d3e050b0-81" aria-hidden="true" tabindex="-1"></a>        RandomForestClassifier(random_state<span class="op">=</span><span class="dv">42</span>),</span>
<span id="d3e050b0-82"><a href="#d3e050b0-82" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="d3e050b0-83"><a href="#d3e050b0-83" aria-hidden="true" tabindex="-1"></a>            <span class="st">"model__n_estimators"</span>: [<span class="dv">50</span>, <span class="dv">100</span>, <span class="dv">200</span>, <span class="dv">300</span>],</span>
<span id="d3e050b0-84"><a href="#d3e050b0-84" aria-hidden="true" tabindex="-1"></a>            <span class="st">"model__max_depth"</span>: [<span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">25</span>],</span>
<span id="d3e050b0-85"><a href="#d3e050b0-85" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="d3e050b0-86"><a href="#d3e050b0-86" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="d3e050b0-87"><a href="#d3e050b0-87" aria-hidden="true" tabindex="-1"></a>    (LogisticRegression(random_state<span class="op">=</span><span class="dv">42</span>), {<span class="st">"model__C"</span>: [<span class="fl">0.1</span>, <span class="dv">1</span>, <span class="dv">10</span>]}),</span>
<span id="d3e050b0-88"><a href="#d3e050b0-88" aria-hidden="true" tabindex="-1"></a>    (</span>
<span id="d3e050b0-89"><a href="#d3e050b0-89" aria-hidden="true" tabindex="-1"></a>        GradientBoostingClassifier(random_state<span class="op">=</span><span class="dv">42</span>),</span>
<span id="d3e050b0-90"><a href="#d3e050b0-90" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="d3e050b0-91"><a href="#d3e050b0-91" aria-hidden="true" tabindex="-1"></a>            <span class="st">"model__n_estimators"</span>: [<span class="dv">50</span>, <span class="dv">100</span>, <span class="dv">200</span>, <span class="dv">300</span>],</span>
<span id="d3e050b0-92"><a href="#d3e050b0-92" aria-hidden="true" tabindex="-1"></a>            <span class="st">"model__max_depth"</span>: [<span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">11</span>, <span class="dv">13</span>],</span>
<span id="d3e050b0-93"><a href="#d3e050b0-93" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="d3e050b0-94"><a href="#d3e050b0-94" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="d3e050b0-95"><a href="#d3e050b0-95" aria-hidden="true" tabindex="-1"></a>    (</span>
<span id="d3e050b0-96"><a href="#d3e050b0-96" aria-hidden="true" tabindex="-1"></a>        SVC(random_state<span class="op">=</span><span class="dv">42</span>, probability<span class="op">=</span><span class="va">True</span>),</span>
<span id="d3e050b0-97"><a href="#d3e050b0-97" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="d3e050b0-98"><a href="#d3e050b0-98" aria-hidden="true" tabindex="-1"></a>            <span class="st">"model__C"</span>: [<span class="fl">0.1</span>, <span class="dv">1</span>, <span class="dv">10</span>],</span>
<span id="d3e050b0-99"><a href="#d3e050b0-99" aria-hidden="true" tabindex="-1"></a>            <span class="st">"model__gamma"</span>: [<span class="st">"scale"</span>, <span class="st">"auto"</span>],</span>
<span id="d3e050b0-100"><a href="#d3e050b0-100" aria-hidden="true" tabindex="-1"></a>            <span class="st">"model__kernel"</span>: [<span class="st">"linear"</span>, <span class="st">"rbf"</span>, <span class="st">"poly"</span>],</span>
<span id="d3e050b0-101"><a href="#d3e050b0-101" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="d3e050b0-102"><a href="#d3e050b0-102" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="d3e050b0-103"><a href="#d3e050b0-103" aria-hidden="true" tabindex="-1"></a>    (</span>
<span id="d3e050b0-104"><a href="#d3e050b0-104" aria-hidden="true" tabindex="-1"></a>        KNeighborsClassifier(),</span>
<span id="d3e050b0-105"><a href="#d3e050b0-105" aria-hidden="true" tabindex="-1"></a>        {<span class="st">"model__n_neighbors"</span>: [<span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">9</span>], <span class="st">"model__weights"</span>: [<span class="st">"uniform"</span>, <span class="st">"distance"</span>]},</span>
<span id="d3e050b0-106"><a href="#d3e050b0-106" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="d3e050b0-107"><a href="#d3e050b0-107" aria-hidden="true" tabindex="-1"></a>    (GaussianNB(), {}),</span>
<span id="d3e050b0-108"><a href="#d3e050b0-108" aria-hidden="true" tabindex="-1"></a>    (</span>
<span id="d3e050b0-109"><a href="#d3e050b0-109" aria-hidden="true" tabindex="-1"></a>        XGBClassifier(random_state<span class="op">=</span><span class="dv">42</span>),</span>
<span id="d3e050b0-110"><a href="#d3e050b0-110" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="d3e050b0-111"><a href="#d3e050b0-111" aria-hidden="true" tabindex="-1"></a>            <span class="st">"model__n_estimators"</span>: [<span class="dv">50</span>, <span class="dv">100</span>, <span class="dv">200</span>, <span class="dv">300</span>],</span>
<span id="d3e050b0-112"><a href="#d3e050b0-112" aria-hidden="true" tabindex="-1"></a>            <span class="st">"model__max_depth"</span>: [<span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">9</span>],</span>
<span id="d3e050b0-113"><a href="#d3e050b0-113" aria-hidden="true" tabindex="-1"></a>            <span class="st">"model__learning_rate"</span>: [<span class="fl">0.01</span>, <span class="fl">0.1</span>, <span class="fl">0.2</span>],</span>
<span id="d3e050b0-114"><a href="#d3e050b0-114" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="d3e050b0-115"><a href="#d3e050b0-115" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="d3e050b0-116"><a href="#d3e050b0-116" aria-hidden="true" tabindex="-1"></a>    (</span>
<span id="d3e050b0-117"><a href="#d3e050b0-117" aria-hidden="true" tabindex="-1"></a>        AdaBoostClassifier(algorithm<span class="op">=</span><span class="st">"SAMME"</span>, random_state<span class="op">=</span><span class="dv">42</span>),</span>
<span id="d3e050b0-118"><a href="#d3e050b0-118" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="d3e050b0-119"><a href="#d3e050b0-119" aria-hidden="true" tabindex="-1"></a>            <span class="st">"model__n_estimators"</span>: [<span class="dv">50</span>, <span class="dv">100</span>, <span class="dv">200</span>, <span class="dv">300</span>],</span>
<span id="d3e050b0-120"><a href="#d3e050b0-120" aria-hidden="true" tabindex="-1"></a>            <span class="st">"model__learning_rate"</span>: [<span class="fl">0.01</span>, <span class="fl">0.1</span>, <span class="dv">1</span>],</span>
<span id="d3e050b0-121"><a href="#d3e050b0-121" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="d3e050b0-122"><a href="#d3e050b0-122" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="d3e050b0-123"><a href="#d3e050b0-123" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="d3e050b0-124"><a href="#d3e050b0-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="d3e050b0-125"><a href="#d3e050b0-125" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform Grid Search for each model</span></span>
<span id="d3e050b0-126"><a href="#d3e050b0-126" aria-hidden="true" tabindex="-1"></a>grid_results <span class="op">=</span> []</span>
<span id="d3e050b0-127"><a href="#d3e050b0-127" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> model, param_grid <span class="kw">in</span> models_and_params:</span>
<span id="d3e050b0-128"><a href="#d3e050b0-128" aria-hidden="true" tabindex="-1"></a>    grid_search <span class="op">=</span> create_and_fit_model(</span>
<span id="d3e050b0-129"><a href="#d3e050b0-129" aria-hidden="true" tabindex="-1"></a>        model,</span>
<span id="d3e050b0-130"><a href="#d3e050b0-130" aria-hidden="true" tabindex="-1"></a>        param_grid,</span>
<span id="d3e050b0-131"><a href="#d3e050b0-131" aria-hidden="true" tabindex="-1"></a>        X_train,</span>
<span id="d3e050b0-132"><a href="#d3e050b0-132" aria-hidden="true" tabindex="-1"></a>        y_train,</span>
<span id="d3e050b0-133"><a href="#d3e050b0-133" aria-hidden="true" tabindex="-1"></a>        feature_scaler_mapping,</span>
<span id="d3e050b0-134"><a href="#d3e050b0-134" aria-hidden="true" tabindex="-1"></a>        default_scaler,</span>
<span id="d3e050b0-135"><a href="#d3e050b0-135" aria-hidden="true" tabindex="-1"></a>        all_features,</span>
<span id="d3e050b0-136"><a href="#d3e050b0-136" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="d3e050b0-137"><a href="#d3e050b0-137" aria-hidden="true" tabindex="-1"></a>    grid_results.append(grid_search)</span>
<span id="d3e050b0-138"><a href="#d3e050b0-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="d3e050b0-139"><a href="#d3e050b0-139" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the fitted models</span></span>
<span id="d3e050b0-140"><a href="#d3e050b0-140" aria-hidden="true" tabindex="-1"></a>rf_grid, lr_grid, gb_grid, svc_grid, knn_grid, nb_grid, xgb_grid, ada_grid <span class="op">=</span> (</span>
<span id="d3e050b0-141"><a href="#d3e050b0-141" aria-hidden="true" tabindex="-1"></a>    grid_results</span>
<span id="d3e050b0-142"><a href="#d3e050b0-142" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We have done a grid search over a few different models, let us checkl the results of the evaluation:</p>
<div id="72899327" class="cell" data-execution_count="18">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="72899327"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="72899327-1"><a href="#72899327-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Model names</span></span>
<span id="72899327-2"><a href="#72899327-2" aria-hidden="true" tabindex="-1"></a>model_names <span class="op">=</span> [</span>
<span id="72899327-3"><a href="#72899327-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Random Forest"</span>,</span>
<span id="72899327-4"><a href="#72899327-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Logistic Regression"</span>,</span>
<span id="72899327-5"><a href="#72899327-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Gradient Boosting"</span>,</span>
<span id="72899327-6"><a href="#72899327-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SVM"</span>,</span>
<span id="72899327-7"><a href="#72899327-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"KNN"</span>,</span>
<span id="72899327-8"><a href="#72899327-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Naive Bayes"</span>,</span>
<span id="72899327-9"><a href="#72899327-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"XGBoost"</span>,</span>
<span id="72899327-10"><a href="#72899327-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"AdaBoost"</span>,</span>
<span id="72899327-11"><a href="#72899327-11" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="72899327-12"><a href="#72899327-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="72899327-13"><a href="#72899327-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Best scores</span></span>
<span id="72899327-14"><a href="#72899327-14" aria-hidden="true" tabindex="-1"></a>best_scores <span class="op">=</span> [</span>
<span id="72899327-15"><a href="#72899327-15" aria-hidden="true" tabindex="-1"></a>    rf_grid.best_score_,</span>
<span id="72899327-16"><a href="#72899327-16" aria-hidden="true" tabindex="-1"></a>    lr_grid.best_score_,</span>
<span id="72899327-17"><a href="#72899327-17" aria-hidden="true" tabindex="-1"></a>    gb_grid.best_score_,</span>
<span id="72899327-18"><a href="#72899327-18" aria-hidden="true" tabindex="-1"></a>    svc_grid.best_score_,</span>
<span id="72899327-19"><a href="#72899327-19" aria-hidden="true" tabindex="-1"></a>    knn_grid.best_score_,</span>
<span id="72899327-20"><a href="#72899327-20" aria-hidden="true" tabindex="-1"></a>    nb_grid.best_score_,</span>
<span id="72899327-21"><a href="#72899327-21" aria-hidden="true" tabindex="-1"></a>    xgb_grid.best_score_,</span>
<span id="72899327-22"><a href="#72899327-22" aria-hidden="true" tabindex="-1"></a>    ada_grid.best_score_,</span>
<span id="72899327-23"><a href="#72899327-23" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="72899327-24"><a href="#72899327-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="72899327-25"><a href="#72899327-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting best scores</span></span>
<span id="72899327-26"><a href="#72899327-26" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="72899327-27"><a href="#72899327-27" aria-hidden="true" tabindex="-1"></a>plt.barh(model_names, best_scores, color<span class="op">=</span><span class="st">"lightgreen"</span>)</span>
<span id="72899327-28"><a href="#72899327-28" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Best Score"</span>)</span>
<span id="72899327-29"><a href="#72899327-29" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Best Cross-Validated Scores for Each Model"</span>)</span>
<span id="72899327-30"><a href="#72899327-30" aria-hidden="true" tabindex="-1"></a>plt.xlim(<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="72899327-31"><a href="#72899327-31" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> index, value <span class="kw">in</span> <span class="bu">enumerate</span>(best_scores):</span>
<span id="72899327-32"><a href="#72899327-32" aria-hidden="true" tabindex="-1"></a>    plt.text(value, index, <span class="ss">f"</span><span class="sc">{</span>value<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="72899327-33"><a href="#72899327-33" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/cell-18-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5"><img src="index_files/figure-html/cell-18-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<p>Keep in mind that these results are based on the training set and cross-validation, and may not generalize to the holdout set. It is clear that three models stand out: Random Forest, Gradient Boosting, and XGBoost.</p>
<p>Later we will evaluate these models on the holdout set to get a more accurate estimate of their performance, first let us look at the hyper-parameter values for the best models.</p>
<div id="73dcefcf" class="cell" data-execution_count="19">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="73dcefcf"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="73dcefcf-1"><a href="#73dcefcf-1" aria-hidden="true" tabindex="-1"></a>model_names <span class="op">=</span> [</span>
<span id="73dcefcf-2"><a href="#73dcefcf-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Random Forest"</span>,</span>
<span id="73dcefcf-3"><a href="#73dcefcf-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Gradient Boosting"</span>,</span>
<span id="73dcefcf-4"><a href="#73dcefcf-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"XGBoost"</span>,</span>
<span id="73dcefcf-5"><a href="#73dcefcf-5" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="73dcefcf-6"><a href="#73dcefcf-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="73dcefcf-7"><a href="#73dcefcf-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Collecting best parameters</span></span>
<span id="73dcefcf-8"><a href="#73dcefcf-8" aria-hidden="true" tabindex="-1"></a>best_params <span class="op">=</span> [rf_grid.best_params_, gb_grid.best_params_, xgb_grid.best_params_]</span>
<span id="73dcefcf-9"><a href="#73dcefcf-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="73dcefcf-10"><a href="#73dcefcf-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Converting to a DataFrame for better visualization</span></span>
<span id="73dcefcf-11"><a href="#73dcefcf-11" aria-hidden="true" tabindex="-1"></a>params_df <span class="op">=</span> pd.DataFrame(best_params, index<span class="op">=</span>model_names)</span>
<span id="73dcefcf-12"><a href="#73dcefcf-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="73dcefcf-13"><a href="#73dcefcf-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the best parameters for each model</span></span>
<span id="73dcefcf-14"><a href="#73dcefcf-14" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="73dcefcf-15"><a href="#73dcefcf-15" aria-hidden="true" tabindex="-1"></a>ax.axis(<span class="st">"off"</span>)</span>
<span id="73dcefcf-16"><a href="#73dcefcf-16" aria-hidden="true" tabindex="-1"></a>tbl <span class="op">=</span> ax.table(</span>
<span id="73dcefcf-17"><a href="#73dcefcf-17" aria-hidden="true" tabindex="-1"></a>    cellText<span class="op">=</span>params_df.values,</span>
<span id="73dcefcf-18"><a href="#73dcefcf-18" aria-hidden="true" tabindex="-1"></a>    colLabels<span class="op">=</span>params_df.columns,</span>
<span id="73dcefcf-19"><a href="#73dcefcf-19" aria-hidden="true" tabindex="-1"></a>    rowLabels<span class="op">=</span>params_df.index,</span>
<span id="73dcefcf-20"><a href="#73dcefcf-20" aria-hidden="true" tabindex="-1"></a>    cellLoc<span class="op">=</span><span class="st">"center"</span>,</span>
<span id="73dcefcf-21"><a href="#73dcefcf-21" aria-hidden="true" tabindex="-1"></a>    loc<span class="op">=</span><span class="st">"center"</span>,</span>
<span id="73dcefcf-22"><a href="#73dcefcf-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="73dcefcf-23"><a href="#73dcefcf-23" aria-hidden="true" tabindex="-1"></a>tbl.auto_set_font_size(<span class="va">False</span>)</span>
<span id="73dcefcf-24"><a href="#73dcefcf-24" aria-hidden="true" tabindex="-1"></a>tbl.set_fontsize(<span class="dv">10</span>)</span>
<span id="73dcefcf-25"><a href="#73dcefcf-25" aria-hidden="true" tabindex="-1"></a>tbl.scale(<span class="fl">1.0</span>, <span class="fl">1.2</span>)</span>
<span id="73dcefcf-26"><a href="#73dcefcf-26" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Best Hyperparameters for Each Model"</span>)</span>
<span id="73dcefcf-27"><a href="#73dcefcf-27" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/cell-19-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6"><img src="index_files/figure-html/cell-19-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="understanding-the-most-important-features" class="level3">
<h3 class="anchored" data-anchor-id="understanding-the-most-important-features">Understanding the most important features</h3>
<p>Feature importance is a critical aspect of model interpretation, as it helps identify the key factors driving the predictions. By analyzing the importance of each feature, we can gain insights into the underlying relationships between the input variables and the target variable. This information is valuable for understanding the model’s decision-making process and identifying areas for improvement.</p>
<div id="a4ce05d6" class="cell" data-execution_count="20">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="a4ce05d6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="a4ce05d6-1"><a href="#a4ce05d6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Show feature importance for Random Forest, Gradient Boosting and XGBoost</span></span>
<span id="a4ce05d6-2"><a href="#a4ce05d6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="a4ce05d6-3"><a href="#a4ce05d6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract feature importances</span></span>
<span id="a4ce05d6-4"><a href="#a4ce05d6-4" aria-hidden="true" tabindex="-1"></a>rf_feature_importances <span class="op">=</span> rf_grid.best_estimator_[<span class="st">"model"</span>].feature_importances_</span>
<span id="a4ce05d6-5"><a href="#a4ce05d6-5" aria-hidden="true" tabindex="-1"></a>gb_feature_importances <span class="op">=</span> gb_grid.best_estimator_[<span class="st">"model"</span>].feature_importances_</span>
<span id="a4ce05d6-6"><a href="#a4ce05d6-6" aria-hidden="true" tabindex="-1"></a>xgb_feature_importances <span class="op">=</span> xgb_grid.best_estimator_[<span class="st">"model"</span>].feature_importances_</span>
<span id="a4ce05d6-7"><a href="#a4ce05d6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="a4ce05d6-8"><a href="#a4ce05d6-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Create DataFrames for feature importances</span></span>
<span id="a4ce05d6-9"><a href="#a4ce05d6-9" aria-hidden="true" tabindex="-1"></a>rf_feature_importances_df <span class="op">=</span> pd.DataFrame(</span>
<span id="a4ce05d6-10"><a href="#a4ce05d6-10" aria-hidden="true" tabindex="-1"></a>    rf_feature_importances, index<span class="op">=</span>all_features, columns<span class="op">=</span>[<span class="st">"Importance"</span>]</span>
<span id="a4ce05d6-11"><a href="#a4ce05d6-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="a4ce05d6-12"><a href="#a4ce05d6-12" aria-hidden="true" tabindex="-1"></a>gb_feature_importances_df <span class="op">=</span> pd.DataFrame(</span>
<span id="a4ce05d6-13"><a href="#a4ce05d6-13" aria-hidden="true" tabindex="-1"></a>    gb_feature_importances, index<span class="op">=</span>all_features, columns<span class="op">=</span>[<span class="st">"Importance"</span>]</span>
<span id="a4ce05d6-14"><a href="#a4ce05d6-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="a4ce05d6-15"><a href="#a4ce05d6-15" aria-hidden="true" tabindex="-1"></a>xgb_feature_importances_df <span class="op">=</span> pd.DataFrame(</span>
<span id="a4ce05d6-16"><a href="#a4ce05d6-16" aria-hidden="true" tabindex="-1"></a>    xgb_feature_importances, index<span class="op">=</span>all_features, columns<span class="op">=</span>[<span class="st">"Importance"</span>]</span>
<span id="a4ce05d6-17"><a href="#a4ce05d6-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="a4ce05d6-18"><a href="#a4ce05d6-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="a4ce05d6-19"><a href="#a4ce05d6-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort the DataFrames by importance</span></span>
<span id="a4ce05d6-20"><a href="#a4ce05d6-20" aria-hidden="true" tabindex="-1"></a>rf_feature_importances_df <span class="op">=</span> rf_feature_importances_df.sort_values(</span>
<span id="a4ce05d6-21"><a href="#a4ce05d6-21" aria-hidden="true" tabindex="-1"></a>    by<span class="op">=</span><span class="st">"Importance"</span>, ascending<span class="op">=</span><span class="va">False</span></span>
<span id="a4ce05d6-22"><a href="#a4ce05d6-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="a4ce05d6-23"><a href="#a4ce05d6-23" aria-hidden="true" tabindex="-1"></a>gb_feature_importances_df <span class="op">=</span> gb_feature_importances_df.sort_values(</span>
<span id="a4ce05d6-24"><a href="#a4ce05d6-24" aria-hidden="true" tabindex="-1"></a>    by<span class="op">=</span><span class="st">"Importance"</span>, ascending<span class="op">=</span><span class="va">False</span></span>
<span id="a4ce05d6-25"><a href="#a4ce05d6-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="a4ce05d6-26"><a href="#a4ce05d6-26" aria-hidden="true" tabindex="-1"></a>xgb_feature_importances_df <span class="op">=</span> xgb_feature_importances_df.sort_values(</span>
<span id="a4ce05d6-27"><a href="#a4ce05d6-27" aria-hidden="true" tabindex="-1"></a>    by<span class="op">=</span><span class="st">"Importance"</span>, ascending<span class="op">=</span><span class="va">False</span></span>
<span id="a4ce05d6-28"><a href="#a4ce05d6-28" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="a4ce05d6-29"><a href="#a4ce05d6-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="a4ce05d6-30"><a href="#a4ce05d6-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the feature importances</span></span>
<span id="a4ce05d6-31"><a href="#a4ce05d6-31" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="a4ce05d6-32"><a href="#a4ce05d6-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="a4ce05d6-33"><a href="#a4ce05d6-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Random Forest</span></span>
<span id="a4ce05d6-34"><a href="#a4ce05d6-34" aria-hidden="true" tabindex="-1"></a>rf_plot <span class="op">=</span> sns.barplot(</span>
<span id="a4ce05d6-35"><a href="#a4ce05d6-35" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"Importance"</span>,</span>
<span id="a4ce05d6-36"><a href="#a4ce05d6-36" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span>rf_feature_importances_df.index,</span>
<span id="a4ce05d6-37"><a href="#a4ce05d6-37" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>rf_feature_importances_df,</span>
<span id="a4ce05d6-38"><a href="#a4ce05d6-38" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>ax[<span class="dv">0</span>],</span>
<span id="a4ce05d6-39"><a href="#a4ce05d6-39" aria-hidden="true" tabindex="-1"></a>    palette<span class="op">=</span><span class="st">"summer"</span>,</span>
<span id="a4ce05d6-40"><a href="#a4ce05d6-40" aria-hidden="true" tabindex="-1"></a>    hue<span class="op">=</span>rf_feature_importances_df.index,</span>
<span id="a4ce05d6-41"><a href="#a4ce05d6-41" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="a4ce05d6-42"><a href="#a4ce05d6-42" aria-hidden="true" tabindex="-1"></a>rf_plot.set_title(<span class="st">"Random Forest Feature Importances"</span>)</span>
<span id="a4ce05d6-43"><a href="#a4ce05d6-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="a4ce05d6-44"><a href="#a4ce05d6-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Gradient Boosting</span></span>
<span id="a4ce05d6-45"><a href="#a4ce05d6-45" aria-hidden="true" tabindex="-1"></a>gb_plot <span class="op">=</span> sns.barplot(</span>
<span id="a4ce05d6-46"><a href="#a4ce05d6-46" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"Importance"</span>,</span>
<span id="a4ce05d6-47"><a href="#a4ce05d6-47" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span>gb_feature_importances_df.index,</span>
<span id="a4ce05d6-48"><a href="#a4ce05d6-48" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>gb_feature_importances_df,</span>
<span id="a4ce05d6-49"><a href="#a4ce05d6-49" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>ax[<span class="dv">1</span>],</span>
<span id="a4ce05d6-50"><a href="#a4ce05d6-50" aria-hidden="true" tabindex="-1"></a>    palette<span class="op">=</span><span class="st">"summer"</span>,</span>
<span id="a4ce05d6-51"><a href="#a4ce05d6-51" aria-hidden="true" tabindex="-1"></a>    hue<span class="op">=</span>gb_feature_importances_df.index,</span>
<span id="a4ce05d6-52"><a href="#a4ce05d6-52" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="a4ce05d6-53"><a href="#a4ce05d6-53" aria-hidden="true" tabindex="-1"></a>gb_plot.set_title(<span class="st">"Gradient Boosting Feature Importances"</span>)</span>
<span id="a4ce05d6-54"><a href="#a4ce05d6-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="a4ce05d6-55"><a href="#a4ce05d6-55" aria-hidden="true" tabindex="-1"></a><span class="co"># XGBoost</span></span>
<span id="a4ce05d6-56"><a href="#a4ce05d6-56" aria-hidden="true" tabindex="-1"></a>xgb_plot <span class="op">=</span> sns.barplot(</span>
<span id="a4ce05d6-57"><a href="#a4ce05d6-57" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"Importance"</span>,</span>
<span id="a4ce05d6-58"><a href="#a4ce05d6-58" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span>xgb_feature_importances_df.index,</span>
<span id="a4ce05d6-59"><a href="#a4ce05d6-59" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>xgb_feature_importances_df,</span>
<span id="a4ce05d6-60"><a href="#a4ce05d6-60" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>ax[<span class="dv">2</span>],</span>
<span id="a4ce05d6-61"><a href="#a4ce05d6-61" aria-hidden="true" tabindex="-1"></a>    palette<span class="op">=</span><span class="st">"summer"</span>,</span>
<span id="a4ce05d6-62"><a href="#a4ce05d6-62" aria-hidden="true" tabindex="-1"></a>    hue<span class="op">=</span>xgb_feature_importances_df.index,</span>
<span id="a4ce05d6-63"><a href="#a4ce05d6-63" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="a4ce05d6-64"><a href="#a4ce05d6-64" aria-hidden="true" tabindex="-1"></a>xgb_plot.set_title(<span class="st">"XGBoost Feature Importances"</span>)</span>
<span id="a4ce05d6-65"><a href="#a4ce05d6-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="a4ce05d6-66"><a href="#a4ce05d6-66" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_ylabel(<span class="st">""</span>)</span>
<span id="a4ce05d6-67"><a href="#a4ce05d6-67" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_ylabel(<span class="st">""</span>)</span>
<span id="a4ce05d6-68"><a href="#a4ce05d6-68" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">2</span>].set_ylabel(<span class="st">""</span>)</span>
<span id="a4ce05d6-69"><a href="#a4ce05d6-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="a4ce05d6-70"><a href="#a4ce05d6-70" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="a4ce05d6-71"><a href="#a4ce05d6-71" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/cell-20-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7"><img src="index_files/figure-html/cell-20-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<p>Interestingly, each model has identified different features as the most important for predicting customer churn, with <code>Age</code>, <code>Balance</code> and <code>NumOfProducts</code> appearing as dominating features. This suggests that the models are capturing different aspects of the data and may have varying strengths and weaknesses.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
About Different Feature Importance for Different Models
</div>
</div>
<div class="callout-body-container callout-body">
<p>When different models highlight different feature importances for the same trained dataset, it generally indicates a few key points. Different models have different ways of processing and interpreting data. For instance, linear models like logistic regression evaluate features based on their linear relationship with the target variable, while tree-based models like random forests or gradient boosting can capture non-linear relationships and interactions between features. Some models can capture interactions better than others.</p>
<p>Some models might be more sensitive to certain aspects of the data. Models like neural networks can capture complex patterns but might also overfit to noise, whereas simpler models might miss these patterns but provide more stable feature importances. Different models employ various regularization techniques that can influence feature importance. For instance, Lasso regression penalizes the absolute size of coefficients, potentially zeroing out some features entirely, while Ridge regression penalizes the squared size, retaining more features but with smaller coefficients. Each model has its own bias-variance trade-off. A model with high bias, such as linear regression, might show feature importances that suggest a simpler relationship, while a model with low bias, like a complex neural network, might indicate a more nuanced understanding of feature importance, potentially highlighting more features as important.</p>
<p>To make sense of differing feature importances, consider combining them from multiple models to get a more robust understanding. Use model interpretation tools like SHAP (SHapley Additive exPlanations) or LIME (Local Interpretable Model-agnostic Explanations) which provide model-agnostic feature importance explanations. Additionally, leverage domain expertise to understand which features are likely to be important, regardless of model output.</p>
</div>
</div>
</section>
</section>
<section id="model-evaluation-on-the-holdout-set" class="level2">
<h2 class="anchored" data-anchor-id="model-evaluation-on-the-holdout-set">Model evaluation on the holdout set</h2>
<p>As a final step, let us now evaluate the best models on the holdout set to get a more accurate estimate of their performance. We will calculate various metrics such as accuracy, precision, recall, and F1 score to assess the models’ performance in predicting customer churn.</p>
<div id="b4627ab6" class="cell" data-execution_count="21">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="b4627ab6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="b4627ab6-1"><a href="#b4627ab6-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> classification_report</span>
<span id="b4627ab6-2"><a href="#b4627ab6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="b4627ab6-3"><a href="#b4627ab6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="b4627ab6-4"><a href="#b4627ab6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to convert classification report to a DataFrame</span></span>
<span id="b4627ab6-5"><a href="#b4627ab6-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> classification_report_to_df(report):</span>
<span id="b4627ab6-6"><a href="#b4627ab6-6" aria-hidden="true" tabindex="-1"></a>    report_dict <span class="op">=</span> classification_report(y_holdout, report, output_dict<span class="op">=</span><span class="va">True</span>)</span>
<span id="b4627ab6-7"><a href="#b4627ab6-7" aria-hidden="true" tabindex="-1"></a>    report_df <span class="op">=</span> pd.DataFrame(report_dict).transpose()</span>
<span id="b4627ab6-8"><a href="#b4627ab6-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> report_df</span>
<span id="b4627ab6-9"><a href="#b4627ab6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="b4627ab6-10"><a href="#b4627ab6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="b4627ab6-11"><a href="#b4627ab6-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict the target variable using the best models</span></span>
<span id="b4627ab6-12"><a href="#b4627ab6-12" aria-hidden="true" tabindex="-1"></a>rf_test_pred <span class="op">=</span> rf_grid.predict(X_holdout)</span>
<span id="b4627ab6-13"><a href="#b4627ab6-13" aria-hidden="true" tabindex="-1"></a>gb_test_pred <span class="op">=</span> gb_grid.predict(X_holdout)</span>
<span id="b4627ab6-14"><a href="#b4627ab6-14" aria-hidden="true" tabindex="-1"></a>xgb_test_pred <span class="op">=</span> xgb_grid.predict(X_holdout)</span>
<span id="b4627ab6-15"><a href="#b4627ab6-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="b4627ab6-16"><a href="#b4627ab6-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Create classification report dataframes</span></span>
<span id="b4627ab6-17"><a href="#b4627ab6-17" aria-hidden="true" tabindex="-1"></a>rf_report_df <span class="op">=</span> classification_report_to_df(rf_test_pred)</span>
<span id="b4627ab6-18"><a href="#b4627ab6-18" aria-hidden="true" tabindex="-1"></a>gb_report_df <span class="op">=</span> classification_report_to_df(gb_test_pred)</span>
<span id="b4627ab6-19"><a href="#b4627ab6-19" aria-hidden="true" tabindex="-1"></a>xgb_report_df <span class="op">=</span> classification_report_to_df(xgb_test_pred)</span>
<span id="b4627ab6-20"><a href="#b4627ab6-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="b4627ab6-21"><a href="#b4627ab6-21" aria-hidden="true" tabindex="-1"></a><span class="co"># List of model names and their reports</span></span>
<span id="b4627ab6-22"><a href="#b4627ab6-22" aria-hidden="true" tabindex="-1"></a>models_and_reports <span class="op">=</span> [</span>
<span id="b4627ab6-23"><a href="#b4627ab6-23" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"Random Forest"</span>, rf_report_df),</span>
<span id="b4627ab6-24"><a href="#b4627ab6-24" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"Gradient Boosting"</span>, gb_report_df),</span>
<span id="b4627ab6-25"><a href="#b4627ab6-25" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"XGBoost"</span>, xgb_report_df),</span>
<span id="b4627ab6-26"><a href="#b4627ab6-26" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="b4627ab6-27"><a href="#b4627ab6-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="b4627ab6-28"><a href="#b4627ab6-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the classification reports on a grid</span></span>
<span id="b4627ab6-29"><a href="#b4627ab6-29" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">9</span>, <span class="dv">6</span>))</span>
<span id="b4627ab6-30"><a href="#b4627ab6-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="b4627ab6-31"><a href="#b4627ab6-31" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (model_name, report_df), ax <span class="kw">in</span> <span class="bu">zip</span>(models_and_reports, axes.flatten()):</span>
<span id="b4627ab6-32"><a href="#b4627ab6-32" aria-hidden="true" tabindex="-1"></a>    sns.heatmap(</span>
<span id="b4627ab6-33"><a href="#b4627ab6-33" aria-hidden="true" tabindex="-1"></a>        report_df.iloc[:<span class="op">-</span><span class="dv">1</span>, :<span class="op">-</span><span class="dv">1</span>],</span>
<span id="b4627ab6-34"><a href="#b4627ab6-34" aria-hidden="true" tabindex="-1"></a>        annot<span class="op">=</span><span class="va">True</span>,</span>
<span id="b4627ab6-35"><a href="#b4627ab6-35" aria-hidden="true" tabindex="-1"></a>        fmt<span class="op">=</span><span class="st">".2f"</span>,</span>
<span id="b4627ab6-36"><a href="#b4627ab6-36" aria-hidden="true" tabindex="-1"></a>        cmap<span class="op">=</span><span class="st">"summer_r"</span>,</span>
<span id="b4627ab6-37"><a href="#b4627ab6-37" aria-hidden="true" tabindex="-1"></a>        cbar<span class="op">=</span><span class="va">False</span>,</span>
<span id="b4627ab6-38"><a href="#b4627ab6-38" aria-hidden="true" tabindex="-1"></a>        ax<span class="op">=</span>ax,</span>
<span id="b4627ab6-39"><a href="#b4627ab6-39" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="b4627ab6-40"><a href="#b4627ab6-40" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="ss">f"</span><span class="sc">{</span>model_name<span class="sc">}</span><span class="ss"> Classification Report"</span>)</span>
<span id="b4627ab6-41"><a href="#b4627ab6-41" aria-hidden="true" tabindex="-1"></a>    ax.set_ylabel(<span class="st">"Metrics"</span>)</span>
<span id="b4627ab6-42"><a href="#b4627ab6-42" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(<span class="st">"Classes"</span>)</span>
<span id="b4627ab6-43"><a href="#b4627ab6-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="b4627ab6-44"><a href="#b4627ab6-44" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="b4627ab6-45"><a href="#b4627ab6-45" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/cell-21-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-8"><img src="index_files/figure-html/cell-21-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<p>The best performing model on the holdout set is Gradient Boosting, with an accuracy score of 0.83. This model also shows relatively balanced precision and recall values, achieving a precision of 0.90 and recall of 0.88 for the negative class, and 0.58 precision and 0.63 recall for the positive class. The F1-score, which is the harmonic mean of precision and recall, is 0.89 for the negative class and 0.60 for the positive class.</p>
<p>The Random Forest and XGBoost models also perform well, each with an accuracy score of 0.81 and 0.82, respectively. However, both models exhibit lower precision and recall for the positive class compared to Gradient Boosting. The Random Forest model has a precision of 0.54 and recall of 0.64 for the positive class, while XGBoost shows a precision of 0.56 and recall of 0.62 for the same class.</p>
<p>The overall macro average metrics (precision, recall, and F1-score) indicate that Gradient Boosting slightly outperforms the other models, providing a balanced performance across different metrics. This makes Gradient Boosting the most reliable model among the three for this particular dataset, especially considering the trade-offs between precision and recall for both classes.</p>
<p>Let’s now plot the ROC curve and calculate the AUC score for the best models, to assess their performance further.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
About the ROC curve
</div>
</div>
<div class="callout-body-container callout-body">
<p>The ROC (Receiver Operating Characteristic) curve is a graphical representation used to evaluate the performance of a binary classification model. It plots the True Positive Rate (TPR) against the False Positive Rate (FPR) at various threshold settings.</p>
<p>The True Positive Rate, also known as sensitivity or recall, is calculated as:</p>
<p><span class="math display">\[
\text{TPR} = \frac{\text{TP}}{\text{TP} + \text{FN}}
\]</span></p>
<p>where <span class="math inline">\(\text{TP}\)</span> is the number of true positives and <span class="math inline">\(\text{FN}\)</span> is the number of false negatives.</p>
<p>The False Positive Rate is calculated as:</p>
<p><span class="math display">\[
\text{FPR} = \frac{\text{FP}}{\text{FP} + \text{TN}}
\]</span></p>
<p>where <span class="math inline">\(\text{FP}\)</span> is the number of false positives and <span class="math inline">\(\text{TN}\)</span> is the number of true negatives.</p>
<p>The ROC curve illustrates the trade-off between sensitivity (recall) and specificity <span class="math inline">\((1 - \text{FPR})\)</span> as the decision threshold is varied. A model with perfect classification capability would have a point in the upper left corner of the ROC space, representing 100% sensitivity and 0% false positive rate.</p>
<p>In practice, the Area Under the ROC Curve (AUC) is often used as a summary metric to quantify the overall performance of the model. An AUC value of 1 indicates a perfect model, whereas an AUC value of 0.5 suggests a model with no discriminatory ability, equivalent to random guessing.</p>
<p>The ROC curve is particularly useful because it provides a comprehensive view of a model’s performance across all threshold levels, making it easier to compare different models or to choose an optimal threshold based on the specific needs of a problem. For example, in a medical diagnosis scenario, one might prefer a threshold that minimizes false negatives to ensure no case is missed, even if it means accepting more false positives.</p>
</div>
</div>
<div id="210e756b" class="cell" data-execution_count="22">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="210e756b"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="210e756b-1"><a href="#210e756b-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> roc_curve, roc_auc_score</span>
<span id="210e756b-2"><a href="#210e756b-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="210e756b-3"><a href="#210e756b-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the probabilities for each model</span></span>
<span id="210e756b-4"><a href="#210e756b-4" aria-hidden="true" tabindex="-1"></a>rf_test_probs <span class="op">=</span> rf_grid.predict_proba(X_holdout)[:, <span class="dv">1</span>]</span>
<span id="210e756b-5"><a href="#210e756b-5" aria-hidden="true" tabindex="-1"></a>gb_test_probs <span class="op">=</span> gb_grid.predict_proba(X_holdout)[:, <span class="dv">1</span>]</span>
<span id="210e756b-6"><a href="#210e756b-6" aria-hidden="true" tabindex="-1"></a>xgb_test_probs <span class="op">=</span> xgb_grid.predict_proba(X_holdout)[:, <span class="dv">1</span>]</span>
<span id="210e756b-7"><a href="#210e756b-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="210e756b-8"><a href="#210e756b-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the ROC curve for each model</span></span>
<span id="210e756b-9"><a href="#210e756b-9" aria-hidden="true" tabindex="-1"></a>rf_test_fpr, rf_test_tpr, _ <span class="op">=</span> roc_curve(y_holdout, rf_test_probs)</span>
<span id="210e756b-10"><a href="#210e756b-10" aria-hidden="true" tabindex="-1"></a>gb_test_fpr, gb_test_tpr, _ <span class="op">=</span> roc_curve(y_holdout, gb_test_probs)</span>
<span id="210e756b-11"><a href="#210e756b-11" aria-hidden="true" tabindex="-1"></a>xgb_test_fpr, xgb_test_tpr, _ <span class="op">=</span> roc_curve(y_holdout, xgb_test_probs)</span>
<span id="210e756b-12"><a href="#210e756b-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="210e756b-13"><a href="#210e756b-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the ROC AUC score for each model</span></span>
<span id="210e756b-14"><a href="#210e756b-14" aria-hidden="true" tabindex="-1"></a>rf_test_auc <span class="op">=</span> roc_auc_score(y_holdout, rf_test_probs)</span>
<span id="210e756b-15"><a href="#210e756b-15" aria-hidden="true" tabindex="-1"></a>gb_test_auc <span class="op">=</span> roc_auc_score(y_holdout, gb_test_probs)</span>
<span id="210e756b-16"><a href="#210e756b-16" aria-hidden="true" tabindex="-1"></a>xgb_test_auc <span class="op">=</span> roc_auc_score(y_holdout, xgb_test_probs)</span>
<span id="210e756b-17"><a href="#210e756b-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="210e756b-18"><a href="#210e756b-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the ROC curve for each model</span></span>
<span id="210e756b-19"><a href="#210e756b-19" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="210e756b-20"><a href="#210e756b-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="210e756b-21"><a href="#210e756b-21" aria-hidden="true" tabindex="-1"></a>plt.plot(</span>
<span id="210e756b-22"><a href="#210e756b-22" aria-hidden="true" tabindex="-1"></a>    rf_test_fpr,</span>
<span id="210e756b-23"><a href="#210e756b-23" aria-hidden="true" tabindex="-1"></a>    rf_test_tpr,</span>
<span id="210e756b-24"><a href="#210e756b-24" aria-hidden="true" tabindex="-1"></a>    label<span class="op">=</span><span class="ss">f"Random Forest Holdout AUC: </span><span class="sc">{</span>rf_test_auc<span class="sc">:.2f}</span><span class="ss">"</span>,</span>
<span id="210e756b-25"><a href="#210e756b-25" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span><span class="st">"blue"</span>,</span>
<span id="210e756b-26"><a href="#210e756b-26" aria-hidden="true" tabindex="-1"></a>    linestyle<span class="op">=</span><span class="st">"--"</span>,</span>
<span id="210e756b-27"><a href="#210e756b-27" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="210e756b-28"><a href="#210e756b-28" aria-hidden="true" tabindex="-1"></a>plt.plot(</span>
<span id="210e756b-29"><a href="#210e756b-29" aria-hidden="true" tabindex="-1"></a>    gb_test_fpr,</span>
<span id="210e756b-30"><a href="#210e756b-30" aria-hidden="true" tabindex="-1"></a>    gb_test_tpr,</span>
<span id="210e756b-31"><a href="#210e756b-31" aria-hidden="true" tabindex="-1"></a>    label<span class="op">=</span><span class="ss">f"Gradient Boosting Holdout AUC: </span><span class="sc">{</span>gb_test_auc<span class="sc">:.2f}</span><span class="ss">"</span>,</span>
<span id="210e756b-32"><a href="#210e756b-32" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span><span class="st">"green"</span>,</span>
<span id="210e756b-33"><a href="#210e756b-33" aria-hidden="true" tabindex="-1"></a>    linestyle<span class="op">=</span><span class="st">"--"</span>,</span>
<span id="210e756b-34"><a href="#210e756b-34" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="210e756b-35"><a href="#210e756b-35" aria-hidden="true" tabindex="-1"></a>plt.plot(</span>
<span id="210e756b-36"><a href="#210e756b-36" aria-hidden="true" tabindex="-1"></a>    xgb_test_fpr,</span>
<span id="210e756b-37"><a href="#210e756b-37" aria-hidden="true" tabindex="-1"></a>    xgb_test_tpr,</span>
<span id="210e756b-38"><a href="#210e756b-38" aria-hidden="true" tabindex="-1"></a>    label<span class="op">=</span><span class="ss">f"XGBoost Holdout AUC: </span><span class="sc">{</span>xgb_test_auc<span class="sc">:.2f}</span><span class="ss">"</span>,</span>
<span id="210e756b-39"><a href="#210e756b-39" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span><span class="st">"pink"</span>,</span>
<span id="210e756b-40"><a href="#210e756b-40" aria-hidden="true" tabindex="-1"></a>    linestyle<span class="op">=</span><span class="st">"--"</span>,</span>
<span id="210e756b-41"><a href="#210e756b-41" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="210e756b-42"><a href="#210e756b-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="210e756b-43"><a href="#210e756b-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the random chance line</span></span>
<span id="210e756b-44"><a href="#210e756b-44" aria-hidden="true" tabindex="-1"></a>plt.plot([<span class="dv">0</span>, <span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>], color<span class="op">=</span><span class="st">"red"</span>, linestyle<span class="op">=</span><span class="st">"--"</span>)</span>
<span id="210e756b-45"><a href="#210e756b-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="210e756b-46"><a href="#210e756b-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Add scatter points for threshold markers</span></span>
<span id="210e756b-47"><a href="#210e756b-47" aria-hidden="true" tabindex="-1"></a>plt.scatter(rf_test_fpr, rf_test_tpr, alpha<span class="op">=</span><span class="fl">0.1</span>, color<span class="op">=</span><span class="st">"blue"</span>)</span>
<span id="210e756b-48"><a href="#210e756b-48" aria-hidden="true" tabindex="-1"></a>plt.scatter(gb_test_fpr, gb_test_tpr, alpha<span class="op">=</span><span class="fl">0.1</span>, color<span class="op">=</span><span class="st">"green"</span>)</span>
<span id="210e756b-49"><a href="#210e756b-49" aria-hidden="true" tabindex="-1"></a>plt.scatter(xgb_test_fpr, xgb_test_tpr, alpha<span class="op">=</span><span class="fl">0.1</span>, color<span class="op">=</span><span class="st">"pink"</span>)</span>
<span id="210e756b-50"><a href="#210e756b-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="210e756b-51"><a href="#210e756b-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Annotate the ideal point</span></span>
<span id="210e756b-52"><a href="#210e756b-52" aria-hidden="true" tabindex="-1"></a>plt.annotate(</span>
<span id="210e756b-53"><a href="#210e756b-53" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Ideal Point"</span>,</span>
<span id="210e756b-54"><a href="#210e756b-54" aria-hidden="true" tabindex="-1"></a>    xy<span class="op">=</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="210e756b-55"><a href="#210e756b-55" aria-hidden="true" tabindex="-1"></a>    xytext<span class="op">=</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>),</span>
<span id="210e756b-56"><a href="#210e756b-56" aria-hidden="true" tabindex="-1"></a>    arrowprops<span class="op">=</span><span class="bu">dict</span>(facecolor<span class="op">=</span><span class="st">"black"</span>, shrink<span class="op">=</span><span class="fl">0.05</span>),</span>
<span id="210e756b-57"><a href="#210e756b-57" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="210e756b-58"><a href="#210e756b-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="210e756b-59"><a href="#210e756b-59" aria-hidden="true" tabindex="-1"></a><span class="co"># Axis labels</span></span>
<span id="210e756b-60"><a href="#210e756b-60" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"False Positive Rate (1 - Specificity)"</span>)</span>
<span id="210e756b-61"><a href="#210e756b-61" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"True Positive Rate (Sensitivity)"</span>)</span>
<span id="210e756b-62"><a href="#210e756b-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="210e756b-63"><a href="#210e756b-63" aria-hidden="true" tabindex="-1"></a><span class="co"># Title and grid</span></span>
<span id="210e756b-64"><a href="#210e756b-64" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'ROC Curve Comparison of Different Models</span><span class="ch">\n</span><span class="st">Predicting "Exited"'</span>)</span>
<span id="210e756b-65"><a href="#210e756b-65" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="210e756b-66"><a href="#210e756b-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="210e756b-67"><a href="#210e756b-67" aria-hidden="true" tabindex="-1"></a><span class="co"># Legend in the right bottom corner</span></span>
<span id="210e756b-68"><a href="#210e756b-68" aria-hidden="true" tabindex="-1"></a>plt.legend(loc<span class="op">=</span><span class="st">"lower right"</span>)</span>
<span id="210e756b-69"><a href="#210e756b-69" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/cell-22-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-9"><img src="index_files/figure-html/cell-22-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<p>The Random Forest model, represented by the blue dashed line, has the highest Area Under the Curve (AUC) at 0.84, indicating the best overall performance. Its curve is closer to the top-left corner, suggesting a good balance between sensitivity and specificity. Gradient Boosting, represented by the green dashed line, has an AUC of 0.83, showing good performance, though slightly less optimal than Random Forest. The XGBoost model, represented by the pink dashed line, has an AUC of 0.82, the lowest among the three but still relatively high.</p>
<p>All three models perform reasonably well, with high AUC values above 0.80, showing good discriminatory power.</p>
<section id="chosing-between-classification-reports-and-roc-curves" class="level3">
<h3 class="anchored" data-anchor-id="chosing-between-classification-reports-and-roc-curves">Chosing between classification reports and ROC curves</h3>
<p>We now have two slightly different views on the model performance - classification reports hint at Gradient Boosting being the best model, while the ROC curves suggest Random Forest is the best model. This is a common situation in machine learning, where different metrics can provide slightly different perspectives on model performance. The choice between classification reports and ROC curves depends on the specific requirements of the problem and the trade-offs between different evaluation metrics.</p>
<p>The ROC curve is particularly useful for evaluating the performance of a binary classification model across different threshold levels. It provides a comprehensive view of the trade-offs between True Positive Rate (sensitivity) and False Positive Rate (1 - specificity), and the Area Under the Curve (AUC) gives a single scalar value summarizing the model’s ability to discriminate between positive and negative classes. This makes the ROC curve ideal for comparing multiple models’ performance in a holistic manner, regardless of the decision threshold.</p>
<p>On the other hand, a model classification report offers detailed metrics at a specific threshold, including precision, recall, F1-score, and support for each class. This report is useful for understanding the model’s performance in terms of how well it predicts each class, taking into account the balance between precision and recall. It is particularly helpful when you need to focus on the performance for a particular class or understand the model’s behavior for specific error types (false positives vs.&nbsp;false negatives).</p>
<p>If you need to compare models broadly and understand their performance across various thresholds, the ROC curve is more advantageous. However, if you need detailed insights into how a model performs for each class and specific error metrics at a given threshold, a model classification report is more informative. Ideally, both tools should be used together to get a comprehensive understanding of a model’s performance.</p>
</section>
</section>
<section id="final-remarks" class="level2">
<h2 class="anchored" data-anchor-id="final-remarks">Final remarks</h2>
<p>In this experiment, we explored a classical machine learning problem: predicting customer churn. We started by loading and preprocessing the dataset, including handling missing values, encoding categorical features, and balancing the class distribution. We then performed exploratory data analysis to understand the data better, visualizing the distributions of numerical features, examining the interdependencies between features, and identifying patterns using dimensionality reduction techniques.</p>
<p>We selected three models - Random Forest, Gradient Boosting, and XGBoost - and evaluated their performance using cross-validation on the training set. We then tested the best models on a holdout set to get a more accurate estimate of their performance. The Random Forest model emerged as the best performer based on the ROC curve, while Gradient Boosting showed the best overall performance in the classification report. The XGBoost model also performed well, with slightly lower scores than the other two models.</p>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div>This work is licensed under CC BY <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">(View License)</a></div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/pedroleitao\.nl");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Written with love, take time to think and ponder.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://quarto.org">
      <i class="bi bi-arrow-through-heart" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="http://www.frankscanteen.com">
      <i class="bi bi-cup-hot" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://www.instagram.com/bilhanovarestaurante">
      <i class="bi bi-egg-fried" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>
<script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","descPosition":"bottom","loop":false,"openEffect":"zoom","selector":".lightbox"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>




</body></html>